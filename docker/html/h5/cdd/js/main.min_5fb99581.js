var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o]);i.prototype=e.prototype,t.prototype=new i},__awaiter=this&&this.__awaiter||function(t,e,i,o){return new(i||(i=Promise))(function(a,r){function n(t){try{h(o.next(t))}catch(e){r(e)}}function s(t){try{h(o["throw"](t))}catch(e){r(e)}}function h(t){t.done?a(t.value):new i(function(e){e(t.value)}).then(n,s)}h((o=o.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function i(t){return function(e){return o([t,e])}}function o(i){if(a)throw new TypeError("Generator is already executing.");for(;h;)try{if(a=1,r&&(n=r[2&i[0]?"return":i[0]?"throw":"next"])&&!(n=n.call(r,i[1])).done)return n;switch(r=0,n&&(i=[0,n.value]),i[0]){case 0:case 1:n=i;break;case 4:return h.label++,{value:i[1],done:!1};case 5:h.label++,r=i[1],i=[0];continue;case 7:i=h.ops.pop(),h.trys.pop();continue;default:if(n=h.trys,!(n=n.length>0&&n[n.length-1])&&(6===i[0]||2===i[0])){h=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){h.label=i[1];break}if(6===i[0]&&h.label<n[1]){h.label=n[1],n=i;break}if(n&&h.label<n[2]){h.label=n[2],h.ops.push(i);break}n[2]&&h.ops.pop(),h.trys.pop();continue}i=e.call(t,h)}catch(o){i=[6,o],r=0}finally{a=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var a,r,n,s,h={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return s={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},CDD;!function(t){var e=function(t){function e(e,i){return t.call(this,e,i)||this}return __extends(e,t),e.prototype.getLayer=function(){return this.viewComponent},e}(puremvc.Mediator);t.AbstractMediator=e,__reflect(e.prototype,"CDD.AbstractMediator")}(CDD||(CDD={}));var CDD;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.positionArr=[],e}return __extends(e,t),e.prototype.setData=function(t){t=card.CDDTool.sort(t),this.positionArr.length=0;for(var e=1;13>=e;e++){var i=this["hand"+e];i.name="ui"+e,remove_XY(i),i.init(),this.positionArr.push(new egret.Point(i.x,i.y))}for(var e=0;13>e;e++){var o=this["hand"+(e+1)];e<t.length?(o.updateCard(t[e]),this.positionArr.length>0?(o.x=this.positionArr[e].x,o.y=this.positionArr[e].y):(o.x=e*o.width,o.y=0),this.addChild(o)):remove_XY(o)}},e}(eui.Component);t.CDDResultHands=e,__reflect(e.prototype,"CDD.CDDResultHands")}(CDD||(CDD={}));var CDD;!function(t){function e(t,e,i){puremvc.Facade.getInstance(GameIdEnum.CDD).sendNotification(t,e,i)}function i(t){return t==I18NType.zh_tw?!0:t==I18NType.en_us?!0:!1}var o=function(i){function o(){return i.call(this,GameIdEnum.CDD)||this}return __extends(o,i),o.prototype.initializeController=function(){i.prototype.initializeController.call(this),this.registerCommand(t.CDDRegisteMVCCommand.NAME,t.CDDRegisteMVCCommand)},o.prototype.setup=function(i){this.layout||(this.layout=new t.CDDLayout(i)),e(t.CDDRegisteMVCCommand.NAME,[this.layout]),e(t.CDDGameSceneMediator.SHOW),t.dataProxy.centerConfig.replayMode?(t.dataProxy.initReplay(),t.dataProxy.replayVo.startAutoPlay(),e(t.CDDReplayMediator.SHOW)):DevelopMain.callWhenFastJoinCompleted(function(){t.sendSocketMessage(t.CDDProtocol.CDD_GET_SNAPSHOT_C)})},o.prototype.dispose=function(){this.layout&&this.layout.dispose(),this.layout=null},o}(puremvc.Facade);t.CDDFacade=o,__reflect(o.prototype,"CDD.CDDFacade"),t.sendNotification=e,t.isLanuageSupport=i}(CDD||(CDD={}));var CDD;!function(t){function e(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=t.concat();i.splice(0,0,"<"+GameIdEnum.CDD+"> "+egret.getTimer()+" "),console.log.apply(console,i)}function i(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=t.concat();i.splice(0,0,"<"+GameIdEnum.CDD+"> "+egret.getTimer()+" "),console.warn.apply(console,i)}function o(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];if(null==t)return t;var o=I18N.getInstance(GameIdEnum.CDD);return o.toString.apply(o,arguments)}var a=function(i){function a(){var t=i.call(this)||this;return Global.eventCenter.addEventListener(EventEnum.SOME_ONE_PLAY_VOICE_P_to_G,t.someOnePlayVoice,t),Global.eventCenter.addEventListener(EventEnum.ACCOUNT_BEEN_KICKED,t.beenKicked,t),Global.eventCenter.addEventListener(EventEnum.SERVER_ERROR_MESSAGE,t.onServerErrorMsg,t),Global.eventCenter.addEventListener(EventEnum.SWITCH_TABLE_P_to_G,t.onSwitchTableOk,t),t}return __extends(a,i),a.prototype.onServerErrorMsg=function(t){SimpleLoading.hide(),Toast.show(t.data[0])},a.prototype.someOnePlayVoice=function(e){var i=e.data,a=new t.CDDChatDTO;a.type=2,a.chat=o("[语音]"),a.uid=int_XY(i),t.sendNotification(t.CDDGameSceneMediator.PLAY_CHAT,a)},a.prototype.onSwitchTableOk=function(i){t.dataProxy.centerConfig.area=i.data[0],SimpleLoading.hide(),t.CDDLoading.getInstance().hide(),e("换桌成功！"),t.sendSocketMessage(t.CDDProtocol.CDD_GET_SNAPSHOT_C)},a.prototype.beenKicked=function(e){Global.isAccountBeenReplaced=!0;var i=e.data;t.alert(i[1],function(){Global.platform.exitApp()})},a.prototype.setup=function(e){var i=this;RES.loadGroup("CDD.all",0),waitGroupAndExecute("CDD.all",function(){Global.onEvent(EventEnum.CLOSE_GAME_INIT_LOADING_G_to_P),bridge_iframe.sendMsgToHall(EventEnum.CLOSE_GAME_INIT_LOADING_G_to_P);var t=RES.getRes("i18n_json");I18N.getInstance(GameIdEnum.CDD).init(t,e.i18nType),i.start(e),egret.setTimeout(function(){RES.loadGroup("CDD.sound",0)},i,1)},this),waitGroupAndExecute("CDD.sound",function(){if(!i.destroied){egret.getDefinitionByName("Main");i.destroied||t.CDDSoundPlayer.bgm()}},this)},a.prototype.start=function(e){__tapSound=GameIdEnum.CDD+"_ui_click_mp3";var i=new t.CDDFacade;t.dataProxy=new t.CDDDataProxy,t.dataProxy.centerConfig=e,t.dataProxy.myUid=e.loginDto?e.loginDto.id:-1,i.setup(this),this.facade=i,MarqueeNotice.getInstace().setup(600,Global.stage.stageHeight-55,200),ResizeCall.addCall(this.onResize,this),this.onResize(),this.startLock()},a.prototype.startLock=function(){egret.Ticker.getInstance().register(this.callBack,this)},a.prototype.callBack=function(t){dragonBones.WorldClock.clock.advanceTime(-1)},a.prototype.onResize=function(){var t=1120/1920,e=Global.stage.stageHeight/Global.stage.stageWidth;t>e?Global.stage.scaleMode=egret.StageScaleMode.FIXED_HEIGHT:Global.stage.scaleMode=egret.StageScaleMode.FIXED_WIDTH,MarqueeNotice.getInstace().setup(600,Global.stage.stageHeight-55,200)},a.prototype.destroy=function(){Global.eventCenter.removeEventListener(EventEnum.SOME_ONE_PLAY_VOICE_P_to_G,this.someOnePlayVoice,this),Global.eventCenter.removeEventListener(EventEnum.ACCOUNT_BEEN_KICKED,this.beenKicked,this),Global.eventCenter.removeEventListener(EventEnum.SERVER_ERROR_MESSAGE,this.onServerErrorMsg,this),Global.eventCenter.removeEventListener(EventEnum.SWITCH_TABLE_P_to_G,this.onSwitchTableOk,this),this.destroied=!0,egret.Ticker.getInstance().unregister(this.callBack,this),ResizeCall.del(this.onResize,this),RES.destroyRes("CDD.all"),Global.stage.scaleMode=egret.StageScaleMode.FIXED_WIDTH,mahjong.MahjongTool.dispose(),this.facade&&(t.sendNotification(t.CDDDisposeMVCCommand.NAME),this.facade.dispose(),t.CDDFacade.removeCore(GameIdEnum.CDD),this.facade=null),t.CDDSoundPlayer.dispose()},a}(egret.DisplayObjectContainer);t.GameLauncher=a,__reflect(a.prototype,"CDD.GameLauncher",["IGameLauncher"]),t.trace=e,t.warn=i,t.i18n=o}(CDD||(CDD={}));var Main=function(t){function e(){var i=t.call(this)||this;try{e.isInModule=!(window&&window.parent!=window&&window.parent.Global)}catch(o){}var a=egret.getOption("ip")||window.serverip||"172.16.236.21";return i.gameId="CDD",i.config.httpURI="http://"+a+":81",i.config.host=a,i.config.port=81,i.config.param1=1010111,i.config.param2=1010111,i.config.num=-1,i.config.type=60,i.config.antiCheat=1,i.config.i18nType=I18NType.zh_cn,i.config.moduleType=ModuleType.MODULE_POKER,Global.useProfile=!0,i.defaultGetSnapshotProtocol=CDD.CDDProtocol.CDD_GET_SNAPSHOT_C,i.sendSnapshotWhenResume=!0,SignalStatus.getInstace().setup(0/0,10,0/0,10),i}return __extends(e,t),e.prototype.test=function(){for(var t=card.Card.createFromStrs("方块3,红桃4,红桃5,红桃6,红桃7,黑桃9,梅花10,方块J,方块Q,红桃Q,方块K,方块A,方块2"),e=[card.CDDPokerGroupType.ONE_PAIR,card.CDDPokerGroupType.THREE_OF_A_KIND,card.CDDPokerGroupType.STRAIGHT,card.CDDPokerGroupType.FLUSH,card.CDDPokerGroupType.FULL_HOUSE,card.CDDPokerGroupType.FOUR_OF_A_KIND,card.CDDPokerGroupType.STRAIGHT_FLUSH],i=-1,o=0;o<e.length;o++){i=e[o];var a=card.CDDTool.getTypeCards(t,i);a&&a.cards.length>0&&(trace(i+" ppppppppppppp"),trace("111"))}},e.prototype.onExit=function(){t.prototype.onExit.call(this)},e.isInModule=!0,e}(DevelopMain);__reflect(Main.prototype,"Main");var CDD;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.execute=function(e){var o=puremvc.Facade.getInstance(GameIdEnum.CDD);o.removeCommand(t.CDDExitCommand.NAME),o.removeCommand(t.CDDRestartGameCommand.NAME),o.removeCommand(i.NAME),o.removeMediator(t.CDDSocketMediator.NAME),o.removeMediator(t.CDDGameSceneMediator.NAME),o.removeProxy(t.CDDDataProxy.NAME),t.dataProxy&&t.dataProxy.dispose(),t.dataProxy=null},i.NAME=GameIdEnum.CDD+"RegisteMVCCommand",i}(puremvc.SimpleCommand);t.CDDDisposeMVCCommand=e,__reflect(e.prototype,"CDD.CDDDisposeMVCCommand")}(CDD||(CDD={}));var CDD;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.execute=function(t){Global.onEvent(EventEnum.EXIT_GAME_G_to_P,t.getBody()),bridge_iframe.sendMsgToHall(EventEnum.EXIT_GAME_G_to_P,t.getBody())},e.NAME=GameIdEnum.CDD+"CDDExitCommand",e}(puremvc.SimpleCommand);t.CDDExitCommand=e,__reflect(e.prototype,"CDD.CDDExitCommand")}(CDD||(CDD={}));var CDD;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.execute=function(t){},e.NAME=GameIdEnum.CDD+"CDDLoadResAndThmCommand",e}(puremvc.SimpleCommand);t.CDDLoadResAndThmCommand=e,__reflect(e.prototype,"CDD.CDDLoadResAndThmCommand")}(CDD||(CDD={}));var CDD;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.execute=function(e){var i=puremvc.Facade.getInstance(GameIdEnum.CDD),o=e.getBody()[0];i.registerProxy(t.dataProxy),t.dataProxy.layout=o,i.registerMediator(new t.CDDSocketMediator),i.registerMediator(new t.CDDGameSceneMediator(o.gameLayer)),i.registerCommand(t.CDDExitCommand.NAME,t.CDDExitCommand),i.registerCommand(t.CDDRestartGameCommand.NAME,t.CDDRestartGameCommand),i.registerCommand(t.CDDDisposeMVCCommand.NAME,t.CDDDisposeMVCCommand),t.dataProxy.centerConfig.replayMode&&i.registerMediator(new t.CDDReplayMediator(o.msgLayer))},i.NAME=GameIdEnum.CDD+"CDDRegisteMVCCommand",i}(puremvc.SimpleCommand);t.CDDRegisteMVCCommand=e,__reflect(e.prototype,"CDD.CDDRegisteMVCCommand")}(CDD||(CDD={}));var CDD;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.execute=function(t){},e.NAME=GameIdEnum.CDD+"CDDRestartGameCommand",e}(puremvc.SimpleCommand);t.CDDRestartGameCommand=e,__reflect(e.prototype,"CDD.CDDRestartGameCommand")}(CDD||(CDD={}));var CDD;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.selectType=-1,e}return __extends(e,t),e.prototype.init=function(){this.visible=!1,bindTapEvent_XY(this.btn1,this.clickType,this),bindTapEvent_XY(this.btn2,this.clickType,this),bindTapEvent_XY(this.btn3,this.clickType,this),bindTapEvent_XY(this.btn4,this.clickType,this),bindTapEvent_XY(this.btn5,this.clickType,this),bindTapEvent_XY(this.btn6,this.clickType,this),bindTapEvent_XY(this.btn7,this.clickType,this)},e.prototype.clickType=function(t){var e=t.target;switch(e){case this.btn1:this.selectType=1;break;case this.btn2:this.selectType=2;break;case this.btn3:this.selectType=3;break;case this.btn4:this.selectType=4;break;case this.btn5:this.selectType=5;break;case this.btn6:this.selectType=6;break;case this.btn7:this.selectType=7}this.selectType>0&&this.dispatchEvent(new egret.Event("touchBtn",!1,!1,this.selectType))},e.prototype.resetUi=function(){this.visible=!1},e.prototype.enableAllBtn=function(){for(var t=1;7>=t;t++)this["btn"+t].enabled=!1},e.prototype.setAllTargetTypeEnable=function(t){this.enableAllBtn();for(var e=0;e<t.length;e++)this["btn"+t[e]].enabled=!0},e.prototype.refresh=function(t){for(var e=[card.CDDPokerGroupType.ONE_PAIR,card.CDDPokerGroupType.THREE_OF_A_KIND,card.CDDPokerGroupType.STRAIGHT,card.CDDPokerGroupType.FLUSH,card.CDDPokerGroupType.FULL_HOUSE,card.CDDPokerGroupType.FOUR_OF_A_KIND,card.CDDPokerGroupType.STRAIGHT_FLUSH],i=-1,o=0;o<e.length;o++){i=e[o];var a=card.CDDTool.getTypeCards(t,i);a&&a.cards.length>0?this["btn"+i].enabled=!0:this["btn"+i].enabled=!1}},e}(eui.Component);t.CCDOpBtn=e,__reflect(e.prototype,"CDD.CCDOpBtn")}(CDD||(CDD={}));var CDD;!function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.setIndex=function(t){this.index=t},i.prototype.init=function(){this.visible=!1},i.prototype.updateData=function(){var e=t.dataProxy.roomInfo,i=e?e.state:0,o=t.dataProxy.getPlayerInfoByUISeat(this.index);0==i&&e&&-1==e.autoReady&&o?this.visible=1==o.ready:this.visible=!1},i}(eui.Component);t.CDD_PlayerReady=e,__reflect(e.prototype,"CDD.CDD_PlayerReady")}(CDD||(CDD={}));var CDD;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.origiPoint=new egret.Point,e.touchEnabled=!1,e.touchChildren=!1,e}return __extends(e,t),e.prototype.init=function(t){this.uiIndex=t,this.visible=!1,this.origiPoint.x=this.imageUi.x,this.origiPoint.y=this.imageUi.y},e.prototype.resetUi=function(){this.visible=!1,egret.Tween.removeTweens(this.imageUi),this.imageUi.x=this.origiPoint.x,this.imageUi.y=this.origiPoint.y},e.prototype.show=function(){egret.Tween.removeTweens(this.imageUi),this.visible=!0,0==this.uiIndex?egret.Tween.get(this.imageUi,{loop:!0}).to({x:this.origiPoint.x-30},500).to({x:this.origiPoint.x},500):1==this.uiIndex?this.hide():2==this.uiIndex?egret.Tween.get(this.imageUi,{loop:!0}).to({x:this.origiPoint.x+30},500).to({x:this.origiPoint.x},500):3==this.uiIndex&&egret.Tween.get(this.imageUi,{loop:!0}).to({y:this.origiPoint.y-30},500).to({y:this.origiPoint.y},500)},e.prototype.hide=function(){egret.Tween.removeTweens(this.imageUi),this.imageUi.x=this.origiPoint.x,this.imageUi.y=this.origiPoint.y,this.visible=!1},e}(eui.Component);t.CDDArrow=e,__reflect(e.prototype,"CDD.CDDArrow")}(CDD||(CDD={}));var CDD;!function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.setData=function(t){this.image.source="CDD_pic_w"+t+"_png"},e.pool=[],e}(eui.Component);t.CDDCardTypeRender=e,__reflect(e.prototype,"CDD.CDDCardTypeRender")}(CDD||(CDD={}));var CDD;!function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.init=function(){this.visible=!1,bindTapEvent_XY(this.btnPass,this.clickPassOver,this,!0),bindTapEvent_XY(this.btnCancel,this.clickCancel,this,!0),bindTapEvent_XY(this.btnDealCard,this.clickDealCard,this,!0),this.notice.clearAllGrp()},e.prototype.resetUi=function(){this.visible=!1,this.notice.clearAllGrp()},e.prototype.clickPassOver=function(){null!=this.passBack&&this.passBack.apply(this.scopeFunction)},e.prototype.clickCancel=function(){null!=this.cancelBack&&this.cancelBack.apply(this.scopeFunction)},e.prototype.clickDealCard=function(){null!=this.dealBack&&this.dealBack.apply(this.scopeFunction)},e.prototype.setCallBack=function(t,e,i,o){this.clearCallBack(),this.passBack=t,this.cancelBack=e,this.dealBack=i,this.scopeFunction=o},e.prototype.showCount=function(t){this.notice.showCount(t)},e.prototype.clearAllGrp=function(){this.notice.clearAllGrp()},e.prototype.clearCallBack=function(){this.passBack=null,this.cancelBack=null,this.dealBack=null,this.scopeFunction=null},e.prototype.destroy=function(){clearTapEvent_XY(this.btnPass,this.clickPassOver,this),clearTapEvent_XY(this.btnCancel,this.clickCancel,this),clearTapEvent_XY(this.btnDealCard,this.clickDealCard,this),this.passBack=null,this.cancelBack=null,this.dealBack=null,this.scopeFunction=null},e.prototype.setStateAll=function(){this.visible=!0,this.showAllBtn()},e.prototype.showAllBtn=function(){this.btnPass.touchEnabled=!0,this.btnPass.touchChildren=!0,this.passBg.source="CDD_buyao_png",this.btnCancel.touchEnabled=!1,this.btnCancel.touchChildren=!1,this.cancelBg.source="CDD_quxiao_2_png",this.btnDealCard.touchEnabled=!0,this.btnDealCard.touchChildren=!0,this.dealCardBg.source="CDD_chupai_png"},e.prototype.setCancelCanClick=function(t){t?(this.btnCancel.touchEnabled=!0,this.btnCancel.touchChildren=!0,this.cancelBg.source="CDD_quxiao_png"):(this.btnCancel.touchEnabled=!1,this.btnCancel.touchChildren=!1,this.cancelBg.source="CDD_quxiao_2_png")},e.prototype.showSend=function(){this.btnPass.touchEnabled=!1,this.btnPass.touchChildren=!1,this.passBg.source="CDD_buyao_2_png",this.btnCancel.touchEnabled=!1,this.btnCancel.touchChildren=!1,this.cancelBg.source="CDD_quxiao_2_png",this.btnDealCard.touchEnabled=!0,this.btnDealCard.touchChildren=!0,this.dealCardBg.source="CDD_chupai_png"},e.prototype.showPass=function(){this.btnPass.touchEnabled=!0,this.btnPass.touchChildren=!0,this.passBg.source="CDD_buyao_png",this.btnCancel.touchEnabled=!1,this.btnCancel.touchChildren=!1,this.cancelBg.source="CDD_quxiao_2_png",this.btnDealCard.touchEnabled=!1,this.btnDealCard.touchChildren=!1,this.dealCardBg.source="CDD_chupai_2_png"},e.prototype.setOnlySend=function(){this.visible=!0,this.showSend()},e.prototype.setOnlyPass=function(){this.visible=!0,this.showPass()},e}(eui.Component);t.CDDDealCard=e,__reflect(e.prototype,"CDD.CDDDealCard")}(CDD||(CDD={}));var CDD;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.posArr=[],t.touchEnabled=!1,t.touchChildren=!1,t}return __extends(i,e),i.prototype.init=function(){this.cardArr=[];for(var t=0;5>t;t++){var e=this["card"+t];this.posArr.push(new egret.Point(e.x,e.y)),this.cardArr.push(e),remove_XY(e)}this.visible=!1},i.prototype.resetUI=function(){this.visible=!1},i.prototype.clearAll=function(){for(var t=0;5>t;t++){var e=this["card"+t];remove_XY(e)}remove_XY(this.cardType)},i.prototype.dealCards=function(e,i){var o=this;if(this.clearAll(),e&&0!=e.length){e=t.CDDCardsUtils.showDiscardCardTurn(e,i);var a=e.length;this.alpha=1,this.visible=!0;var a=e.length,r=[],n=[];switch(a){case 1:r.push(this.card2),n.push(this.posArr[2]);break;case 2:r.push(this.card2),r.push(this.card3),n.push(this.posArr[2]),n.push(this.posArr[3]);break;case 3:r.push(this.card1),r.push(this.card2),r.push(this.card3),n.push(this.posArr[1]),n.push(this.posArr[2]),n.push(this.posArr[3]);break;case 5:r.push(this.card0),r.push(this.card1),r.push(this.card2),r.push(this.card3),r.push(this.card4);var s=card.CDDTool.getPokerGroup(e);if((s.type==card.CDDPokerGroupType.STRAIGHT||s.type==card.CDDPokerGroupType.STRAIGHT_FLUSH)&&3==e[0].point&&e[3].point==card.Point.A&&e[4].point==card.Point.B2){var h=[e[3],e[4],e[0],e[1],e[2]];e=h}n.push(this.posArr[0]),n.push(this.posArr[1]),n.push(this.posArr[2]),n.push(this.posArr[3]),n.push(this.posArr[4])}for(var l=0;l<r.length;l++){var c=r[l];c.updateCard(e[l]),c.x=n[l].x,c.y=n[l].y,this.addChild(c)}i>0&&(this.cardType.setData(i),this.addChild(this.cardType),this.cardType.x=this.width/2,this.cardType.y=this.height/2),egret.Tween.removeTweens(this),egret.Tween.get(this).wait(500).to({alpha:0},1500).call(function(){o.visible=!1},this)}},i.prototype.destory=function(){this.cardArr=null},i}(eui.Component);t.CDDDiscard=e,__reflect(e.prototype,"CDD.CDDDiscard")}(CDD||(CDD={}));var CDD;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.timeCount=9,t}return __extends(i,e),i.prototype.init=function(){i18nEUI(GameIdEnum.CDD,this,[]),this.visible=!1,bindTapEvent_XY(this.exitBtn,this.quitGame,this),bindTapEvent_XY(this.nextBtn,this.continueGame,this)},i.prototype.resetUi=function(){this.visible=!1,this.clearTimer()},i.prototype.quitGame=function(){t.sendSocketMessage(t.CDDProtocol.TABLE_TRY_TO_LEAVE_C),this.clearTimer(),this.visible=!1,t.dataProxy.movieEnd()},i.prototype.continueGame=function(){this.clearTimer(),t.dataProxy.isClickResultView=!0,this.visible=!1,t.dataProxy.roomInfo.friends?t.sendSocketMessage(t.CDDProtocol.CDD_READY_FOR_NEXT_ROUND_C):1==t.dataProxy.roomInfo.antiCheatConf?(t.sendNotification(t.CDDGameSceneMediator.GAME_RESET),t.CDDLoading.getInstance().show(),egret.setTimeout(function(){t.sendNotification(t.CDDSocketMediator.SWITCH_ROOM)},this,randomInt_XY(1e3,3e3))):t.sendNotification(t.CDDGameSceneMediator.GAME_RESET)},i.prototype.updateTime=function(e){t.trace("结算时收到服务器时间 "+e),t.dataProxy.centerConfig.replayMode&&(e=5),this.timeTf.text="",1==t.dataProxy.roomInfo.antiCheatConf?this.clearTimer():(this.timeCount=e,null==this.time&&(this.time=new egret.Timer(1e3,0),this.time.addEventListener(egret.TimerEvent.TIMER,this.onTime,this)),this.time.start())},i.prototype.setData=function(){if(null!=t.dataProxy.roomInfo.settlement){this.visible=!0,this.addJieSuanAni();var e=t.dataProxy.roomInfo.settlement.settlementInfo,i=e.slice(0,e.length),o=this.checkSelfInfo(i),a=t.dataProxy.getSelfPlayerInfo();o.scoreOffset>0?(t.CDDSoundPlayer.playWin(a.sex),this.addResultAnimation(!0)):this.addResultAnimation(!1);var r=i.indexOf(o);i.splice(r,1);for(var n=0;n<i.length;n++){var s=i[n];if(null!=s){var h=t.dataProxy.getPlayerInfoByUid(s.uid),l=t.CDDStringUtils.getUIPosByServerPos(h.position),c=this["headInfo"+l];c.setData(s,h.head);var d=this["image_win"+l];d.visible=s.isWin;var p=this["allPay"+l];p.visible=s.isPayAll;var u=this["rateImage"+l];if(s.handCards){var D=2;13==s.handCards.length?D=4:s.handCards.length>=10&&s.handCards.length<13&&(D=3),u.source="CDD_balance_w_0"+D+"_png"}else u.source="";var f=this["resultHands"+l];f.setData(s.handCards);var y=this["scoreInfo"+l];s.scoreOffset>0&&s.uid==t.dataProxy.myUid&&t.CDDSoundPlayer.playWin(h.sex),setHtmlText(y,t.i18n("总分:{0}{1}{2}","<font color='0xffea00'>",coin2Str_XY(s.scoreOffset),"</font>"))}}this.headInfo1.setData(o,a.head),this.resultHands1.setData(o.handCards);var C=this.scoreInfo1;setHtmlText(C,t.i18n("总分:{0}{1}{2}","<font color='0xFFFFFF'>",coin2Str_XY(o.scoreOffset),"</font>"));var m=this.image_win1;m.visible=o.isWin;var g=this.allPay1;g.visible=o.isPayAll;var _=this.rateImage1;if(o.handCards){var v=2;13==o.handCards.length?v=4:o.handCards.length>=10&&o.handCards.length<13&&(v=3),_.source="CDD_balance_w_0"+v+"_png"}else _.source="";for(var n=0;n<o.scoreOffsetInfo.length;n++){var T=this["info"+n],P=o.scoreOffsetInfo[n];P.scoreOffset>0?setHtmlText(T,t.i18n("赢第{0}名:",P.rank)+"<font color='0xFFFFFF'>"+coin2Str_XY(P.scoreOffset)+"</font>"):setHtmlText(T,t.i18n("输第{0}名:",P.rank)+"<font color='0xFFFFFF'>"+coin2Str_XY(P.scoreOffset)+"</font>")}}},i.prototype.addJieSuanAni=function(){this.jiesuanGrp.removeChildren(),null==this.jiesuanArm&&(this.jiesuanArm=Global.buildArmature(GameIdEnum.CDD,"CDD_jiesuan")),this.jiesuanArm.animation.play("Sprite",1),this.jiesuanArm.display.x=this.jiesuanGrp.width/2,this.jiesuanArm.display.y=this.jiesuanGrp.height/2,this.jiesuanGrp.addChild(this.jiesuanArm.display),dragonBones.WorldClock.clock.add(this.jiesuanArm)},i.prototype.addResultAnimation=function(t){this.aniCon.removeChildren();var e=t?"CDD_shengli":"CDD_shibai";this.dragonArm=Global.buildArmature(GameIdEnum.CDD,e),this.dragonArm.removeEventListener(egret.Event.COMPLETE,this.playComplete,this),this.dragonArm.addEventListener(egret.Event.COMPLETE,this.playComplete,this),this._time=null;var i=t?"biaoqian_shengli_kaishi":"biaoqian_chuxian",o=i;this.dragonArm.animation.play(o,1),this.aniCon.addChild(this.dragonArm.display),this.dragonArm.display.x=this.width/2,this.dragonArm.display.y=this.height/2,dragonBones.WorldClock.clock.add(this.dragonArm)},i.prototype.playComplete=function(e){this.dragonArm.removeEventListener(egret.Event.COMPLETE,this.playComplete,this),null!=t.dataProxy.roomInfo.settlement&&(this.dragonArm&&this.dragonArm.display&&(dragonBones.WorldClock.clock.remove(this.dragonArm),remove_XY(this.dragonArm.display)),this.aniCon.removeChildren())},i.prototype.checkSelfInfo=function(e){for(var i=0;i<e.length;i++)if(e[i].uid==t.dataProxy.myUid)return e[i];return null},i.prototype.onTime=function(e){this.timeCount--,this.timeCount<=0?(this.time&&this.time.stop(),this.timeTf.text="0",t.dataProxy.movieEnd(),this.visible=!1,t.dataProxy.isClickResultView=!0,t.sendNotification(t.CDDGameSceneMediator.CHECK_WAIT_INFO)):this.timeTf.text=this.timeCount+""},i.prototype.clearTimer=function(){this.time&&(this.time.removeEventListener(egret.TimerEvent.TIMER,this.onTime,this),this.time.stop(),this.time=null,this.dragonArm&&(this.dragonArm.animation.stop(),this.dragonArm.display&&this.dragonArm.display.parent&&this.dragonArm.display.parent.removeChild(this.dragonArm.display),dragonBones.WorldClock.clock.remove(this.dragonArm)),this.jiesuanArm&&(this.jiesuanArm.animation.stop(),remove_XY(this.jiesuanArm.display)),this.jiesuanGrp.removeChildren())},i.prototype.destory=function(){this.clearTimer(),clearTapEvent_XY(this.exitBtn,this.quitGame,this),clearTapEvent_XY(this.nextBtn,this.continueGame,this)},i}(eui.Component);t.CDDGameResult=e,__reflect(e.prototype,"CDD.CDDGameResult")}(CDD||(CDD={}));var CDD;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.uiArr=[],t.positionArr=[],t.isTouched=!1,t.isInit=!1,t.clickUiArr=[],t.startIndex=-1,t.moveIndex=-1,t.selectUIData=[],t.dataArr=[],t}return __extends(i,e),i.prototype.init=function(){this.touchEnabled=!1,this.touchChildren=!0,this.uiArr.length=0,this.positionArr.length=0;for(var t=1;13>=t;t++){var e=this["hand"+t];this.uiArr.push(e),e.name="ui"+t,remove_XY(e),e.init(),this.positionArr.push(new egret.Point(e.x,e.y))}},i.prototype.removeUI=function(){for(var t=1;13>=t;t++){var e=this["hand"+t];remove_XY(e)}},i.prototype.addListener=function(){this.isInit||(this.isInit=!0,this.touchEnabled=!0,this.touchChildren=!0,this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.clickBegin,this),Global.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.clickMoved,this),Global.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.clickEnd,this))},i.prototype.removeListener=function(){this.isInit=!1,this.touchEnabled=!1,this.touchChildren=!1,this.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.clickBegin,this),Global.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.clickMoved,this),Global.stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.clickEnd,this),this.clearSelectCards()},i.prototype.clickBegin=function(e){this.isTouched=!0,this.clickUiArr.length=0;var i=e.target.name,o=i.substring(2,i.length);this.startIndex=parseInt(o);var a=e.target;-1==this.clickUiArr.indexOf(a)&&a instanceof t.CDDLargeCard&&(this.clickUiArr.push(a),t.CDDSoundPlayer.chooseCard())},i.prototype.clickMoved=function(t){if(this.isTouched){var e=(t.target,t.target.name),i=e.substring(2,e.length);if(this.moveIndex=parseInt(i),t.target&&null!=t.target){if(-1!=this.startIndex&&!isNaN(this.startIndex)&&!isNaN(this.moveIndex)){var o=0,a=0;this.startIndex>this.moveIndex?(o=this.moveIndex,a=this.startIndex):(o=this.startIndex,a=this.moveIndex)}this.addMask(o,a)}}},i.prototype.clickEnd=function(t){if(this.isTouched){this.isTouched=!1;for(var e=0;e<this.clickUiArr.length;e++){var i=this.clickUiArr[e];i.showMask(!1),i.showDown()}egret.callLater(this.clearReset,this)}},i.prototype.addMask=function(t,e){this.clickUiArr.length=0;for(var i=1;13>=i;i++){var o=this["hand"+i];o&&o.parent&&i>=t&&e>=i&&(o.showMask(!0),this.clickUiArr.push(o))}},i.prototype.clearReset=function(){if(this.clickUiArr.length>0){for(var t=0;t<this.clickUiArr.length;t++){var e=this.clickUiArr[t];e.renderAfter()}this.clickUiArr.length=0}egret.callLater(this.checkCanHandlePai,this)},i.prototype.checkCanHandlePai=function(){var e=!1,i=t.dataProxy.roomInfo.actionable;if(null==i||-1==i.actionPlayerUid?e=!1:i.actionPlayerUid==t.dataProxy.myUid&&(e=!0),e){var o=this.getDiscards();o.length>0?this.dispatchEvent(new egret.Event("canClickCancel",!1,!1,!0)):this.dispatchEvent(new egret.Event("canClickCancel",!1,!1,!1))}},i.prototype.enableAllCards=function(){for(var t=1;13>=t;t++){var e=this["hand"+t];e&&e.parent&&(e.showMask(!0),e.showDirDown(),e.enabled=!1,e.renderAfter())}this.clearReset()},i.prototype.setTargetTypeCards=function(t){this.clearSelectCards();for(var e=[],i=1;13>=i;i++){var o=this["hand"+i];o&&o.parent&&e.push(o)}for(var a=0;a<t.length;a++)for(var r=t[a],n=0;n<e.length;n++)if(card.CDDTool.compare(e[n].uiData,r)){e[n].showDirUp(),e[n].renderAfter();break}},i.prototype.setTargetTypeCards2=function(t){for(var e=[],i=1;13>=i;i++){var o=this["hand"+i];o&&o.parent&&(o.showDirDown(),o.renderAfter(),e.push(o))}for(var a=0;a<t.length;a++)for(var r=t[a],n=0;n<e.length;n++)if(card.CDDTool.compare(e[n].uiData,r)){e[n].showDirUp(),e[n].renderAfter();break}},i.prototype.setTargetBigger=function(t,e){for(var i=[],o=1;13>=o;o++){var a=this["hand"+o];a&&a.parent&&i.push(a)}for(var r=[],o=0;o<t.length;o++)for(var n=t[o],s=0;s<n.pokers.length;s++)for(var h=n.pokers[s],l=0;l<i.length;l++)if(card.CDDTool.compare(i[l].uiData,h)){r.push(i[l]);break}if(r.length>0)for(var o=0;o<i.length;o++){var a=i[o];-1!=r.indexOf(a)?(a.showMask(!1),a.enabled=!0):(a.showMask(!0),a.enabled=!1,a.showDirDown(),a.renderAfter())}},i.prototype.getDiscards=function(){this.selectUIData=[];for(var t=0;t<this.uiArr.length;t++){var e=this.uiArr[t];e&&null!=e.parent&&e.getIsUp()&&this.selectUIData.push(e.uiData)}return this.selectUIData},i.prototype.clearSelectCards=function(){this.selectUIData=[];for(var t=0;t<this.uiArr.length;t++)if(null!=this.uiArr[t].parent){var e=this.uiArr[t];e.showDirDown(),e.showMask(!1),e.enabled=!0,e.renderAfter()}},i.prototype.showAllDown=function(){for(var t=0;t<this.uiArr.length;t++)if(null!=this.uiArr[t].parent){var e=this.uiArr[t];e.showDirDown(),e.renderAfter()}},i.prototype.updateData=function(t){if(this.clearSelectCards(),null==t){this.dataArr=[];for(var e=0;13>e;e++){var i=this["hand"+(e+1)];remove_XY(i)}}else{this.dataArr=card.CDDTool.sort(t);for(var e=0;13>e;e++){var i=this["hand"+(e+1)];e<t.length?(i.updateCard(t[e]),this.positionArr.length>0?(i.x=this.positionArr[e].x,i.y=this.positionArr[e].y):(i.x=45*e,i.y=0),this.addChild(i)):remove_XY(i)}}},i.prototype.destroy=function(){this.removeListener(),this.positionArr.length=0,this.uiArr.length=0,this.dataArr.length=0,this.clickUiArr.length=0,this.selectUIData=[],this.startIndex=-1,this.moveIndex=-1},i}(eui.Component);t.CDDHandCards=e,__reflect(e.prototype,"CDD.CDDHandCards")}(CDD||(CDD={}));var CDD;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.pos=0,t}return __extends(i,e),i.prototype.init=function(t){this.pos=t,this.effect1=Global.buildArmature(GameIdEnum.CDD,"bairenniuniu_touxiangteiao"),this.image_robot.visible=!1,this.bornLoc=[this.infoGrp.x,this.infoGrp.y],this.clearAllGrp(),this.pass.hide()},i.prototype.showPass=function(){this.pass.show()},i.prototype.hidePass=function(){this.pass.hide()},i.prototype.clearAllGrp=function(){this.notice.clearAllGrp()},i.prototype.showCount=function(t){this.notice.showCount(t)},i.prototype.addEffect=function(){var t="Animation1_2";this.effect1.animation.play(t,1),this.effect1.display.visible=!0,dragonBones.WorldClock.clock.add(this.effect1),this.infoGrp.addChild(this.effect1.display),this.effect1.display.x=this.image_head.x+this.image_head.width/2,this.effect1.display.y=this.image_head.y+this.image_head.height/2},i.prototype.clearEffect=function(){this.effect1.display.visible=!1,dragonBones.WorldClock.clock.remove(this.effect1),this.effect1.display&&this.effect1.display.parent&&this.effect1.display.parent.removeChild(this.effect1.display)},i.prototype.setRemainCount=function(t){""==t?this.countGrp.visible=!1:(this.countGrp.visible=!0,this.lastCount.text=t+"")
},i.prototype.setShow=function(e){Tween$.removeTweens(this);var i=this.bornLoc[0];2==this.pos?i-=60:i+=60,this.x=i;var o=t.dataProxy.getPlayerInfoByPos(e);this.setData(o),this.visible=!0,Tween$.get(this.infoGrp).to({x:this.bornLoc[0]},400,Ease$.sineOut),this.countGrp.visible=!1},i.prototype.setHide=function(){var t=this;Tween$.removeTweens(this);var e=this.bornLoc[0];(this.pos=0)?e-=60:e+=60,this.x=this.bornLoc[0],Tween$.get(this.infoGrp).to({x:e},400,Ease$.sineOut).set({visible:!1}).call(function(){t.setData(null)},this),this.countGrp.visible=!1,this.notice.clearAllGrp()},i.prototype.setData=function(e){if(null==e)this.infoGrp.visible=!1,this.notice.clearAllGrp();else{this.infoGrp.visible=!0,this.moneyTf.text="--",this.image_head.source="tAvatarnull_png",this.nameTf.text=copyChar_XY("*",6);var i=t.dataProxy.roomInfo&&t.dataProxy.roomInfo.friends;(i||e.uid==Global.uid||t.dataProxy.isBothInLastGamePlayers(e.uid,Global.uid))&&(this.image_head.source=toAvatarSource_XY(e.head)||"CDD_head_png",this.nameTf.text=substrNick_XY(e.name),this.moneyTf.text=coin2Str_XY(e.score)+""),this.image_robot.visible=1==e.trusteeshipState}var o=t.dataProxy.roomInfo.state;0==o||null==e?this.setRemainCount(""):this.setRemainCount(e.remaining+"")},i}(eui.Component);t.CDDHeadGroup=e,__reflect(e.prototype,"CDD.CDDHeadGroup")}(CDD||(CDD={}));var CDD;!function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.init=function(){bindTapEvent_XY(this.image_rule,this.clickRule,this),bindTapEvent_XY(this.imageBg,this.clickClose,this),this.tableGroup.width=673,this.grp.x=Global.stage.stageWidth,Tween$.removeTweens(this.grp),Tween$.get(this.grp).to({x:Global.stage.stageWidth-this.grp.width},300,Ease$.sineOut),this.clickRule(),this.scl.setSliderBarAlwaysShow(!1)},e.prototype.showView=function(){this.visible=!0,this.grp.x=Global.stage.stageWidth,Tween$.removeTweens(this.grp),Tween$.get(this.grp).to({x:Global.stage.stageWidth-this.grp.width},300,Ease$.sineOut)},e.prototype.clickRule=function(){this.scl.stopAnimation(),this.tableGroup.removeChildren();var t=new eui.Image;t.source="CDD_gamerule_png",this.tableGroup.addChild(t),this.tableGroup.scrollV=0,updateScrollerThumb_XY(this.scl)},e.prototype.onResize=function(){Tween$.removeTweens(this.grp),this.visible?this.grp.x=Global.stage.stageWidth-this.grp.width:this.grp.x=Global.stage.stageWidth},e.prototype.clickClose=function(){var t=this;Tween$.removeTweens(this.grp),Tween$.get(this.grp).to({x:Global.stage.stageWidth},300,Ease$.sineOut).call(function(){t.visible=!1})},e.prototype.dispose=function(){clearTapEvent_XY(this.image_rule,this.clickRule,this),clearTapEvent_XY(this.imageBg,this.clickClose,this)},e}(eui.Component);t.CDDInstroduction=e,__reflect(e.prototype,"CDD.CDDInstroduction")}(CDD||(CDD={}));var CDD;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.needUp=!1,t.touchEnabled=!0,t.touchChildren=!1,t}return __extends(i,e),i.prototype.getIsUp=function(){return this.needUp},i.prototype.showDirUp=function(){this.needUp=!0},i.prototype.showDirDown=function(){this.needUp=!1},i.prototype.showDown=function(){this.needUp=!this.needUp},i.prototype.resetDown=function(){this.needUp=!1},i.prototype.init=function(){this.needUp=!1,this.renderAfter()},i.prototype.setData=function(t){this.updateCard(t)},i.prototype.showMask=function(t){this.image10.visible=t},i.prototype.renderAfter=function(){this.needUp?this.y=-20:this.y=0},i.prototype.showCard=function(){this.image_bg.visible=!1,this.grp.visible=!0,this.image_num.visible=!0,this.image_white.visible=!0,this.image_smallType.visible=!0,this.image_bigType.visible=!0,this.image_highType.visible=!0,this.image_highKing.visible=!0,this.image6.visible=!1,this.image10.visible=!1},i.prototype.updateCard=function(e){if(null!=e&&-1!=e.type&&-1!=e.point){this.showCard(),this.uiData=e;var i=e.type,o="",a="",r="",n="";0==i||2==i?(a="2",0==i?(r="CDD_poker_mfk_png",n="CDD_color_diamon_png",o="14"):(r="CDD_poker_mhx_png",n="CDD_color_heat_png",o="12")):(a="1",1==i?(r="CDD_poker_myh_png",n="CDD_color_club_png",o="13"):(r="CDD_poker_mht_png",n="CDD_color_spade_png",o="11"));var s="";if(2<=e.point&&e.point<=10)s=e.point+"",this.image_highType.source="",this.image_highType.visible=!1,this.image_bigType.visible=!0,this.image_bigType.source=n,this.image_highKing.visible=!1,this.image_num.source="CDD_poker_"+s+a+"_png",this.image_smallType.source=r;else if(15==e.point)s="2",this.image_highType.source="",this.image_highType.visible=!1,this.image_bigType.visible=!0,this.image_bigType.source=n,this.image_highKing.visible=!1,this.image_num.source="CDD_poker_"+s+a+"_png",this.image_smallType.source=r;else{switch(e.point){case card.Point.A:s="1",this.image_highType.visible=!1,this.image_highType.source="",this.image_bigType.visible=!0,this.image_bigType.source=n;break;case card.Point.J:s="11",this.image_highType.visible=!0,this.image_highType.source="CDD_poker_"+s+o+"_bk_png",t.trace("res "+this.image_highType.source),this.image_bigType.visible=!1,this.image_bigType.source="";break;case card.Point.Q:s="12",this.image_highType.visible=!0,this.image_highType.source="CDD_poker_"+s+o+"_bk_png",t.trace("res "+this.image_highType.source),this.image_bigType.visible=!1,this.image_bigType.source="";break;case card.Point.K:s="13",this.image_highType.visible=!0,this.image_highType.source="CDD_poker_"+s+o+"_bk_png",t.trace("res "+this.image_highType.source),this.image_bigType.visible=!1,this.image_bigType.source="";break;default:t.trace("can find point : "+e.point)}this.image_highKing.visible=!1,this.image_num.source="CDD_poker_"+s+a+"_png",this.image_smallType.source=r}}},i}(eui.Component);t.CDDLargeCard=e,__reflect(e.prototype,"CDD.CDDLargeCard")}(CDD||(CDD={}));var CDD;!function(t){var e=function(e){function i(){var t=e.call(this,"CDDAlertSkin")||this;return t.timer=0,remove_XY(t.btnGrp),t.tf.height=270,t.tf.lineSpacing=15,t}return __extends(i,e),i.getInstance=function(){return this.instance||(this.instance=new i),this.instance},i.dispose=function(){i.instance&&i.instance.dispose(),i.instance=null},i.prototype.show=function(){var t=puremvc.Facade.getInstance(GameIdEnum.CDD).layout;t.msgLayer.addChild(this),this.counter=0,this.onTimer(),this.startTimer()},i.prototype.startTimer=function(){egret.clearInterval(this.timer),this.timer=egret.setInterval(this.onTimer,this,500)},i.prototype.onTimer=function(){this.counter++;var e=this.counter%4;this.tf.text=t.i18n("正在为您匹配牌桌{0}游戏即将开始，请耐心等待","\n")+copyChar_XY(".",e)+copyChar_XY(" ",3-e)},i.prototype.stopTimer=function(){egret.clearInterval(this.timer)},i.prototype.hide=function(){this.stopTimer(),remove_XY(this)},i}(BaseComponent);t.CDDLoading=e,__reflect(e.prototype,"CDD.CDDLoading")}(CDD||(CDD={}));var CDD;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.touchEnabled=!1,e.touchChildren=!1,e}return __extends(e,t),e.prototype.init=function(){this.grp.visible=!1},e.prototype.showCard=function(){this.grp.visible=!0},e}(eui.Component);t.CDDMiddleCard=e,__reflect(e.prototype,"CDD.CDDMiddleCard")}(CDD||(CDD={}));var CDD;!function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.init=function(){this.effect1=Global.buildArmature(GameIdEnum.CDD,"bairenniuniu_touxiangteiao")},i.prototype.addEffect=function(){var t="Animation1_2";this.effect1.animation.play(t,1),this.effect1.display.visible=!0,dragonBones.WorldClock.clock.add(this.effect1),this.topHeadGrp.addChild(this.effect1.display),this.effect1.display.x=this.image_head.x+this.image_head.width/2,this.effect1.display.y=this.image_head.y+this.image_head.height/2},i.prototype.clearEffect=function(){this.effect1.display.visible=!1,dragonBones.WorldClock.clock.remove(this.effect1),this.effect1.display&&this.effect1.display.parent&&this.effect1.display.parent.removeChild(this.effect1.display)},i.prototype.updateView=function(){var e=t.dataProxy.getSelfPlayerInfo();null==e?(this.myNameTf.text="",this.image_head.source="CDD_head_png"):(this.image_head.source=toAvatarSource_XY(e.head)||"CDD_head_png",this.myNameTf.text=substrNick_XY(e.name),this.myMoneyTf.text=coin2Str_XY(e.score))},i}(eui.Component);t.CDDMyInfo=e,__reflect(e.prototype,"CDD.CDDMyInfo")}(CDD||(CDD={}));var CDD;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.touchEnabled=!1,e.touchChildren=!1,e}return __extends(e,t),e.prototype.init=function(){this.clearAllGrp(),this.visible=!0},e.prototype.clearAllGrp=function(){this.countGrp.visible=!1,this.countTf.text=""},e.prototype.showCount=function(t){0==t?(this.countGrp.visible=!1,this.countTf.text="",egret.Tween.removeTweens(this.countGrp),this.countGrp.rotation=0):(this.countGrp.visible=!0,this.countTf.text=t+"",3>=t?(3==t&&(egret.Tween.removeTweens(this.countGrp),egret.Tween.get(this.countGrp).to({rotation:10},200).to({rotation:-10},200).to({rotation:10},200).to({rotation:-10},200).to({rotation:10},200).to({rotation:-10},200).to({rotation:10},200).to({rotation:-10},200).to({rotation:10},200).to({rotation:-10},200).to({rotation:10},200).to({rotation:-10},200).to({rotation:10},200).to({rotation:-10},200).to({rotation:10},200)),this.image_clock_bg.source="CDD_nao3_png"):this.image_clock_bg.source="CDD_bg_clock_png")},e.prototype.destory=function(){this.clearAllGrp()},e}(eui.Component);t.CDDNoticeInfo=e,__reflect(e.prototype,"CDD.CDDNoticeInfo")}(CDD||(CDD={}));var CDD;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.offsetX=0,t.offsetY=0,t}return __extends(i,e),i.prototype.init=function(){this.offsetX=this.moneyTf.x,this.offsetY=this.moneyTf.y},i.prototype.setData=function(t){if(t>0)this.moneyTf.font="CDD_win_fnt",this.moneyTf.text="+ "+coin2Str_XY(t);else{this.moneyTf.font="CDD_lose_fnt";var e=Math.abs(t);this.moneyTf.text="-"+coin2Str_XY(e)}this.moneyTf.alpha=1,egret.Tween.removeTweens(this.moneyTf),egret.Tween.get(this.moneyTf).to({y:this.offsetY-50},500).call(this.passComplete,this)},i.prototype.passComplete=function(){var e=this;egret.Tween.removeTweens(this.moneyTf),egret.Tween.get(this.moneyTf).wait(500).to({alpha:0},500).call(function(){e.moneyTf.y=e.offsetY,t.trace(e.moneyTf.y+" this.moneyTf.y"),egret.Tween.removeTweens(e.moneyTf)},this)},i.prototype.dispose=function(){egret.Tween.removeTweens(this.moneyTf)},i}(eui.Component);t.CDDOffsetUi=e,__reflect(e.prototype,"CDD.CDDOffsetUi")}(CDD||(CDD={}));var CDD;!function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.init=function(){this.visible=!1},e.prototype.resetUI=function(){this.visible=!1},e.prototype.show=function(){this.visible=!0},e.prototype.hide=function(){this.visible=!1},e}(eui.Component);t.CDDPass=e,__reflect(e.prototype,"CDD.CDDPass")}(CDD||(CDD={}));var CDD;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.touchEnabled=!1,e.touchChildren=!1,e}return __extends(e,t),e.prototype.init=function(){this.tf0.text="",this.tf1.text=""},e.prototype.setData=function(t){t>=0?(this.tf0.text="+",this.tf1.text=coin2Str_XY(t)+"",this.tf0.textColor=this.tf1.textColor=16777215):(this.tf0.text="-",this.tf1.text=Math.abs(Number(coin2Str_XY(t)))+"",this.tf0.textColor=this.tf1.textColor=16711680)},e}(eui.Component);t.CDDPersonScore=e,__reflect(e.prototype,"CDD.CDDPersonScore")}(CDD||(CDD={}));var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var CDD;!function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.setData=function(t,e){this.image_head.source=toAvatarSource_XY(e)||"CDD_head_png",this.nameTf.text=substrNick_XY(t.name),this.moneyTf.text=coin2Str_XY(t.score)+""},e}(eui.Component);t.CDDResultHead=e,__reflect(e.prototype,"CDD.CDDResultHead")}(CDD||(CDD={}));var CDD;!function(t){var e=function(t){function e(e){var i=t.call(this)||this;i.inited=!1,i.posArr=[],i.currentIndex=0,i.skinName="CDDSmallDiscard"+e+"Skin",i.posArr.length=0,i.currentIndex=e;for(var o=0;5>o;o++){var a=i["card"+o];a.name="ui"+o,i.posArr.push(new egret.Point(a.x,a.y)),remove_XY(a),a.init()}return i.addEventListener(egret.Event.REMOVED,i.onRemoved,i),i}return __extends(e,t),e.prototype.clearAll=function(){for(var t=0;5>t;t++){var e=this["card"+t];remove_XY(e)}},e.prototype.setData=function(t){if(this.clearAll(),t&&0!=t.length){var e=t.length;this.visible=!0;var i=[],o=[];switch(e){case 1:i.push(this.card2),o.push(this.posArr[2]);break;case 2:i.push(this.card2),i.push(this.card3),o.push(this.posArr[2]),o.push(this.posArr[3]);break;case 3:i.push(this.card1),i.push(this.card2),i.push(this.card3),o.push(this.posArr[1]),o.push(this.posArr[2]),o.push(this.posArr[3]);break;case 5:i.push(this.card0),i.push(this.card1),i.push(this.card2),i.push(this.card3),i.push(this.card4);var a=card.CDDTool.getPokerGroup(t);if((a.type==card.CDDPokerGroupType.STRAIGHT||a.type==card.CDDPokerGroupType.STRAIGHT_FLUSH)&&3==t[0].point&&t[3].point==card.Point.A&&t[4].point==card.Point.B2){var r=[t[3],t[4],t[0],t[1],t[2]];t=r}o.push(this.posArr[0]),o.push(this.posArr[1]),o.push(this.posArr[2]),o.push(this.posArr[3]),o.push(this.posArr[4])}for(var n=0;n<i.length;n++){var s=i[n];s.updateCard(t[n]),s.x=o[n].x,s.y=o[n].y,this.conGrp.addChild(s)}}},e.make=function(t){var i=null;return null==this.poolObj[t]||0==this.poolObj[t].length?(i=new e(t),this.poolObj[t]=[]):i=this.poolObj[t].shift(),i},e.prototype.onRemoved=function(t){var i=t.target;if(i instanceof e){this.inited=!1;var o=i.currentIndex;null==e.poolObj[o]&&(e.poolObj[o]=[]),e.poolObj[o].push(this)}},e.poolObj={},e}(eui.Component);t.CDDSmallDiscard=e,__reflect(e.prototype,"CDD.CDDSmallDiscard")}(CDD||(CDD={}));var CDD;!function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.init=function(){i18nEUI(GameIdEnum.CDD,this,[]),bindTapEvent_XY(this.btnTrusteeShip,this.clickFunc,this),this.visible=!1},i.prototype.resetUi=function(){this.visible=!1},i.prototype.clickFunc=function(){var e=new t.CddTrusteeshipDTO;e.uid=t.dataProxy.myUid,e.trusteeshipState=0,t.sendSocketMessage(t.CDDProtocol.CDD_TRUSTEESHIP_C,e)},i.prototype.clearListener=function(){clearTapEvent_XY(this.btnTrusteeShip,this.clickFunc,this)},i.prototype.destory=function(){this.clearListener()},i}(eui.Component);t.CDDTrusteeShip=e,__reflect(e.prototype,"CDD.CDDTrusteeShip")}(CDD||(CDD={}));var CDD;!function(t){var e=function(e){function i(){var t=e.call(this,i.NAME)||this;return t.gameExited=!1,t.hasShowResult=!1,t.isCheat=!1,t.isClickResultView=!1,t.TOTAL_POSITION_NUM=4,t}return __extends(i,e),i.prototype.setRoomInfo=function(e){this.roomInfo=e,this.lastGamePlayerIds=[];for(var i=0;i<e.players.length;i++)e.players[i].uid==t.dataProxy.myUid&&(this.selfIndex=e.players[i].position),t.CddPlayerDTO.maskNick(e.players[i]),e.state>0&&e.state<3&&this.lastGamePlayerIds.push(e.players[i].uid)},i.prototype.setFirstTurn=function(e){this.roomInfo.state=1,this.lastGamePlayerIds=[];for(var i=this.roomInfo.state,o=0;o<this.roomInfo.players.length;o++){var a=this.roomInfo.players[o];if(i>0&&3>i&&this.lastGamePlayerIds.push(a.uid),a.uid!=t.dataProxy.myUid){if(t.dataProxy.isCheat);else{a.handCards=[];for(var r=0;13>r;r++){var n=new card.Card(-1,-1);a.handCards.push(n)}}a.remaining=13}}var s=t.dataProxy.getPlayerInfoByUid(e.uid);s.handCards=e.handCards,this.firstTurnUid=e.beginUid,t.dataProxy.roomInfo.curRound=e.curRound,this.lastGamePlayerIds=[];for(var o=0;o<this.roomInfo.players.length;o++)this.roomInfo.state>0&&this.roomInfo.state<3&&this.lastGamePlayerIds.push(this.roomInfo.players[o].uid)},i.prototype.updateActionAble=function(e){null!=this.roomInfo&&(t.dataProxy.roomInfo.state=2,this.roomInfo.actionable=e,this.roomInfo.time=e.timeOut,t.sendNotification(t.CDDGameSceneMediator.UPDATE_TURN))},i.prototype.initReplay=function(){this.centerConfig.replayMode&&(this.replayVo?this.replayVo.stopAndClear():this.replayVo=new t.CDDReplayVo,this.replayVo.init(this.centerConfig.replayData))},i.prototype.isBothInLastGamePlayers=function(t,e){return this.lastGamePlayerIds?-1!=this.lastGamePlayerIds.indexOf(t)&&-1!=this.lastGamePlayerIds.indexOf(e):!1},i.prototype.resetRoomInfo=function(){if(null!=this.roomInfo){this.roomInfo.state=0,this.roomInfo.actionable=null,this.roomInfo.tableId="";for(var t=0;t<this.roomInfo.players.length;t++)this.roomInfo.players[t].handCards&&(this.roomInfo.players[t].handCards.length=0),-1==this.roomInfo.autoReady||(this.roomInfo.players[t].ready=-1),this.roomInfo.players[t].remaining=0,this.roomInfo.players[t].trusteeshipState=0}},i.prototype.getSexById=function(t){var e=this.getPlayerInfoByUid(t);return e?e.sex:0},i.prototype.getResultInfoById=function(t){if(null==this.roomInfo.settlement)return null;for(var e=0;e<this.roomInfo.settlement.settlementInfo.length;e++){var i=this.roomInfo.settlement.settlementInfo[e];if(i.uid==t)return i}return null},i.prototype.doActionAbleSound=function(e){if(this.centerConfig.replayMode){var i=e.actionable,o=null;if(-1==i.lastOpPlayerUid&&-1==i.lastOpPlayerActionType)return;o=t.dataProxy.getPlayerInfoByUid(i.lastOpPlayerUid);var a=-1;if(a=i.lastOpPlayerActionType,e.state<=4)switch(a){case 3:o=t.dataProxy.getPlayerInfoByUid(i.lastOpPlayerUid),null==o.lastDiscard&&0==o.lastDisscardType?t.CDDSoundPlayer.playPass(o.sex):this.addDealsCardsMusic(o.lastDisscardType,o.lastDiscard,o.sex)}}},i.prototype.addDealsCardsMusic=function(e,i,o){t.dataProxy.roomInfo;e==card.CDDPokerGroupType.ONE_CARD?t.CDDSoundPlayer.playSingle(i,o):e==card.CDDPokerGroupType.ONE_PAIR?t.CDDSoundPlayer.playDouble(i,o):e==card.CDDPokerGroupType.THREE_OF_A_KIND?t.CDDSoundPlayer.playThree(i,o):e==card.CDDPokerGroupType.STRAIGHT?t.CDDSoundPlayer.playShunzi(o):e==card.CDDPokerGroupType.FLUSH?t.CDDSoundPlayer.playFlush(o):e==card.CDDPokerGroupType.FULL_HOUSE?t.CDDSoundPlayer.playFullHouse(o):e==card.CDDPokerGroupType.FOUR_OF_A_KIND?t.CDDSoundPlayer.playFourWithOne(o):e==card.CDDPokerGroupType.STRAIGHT_FLUSH&&t.CDDSoundPlayer.playBomb(o)},i.prototype.movieStart=function(){t.dataProxy.centerConfig.replayMode||(t.dataProxy.movieing=!0)},i.prototype.movieEnd=function(){t.dataProxy.centerConfig.replayMode||(t.dataProxy.movieing=!1,t.sendNotification(t.CDDSocketMediator.SHIFT_ALL_SERVER_DATA))},i.prototype.updatePlayerGold=function(){if(this.roomInfo.settlement)for(var t=this.roomInfo.settlement.settlementInfo,e=0;e<t.length;e++){var i=t[e],o=this.getPlayerInfoByUid(i.uid);o.score=i.score,o.handCards=i.handCards,o.remaining=i.handCards.length}},i.prototype.updatePlayerTrustShip=function(t){for(var e=0;e<this.roomInfo.players.length;e++){var i=this.roomInfo.players[e];if(i.uid==t.uid){i.trusteeshipState=t.trusteeshipState;break}}},i.prototype.someOneJoin=function(e){if(e.uid!=Global.uid){t.CddPlayerDTO.maskNick(e);var i=t.dataProxy.getPlayerInfoByPos(e.position),o=t.dataProxy.roomInfo.players.indexOf(i);-1==o?t.dataProxy.roomInfo.players.push(e):t.dataProxy.roomInfo.players[o]=e,t.sendNotification(t.CDDGameSceneMediator.SOME_ONE_JOIN,e.position)}},i.prototype.someOneLeave=function(e){var i=t.dataProxy.getPlayerInfoByUid(e);if(i&&i.uid!=t.dataProxy.myUid){var o=t.dataProxy.roomInfo.players.indexOf(i);-1!=o&&t.dataProxy.roomInfo.players.splice(o,1),t.sendNotification(t.CDDGameSceneMediator.SOME_ONE_LEAVE,i.position)}},i.prototype.updatePlayerReadyStatus=function(e){var i=t.dataProxy.getPlayerInfoByUid(e);i.ready=1,t.sendNotification(t.CDDGameSceneMediator.READY)},i.prototype.updateCurrentDiscard=function(e){if(null!=this.roomInfo){if(this.roomInfo.actionable.lastDiscard=e.discard,this.roomInfo.actionable.lastDiscardUid=e.uid,this.roomInfo.actionable.lastDisscardType=e.discardType,-1!=e.discardType)if(t.dataProxy.centerConfig.replayMode||t.dataProxy.isCheat){var i=e.uid,o=t.dataProxy.getPlayerInfoByUid(i);if(o){for(var a=0;a<e.discard.length;a++)for(var r=e.discard[a],n=0;n<o.handCards.length;n++){var s=o.handCards[n];if(card.CDDTool.compare(s,r)){o.handCards.splice(n,1);break}}o.remaining=o.handCards.length}}else if(e.uid==t.dataProxy.myUid){for(var h=this.getSelfPlayerInfo(),a=0;a<e.discard.length;a++)for(var r=e.discard[a],n=0;n<h.handCards.length;n++){var s=h.handCards[n];if(card.CDDTool.compare(s,r)){h.handCards.splice(n,1);break}}h.remaining=h.handCards.length}else{for(var l=this.getPlayerInfoByUid(e.uid),c=e.discard.length,a=0;c>a;a++)l.handCards.shift();l.remaining=l.handCards.length}t.sendNotification(t.CDDGameSceneMediator.PLAYER_DISCARD,e)}},i.prototype.getPlayerInfoByPos=function(t){if(null==this.roomInfo.players)return null;for(var e=0;e<this.roomInfo.players.length;e++){var i=this.roomInfo.players[e];if(i.position==t)return i}return null},i.prototype.getUIPosByServerPos=function(e){var i=t.dataProxy.getPlayerInfoByUid(t.dataProxy.myUid);if(null==i)return-1;var o=-1,a=i.position,r=1,n=this.TOTAL_POSITION_NUM,s=e-a;return o=r+s,o>=n&&(o-=n),0>o&&(o+=n),o},i.prototype.getPlayerInfoByUISeat=function(e){if(!this.roomInfo||!this.roomInfo.players)return null;for(var i=0,o=this.roomInfo.players.length;o>i;i++){var a=this.roomInfo.players[i];if(t.CDDStringUtils.getUIPosByServerPos(a.position)==e)return a}return null},i.prototype.checkRateNum=function(){for(var e=t.dataProxy.roomInfo.settlement.settlementInfo,i=2,o=0;o<e.length;o++)e[o].isWin||(e[o].handCards&&13==e[o].handCards.length?i=4:e[o].handCards&&e[o].handCards.length>=10&&e[o].handCards.length<13&&(i=3));return i},i.prototype.getSelfPlayerInfo=function(){return this.getPlayerInfoByUid(t.dataProxy.myUid)},i.prototype.updateSortHandCards=function(){var e=t.dataProxy.getSelfPlayerInfo(),i=card.CDDTool.sort(e.handCards);e.handCards=i},i.prototype.changeMyReadyStatus=function(){var e=t.dataProxy.getSelfPlayerInfo();e&&(e.ready=1)},i.prototype.updateOtherHandCards=function(e){var i=t.dataProxy.getPlayerInfoByUid(e),o=card.CDDTool.sort(i.handCards);i.handCards=o},i.prototype.getPlayerInfoByUid=function(t){if(!this.roomInfo)return null;if(null==this.roomInfo.players)return null;for(var e=0;e<this.roomInfo.players.length;e++){var i=this.roomInfo.players[e];if(i.uid==t)return i}return null},i.prototype.dispose=function(){this.centerConfig=null},i.NAME=GameIdEnum.CDD+"CDDDataProxy",i}(puremvc.Proxy);t.CDDDataProxy=e,__reflect(e.prototype,"CDD.CDDDataProxy")}(CDD||(CDD={}));var CDD;!function(t){var e=function(){function t(){}return t}();t.CddActionableDTO=e,__reflect(e.prototype,"CDD.CddActionableDTO")}(CDD||(CDD={}));var CDD;!function(t){var e=function(){function t(){}return t}();t.CddBeginDTO=e,__reflect(e.prototype,"CDD.CddBeginDTO")}(CDD||(CDD={}));var CDD;!function(t){var e=function(){function t(){}return t}();t.CDDChatDTO=e,__reflect(e.prototype,"CDD.CDDChatDTO")}(CDD||(CDD={}));var CDD;!function(t){var e=function(){function t(){}return t}();t.CddCountdownDTO=e,__reflect(e.prototype,"CDD.CddCountdownDTO")}(CDD||(CDD={}));var CDD;!function(t){var e=function(){function t(){}return t}();t.CddDiscardDTO=e,__reflect(e.prototype,"CDD.CddDiscardDTO")}(CDD||(CDD={}));var CDD;!function(t){var e=function(){function e(){this.sex=0}return e.maskNick=function(e){e&&(e.name=maskNick_XY(e.name,e.uid,t.dataProxy.roomInfo&&t.dataProxy.roomInfo.friends,t.dataProxy.centerConfig&&t.dataProxy.centerConfig.replayMode))},e}();t.CddPlayerDTO=e,__reflect(e.prototype,"CDD.CddPlayerDTO")}(CDD||(CDD={}));var CDD;!function(t){var e=function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t.stepTimeGapMs=1e3,t}return __extends(i,e),i.prototype.init=function(t){this.index=0,this.data=t,this.max=t.length,this.stepTimeGapMs=2e3,this.speed=1,this.autoPlay=!1,egret.clearInterval(this.autoPlayTimer)},i.prototype.startAutoPlay=function(){this.autoPlay=!0,t.dataProxy.centerConfig.socketProxy.replayData(this.data[0]),this.index=1,egret.clearInterval(this.autoPlayTimer),this.autoPlayTimer=egret.setInterval(this.onPlayTimer,this,this.stepTimeGapMs/this.speed),this.isPlaying=!0},i.prototype.showPrevFrame=function(){this.index--,this.index<1&&(this.index=1),t.dataProxy.centerConfig.socketProxy.replayData(this.data[this.index-1])},i.prototype.showNextFrame=function(){this.index++,this.index>this.max&&(this.index=this.max),t.dataProxy.centerConfig.socketProxy.replayData(this.data[this.index-1])},i.prototype.jumpToPersent=function(e){0>e&&(e=0),e>1&&(e=1),this.index=int_XY(this.max*e),t.dataProxy.centerConfig.socketProxy.replayData(this.data[this.index-1])},i.prototype.pause=function(){egret.clearInterval(this.autoPlayTimer),this.isPlaying=!1},i.prototype.resume=function(){egret.clearInterval(this.autoPlayTimer),this.autoPlayTimer=egret.setInterval(this.onPlayTimer,this,this.stepTimeGapMs/this.speed),this.isPlaying=!0},i.prototype.changePlaySpeed=function(t){this.speed=t,this.isPlaying&&(egret.clearInterval(this.autoPlayTimer),this.autoPlayTimer=egret.setInterval(this.onPlayTimer,this,this.stepTimeGapMs/this.speed))},i.prototype.stopAndClear=function(){egret.clearInterval(this.autoPlayTimer),this.data=null,this.isPlaying=!1},i.prototype.onPlayTimer=function(){this.index++,this.index>this.max?egret.clearInterval(this.autoPlayTimer):(t.dataProxy.centerConfig.socketProxy.replayData(this.data[this.index-1]),this.dispatchEventWith(i.E_PROGRESS,!1,this.index/this.max))},i.E_PROGRESS="E_PROGRESS",i}(egret.EventDispatcher);t.CDDReplayVo=e,__reflect(e.prototype,"CDD.CDDReplayVo")}(CDD||(CDD={}));var CDD;!function(t){var e=function(){function t(){}return t}();t.CDDScoreOffsetInfo=e,__reflect(e.prototype,"CDD.CDDScoreOffsetInfo")}(CDD||(CDD={}));var CDD;!function(t){var e=function(){function t(){}return t}();t.CddSettlementDTO=e,__reflect(e.prototype,"CDD.CddSettlementDTO")}(CDD||(CDD={}));var CDD;!function(t){var e=function(){function e(){}return e.maskNick=function(e){e&&(e.name=maskNick_XY(e.name,e.uid,t.dataProxy.roomInfo&&t.dataProxy.roomInfo.friends,t.dataProxy.centerConfig&&t.dataProxy.centerConfig.replayMode))},e}();t.CddSettlementInfoDTO=e,__reflect(e.prototype,"CDD.CddSettlementInfoDTO")}(CDD||(CDD={}));var CDD;!function(t){var e=function(){function t(){}return t}();t.CddSnapshotDTO=e,__reflect(e.prototype,"CDD.CddSnapshotDTO")}(CDD||(CDD={}));var CDD;!function(t){var e=function(){function t(){}return t}();t.CddTrusteeshipDTO=e,__reflect(e.prototype,"CDD.CddTrusteeshipDTO")}(CDD||(CDD={}));var CDD;!function(t){var e=function(){function t(){}return t.CDD_GET_SNAPSHOT_C=1e3,t.CDD_GET_SNAPSHOT_S=1001,t.CDD_JOIN_B=1002,t.CDD_LEAVE_B=1003,t.CDD_REFRESH_TABLE_ID_B=1004,t.CDD_BEGIN_S=1005,t.CDD_YOUR_TRUN_B=1006,t.CDD_DISCARD_C=1007,t.CDD_DISCARD_B=1008,t.CDD_SETTLEMENT_B=1009,t.CDD_COUNTDOWN_B=1010,t.CDD_TRUSTEESHIP_C=1011,t.CDD_TRUSTEESHIP_B=1012,t.CDD_READY_FOR_NEXT_ROUND_C=1013,t.CDD_READY_FOR_NEXT_ROUND_S=1014,t.CDD_OPERATE_FAIL_S=1015,t.CDD_READY_C=1016,t.CDD_READY_B=1017,t.CDD_INIT_FOR_NEXT_ROUND_B=1018,t.TABLE_CHAT_C=31,t.TABLE_CHAT_B=32,t.TABLE_TRY_TO_LEAVE_C=91,t.TABLE_LEAVE_S=92,t.TABLE_NOT_EXISTS_S=99,t}();t.CDDProtocol=e,__reflect(e.prototype,"CDD.CDDProtocol")}(CDD||(CDD={}));var CDD;!function(t){function e(e,o){var a=puremvc.Facade.getInstance(GameIdEnum.CDD);if(a){var r=a.retrieveMediator(i.NAME);r?r.sendMessage(e,o):t.warn("CDD的CDDSocketMediator已经销毁")}else t.warn("CDD的facade已经销毁")}var i=function(i){function o(){var e=i.call(this,o.NAME)||this;return e.currentIP=null,e.roomStr=0,e.serverDataStack=[],e.topic=t.dataProxy.centerConfig.moduleType+TopicType.HD_LOGIC,t.dataProxy.centerConfig.socketProxy.addHandler(e.topic,e),Global.eventCenter.addEventListener("mqtt_reconnecting",e.onReconnecting,e),Global.eventCenter.addEventListener("mqtt_reconnect_ok",e.onReconnectOk,e),e}return __extends(o,i),o.prototype.onRemove=function(){i.prototype.onRemove.call(this),t.dataProxy.centerConfig.socketProxy.clearHandlers(this.topic),Global.eventCenter.removeEventListener("mqtt_reconnecting",this.onReconnecting,this),Global.eventCenter.removeEventListener("mqtt_reconnect_ok",this.onReconnectOk,this)},o.prototype.listNotificationInterests=function(){return[o.START_CONNECT,o.SHIFT_ALL_SERVER_DATA,o.SWITCH_ROOM]},o.prototype.handleNotification=function(i){switch(i.getName()){case o.START_CONNECT:break;case o.SHIFT_ALL_SERVER_DATA:this.shiftAllServerData();break;case o.SWITCH_ROOM:e(t.CDDProtocol.TABLE_TRY_TO_LEAVE_C,999999)}},o.prototype.shiftAllServerData=function(){for(t.trace("开始处理所有堆栈中的服务器消息");this.serverDataStack.length>0&&!t.dataProxy.movieing;){var e=this.serverDataStack.shift();this.executeServerData(e.cmd,e.data,e.fromData)}},o.prototype.handle=function(e,i,o){t.trace("receive cmd ["+e+"], data:",i);{if(e!=SocketProxy.CMD_REPLAY)return e==t.CDDProtocol.CDD_GET_SNAPSHOT_S||e==t.CDDProtocol.TABLE_NOT_EXISTS_S||e==t.CDDProtocol.TABLE_LEAVE_S||this.roomInfoInited?(t.dataProxy.movieing&&this.cmdNeedToStack(e)?(t.trace("流程动画播放中，消息暂时压入堆栈"),this.serverDataStack.push({cmd:e,data:i,fromData:o})):this.executeServerData(e,i,o),!0):void t.trace("房间数据没有初始化, 当前消息抛弃!");var a=t.dataProxy.replayVo.data;if(i==a[a.length-1]){var r=i;t.dataProxy.roomInfo.settlement=r,t.dataProxy.hasShowResult=!0,t.dataProxy.movieStart(),t.dataProxy.updatePlayerGold(),t.sendNotification(t.CDDGameSceneMediator.PLAYER_SHOW_RESULT)}else{var n=i;t.dataProxy.setRoomInfo(n),t.sendNotification(t.CDDGameSceneMediator.GAME_INFO)}}},o.prototype.cmdNeedToStack=function(e){return e==t.CDDProtocol.TABLE_LEAVE_S?!1:!0},o.prototype.onReconnecting=function(){this.roomInfoInited=!1,SimpleLoading.show(t.i18n("网络异常，游戏重连中...")),t.trace("网络断开，开始重连")},o.prototype.onReconnectOk=function(){SimpleLoading.hide(),t.trace("重连成功！"),this.sendMessage(t.CDDProtocol.CDD_GET_SNAPSHOT_C)},o.prototype.sendMessage=function(e,i){t.dataProxy.centerConfig.socketProxy.sendMessage(this.topic,t.dataProxy.centerConfig.type,t.dataProxy.centerConfig.area,e,i),t.trace("send cmd ["+e+"], data:",i)},o.prototype.executeServerData=function(e,i,o){switch(t.trace("executeServerData cmd ["+e+"], data:",i),e){case t.CDDProtocol.CDD_GET_SNAPSHOT_S:var a=i;t.dataProxy.setRoomInfo(a),t.sendNotification(t.CDDGameSceneMediator.GAME_INFO,!0),this.roomInfoInited=!0,DevelopMain.dataInited=!0;break;case t.CDDProtocol.CDD_BEGIN_S:t.dataProxy.isClickResultView=!1,t.sendNotification(t.CDDGameSceneMediator.GAME_RESET);var r=i;t.dataProxy.setFirstTurn(r),t.sendNotification(t.CDDGameSceneMediator.START_GAME);break;case t.CDDProtocol.CDD_YOUR_TRUN_B:var n=i;t.dataProxy.updateActionAble(n);break;case t.CDDProtocol.CDD_DISCARD_B:var s=i;t.dataProxy.updateCurrentDiscard(s);break;case t.CDDProtocol.CDD_COUNTDOWN_B:if(null!=t.dataProxy.roomInfo){var h=i;t.dataProxy.roomInfo.time=h.second,t.dataProxy.roomInfo.state=h.state,t.sendNotification(t.CDDGameSceneMediator.UPDATE_COUNT_DOWN)}break;case t.CDDProtocol.CDD_JOIN_B:var l=i;t.dataProxy.someOneJoin(l);break;case t.CDDProtocol.CDD_LEAVE_B:var c=i;t.dataProxy.someOneLeave(c);break;case t.CDDProtocol.CDD_READY_B:var d=i;t.dataProxy.updatePlayerReadyStatus(d);break;case t.CDDProtocol.CDD_SETTLEMENT_B:var p=i;if(null!=p&&p.settlementInfo.length>0)for(var u=0;u<p.settlementInfo.length;u++)t.CddSettlementInfoDTO.maskNick(p.settlementInfo[u]);t.dataProxy.roomInfo.settlement=p,t.dataProxy.hasShowResult=!0,t.dataProxy.updatePlayerGold(),t.sendNotification(t.CDDGameSceneMediator.PLAYER_SHOW_RESULT);break;case t.CDDProtocol.CDD_TRUSTEESHIP_B:var D=i;t.dataProxy.updatePlayerTrustShip(D),t.sendNotification(t.CDDGameSceneMediator.PLAYER_TRUST_SHIP);break;case t.CDDProtocol.TABLE_CHAT_B:var f=i;if(!f)return;var y=t.dataProxy.getPlayerInfoByUid(f.uid);if(!y)return;var C=t.dataProxy.getUIPosByServerPos(y.position);if(-1==C)return;ChatManager.showChatAt(C,f,1==y.sex);break;case t.CDDProtocol.TABLE_NOT_EXISTS_S:t.alert(t.i18n("房间已解散，请重新进入房间."),function(){t.sendNotification(t.CDDExitCommand.NAME)});break;case t.CDDProtocol.CDD_REFRESH_TABLE_ID_B:var m=i;
t.dataProxy.roomInfo.tableId=m,t.trace("server牌局编号:"+m),t.sendNotification(t.CDDGameSceneMediator.GAME_SHOW_TABLE);break;case t.CDDProtocol.CDD_READY_FOR_NEXT_ROUND_S:var g=i;1==g&&t.dataProxy.changeMyReadyStatus(),t.sendNotification(t.CDDGameSceneMediator.ROOM_CONTINUE_GAME,g);break;case t.CDDProtocol.CDD_INIT_FOR_NEXT_ROUND_B:t.sendNotification(t.CDDGameSceneMediator.GAME_RESET);break;case t.CDDProtocol.CDD_OPERATE_FAIL_S:var _=i,v="";_&&(v=format_XY2(t.i18n(_.m),_.a),Toast.show(v));break;case t.CDDProtocol.TABLE_LEAVE_S:var v,T=i,P=T.s;if(0>P)v=format_XY2(t.i18n(i.m),i.a),Toast.show(v),SimpleLoading.hide(),t.CDDLoading.getInstance().hide();else if(888888==P)this.roomInfoInited=!1,t.dataProxy.gameExited=!0,DevelopMain.dataInited=!1;else if(999999==P){this.roomInfoInited=!1,t.dataProxy.gameExited=!0,DevelopMain.dataInited=!1,t.dataProxy.lastGamePlayerIds=[],null!=T.m&&""!=T.m&&(v=format_XY2(t.i18n(T.m),T.a),Toast.show(v));var E=new JoinDTO(t.dataProxy.centerConfig.moduleType,T.d);t.dataProxy.centerConfig.socketProxy.sendMessage(ModuleType.MODULE_LOBBY+TopicType.HD_SWITCHTABLE,t.dataProxy.centerConfig.type,t.dataProxy.centerConfig.area,0,E)}else this.roomInfoInited=!1,t.dataProxy.gameExited=!0,DevelopMain.dataInited=!1,SocketManager.getInstance().disconnect(),DevelopMain.dataInited=!1,T.m?t.alert(format_XY2(t.i18n(T.m),T.a),function(){t.sendNotification(t.CDDExitCommand.NAME)}):t.sendNotification(t.CDDExitCommand.NAME)}},o.NAME=GameIdEnum.CDD+"CDDSocketMediator",o.START_CONNECT=o.NAME+"START_CONNECT",o.SHIFT_ALL_SERVER_DATA=o.NAME+"SHIFT_ALL_SERVER_DATA",o.SEND_JOIN_C=o.NAME+"SEND_JOIN_C",o.SWITCH_ROOM=o.NAME+"SWITCH_ROOM",o}(puremvc.Mediator);t.CDDSocketMediator=i,__reflect(i.prototype,"CDD.CDDSocketMediator",["ISocketDataHandler"]),t.sendSocketMessage=e}(CDD||(CDD={}));var CDD;!function(t){var e=function(){function t(){}return t.containsPointA=function(t){for(var e=0;e<t.length;e++)if(t[e].point==card.Point.A)return!0;return!1},t.containsPointB2=function(t){for(var e=0;e<t.length;e++)if(t[e].point==card.Point.B2)return!0;return!1},t.showDiscardCardTurn=function(t,e){var i=[];if(e==card.CDDPokerGroupType.FULL_HOUSE){var o=card.CDDTool.sort(t);i=o[0].point==o[2].point?o:o.reverse()}else if(e==card.CDDPokerGroupType.FOUR_OF_A_KIND){var a=card.CDDTool.sort(t);i=a[0].point==a[1].point?a:a.reverse()}else if(e==card.CDDPokerGroupType.STRAIGHT||e==card.CDDPokerGroupType.STRAIGHT_FLUSH){if(t.length>0&&(i=card.CDDTool.sort(t)),this.containsPointA(i)&&this.containsPointB2(i)){var r=i.slice(0,3),n=i.slice(3,5);i=n.concat(r)}else if(this.containsPointB2(i)&&!this.containsPointA(i)){var a=i.slice(0,4),s=i.slice(4,5);i=s.concat(a)}}else t.length>0&&(i=card.CDDTool.sort(t));return i},t}();t.CDDCardsUtils=e,__reflect(e.prototype,"CDD.CDDCardsUtils")}(CDD||(CDD={}));var CDD;!function(t){var e=function(){function t(){}return t.dispose=function(){SoundManager.dispose(GameIdEnum.CDD)},t.bgm=function(){this.play("ready",!0)},t.chooseCard=function(){this.play("select")},t.gameStart=function(t){var e=1==t?"boy_":"girl_";this.play(e+"start")},t.playPass=function(t){var e=1==t?"boy_":"girl_";this.play(e+"pass")},t.playLast=function(t){var e=1==t?"boy_":"girl_",i=randomInt_XY(1,3);this.play(e+"over"+i)},t.playWin=function(t){var e=1==t?"boy_":"girl_",i=randomInt_XY(1,5);this.play(e+"win"+i)},t.playFaPaiBg=function(){this.play("game_dispatch")},t.stopFaPaiBg=function(){SoundManager.stop("game_dispatch",!1)},t.playSingle=function(t,e){if(!(t.length<=0)){var i=1==e?"c_m_":"c_f_",o=t[0],a=o.point;this.play(i+a)}},t.playDouble=function(t,e){var i;if(!(t.length<=0)){var o=1==e?"c_m_":"c_f_",a=t[0];i=a.point;var r=i+"_2";this.play(o+r)}},t.playThree=function(t,e){var i;if(!(t.length<=0)){var o=1==e?"boy_":"girl_",a=t[0];i=a.point;var r="santiao";this.play(o+r)}},t.playFlush=function(t){var e=1==t?"boy_":"girl_",i="tonghua";this.play(e+i)},t.playEffect=function(){this.play("plane_effect")},t.playFullHouse=function(t){var e=1==t?"boy_":"girl_";this.play(e+"fulao")},t.playFourWithOne=function(t){var e=1==t?"boy_":"girl_";this.play(e+"sitiao")},t.playShunzi=function(t){var e=1==t?"boy_":"girl_";this.play(e+"shun")},t.playBomb=function(t){var e=1==t?"boy_":"girl_";this.play(e+"tonghuashun")},t.play=function(t,e){void 0===e&&(e=!1),""!=t&&(t=GameIdEnum.CDD+"_"+t+"_mp3",RES.getRes(t)&&(e?SoundManager.playBg(t,0,-1):SoundManager.playEffect(t)))},t}();t.CDDSoundPlayer=e,__reflect(e.prototype,"CDD.CDDSoundPlayer")}(CDD||(CDD={}));var CDD;!function(t){var e=function(){function e(){}return e.getScaleModelStr=function(){return Global.stage.scaleMode},e.getUIPosByServerPos=function(e){var i=t.dataProxy.selfIndex,o=this.DONG,a=this.NAN,r=this.XI,n=this.BEI;if(i==o){if(e==o)return 1;if(e==a)return 2;if(e==r)return 3;if(e==n)return 0}if(i==a){if(e==o)return 0;if(e==a)return 1;if(e==r)return 2;if(e==n)return 3}if(i==r){if(e==o)return 3;if(e==a)return 0;if(e==r)return 1;if(e==n)return 2}if(i==n){if(e==o)return 2;if(e==a)return 3;if(e==r)return 0;if(e==n)return 1}return-1},e.DONG=0,e.NAN=1,e.XI=2,e.BEI=3,e}();t.CDDStringUtils=e,__reflect(e.prototype,"CDD.CDDStringUtils")}(CDD||(CDD={}));var CDD;!function(t){function e(t,e){o.init(),o.instance.showAlert(t,e)}function i(t,e,i){o.init(),o.instance.showConfirm(t,e,i)}var o=function(t){function e(){var e=t.call(this,"CDDAlertSkin")||this;return i18nEUI(GameIdEnum.CDD,e,[e.okBtn,e.cancelBtn]),bindTapEvent_XY(e.okBtn,e.onOk,e,!1,null,!1,!0),bindTapEvent_XY(e.cancelBtn,e.onNo,e,!1,null,!1,!0),bindTapEvent_XY(e.closeBtn,e.onClose,e,!0),e}return __extends(e,t),e.init=function(){e.instance=e.instance||new e},e.dispose=function(){e.instance&&e.instance.dispose(),e.instance=null},e.prototype.dispose=function(){t.prototype.dispose.call(this),this.okCall=null,this.cancelCall=null,clearTapEvent_XY(this.okBtn,this.onOk,this),clearTapEvent_XY(this.cancelBtn,this.onNo,this),clearTapEvent_XY(this.closeBtn,this.onClose,this)},e.prototype.onOk=function(){this.okCall&&this.okCall(),this.hide()},e.prototype.onNo=function(){this.cancelCall&&this.cancelCall(),this.hide()},e.prototype.onClose=function(){this.hide()},e.prototype.showAlert=function(t,e){this.okCall=e;var i=puremvc.Facade.getInstance(GameIdEnum.CDD).layout;i.msgLayer.addChild(this),setHtmlText(this.tf,t),remove_XY(this.cancelBtn),this.okBtn.x=0,tween_XY_alphaShow(this)},e.prototype.showConfirm=function(t,e,i){this.okCall=e,this.cancelCall=i;var o=puremvc.Facade.getInstance(GameIdEnum.CDD).layout;o.msgLayer.addChild(this),setHtmlText(this.tf,t),this.btnGrp.addChild(this.cancelBtn),tween_XY_alphaShow(this),this.okBtn.x=248},e.prototype.hide=function(){this.okCall=null,this.cancelCall=null,remove_XY(this)},e}(BaseComponent);t.XYAlert=o,__reflect(o.prototype,"CDD.XYAlert"),t.alert=e,t.confirm=i}(CDD||(CDD={}));var CDD;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.mLabel="",e.mLabelSize=30,bindEuiCreateOkEventOnce_XY(e,e.onInit,e),e.isEnable=!0,e}return __extends(e,t),e.prototype.onInit=function(){setHtmlText(this.tf,this.mLabel),this.bg.source="CDD_btn_tb2_png",this.a_labelColor=14868963,this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onEffectBeginTouchHandler,this),this.addEventListener(egret.TouchEvent.TOUCH_CANCEL,this.onEffectEndTouchHandler,this),this.addEventListener(egret.TouchEvent.TOUCH_END,this.onEffectEndTouchHandler,this),this.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onEffectEndTouchHandler,this)},e.prototype.onEffectBeginTouchHandler=function(){this.isEnable&&(this.bg.source="CDD_btn_tb1_png",this.a_labelColor=4925952,this.useTapSound&&SoundManager.playEffect(__tapSound))},e.prototype.onEffectEndTouchHandler=function(){this.isEnable&&(this.bg.source="CDD_btn_tb2_png",this.a_labelColor=14868963)},e.prototype.setEnalble=function(t){this.touchEnabled=t,this.touchChildren=t,this.isEnable=t,t?(this.bg.source="CDD_btn_tb2_png",this.a_labelColor=14868963):(this.bg.source="CDD_btn_an2_png",this.a_labelColor=4211011)},e.prototype.dispose=function(){this.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onEffectBeginTouchHandler,this),this.removeEventListener(egret.TouchEvent.TOUCH_CANCEL,this.onEffectEndTouchHandler,this),this.removeEventListener(egret.TouchEvent.TOUCH_END,this.onEffectEndTouchHandler,this),this.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onEffectEndTouchHandler,this)},e.prototype.setHtmlLabel=function(t){this.mLabel=t,this.tf&&setHtmlText(this.tf,t)},Object.defineProperty(e.prototype,"a_label",{get:function(){return this.mLabel},set:function(t){this.mLabel=t,this.tf&&setHtmlText(this.tf,t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"a_labelSize",{get:function(){return this.mLabelSize},set:function(t){this.mLabelSize=t,this.tf&&(this.tf.size=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"a_labelColor",{get:function(){return this.mLabelColor},set:function(t){this.mLabelColor=t,this.tf&&(this.tf.textColor=t)},enumerable:!0,configurable:!0}),e}(eui.Component);t.XYButton=e,__reflect(e.prototype,"CDD.XYButton")}(CDD||(CDD={}));var CDD;!function(t){var e=function(e){function i(t){return e.call(this,i.NAME,t)||this}return __extends(i,e),i.prototype.listNotificationInterests=function(){return[i.SHOW,i.GAME_INFO,i.START_GAME,i.READY,i.UPDATE_TURN,i.UPDATE_COUNT_DOWN,i.PLAYER_DISCARD,i.PLAYER_SHOW_RESULT,i.PLAYER_TRUST_SHIP,i.GAME_RESET,i.GAME_SHOW_TABLE,i.ROOM_CONTINUE_GAME,i.CHECK_WAIT_INFO,i.SOME_ONE_JOIN,i.SOME_ONE_LEAVE]},i.prototype.handleNotification=function(e){var o=e.getBody();switch(e.getName()){case i.SHOW:this.gameScene||(this.gameScene=new t.CDDGameScene,this.gameScene.init()),this.getLayer().addChild(this.gameScene);break;case i.GAME_INFO:this.gameScene&&this.gameScene.updateRoomInfo(o);break;case i.START_GAME:this.gameScene&&this.gameScene.gameStart();break;case i.UPDATE_TURN:this.gameScene&&this.gameScene.updateTurn();break;case i.UPDATE_COUNT_DOWN:this.gameScene&&this.gameScene.showCountDown();break;case i.SOME_ONE_JOIN:this.gameScene&&this.gameScene.someOneJoin(o);break;case i.SOME_ONE_LEAVE:this.gameScene&&this.gameScene.someOneLeave(o);break;case i.PLAYER_DISCARD:this.gameScene&&this.gameScene.doShowDiscards(o);break;case i.PLAYER_SHOW_RESULT:this.gameScene&&this.gameScene.showResult();break;case i.PLAYER_TRUST_SHIP:this.gameScene&&this.gameScene.updatePlayerInfo();break;case i.GAME_RESET:this.gameScene&&this.gameScene.nextRound();break;case i.GAME_SHOW_TABLE:this.gameScene&&this.gameScene.updateTableTf();break;case i.ROOM_CONTINUE_GAME:this.gameScene&&this.gameScene.refreshContinue(o);break;case i.CHECK_WAIT_INFO:this.gameScene&&this.gameScene.checkWait();break;case i.READY:this.gameScene&&this.gameScene.updatePlayerStatus()}},i.prototype.onRemove=function(){e.prototype.onRemove.call(this),this.gameScene&&(this.gameScene.dispose(),remove_XY(this.gameScene),this.gameScene=null)},i.NAME=GameIdEnum.CDD+"CDDGameSceneMediator",i.SHOW=i.NAME+"SHOW",i.GAME_INFO=i.NAME+"GAME_INFO",i.START_GAME=i.NAME+"START_GAME",i.READY=i.NAME+"READY",i.PLAYER_DISCARD=i.NAME+"PLAYER_DISCARD",i.UPDATE_COUNT_DOWN=i.NAME+"UPDATE_COUNT_DOWN",i.PLAYER_SHOW_RESULT=i.NAME+"PLAYER_SHOW_RESULT",i.PLAYER_TRUST_SHIP=i.NAME+"PLAYER_TRUST_SHIP",i.PLAY_CHAT=i.NAME+"PLAY_CHAT",i.UPDATE_TURN=i.NAME+"UPDATE_TURN",i.GAME_RESET=i.NAME+"GAME_RESET",i.SOME_ONE_JOIN=i.NAME+"SOME_ONE_JOIN",i.SOME_ONE_LEAVE=i.NAME+"SOME_ONE_LEAVE",i.GAME_SHOW_TABLE=i.NAME+"GAME_SHOW_TABLE",i.ROOM_CONTINUE_GAME=i.NAME+"ROOM_CONTINUE_GAME",i.CHECK_WAIT_INFO=i.NAME+"CHECK_WAIT_INFO",i}(t.AbstractMediator);t.CDDGameSceneMediator=e,__reflect(e.prototype,"CDD.CDDGameSceneMediator")}(CDD||(CDD={}));var CDD;!function(t){var e=function(e){function i(){var i=e.call(this,"CDDGameSceneSkin")||this;return i.selectTypeIndex=-1,i.preType=-1,i.timeSendCard=0,i.replayDiscardDTO=new t.CddDiscardDTO,i.countDown=0,i.smallDiscardUIArr=[],i.fangThree=new card.Card(0,3),i.totalArr=[],i.totalSendCount=0,i.doCount=0,i.totalCount=0,i.p0=new egret.Point,i.p1=new egret.Point,i.p2=new egret.Point,i.p3=new egret.Point,i.renderArr=[],i.clearTimeOutNum=0,i.initEvent(),i}return __extends(i,e),i.prototype.initEvent=function(){i18nEUI(GameIdEnum.CDD,this,[]),bindTapEvent_XY(this.tuoguan,this.clickTuoGuan,this),bindTapEvent_XY(this.tuoguanZhong,this.clickCancelTuoGuan,this),bindTapEvent_XY(this.volumeOpen,this.clickMenu,this),bindTapEvent_XY(this.volumeClose,this.clickMenu,this),bindTapEvent_XY(this.backBtn,this.clickMenu,this),bindTapEvent_XY(this.introBtn,this.clickMenu,this),bindTapEvent_XY(this.replayGrp,this.copyBoard,this),bindTapEvent_XY(this.friendGrp,this.copyNum,this),bindTapEvent_XY(this.imagedesk,this.clickStage,this),bindTapEvent_XY(this.copyRoomInfoBtn,this.copyNum,this,!0,["copy_btn_0_png","copy_btn_1_png"]),bindTapEvent_XY(this.readyBtnGrp,this.clickReady,this,!0),bindTapEvent_XY(this.chatBtn,this.onChat,this,!0),this.volumeClose.visible=SoundManager.getBgMute(),this.volumeOpen.visible=!this.volumeClose.visible},i.prototype.init=function(){this.introView.init(),this.introView.visible=!1,this.replayTf.text=t.i18n("牌局编号:{0}","--"),this.gameResult.init(),this.opBtn.init(),this.opBtn.addEventListener("touchBtn",this.clickBtn,this),this.handCard1.addEventListener("canClickCancel",this.showCancelBtn,this),this.trustShip.init(),this.grpOption.init();for(var e=0;4>e;e++)if(1!=e){var i=this["replayHand"+e];i.visible=!1}this.handCard1.init();for(var e=0;4>e;e++)if(1!=e){var o=this["headGrp"+e];o.init(e)}this.headGrp1.init(),this.pass1.hide();for(var e=0;4>e;e++){var a=this["arrow"+e];a.init(e),this["playerReady"+e].setIndex(e),this["playerReady"+e].init()}this.grpOption.init(),this.grpOption.setCallBack(this.clickPassOver,this.clickCancel,this.clickDealCard,this),this.copyRoomInfoBtn.visible=!1,this.readyBtnGrp.visible=!1,this.hideRule(),ChatManager.setup(RES.getRes("chat_config_json"),[this.chatCtx0,this.chatCtx1,this.chatCtx2,this.chatCtx3],[1,1,2,1])},i.prototype.showNORule=function(){this.noRuleGrp.visible=!0,egret.Tween.removeTweens(this.image_noRule),this.image_noRule.alpha=1,egret.Tween.get(this.image_noRule).to({scaleX:1.5,scaleY:1.5},500).to({scaleX:1,scaleY:1,alpha:0},500)},i.prototype.hideRule=function(){this.noRuleGrp.visible=!1,egret.Tween.removeTweens(this.image_noRule)},i.prototype.clickBtn=function(e){var i=e.data,o=[];-1==this.preType?this.preType=i:this.preType!=i&&(this.selectTypeIndex=-1,this.preType=i);var a=null,r=t.dataProxy.getSelfPlayerInfo().handCards;if(null!=r){if(t.dataProxy.roomInfo.actionable.lastDiscardUid<=0)a=card.CDDTool.getTypeCards(r,i),a&&a.cards.length>0&&(o=a.cards);else if(t.dataProxy.roomInfo.actionable.actionPlayerUid==t.dataProxy.myUid&&t.dataProxy.roomInfo.actionable.lastDiscardUid==t.dataProxy.myUid)a=card.CDDTool.getTypeCards(r,i),a&&a.cards.length>0&&(o=a.cards);else if(-1!=t.dataProxy.roomInfo.actionable.lastDiscardUid&&t.dataProxy.roomInfo.actionable.lastDiscardUid==t.dataProxy.roomInfo.actionable.actionPlayerUid){var a=card.CDDTool.getTypeCards(r,i);a&&a.cards.length>0&&(o=a.cards)}else{var n=t.dataProxy.roomInfo.actionable.lastDiscard,s=card.CDDTool.getPokerGroup(n),h=card.CDDTool.getBigTypeCards(s,r);if(null!=h&&h.length>0)for(var l=0;l<h.length;l++)h[l].type==i&&o.push(h[l].pokers)}if(-1==this.preType?this.selectTypeIndex=o.length-1:this.selectTypeIndex--,o.length>0){var c=[];(this.selectTypeIndex<0||this.selectTypeIndex>=o.length)&&(this.selectTypeIndex=o.length-1),c=o[this.selectTypeIndex];var d=0;switch(this.preType){case card.CDDPokerGroupType.ONE_CARD:d=1;break;case card.CDDPokerGroupType.ONE_PAIR:d=2;break;case card.CDDPokerGroupType.THREE_OF_A_KIND:d=3;break;case card.CDDPokerGroupType.STRAIGHT:case card.CDDPokerGroupType.FLUSH:case card.CDDPokerGroupType.FULL_HOUSE:case card.CDDPokerGroupType.FOUR_OF_A_KIND:case card.CDDPokerGroupType.STRAIGHT_FLUSH:d=5}c=c.slice(0,d),this.handCard1.setTargetTypeCards2(c)}}var p=this.handCard1.getDiscards();p.length>0?this.grpOption.setCancelCanClick(!0):this.grpOption.setCancelCanClick(!1)},i.prototype.clickStage=function(e){e.target;e.stopImmediatePropagation(),null!=t.dataProxy.roomInfo&&2==t.dataProxy.roomInfo.state&&t.dataProxy.roomInfo.actionable&&t.dataProxy.roomInfo.actionable.actionPlayerUid>0&&(this.handCard1.showAllDown(),this.handCard1.checkCanHandlePai())},i.prototype.copyNum=function(){var e=t.dataProxy.roomInfo;if(e&&e.friends){var i=t.i18n("底注:{0}",coin2Str_XY(t.dataProxy.roomInfo.anteValue));copyGameShareText_XY(GameIdEnum.CDD,t.dataProxy.centerConfig.area,i)}},i.prototype.onChat=function(){ChatManager.showPanel()},i.prototype.clickReady=function(){t.sendSocketMessage(t.CDDProtocol.CDD_READY_C)},i.prototype.checkReady=function(){var e=t.dataProxy.roomInfo;if(e){var i=e.state;if(-1==e.autoReady){var o=t.dataProxy.getPlayerInfoByUid(t.dataProxy.myUid);0==i&&o&&-1==o.ready?this.readyBtnGrp.visible=!0:this.readyBtnGrp.visible=!1}else this.readyBtnGrp.visible=!1}},i.prototype.updatePlayerStatus=function(){for(var t=0;4>t;t++)this["playerReady"+t].updateData();this.checkReady(),this.checkWait()},i.prototype.copyBoard=function(){copyTextToClipboard_XY(this.replayTf.text,function(){Toast.show(t.i18n("复制牌局编号成功!"))},function(){})},i.prototype.clickMenu=function(e){var i=e.target;switch(i){case this.backBtn:t.sendSocketMessage(t.CDDProtocol.TABLE_TRY_TO_LEAVE_C);break;case this.introBtn:this.showRule();break;case this.volumeOpen:this.volumeOpen.visible=!1,this.volumeClose.visible=!0,SoundManager.setBgMute(!0),SoundManager.setEffectMute(!0);break;case this.volumeClose:this.volumeOpen.visible=!0,this.volumeClose.visible=!1,SoundManager.setBgMute(!1),SoundManager.setEffectMute(!1)}},i.prototype.clearAllCountDown=function(){this.headGrp0.showCount(0),this.headGrp2.showCount(0),this.headGrp3.showCount(0),this.grpOption.showCount(0);for(var t=0;4>t;t++){var e=this["arrow"+t];e.hide()}this.clearTimer()},i.prototype.updateTurn=function(){if(2==t.dataProxy.roomInfo.state){var e=t.dataProxy.roomInfo.actionable;if(-1!=e.actionPlayerUid){this.clearAllCountDown();var i=t.dataProxy.getPlayerInfoByUid(e.actionPlayerUid);if(null!=i){var o=t.dataProxy.getUIPosByServerPos(i.position);t.dataProxy.centerConfig.replayMode?1==o?this.grpOption.showCount(4):this["headGrp"+o].showCount(4):1==o?this.grpOption.showCount(e.timeOut):this["headGrp"+o].showCount(e.timeOut),this.showDealCards(e.actionPlayerUid)}}}},i.prototype.showCancelBtn=function(t){var e=t.data;this.grpOption.setCancelCanClick(e)},i.prototype.hideOptionGrp=function(){this.grpOption.visible=!1},i.prototype.enAllBtnsAndCards=function(){this.opBtn.enableAllBtn(),this.handCard1.enableAllCards()},i.prototype.hideAllArow=function(){this.arrow0.hide(),this.arrow1.hide(),this.arrow2.hide(),this.arrow3.hide()},i.prototype.showDealCards=function(e){this.startTimer();var i=t.dataProxy.getPlayerInfoByUid(e),o=t.dataProxy.roomInfo.actionable.lastDiscard;if(e==t.dataProxy.myUid){var a=this.discardGrp1;a.removeChildren(),this.grpOption.clearAllGrp();var r=this.pass1;r.hide();var n=this.checkDealCardState();if(1==i.trusteeshipState)this.hideOptionGrp(),this.opBtn.visible=!1,2==n&&this.clearSmallDiscardUI();else{this.opBtn.visible=!0,1==n?(this.grpOption.setStateAll(),t.trace("轮到我打牌，检测是否要的起别人的牌"),this.checkBiggerCards(o)):2==n?(this.grpOption.setOnlySend(),this.clearSmallDiscardUI(),this.checkHandCards(),this.isLastShou()):3==n&&(this.grpOption.setOnlyPass(),this.enAllBtnsAndCards());var s=this.handCard1.getDiscards();s.length>0?this.grpOption.setCancelCanClick(!0):this.grpOption.setCancelCanClick(!1)}this.arrow1.show()}else{var h=!1;e==t.dataProxy.roomInfo.actionable.lastDiscardUid?(h=!0,t.trace("轮到"+i.name+"主动打牌ID ")):h=!1,h?(this.clearSmallDiscardUI(),this.checkHandCards()):this.checkBiggerCards(o);var l=t.dataProxy.getUIPosByServerPos(i.position),c=this["headGrp"+l];c.hidePass();var d=this["discardGrp"+l];d.removeChildren(),this["headGrp"+l].clearAllGrp(),this["arrow"+l].show()}},i.prototype.isLastShou=function(){},i.prototype.checkDealCardState=function(){var e=-1;if(t.dataProxy.roomInfo.actionable.lastDiscardUid<=0)e=2;else if(t.dataProxy.roomInfo.actionable.lastDiscardUid==t.dataProxy.myUid)e=2;else{var i=t.dataProxy.roomInfo.actionable.lastDiscard,o=t.dataProxy.getSelfPlayerInfo(),a=card.CDDTool.getPokerGroup(i);if(null!=a){var r=card.CDDTool.getBigTypeCards(a,o.handCards);e=null==r||0==r.length?3:1}else t.trace("别人打出去的牌，测试找不到类型")}return e},i.prototype.showOtherCardInfo=function(){var e=t.dataProxy.getSelfPlayerInfo();if(t.dataProxy.centerConfig.replayMode||t.dataProxy.isCheat){var i=t.dataProxy.roomInfo.actionable.lastOpPlayerUid,o=t.dataProxy.roomInfo.actionable.lastOpPlayerActionType,a=t.dataProxy.getPlayerInfoByUid(i);if(a){var r=t.dataProxy.getUIPosByServerPos(a.position);if(this.replayDiscardDTO.uid=i,this.replayDiscardDTO.discard=a.lastDiscard,this.replayDiscardDTO.discardType=o,this.showDiscardsMusic(this.replayDiscardDTO),o!=card.CDDPokerGroupType.CDD_PASS){var n=a.lastDiscard;if(null==n)return;1==r?this.grpOption.clearAllGrp():this["headGrp"+r].clearAllGrp(),this.addDiscardUi(r,n,o)}else 1==r?this.grpOption.clearAllGrp():this["headGrp"+r].clearAllGrp(),1==r?this.pass1.show():this["headGrp"+r].showPass()}}else{var s=t.dataProxy.roomInfo.actionable.lastDiscardUid,h=t.dataProxy.roomInfo.actionable.lastDiscard,l=(t.dataProxy.roomInfo.actionable.lastDisscardType,t.dataProxy.getPlayerInfoByUid(s));if(l){var r=t.dataProxy.getUIPosByServerPos(l.position);if(null==h)return;-1!=e.lastDisscardType?e.lastDisscardType==card.CDDPokerGroupType.CDD_PASS?1==r?this.pass1.show():this["headGrp"+r].showPass():this.addDiscardUi(r,e.lastDiscard,e.lastDisscardType):this.grpOption.clearAllGrp();for(var c=t.dataProxy.roomInfo.players,d=0;d<c.length;d++){var p=c[d];if(p.uid!=t.dataProxy.myUid){var u=t.dataProxy.getUIPosByServerPos(p.position);-1!=p.lastDisscardType?p.lastDisscardType==card.CDDPokerGroupType.CDD_PASS?1==r?this.pass1.show():this["headGrp"+r].showPass():this.addDiscardUi(u,p.lastDiscard,p.lastDisscardType):1==r?this.grpOption.clearAllGrp():this["headGrp"+r].clearAllGrp()}}}}},i.prototype.showCountDown=function(){var e=t.dataProxy.roomInfo.state,i=t.dataProxy.roomInfo.actionable;switch(e){case 0:this.checkWait(),this.startTimer();break;case 1:this.waitGrp.visible=!1;break;case 2:if(this.waitGrp.visible=!1,null==i||-1==i.actionPlayerUid)return;this.startTimer(),this.showOtherCardInfo(),this.checkTuoGuan();break;case 3:this.countDown=t.dataProxy.roomInfo.time,this.countDown>0?(this.showResult(),null==this.countTimer&&(this.countTimer=new egret.Timer(1e3,0),this.countTimer.addEventListener(egret.TimerEvent.TIMER,this.showAdd,this)),this.countTimer.running||this.countTimer.start()):this.nextRound()}if(null!=t.dataProxy.roomInfo.actionable&&-1!=t.dataProxy.roomInfo.actionable.actionPlayerUid){var o=t.dataProxy.getSelfPlayerInfo();if(this.handCard1.updateData(o.handCards),this.handCard1.addListener(),t.dataProxy.centerConfig.replayMode||t.dataProxy.isCheat){if(!t.dataProxy.centerConfig.replayHidePoke||t.dataProxy.isCheat)for(var a=0;4>a;a++){var r=t.dataProxy.getPlayerInfoByPos(a);if(r.uid!=t.dataProxy.myUid){var n=t.dataProxy.getUIPosByServerPos(r.position),s=this["replayHand"+n];s.visible=!0,s.setData(r.handCards)}}t.dataProxy.doActionAbleSound(t.dataProxy.roomInfo)}}},i.prototype.startTimer=function(){if(t.dataProxy.roomInfo){var e=t.dataProxy.roomInfo.state;if(0==e)this.countDown=t.dataProxy.roomInfo.time;else{var i=t.dataProxy.roomInfo.actionable;i&&(this.countDown=i.timeOut)}this.countDown>0?(null==this.countTimer&&(this.countTimer=new egret.Timer(1e3,0),this.countTimer.addEventListener(egret.TimerEvent.TIMER,this.showAdd,this)),this.countTimer.start()):this.clearTimer()}},i.prototype.showAdd=function(){null!=t.dataProxy&&null!=t.dataProxy.roomInfo&&(this.countDown--,this.checkCountDown())},i.prototype.checkCountDown=function(){var e=t.dataProxy.roomInfo.state,i=t.dataProxy.roomInfo;if(3==e)this.countDown<=0&&this.nextRound();else if(2==e){var o=t.dataProxy.roomInfo.actionable;if(-1==o.actionPlayerUid)return;var a=t.dataProxy.getPlayerInfoByUid(o.actionPlayerUid);if(null==a)return;var r=t.dataProxy.getUIPosByServerPos(a.position);this.countDown>0?1==r?this.grpOption.showCount(this.countDown):this["headGrp"+r].showCount(this.countDown):(this.countTimer.stop(),1==r?this.grpOption.showCount(0):this["headGrp"+r].showCount(0))}else 0==t.dataProxy.roomInfo.state&&(-1==i.autoReady&&this.countDown>0?this.willStartLabel.text=t.i18n("游戏即将开始:{0}",this.countDown):this.willStartLabel.text="")},i.prototype.clearTimer=function(){this.countTimer&&this.countTimer.stop(),this.willStartLabel.text=""},i.prototype.someOneJoin=function(e){var i=t.dataProxy.getUIPosByServerPos(e),o=this["headGrp"+i];o&&o.setShow(e),this.checkWait()},i.prototype.someOneLeave=function(e){var i=t.dataProxy.getUIPosByServerPos(e),o=this["headGrp"+i];o&&o.setHide();var a=this["playerReady"+i];a&&(a.visible=!1)},i.prototype.addDiscardUi=function(e,i,o,a){void 0===a&&(a=!1),i=t.CDDCardsUtils.showDiscardCardTurn(i,o);var r=t.CDDSmallDiscard.make(e);r.setData(i),r.anchorOffsetX=r.width/2,r.anchorOffsetY=r.height/2;var n=this["discardGrp"+e];n.removeChildren(),n.addChild(r),r.x=n.width/2,r.y=n.height/2,egret.Tween.removeTweens(r),this.smallDiscardUIArr.push(r)},i.prototype.doShowDiscards=function(e){this.showDiscardsMusic(e);t.dataProxy.getPlayerInfoByUid(e.uid),t.dataProxy.getSexById(e.uid);if(e.uid==t.dataProxy.myUid)if(this.grpOption.showCount(0),e.discardType==card.CDDPokerGroupType.CDD_PASS){var i=this.pass1;i.show(),this.hideOptionGrp()}else{this.grpOption.clearAllGrp(),this.addDiscardUi(1,e.discard,e.discardType,!0);var o=t.dataProxy.getSelfPlayerInfo();this.handCard1.updateData(o.handCards),t.trace("自己打出牌以后，检测是否要的起刚才自己打出来的牌"),this.checkBiggerCards(e.discard)}else{var a=t.dataProxy.getPlayerInfoByUid(e.uid),r=t.dataProxy.getUIPosByServerPos(a.position);if(1==r?this.grpOption.showCount(0):this["headGrp"+r].showCount(0),e.discardType==card.CDDPokerGroupType.CDD_PASS)1==r?this.pass1.show():this["headGrp"+r].showPass();else{if((t.dataProxy.centerConfig.replayMode||t.dataProxy.isCheat)&&!t.dataProxy.centerConfig.replayHidePoke){var n=this["replayHand"+r];n.visible=!0,n.setData(a.handCards)}1==r?this.grpOption.clearAllGrp():this["headGrp"+r].clearAllGrp(),this["headGrp"+r].setRemainCount(a.remaining+""),this.addDiscardUi(r,e.discard,e.discardType,!0),t.trace("别人打出牌以后，检测是否要的起刚才自己打出来的牌"),this.checkBiggerCards(e.discard)}}},i.prototype.clearSmallDiscardUI=function(){for(;this.smallDiscardUIArr.length>0;){var t=this.smallDiscardUIArr.shift();remove_XY(t)}this.headGrp0.hidePass(),this.headGrp2.hidePass(),this.headGrp3.hidePass(),this.pass1.hide()},i.prototype.showDiscardsMusic=function(e){var i=t.dataProxy.getSexById(e.uid);if(e.discardType==card.CDDPokerGroupType.CDD_PASS)t.CDDSoundPlayer.playPass(i);else{var o=e.discardType,a=e.discard;t.dataProxy.addDealsCardsMusic(o,a,i),this.dealAnimation(e)}},i.prototype.dealAnimation=function(t){},i.prototype.showResult=function(){this.gameResult.updateTime(t.dataProxy.roomInfo.time),this.gameResult.setData()},i.prototype.updatePlayerInfo=function(){this.setPlayerInfo(),this.checkTuoGuan()},i.prototype.nextRound=function(){t.dataProxy.resetRoomInfo(),this.resetUI()},i.prototype.resetUI=function(){this.gameResult.resetUi(),this.opBtn.resetUi(),this.trustShip.resetUi(),this.grpOption.resetUi(),this.hideRule();for(var t=0;4>t;t++)if(1!=t){var e=this["replayHand"+t];e.visible=!1}this.handCard1.removeUI(),this.setPlayerInfo();for(var t=0;4>t;t++)if(1!=t){var i=this["headGrp"+t];i.hidePass(),i.clearAllGrp()}this.grpOption.clearAllGrp(),this.pass1.hide();for(var t=0;4>t;t++){var o=this["arrow"+t];o.resetUi(),this["playerReady"+t].updateData()}this.clearSmallDiscardUI(),this.checkReady()},i.prototype.refreshContinue=function(t){1==t&&(this.gameResult.clearTimer(),this.gameResult.visible=!1,this.resetUI())},i.prototype.showRule=function(){this.introView.showView()},i.prototype.updateTableTf=function(){t.dataProxy.roomInfo.state;t.trace("编号: "+t.dataProxy.roomInfo.tableId),this.replayTf.text=t.i18n("牌局编号:{0}",t.dataProxy.roomInfo.tableId),this.updateRound()},i.prototype.updateRound=function(){this.dizhuTf.text=t.i18n("底注:{0}",coin2Str_XY(t.dataProxy.roomInfo.anteValue))+" "+t.i18n("局数:{0}{1}{2}",t.dataProxy.roomInfo.curRound,"/",t.dataProxy.roomInfo.totalRound)},i.prototype.checkWait=function(){if(t.dataProxy.roomInfo){if(t.dataProxy.roomInfo.players&&t.dataProxy.roomInfo.players.length<4)if(-1==t.dataProxy.roomInfo.autoReady){var e=t.dataProxy.getSelfPlayerInfo();e&&1==e.ready?this.waitGrp.visible=!0:this.waitGrp.visible=!1}else this.gameResult&&0==this.gameResult.visible?this.waitGrp.visible=!0:this.waitGrp.visible=!1;else this.waitGrp.visible=!1;1==t.dataProxy.roomInfo.antiCheatConf&&(this.waitGrp.visible=!1)}},i.prototype.clickPassOver=function(){t.trace("过");var e=new t.CddDiscardDTO;e.uid=t.dataProxy.myUid,e.discardType=-1,e.discard=[],t.sendSocketMessage(t.CDDProtocol.CDD_DISCARD_C,e),this.selectTypeIndex=-1,this.preType=-1,this.handCard1.showAllDown()},i.prototype.clickCancel=function(){this.handCard1.showAllDown(),this.grpOption.setCancelCanClick(!1)},i.prototype.clickDealCard=function(){var e=this.handCard1.getDiscards();if(null!=e&&0!=e.length){var i=card.CDDTool.getPokerGroup(e);if(null!=i){var o=new t.CddDiscardDTO,a=i.type;if(t.dataProxy.roomInfo.actionable.lastDiscardUid<=0||t.dataProxy.roomInfo.actionable.lastDiscardUid==t.dataProxy.myUid){var r=!1;if(1==t.dataProxy.roomInfo.curRound){var n=t.dataProxy.getSelfPlayerInfo();if(13==n.handCards.length){for(var s=0;s<e.length;s++)if(e[s].type==this.fangThree.type&&e[s].point==this.fangThree.point){r=!0;break}if(!r)return void Toast.show(t.i18n("打出去的牌必须包含方块3!"))}}o.discard=i.pokers,o.discardType=a,o.uid=t.dataProxy.myUid,this.hideOptionGrp(),this.grpOption.showCount(0),t.sendSocketMessage(t.CDDProtocol.CDD_DISCARD_C,o)}else{var h=t.dataProxy.roomInfo.actionable.lastDiscard,l=card.CDDTool.getPokerGroup(h);null!=l&&(1==i.compare(l)?(o.discard=i.pokers,o.discardType=a,o.uid=t.dataProxy.myUid,this.hideOptionGrp(),this.grpOption.showCount(0),t.sendSocketMessage(t.CDDProtocol.CDD_DISCARD_C,o)):this.showNORule())}}else this.showNORule()}},i.prototype.gameStart=function(){this.addDiscardAnimation(),this.setPlayerInfo(),this.updateRound(),this.checkWait();var e=t.dataProxy.getSelfPlayerInfo();t.CDDSoundPlayer.gameStart(e.sex);for(var i=0;4>i;i++)this["playerReady"+i].visible=!1;this.willStartLabel.text=""},i.prototype.addDiscardAnimation=function(){this.sendCardNum=1,this.renderArr.length=0,this.totalSendCount=13;for(var t=0;52>t;t++){var e=new eui.Image;e.source="CDD_icon_pai_png",this.cardContainier.addChild(e),e.scaleX=.6,e.scaleY=.6,e.anchorOffsetX=80,e.anchorOffsetY=111,e.x=Global.stage.stageWidth/2,e.y=Global.stage.stageHeight/2-.4*t,this.totalArr.push(e)}this.doCount=0,this.totalCount=0,this.doAction()},i.prototype.doAction=function(){this.totalArr.length>0?(this.doCount++,this.doTweener()):(this.totalArr.length=0,this.cardContainier.removeChildren(),t.trace("发牌完毕"),this.setPlayerInfo(),this.headGrp0.setRemainCount("13"),this.headGrp2.setRemainCount("13"),this.headGrp3.setRemainCount("13"),t.dataProxy.updateSortHandCards(),this.checkTuoGuan(),this.updatePlayerHandCards())},i.prototype.checkHandCards=function(){var e=t.dataProxy.getSelfPlayerInfo().handCards;this.handCard1.updateData(e),this.opBtn.refresh(e),this.handCard1.clearSelectCards()},i.prototype.checkBiggerCards=function(e){var i=e,o=t.dataProxy.getSelfPlayerInfo(),a=card.CDDTool.getPokerGroup(i);if(a){var r=card.CDDTool.getBigTypeCards(a,o.handCards);if(r&&r.length>0){this.handCard1.setTargetBigger(r,o.handCards);for(var n=[],s=0;s<r.length;s++){var h=r[s];h&&h.type>0&&n.push(h.type)}var l=a.type;0==l?this.opBtn.enableAllBtn():n.length>0&&this.opBtn.setAllTargetTypeEnable(n)}else this.opBtn.enableAllBtn(),this.handCard1.enableAllCards()}},i.prototype.doTweener=function(){if(this.totalArr.length>=4){var e=this.totalArr.pop(),i=this.totalArr.pop(),o=this.totalArr.pop(),a=this.totalArr.pop();
this.p0.x=this.headGrp0.countGrp.localToGlobal().x,this.p0.y=Global.stage.stageHeight/2,this.p1.x=Global.stage.stageWidth/2,this.p1.y=Global.stage.stageHeight-220,this.p2.x=this.headGrp2.countGrp.localToGlobal().x,this.p2.y=Global.stage.stageHeight/2,this.p3.x=Global.stage.stageWidth/2,this.p3.y=this.headGrp3.countGrp.localToGlobal().y+this.headGrp3.countGrp.height;var r=randomInt_XY(0,360),n=randomInt_XY(0,360),s=randomInt_XY(0,360),h=randomInt_XY(0,360);t.CDDSoundPlayer.playFaPaiBg(),this.totalCount++,egret.Tween.removeTweens(e),egret.Tween.removeTweens(i),egret.Tween.removeTweens(o),egret.Tween.removeTweens(a),egret.Tween.get(e).to({x:this.p0.x,y:this.p0.y,rotation:r},120,Ease$.sineOut).call(this.updateCard0,this,[e]),egret.Tween.get(i).to({x:this.p1.x,y:this.p1.y,rotation:n},120,Ease$.sineOut).call(this.updateCard0,this,[i]),egret.Tween.get(o).to({x:this.p2.x,y:this.p2.y,rotation:s},120,Ease$.sineOut).call(this.updateCard0,this,[o]),egret.Tween.get(a).to({x:this.p3.x,y:this.p3.y,rotation:h},120,Ease$.sineOut).call(this.updateCard,this,[a])}},i.prototype.updateCard0=function(t){this.renderArr.push(t)},i.prototype.updateCard=function(t){this.renderArr.push(t),this.headGrp0.setRemainCount(this.totalCount+""),this.headGrp2.setRemainCount(this.totalCount+""),this.headGrp3.setRemainCount(this.totalCount+""),1==this.sendCardNum&&this.doAction()},i.prototype.doContinueDealCards=function(){this.doAction()},i.prototype.updateRoomInfo=function(e){if(void 0===e&&(e=!1),t.dataProxy.roomInfo){if(e&&this.clearFaPaiAni(),t.dataProxy.roomInfo.friends?t.dataProxy.centerConfig.replayMode?(this.friendGrp.visible=!1,this.copyRoomInfoBtn.visible=!1):(this.copyRoomInfoBtn.visible=!0,this.friendGrp.visible=!0,this.roomLabel.text=t.i18n("房号:{0}",t.dataProxy.centerConfig.area)):(this.copyRoomInfoBtn.visible=!1,this.friendGrp.visible=!1),this.setPlayerInfo(),this.showCountDown(),this.updatePlayerHandCards(),null!=t.dataProxy.roomInfo.actionable){t.dataProxy.getSelfPlayerInfo();this.handCard1.addListener()}2==t.dataProxy.roomInfo.state&&this.updateTurn(),this.checkTuoGuan(),this.updateTableTf(),this.checkReady()}},i.prototype.setPlayerInfo=function(){for(var e=0;4>e;e++){var i=t.dataProxy.getUIPosByServerPos(e),o=t.dataProxy.getPlayerInfoByPos(e);(null==o||o.uid!=t.dataProxy.myUid)&&(this["headGrp"+i].setData(o),3!=t.dataProxy.roomInfo.state&&null==o&&this["headGrp"+i].setRemainCount(""))}this.headGrp1.updateView();for(var e=0;4>e;e++)this["playerReady"+e].updateData()},i.prototype.updatePlayerHandCards=function(){var e=t.dataProxy.roomInfo.state;if(e>0&&3>e){var i=t.dataProxy.getSelfPlayerInfo().handCards;this.handCard1.updateData(i),this.opBtn.visible=!0,this.opBtn.refresh(i)}},i.prototype.clearFaPaiAni=function(){if(this.renderArr&&this.renderArr.length>0)for(;this.renderArr.length>0;){var t=this.renderArr.shift();egret.Tween.removeTweens(t),remove_XY(t)}if(this.totalArr&&this.totalArr.length>0)for(;this.totalArr.length>0;){var t=this.totalArr.shift();egret.Tween.removeTweens(t),remove_XY(t)}this.cardContainier.removeChildren(),this.clearSmallDiscardUI()},i.prototype.clickTuoGuan=function(){var e=new t.CddTrusteeshipDTO;e.uid=t.dataProxy.myUid,e.trusteeshipState=1,t.sendSocketMessage(t.CDDProtocol.CDD_TRUSTEESHIP_C,e)},i.prototype.clickCancelTuoGuan=function(){var e=new t.CddTrusteeshipDTO;e.uid=t.dataProxy.myUid,e.trusteeshipState=0,t.sendSocketMessage(t.CDDProtocol.CDD_TRUSTEESHIP_C,e)},i.prototype.checkTuoGuan=function(){if(t.dataProxy.roomInfo.state>0&&t.dataProxy.roomInfo.state<3){var e=t.dataProxy.getSelfPlayerInfo();0==e.trusteeshipState?(this.tuoguanZhong.visible=!1,this.tuoguan.visible=!0,this.tuoguan.enabled=!0,this.trustShip.visible=!1,2==t.dataProxy.roomInfo.state?this.opBtn.visible=!0:this.opBtn.visible=!1):(this.tuoguanZhong.visible=!0,this.tuoguan.visible=!1,this.trustShip.visible=!0,this.grpOption.showCount(0),this.grpOption.visible=!1,this.opBtn.visible=!1)}else this.tuoguanZhong.visible=!1,this.tuoguan.visible=!0,this.tuoguan.enabled=!1,this.trustShip.visible=!1},i.prototype.onResize=function(){e.prototype.onResize.call(this),this.introView.onResize()},i.prototype.dispose=function(){e.prototype.dispose.call(this)},i}(BaseComponent);t.CDDGameScene=e,__reflect(e.prototype,"CDD.CDDGameScene")}(CDD||(CDD={}));var CDD;!function(t){var e=function(){function t(t){this.gameLayer=new egret.DisplayObjectContainer,this.popupLayer=new egret.DisplayObjectContainer,this.msgLayer=new egret.DisplayObjectContainer,this.loadingLayer=new egret.DisplayObjectContainer,t.addChild(this.gameLayer),t.addChild(this.popupLayer),t.addChild(this.msgLayer),t.addChild(this.loadingLayer)}return t.prototype.dispose=function(){remove_XY(this.gameLayer),remove_XY(this.popupLayer),remove_XY(this.msgLayer),remove_XY(this.loadingLayer),this.gameLayer=null,this.popupLayer=null,this.msgLayer=null,this.loadingLayer=null},t}();t.CDDLayout=e,__reflect(e.prototype,"CDD.CDDLayout")}(CDD||(CDD={}));var CDD;!function(t){var e=function(e){function i(t){return e.call(this,i.NAME,t)||this}return __extends(i,e),i.prototype.onRemove=function(){e.prototype.onRemove.call(this),this.replayPanel&&(this.replayPanel.dispose(),remove_XY(this.replayPanel),this.replayPanel=null)},i.prototype.listNotificationInterests=function(){return[i.SHOW,i.HIDE]},i.prototype.handleNotification=function(e){e.getBody();switch(e.getName()){case i.SHOW:this.replayPanel||(this.replayPanel=new t.CDDReplay),this.getLayer().addChild(this.replayPanel),this.replayPanel.initData();break;case i.HIDE:remove_XY(this.replayPanel)}},i.NAME=GameIdEnum.CDD+"CDDReplayMediator",i.SHOW=i.NAME+"SHOW",i.HIDE=i.NAME+"HIDE",i}(t.AbstractMediator);t.CDDReplayMediator=e,__reflect(e.prototype,"CDD.CDDReplayMediator")}(CDD||(CDD={}));var CDD;!function(t){var e=function(e){function i(){var i=e.call(this,"CDDReplaySkin")||this;bindTapEvent_XY(i.bg,i.onBg,i),bindTapEvent_XY(i.prevBtn,i.onPrev,i,!0),bindTapEvent_XY(i.playBtn,i.onPlay,i,!0),bindTapEvent_XY(i.nextBtn,i.onNext,i,!0),bindTapEvent_XY(i.exitBtn,i.onExit,i,!0),bindTapEvent_XY(i.bgmBtn,i.onBgm,i,!0),bindTapEvent_XY(i.musicBtn,i.onMusic,i,!0);for(var o=0,a=4;a>o;o++){var r=i["spdBtn"+o];r.__speed__=[.5,1,2,3][o],bindTapEvent_XY(r,i.onSpeed,i,!0)}return t.dataProxy.replayVo.addEventListener(t.CDDReplayVo.E_PROGRESS,i.updateUI,i),i}return __extends(i,e),i.prototype.onBgm=function(){SoundManager.setBgMute(!SoundManager.getBgMute()),this.updateMusicBtnState()},i.prototype.updateMusicBtnState=function(){this.musicBtn.backgroundColor=SoundManager.getEffectMute()?0:8026746,this.bgmBtn.backgroundColor=SoundManager.getBgMute()?0:8026746},i.prototype.onMusic=function(){SoundManager.setEffectMute(!SoundManager.getEffectMute()),this.updateMusicBtnState()},i.prototype.onPrev=function(){t.dataProxy.replayVo.showPrevFrame(),this.updateUI()},i.prototype.onPlay=function(){t.dataProxy.replayVo.isPlaying?t.dataProxy.replayVo.pause():t.dataProxy.replayVo.resume(),this.updateUI()},i.prototype.onNext=function(){t.dataProxy.replayVo.showNextFrame(),this.updateUI()},i.prototype.onSpeed=function(e){var i=e.currentTarget.__speed__||1;t.dataProxy.replayVo.changePlaySpeed(i),this.updateUI()},i.prototype.updateUI=function(){var e=t.dataProxy.replayVo;this.progressTf.text=t.i18n("进度:{0}{1}{2}{3}{4}{5}",e.index,"/",e.max,"(",(e.index/e.max*100).toFixed(1),"%)"),this.playBtn.text=e.isPlaying?t.i18n("暂停"):t.i18n("播放");for(var i=0,o=4;o>i;i++){var a=this["spdBtn"+i];a.__speed__=[.5,1,2,3][i],a.backgroundColor=a.__speed__==e.speed?8026746:0}},i.prototype.onExit=function(){t.confirm(t.i18n("确定退出回放吗?"),function(){t.sendNotification(t.CDDExitCommand.NAME)})},i.prototype.onBg=function(){Tween$.removeTweens(this.ctrlGrp),this.isUIShowed?Tween$.get(this.ctrlGrp).to({bottom:-this.ctrlGrp.height},300):Tween$.get(this.ctrlGrp).to({bottom:0},300),this.isUIShowed=!this.isUIShowed},i.prototype.initData=function(){this.isUIShowed=!0,Tween$.removeTweens(this.ctrlGrp),this.ctrlGrp.bottom=0,this.updateUI()},i.prototype.dispose=function(){e.prototype.dispose.call(this),Tween$.removeTweens(this.ctrlGrp),clearTapEvent_XY(this.bg,this.onBg,this),clearTapEvent_XY(this.prevBtn,this.onPrev,this),clearTapEvent_XY(this.playBtn,this.onPlay,this),clearTapEvent_XY(this.nextBtn,this.onNext,this),clearTapEvent_XY(this.exitBtn,this.onExit,this);for(var i=0,o=4;o>i;i++){var a=this["spdBtn"+i];a.__speed__=[.5,1,2,3][i],clearTapEvent_XY(a,this.onSpeed,this)}t.dataProxy.replayVo.removeEventListener(t.CDDReplayVo.E_PROGRESS,this.updateUI,this)},i}(BaseComponent);t.CDDReplay=e,__reflect(e.prototype,"CDD.CDDReplay")}(CDD||(CDD={}));