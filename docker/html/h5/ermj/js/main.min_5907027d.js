function runAI(t){void 0===t&&(t=3),ERMJ.dataProxy.AIMode=!0,ERMJ.dataProxy.AIDelaySecond=t}var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);i.prototype=e.prototype,t.prototype=new i},__awaiter=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))(function(a,o){function r(t){try{h(n.next(t))}catch(e){o(e)}}function s(t){try{h(n["throw"](t))}catch(e){o(e)}}function h(t){t.done?a(t.value):new i(function(e){e(t.value)}).then(r,s)}h((n=n.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function i(t){return function(e){return n([t,e])}}function n(i){if(a)throw new TypeError("Generator is already executing.");for(;h;)try{if(a=1,o&&(r=o[2&i[0]?"return":i[0]?"throw":"next"])&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[0,r.value]),i[0]){case 0:case 1:r=i;break;case 4:return h.label++,{value:i[1],done:!1};case 5:h.label++,o=i[1],i=[0];continue;case 7:i=h.ops.pop(),h.trys.pop();continue;default:if(r=h.trys,!(r=r.length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){h=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){h.label=i[1];break}if(6===i[0]&&h.label<r[1]){h.label=r[1],r=i;break}if(r&&h.label<r[2]){h.label=r[2],h.ops.push(i);break}r[2]&&h.ops.pop(),h.trys.pop();continue}i=e.call(t,h)}catch(n){i=[6,n],o=0}finally{a=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var a,o,r,s,h={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return s={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},ERMJ;!function(t){var e=function(t){function e(e,i){return t.call(this,e,i)||this}return __extends(e,t),e.prototype.getLayer=function(){return this.viewComponent},e}(puremvc.Mediator);t.AbstractMediator=e,__reflect(e.prototype,"ERMJ.AbstractMediator")}(ERMJ||(ERMJ={}));var ERMJ;!function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.initEvents=function(){bindTapEvent_XY(this.grp0,this.onChoose,this),bindTapEvent_XY(this.grp1,this.onChoose,this),bindTapEvent_XY(this.grp2,this.onChoose,this)},i.prototype.onChoose=function(e){for(var n=0,a=0,o=3;o>a;a++)if(e.currentTarget==this["grp"+a]){n=a;break}var r=new t.MahjongGameChowDTO;r.fromThreeCard(this.datas[n],this.keyCard),this.dispatchEventWith(i.E_CHI,!1,r)},i.prototype.dispose=function(){clearTapEvent_XY(this.grp0,this.onChoose,this),clearTapEvent_XY(this.grp1,this.onChoose,this),clearTapEvent_XY(this.grp2,this.onChoose,this),this.datas=null},i.prototype.updateData=function(t,e){this.datas=t,this.keyCard=e;for(var i=40,n=30,a=0,o=3;o>a;a++){var r=t[a],s=this["grp"+a];if(r){for(var h=0,l=r.length;l>h;h++){var d=r[h],c=this["card"+(3*a+h)];d==e&&(this["light"+a].x=c.x),c.setCard(d)}this.addChild(s),s.x=i,i+=s.width+n}else remove_XY(s)}this.width=i},i.E_CHI="E_CHI",i}(eui.Component);t.ERMJ_ChiChoosePanel=e,__reflect(e.prototype,"ERMJ.ERMJ_ChiChoosePanel")}(ERMJ||(ERMJ={}));var ERMJ;!function(t){function e(t,e,i){puremvc.Facade.getInstance(GameIdEnum.ERMJ).sendNotification(t,e,i)}function i(t){return t==I18NType.zh_tw||t==I18NType.en_us?!0:!1}var n=function(i){function n(){return i.call(this,GameIdEnum.ERMJ)||this}return __extends(n,i),n.prototype.initializeController=function(){i.prototype.initializeController.call(this),this.registerCommand(t.ERMJRegisteMVCCommand.NAME,t.ERMJRegisteMVCCommand)},n.prototype.setup=function(i){this.layout||(this.layout=new t.ERMJLayout(i)),e(t.ERMJRegisteMVCCommand.NAME,[this.layout]),e(t.ERMJGameSceneMediator.SHOW),t.dataProxy.centerConfig.replayMode?(t.dataProxy.initReplay(),t.dataProxy.replayVo.startAutoPlay(),e(t.ERMJReplayMediator.SHOW)):DevelopMain.callWhenFastJoinCompleted(function(){t.sendSocketMessage(t.ERMJProtocol.GET_SNAPSHOT_C)}),EnterFrameCall.add(function(){dragonBones.WorldClock.clock.advanceTime(-1)},this)},n.prototype.dispose=function(){this.layout&&this.layout.dispose(),this.layout=null},n}(puremvc.Facade);t.ERMJFacade=n,__reflect(n.prototype,"ERMJ.ERMJFacade"),t.sendNotification=e,t.isLanuageSupport=i}(ERMJ||(ERMJ={}));var ERMJ;!function(t){function e(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=t.concat();i.splice(0,0,"<"+GameIdEnum.ERMJ+"> "+egret.getTimer()+" "),console.log.apply(console,i)}function i(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=t.concat();i.splice(0,0,"<"+GameIdEnum.ERMJ+"> "+egret.getTimer()+" "),console.warn.apply(console,i)}function n(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];var n=I18N.getInstance(GameIdEnum.ERMJ);return n.toString.apply(n,arguments)}var a=function(i){function n(){var t=i.call(this)||this;return Global.eventCenter.addEventListener(EventEnum.SOME_ONE_PLAY_VOICE_P_to_G,t.someOnePlayVoice,t),Global.eventCenter.addEventListener(EventEnum.ACCOUNT_BEEN_KICKED,t.beenKicked,t),Global.eventCenter.addEventListener(EventEnum.SERVER_ERROR_MESSAGE,t.onServerErrorMsg,t),Global.eventCenter.addEventListener(EventEnum.SWITCH_TABLE_P_to_G,t.onSwitchTableOk,t),t}return __extends(n,i),n.prototype.someOnePlayVoice=function(t){},n.prototype.beenKicked=function(e){Global.isAccountBeenReplaced=!0;var i=e.data;t.alert(i[1],function(){Global.platform.exitApp()})},n.prototype.onSwitchTableOk=function(i){t.dataProxy.centerConfig.area=i.data[0],SimpleLoading.hide(),e("换桌成功！"),t.sendSocketMessage(t.ERMJProtocol.GET_SNAPSHOT_C)},n.prototype.onServerErrorMsg=function(t){SimpleLoading.hide(),Toast.show(t.data[0])},n.prototype.setup=function(i){var n=this;e("setup"),RES.loadGroup("ERMJ.all",0),waitGroupAndExecute("ERMJ.all",function(){Global.onEvent(EventEnum.CLOSE_GAME_INIT_LOADING_G_to_P),bridge_iframe.sendMsgToHall(EventEnum.CLOSE_GAME_INIT_LOADING_G_to_P);var t=RES.getRes("i18n_json");I18N.getInstance(GameIdEnum.ERMJ).init(t,i.i18nType),n.start(i),egret.setTimeout(function(){RES.loadGroup("ERMJ.sound",0)},n,1)},this),waitGroupAndExecute("ERMJ.sound",function(){if(!n.destroied){egret.getDefinitionByName("Main");n.destroied||t.ERMJSoundPlayer.bgm()}},this)},n.prototype.start=function(e){mahjong.Card.init(),__tapSound=GameIdEnum.ERMJ+"_ui_click_mp3";var i=new mahjong.TableSource;i.buildFromZipFile(RES.getRes("ERMJ_tbl"));var n=new mahjong.Card(mahjong.Type.BAMBOO,2);mahjong.MahjongTool.init([n],i,!0),mahjong.MahjongTool.allow_7dui=!0,mahjong.ERMJTool.init();var a=new t.ERMJFacade;t.dataProxy=new t.ERMJDataProxy,t.dataProxy.centerConfig=e,t.dataProxy.myUid=e.loginDto?e.loginDto.id:-1,a.setup(this),this.facade=a,ResizeCall.addCall(this.onResize,this),this.onResize()},n.prototype.onResize=function(){var t=1120/1920,e=Global.stage.stageHeight/Global.stage.stageWidth;t>e?Global.stage.scaleMode=egret.StageScaleMode.FIXED_HEIGHT:Global.stage.scaleMode=egret.StageScaleMode.FIXED_WIDTH},n.prototype.destroy=function(){},n}(egret.DisplayObjectContainer);t.GameLauncher=a,__reflect(a.prototype,"ERMJ.GameLauncher",["IGameLauncher"]),t.trace=e,t.warn=i,t.i18n=n}(ERMJ||(ERMJ={}));var Main=function(t){function e(){var i=t.call(this)||this;try{e.isInModule=!(window&&window.parent!=window&&window.parent.Global)}catch(n){}var a=egret.getOption("ip")||window.serverip||"172.16.236.21";return i.gameId="ERMJ",i.config.httpURI="http://"+a+":81",i.config.host=a,i.config.port=81,i.config.param1=2013110,i.config.param2=5,i.config.antiCheat=1,i.config.num=8,i.config.type=39,i.sendSnapshotWhenResume=!0,i.config.i18nType=I18NType.en_us,i.config.moduleType=ModuleType.MODULE_MAHJONG,Global.useProfile=!0,i}return __extends(e,t),e.prototype.onExit=function(){t.prototype.onExit.call(this)},e.isInModule=!0,e}(DevelopMain);__reflect(Main.prototype,"Main");var ERMJ;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.execute=function(e){var n=puremvc.Facade.getInstance(GameIdEnum.ERMJ);n.removeCommand(t.ERMJExitCommand.NAME),n.removeCommand(i.NAME),n.removeMediator(t.ERMJSocketMediator.NAME),n.removeMediator(t.ERMJGameSceneMediator.NAME),n.removeProxy(t.ERMJDataProxy.NAME),t.dataProxy&&t.dataProxy.dispose(),t.dataProxy=null},i.NAME=GameIdEnum.ERMJ+"RegisteMVCCommand",i}(puremvc.SimpleCommand);t.ERMJDisposeMVCCommand=e,__reflect(e.prototype,"ERMJ.ERMJDisposeMVCCommand")}(ERMJ||(ERMJ={}));var ERMJ;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.execute=function(t){Global.onEvent(EventEnum.EXIT_GAME_G_to_P),bridge_iframe.sendMsgToHall(EventEnum.EXIT_GAME_G_to_P)},e.NAME=GameIdEnum.ERMJ+"ERMJExitCommand",e}(puremvc.SimpleCommand);t.ERMJExitCommand=e,__reflect(e.prototype,"ERMJ.ERMJExitCommand")}(ERMJ||(ERMJ={}));var ERMJ;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.execute=function(e){var i=puremvc.Facade.getInstance(GameIdEnum.ERMJ),n=e.getBody()[0];i.registerProxy(t.dataProxy),i.registerMediator(new t.ERMJSocketMediator),i.registerMediator(new t.ERMJGameSceneMediator(n.gameLayer)),i.registerMediator(new t.ERMJReadmeMediator(n.popupLayer)),i.registerMediator(new t.ERMJResultMediator(n.popupLayer)),i.registerMediator(new t.ERMJHackMediator(n.popupLayer)),t.dataProxy.centerConfig.replayMode&&i.registerMediator(new t.ERMJReplayMediator(n.msgLayer)),i.registerCommand(t.ERMJExitCommand.NAME,t.ERMJExitCommand),i.registerCommand(t.ERMJDisposeMVCCommand.NAME,t.ERMJDisposeMVCCommand)},i.NAME=GameIdEnum.ERMJ+"RegisteMVCCommand",i}(puremvc.SimpleCommand);t.ERMJRegisteMVCCommand=e,__reflect(e.prototype,"ERMJ.ERMJRegisteMVCCommand")}(ERMJ||(ERMJ={}));var ERMJ;!function(t){var e=function(e){function i(){var t=e.call(this,i.NAME)||this;t.hackedCard=-1,t.AIMode=!1,t.AIDelaySecond=3,t.fullCards=[];for(var n=[0,1,2,3,4,5,6,7,8,27,28,29,30,31,32,33],a=0,o=n.length;o>a;a++){var r=mahjong.Card.createFromCardID(n[a]);t.fullCards.push(r)}return t}return __extends(i,e),i.prototype.isBothInLastGamePlayers=function(t,e){return this.lastGamePlayerIds?-1!=this.lastGamePlayerIds.indexOf(t)&&-1!=this.lastGamePlayerIds.indexOf(e):!1},i.prototype.initReplay=function(){this.centerConfig.replayMode&&(this.replayVo?this.replayVo.stopAndClear():this.replayVo=new t.ERMJReplayVo,this.replayVo.init(this.centerConfig.replayData))},i.prototype.findCheckResult=function(t){if(!this.currentCheckResults)return null;for(var e=0,i=this.currentCheckResults.length;i>e;e++){var n=this.currentCheckResults[e];if(n&&n.discard&&n.discard.cardID==t)return n}return null},i.prototype.getTingCount=function(){if(!this.currentCheckResults)return 0;for(var t=0,e=0,i=this.currentCheckResults.length;i>e;e++){var n=this.currentCheckResults[e];n&&n.discard&&t++}return t},i.prototype.calCheckResult=function(){var e=this.roomDetailInfo;if(1==e.state&&e.turnPlayers&&-1!=e.turnPlayers.indexOf(this.myUid)){var i,n,a=this.findPlayerGameInfoByUid(this.myUid),o=a.card.currentCard,r=a.card.handCards;-1!=a.card.currentCard?(i=mahjong.Card.createFronCardIds(r),n=mahjong.Card.createFromCardID(o)):(i=mahjong.Card.createFronCardIds(r),n=i.shift()),t.trace("计算我可以听、胡什么牌");var s=mahjong.MahjongTool.findWinCardsWhenDraw(i,n,t.dataProxy.fullCards,null,null,!1),h=mahjong.Meld.fromServerMelds(a.card.meldCards),l=a.card.flowerCards.length,d=t.dataProxy.roomDetailInfo.roundRec,c=a.position;if(s)for(var u=0,p=s.length;p>u;u++){var f=s[u];if(f){f.winFactors=f.winFactors||[];for(var E=0,_=f.winCards.length;_>E;E++){var g=f.winCards[E],y=mahjong.MahjongTool.getCardLeftInRecord(g.cardID),m=mahjong.ERMJTool.getWinTypeAndFactors(h,i,g,l,y,d,c);f.winFactors[E]=m.factor}}}this.currentCheckResults=s}else this.currentCheckResults=null},i.prototype.verifyHandCardNum=function(){if(this.roomDetailInfo)for(var e=0,i=this.roomDetailInfo.info.length;i>e;e++){var n=this.roomDetailInfo.info[e];if(n.card&&n.card.handCards){var a=n.card.handCards.length;if(n.card.meldCards&&(a+=3*n.card.meldCards.length),a>13)if(t.warn(n.uid+"玩家手牌数量为:"+n.card.handCards.length),n.uid==this.myUid||t.dataProxy.centerConfig.replayMode){if(-1!=n.card.currentCard){var o=n.card.handCards.indexOf(n.card.currentCard);n.card.handCards.splice(o,1)}}else n.card.handCards.pop()}}},i.prototype.updateRoomDetailInfo=function(e){this.roomDetailInfo=e,this.gameExited=!1,9!=e.state&&t.sendNotification(t.ERMJResultMediator.HIDE),this.verifyHandCardNum(),this.lastGamePlayerIds=[];var i=this.findPlayerGameInfoByUid(this.myUid);if(i)this.selfIndex=i.position;else for(var n=1,a=4;a>=n;n++){var o=this.findPlayerGameInfoBySeat(n);o||(this.selfIndex=n)}for(var n=1,a=4;a>=n;n++){var o=this.findPlayerGameInfoBySeat(n);o&&(t.PlayerDTO.maskNick(o),o.dealer&&(this.dealerIndex=n),this.lastGamePlayerIds.push(o.uid))}if(t.trace("mySeat:"+this.selfIndex),this.updateRecordCard(),this.calCheckResult(),this.centerConfig.replayMode){var r=e.replayAction;if(!r){var r=new t.MahjongGameActionDTO;r.action=e.lastValidAction,r.card=e.currentDiscard,r.currentDiscard=e.currentDiscard,r.lastDiscardUid=e.lastDiscardUid,r.lastOpUid=e.lastOpUid,r.remaining=e.remaining,r.turnPlayers=e.turnPlayers,r.uid=e.lastOpUid}r.action!=t.Action.hu&&t.ERMJSoundPlayer.action(r),t.sendNotification(t.ERMJGameSceneMediator.DO_ACTION,[r.uid,r.action,r.currentDiscard])}},i.prototype.changeToPrepare=function(e){this.roomDetailInfo.state=0,this.roomDetailInfo.actionable=null,this.roomDetailInfo.ascDraw=0,this.roomDetailInfo.currentDiscard=-1,this.roomDetailInfo.descDraw=0,this.roomDetailInfo.dices=[0,0],this.roomDetailInfo.lastDiscardUid=-1,this.roomDetailInfo.lastOpUid=-1,this.roomDetailInfo.lastValidAction=-1,this.roomDetailInfo.remaining=72,this.roomDetailInfo.tableId="",this.roomDetailInfo.turnPlayers=null,this.roomDetailInfo.timeout=e,this.roomDetailInfo.settlingDTO=null,this.dealerIndex=-1;for(var i=0,n=this.roomDetailInfo.info.length;n>i;i++){var a=this.roomDetailInfo.info[i];a.dealer=!1,a.trusteeship=!1,a.ting=!1}t.sendNotification(t.ERMJGameSceneMediator.CHANGE_TO_PREPARE),t.sendNotification(t.ERMJResultMediator.HIDE)},i.prototype.updateTableId=function(e){this.roomDetailInfo&&(this.roomDetailInfo.tableId=e,t.sendNotification(t.ERMJGameSceneMediator.UPDATE_TABLE_ID))},i.prototype.setPlayerReady=function(e){var i=this.findPlayerGameInfoByUid(e);i&&(i.ready=1,t.sendNotification(t.ERMJGameSceneMediator.UPDATE_PLAYER_READY,e==Global.uid?1:3))},i.prototype.clearReadyState=function(){for(var e=0,i=this.roomDetailInfo.info.length;i>e;e++){var n=this.roomDetailInfo.info[e];n&&(1==this.roomDetailInfo.autoReadyConf?n.ready=1:n.ready=0)}t.sendNotification(t.ERMJGameSceneMediator.CHANGE_TO_PREPARE)},i.prototype.updateTurn=function(e){var i=this;if(egret.clearTimeout(this.AITimer),e.uid==Global.uid&&(this.roomDetailInfo.actionable=e.actionable,-1!=e.card&&(this.hackedCard=-1),this.AIMode&&(this.AITimer=egret.setTimeout(function(){if(e.actionable)if(-1!=e.actionable.indexOf(99))t.sendSocketMessage(t.ERMJProtocol.MAHJONG_HU_C);else if(-1!=e.actionable.indexOf(1)){var n,a=i.findPlayerGameInfoByUid(Global.uid),o=mahjong.Card.createFronCardIds(a.card.handCards),r=mahjong.Card.createFromCardID(a.card.currentCard);try{n=mahjong.ai.MSelector.getSuggest(o,r,t.dataProxy.fullCards),t.trace("AI打牌",n.cardID)}catch(s){n=r,error("AI报错! 手牌:"+o.join()+"  摸牌:"+r.toString())}t.sendSocketMessage(t.ERMJProtocol.MAHJONG_DA_C,n.cardID)}else t.sendSocketMessage(t.ERMJProtocol.MAHJONG_PASS_C)},this,Math.max(100,1e3*this.AIDelaySecond)))),-1!=e.card){var n=this.findPlayerGameInfoByUid(e.turnPlayers[0]);n&&(n.card.currentCard=e.card)}this.roomDetailInfo.turnPlayers=e.turnPlayers,this.roomDetailInfo.lastOpUid=e.lastOpUid,this.roomDetailInfo.remaining=e.remaining,this.roomDetailInfo.ascDraw=e.ascDraw,this.roomDetailInfo.descDraw=e.descDraw,this.roomDetailInfo.timeout=e.timeout,this.calCheckResult(),t.sendNotification(t.ERMJGameSceneMediator.UPDATE_TURN)},i.prototype.updateAction=function(e){var i=e.uid==Global.uid,n=this.findPlayerGameInfoByUid(e.uid);if(i&&egret.clearTimeout(this.AITimer),e.action==t.Action.ting&&(n.ting=!0),this.roomDetailInfo.remaining=e.remaining,n.card=e.userMahjong,this.roomDetailInfo.turnPlayers=e.turnPlayers,this.roomDetailInfo.lastOpUid=e.lastOpUid,this.roomDetailInfo.currentDiscard=e.currentDiscard,this.roomDetailInfo.lastDiscardUid=e.lastDiscardUid,e.action==t.Action.chi||e.action==t.Action.peng||e.action==t.Action.ming_gang){var a=this.findPlayerGameInfoByUid(e.lastDiscardUid),o=a.card.discards.indexOf(e.currentDiscard);a.card.discards.splice(o,1)}e.action!=t.Action.hu&&t.ERMJSoundPlayer.action(e),this.verifyHandCardNum(),this.updateRecordCard(),t.sendNotification(t.ERMJGameSceneMediator.DO_ACTION,[e.uid,e.action,e.currentDiscard])},i.prototype.updateTuoguan=function(e){var i=this.findPlayerGameInfoByUid(Global.uid);i.trusteeship=e,t.sendNotification(t.ERMJGameSceneMediator.UPDATE_TUOGUAN)},i.prototype.gameComplete=function(e){this.roomDetailInfo&&(this.roomDetailInfo.state=9,this.roomDetailInfo.settlingDTO=e);for(var i=0,n=e.players.length;n>i;i++){var a=e.players[i],o=this.findPlayerGameInfoByUid(a.uid);o.coin=a.coin,o.card=a.card,o.trusteeship=!1}t.sendNotification(t.ERMJGameSceneMediator.SHOW_HU)},i.prototype.findWinnerInSetting=function(){for(var e=0,i=t.dataProxy.roomDetailInfo.settlingDTO.players.length;i>e;e++){var n=t.dataProxy.roomDetailInfo.settlingDTO.players[e];if(n.isWin)return n}return null},i.prototype.findSelfInSetting=function(){for(var e=0,i=t.dataProxy.roomDetailInfo.settlingDTO.players.length;i>e;e++){var n=t.dataProxy.roomDetailInfo.settlingDTO.players[e];if(n.uid==Global.uid)return n}return null},i.prototype.someOneJoin=function(e){t.PlayerDTO.maskNick(e),e.uid!=Global.uid&&(t.dataProxy.roomDetailInfo.info.push(e),t.sendNotification(t.ERMJGameSceneMediator.SOME_ONE_JOIN))},i.prototype.someOneLeave=function(e){var i=t.dataProxy.findPlayerGameInfoByUid(e);if(i&&-1!=i.uid){var n=t.dataProxy.roomDetailInfo.info.indexOf(i);t.dataProxy.roomDetailInfo.info.splice(n,1),t.sendNotification(t.ERMJGameSceneMediator.SOME_ONE_LEAVE)}},i.prototype.updateRecordCard=function(){if(this.roomDetailInfo&&this.roomDetailInfo.info){for(var e=[],i=0,n=this.roomDetailInfo.info.length;n>i;i++){var a=this.roomDetailInfo.info[i];if(a&&a.card&&(a.card.discards&&(e=e.concat(a.card.discards)),a.card.meldCards))for(var o=0,r=a.card.meldCards.length;r>o;o++){var s=a.card.meldCards[o];s&&-1!=s[0]?e=e.concat(s):a.uid==Global.uid&&s&&-1==s[0]&&-1!=s[3]&&(e.push(s[3]),e.push(s[3]),e.push(s[3]),e.push(s[3]))}}t.trace("更新记牌器("+e.length+"张): "+e.join(",")),mahjong.MahjongTool.updateDiscard(e)}},i.prototype.findPlayerGameInfoBySeat=function(t){if(!this.roomDetailInfo||!this.roomDetailInfo.info)return null;for(var e=0,i=this.roomDetailInfo.info.length;i>e;e++){var n=this.roomDetailInfo.info[e];if(n.position==t)return n}return null},i.prototype.findPlayerGameInfoByUISeat=function(e){if(!this.roomDetailInfo||!this.roomDetailInfo.info)return null;for(var i=0,n=this.roomDetailInfo.info.length;n>i;i++){var a=this.roomDetailInfo.info[i];if(t.ERMJPositionUtils.getUIPosByServerPos(a.position)==e)return a}return null},i.prototype.findPlayerGameInfoByUid=function(t){if(!this.roomDetailInfo||!this.roomDetailInfo.info)return null;for(var e=0,i=this.roomDetailInfo.info.length;i>e;e++){var n=this.roomDetailInfo.info[e];if(n.uid==t)return n}return null},i.prototype.dispose=function(){this.centerConfig=null,this.roomDetailInfo=null,this.fullCards=null,this.currentCheckResults=null,this.replayVo&&this.replayVo.stopAndClear(),this.replayVo=null},i.NAME=GameIdEnum.ERMJ+"ERMJDataProxy",i}(puremvc.Proxy);t.ERMJDataProxy=e,__reflect(e.prototype,"ERMJ.ERMJDataProxy")}(ERMJ||(ERMJ={}));var ERMJ;!function(t){var e=function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t.stepTimeGapMs=1e3,t}return __extends(i,e),i.prototype.init=function(t){this.index=0,this.data=t,this.max=t.length,this.stepTimeGapMs=2e3,this.speed=1,this.autoPlay=!1,egret.clearInterval(this.autoPlayTimer)},i.prototype.startAutoPlay=function(){this.autoPlay=!0,t.dataProxy.centerConfig.socketProxy.replayData(this.data[0]),this.index=1,egret.clearInterval(this.autoPlayTimer),this.autoPlayTimer=egret.setInterval(this.onPlayTimer,this,this.stepTimeGapMs/this.speed),this.isPlaying=!0},i.prototype.showPrevFrame=function(){this.index<=1||(this.index--,t.dataProxy.centerConfig.socketProxy.replayData(this.data[this.index-1]))},i.prototype.showNextFrame=function(){this.index>=this.max||(this.index++,t.dataProxy.centerConfig.socketProxy.replayData(this.data[this.index-1]))},i.prototype.jumpToPersent=function(e){0>e&&(e=0),e>1&&(e=1),this.index=int_XY(this.max*e),t.dataProxy.centerConfig.socketProxy.replayData(this.data[this.index-1])},i.prototype.pause=function(){egret.clearInterval(this.autoPlayTimer),this.isPlaying=!1},i.prototype.resume=function(){egret.clearInterval(this.autoPlayTimer),this.autoPlayTimer=egret.setInterval(this.onPlayTimer,this,this.stepTimeGapMs/this.speed),this.isPlaying=!0},i.prototype.changePlaySpeed=function(t){this.speed=t,this.isPlaying&&(egret.clearInterval(this.autoPlayTimer),this.autoPlayTimer=egret.setInterval(this.onPlayTimer,this,this.stepTimeGapMs/this.speed))},i.prototype.stopAndClear=function(){egret.clearInterval(this.autoPlayTimer),this.data=null,this.isPlaying=!1},i.prototype.onPlayTimer=function(){this.index++,this.index>this.max?egret.clearInterval(this.autoPlayTimer):(t.dataProxy.centerConfig.socketProxy.replayData(this.data[this.index-1]),this.dispatchEventWith(i.E_PROGRESS,!1,this.index/this.max))},i.E_PROGRESS="E_PROGRESS",i}(egret.EventDispatcher);t.ERMJReplayVo=e,__reflect(e.prototype,"ERMJ.ERMJReplayVo")}(ERMJ||(ERMJ={}));var ERMJ;!function(t){var e=function(){function t(){}return t}();t.MahjongGameActionDTO=e,__reflect(e.prototype,"ERMJ.MahjongGameActionDTO")}(ERMJ||(ERMJ={}));var ERMJ;!function(t){var e=function(){function t(){}return t.prototype.fromThreeCard=function(t,e){t.sort(function(t,e){return e>t?-1:t==e?0:1}),this.card=e,t[0]==e?this.type=1:t[1]==e?this.type=2:this.type=3},t}();t.MahjongGameChowDTO=e,__reflect(e.prototype,"ERMJ.MahjongGameChowDTO")}(ERMJ||(ERMJ={}));var ERMJ;!function(t){var e=function(){function t(){}return t}();t.MahjongGameTurnDTO=e,__reflect(e.prototype,"ERMJ.MahjongGameTurnDTO")}(ERMJ||(ERMJ={}));var ERMJ;!function(t){var e=function(){function e(){}return e.maskNick=function(e){e&&(e.name=maskNick_XY(e.name,e.uid,t.dataProxy.roomDetailInfo&&t.dataProxy.roomDetailInfo.friends,t.dataProxy.centerConfig&&t.dataProxy.centerConfig.replayMode))},e}();t.PlayerDTO=e,__reflect(e.prototype,"ERMJ.PlayerDTO")}(ERMJ||(ERMJ={}));var ERMJ;!function(t){var e=function(){function t(){}return t}();t.SettlingDTO=e,__reflect(e.prototype,"ERMJ.SettlingDTO")}(ERMJ||(ERMJ={}));var ERMJ;!function(t){var e=function(){function t(){}return t}();t.SettlingPlayerDTO=e,__reflect(e.prototype,"ERMJ.SettlingPlayerDTO")}(ERMJ||(ERMJ={}));var ERMJ;!function(t){var e=function(){function t(){}return t}();t.SnapshotDTO=e,__reflect(e.prototype,"ERMJ.SnapshotDTO")}(ERMJ||(ERMJ={}));var ERMJ;!function(t){var e=function(){function t(){}return t}();t.UserMahjongDTO=e,__reflect(e.prototype,"ERMJ.UserMahjongDTO")}(ERMJ||(ERMJ={}));var ERMJ;!function(t){var e=function(){function t(){}return t.hasValid=function(e){return-1!=e.indexOf(t.chi)||-1!=e.indexOf(t.peng)||-1!=e.indexOf(t.ming_gang)||-1!=e.indexOf(t.bu_gang)||-1!=e.indexOf(t.an_gang)||-1!=e.indexOf(t.ting)||-1!=e.indexOf(t.hu)},t.da_pai=1,t.mo_pai=2,t.chi=11,t.peng=22,t.ming_gang=31,t.bu_gang=32,t.an_gang=33,t.huan_hua=44,t.ting=88,t.hu=99,t.pass=999,t}();t.Action=e,__reflect(e.prototype,"ERMJ.Action")}(ERMJ||(ERMJ={}));var ERMJ;!function(t){var e=function(){function t(){}return t.TABLE_TRY_TO_LEAVE_C=91,t.TABLE_LEAVE_S=92,t.TABLE_NOT_EXISTS_S=99,t.GET_SNAPSHOT_C=1e3,t.REFRESH_SNAPSHOT_S=1001,t.REFRESH_TABLE_ID_B=1011,t.STATE_PREPARE_B=1031,t.STATE_START_B=1034,t.STATE_END_B=1201,t.JOIN_B=2001,t.LEAVE_B=2009,t.MAHJONG_DA_C=9001,t.MAHJONG_CHI_C=9002,t.MAHJONG_PENG_C=9003,t.MAHJONG_MING_GANG_C=9011,t.MAHJONG_JIA_GANG_C=9012,t.MAHJONG_AN_GANG_C=9013,t.MAHJONG_TING_C=9018,t.MAHJONG_HU_C=9020,t.MAHJONG_PASS_C=9031,t.MAHJONG_TURN_B=9901,t.MAHJONG_ACTION_B=9949,t.TRUSTEESHIP_C=1101,t.TRUSTEESHIP_S=1102,t.CONTINUE_C=1199,t.MAHJONG_SHOW_ME_THE_MONEY_C=9881,t.MAHJONG_SHOW_ME_THE_MONEY_S=9882,t.MAHJONG_BLACK_SHEEP_WALL_C=9883,t.READY_C=2005,t.READY_B=2006,t.INIT_FOR_NEXT_ROUND_B=1209,t.TABLE_CHAT_C=31,t.TABLE_CHAT_B=32,t}();t.ERMJProtocol=e,__reflect(e.prototype,"ERMJ.ERMJProtocol")}(ERMJ||(ERMJ={}));var ERMJ;!function(t){function e(e,n){void 0===n&&(n={});var a=puremvc.Facade.getInstance(GameIdEnum.ERMJ);if(a){var o=a.retrieveMediator(i.NAME);o?o.sendMessage(e,n):t.warn("ERMJ的ERMJSocketMediator已经销毁")}else t.warn("ERMJ的facade已经销毁")}var i=function(i){function n(){var e=i.call(this,n.NAME)||this;return e.currentIP=null,e.roomStr=0,e.serverDataStack=[],e.topic=t.dataProxy.centerConfig.moduleType+TopicType.HD_LOGIC,t.dataProxy.centerConfig.socketProxy.addHandler(e.topic,e),Global.eventCenter.addEventListener("mqtt_reconnecting",e.onReconnecting,e),Global.eventCenter.addEventListener("mqtt_reconnect_ok",e.onReconnectOk,e),e}return __extends(n,i),n.prototype.onRemove=function(){i.prototype.onRemove.call(this),t.dataProxy.centerConfig.socketProxy.clearHandlers(this.topic),Global.eventCenter.removeEventListener("mqtt_reconnecting",this.onReconnecting,this),Global.eventCenter.removeEventListener("mqtt_reconnect_ok",this.onReconnectOk,this)},n.prototype.listNotificationInterests=function(){return[n.START_CONNECT,n.SHIFT_ALL_SERVER_DATA,n.SWITCH_ROOM]},n.prototype.handleNotification=function(i){switch(i.getName()){case n.START_CONNECT:break;case n.SHIFT_ALL_SERVER_DATA:this.shiftAllServerData();break;case n.SWITCH_ROOM:e(t.ERMJProtocol.TABLE_TRY_TO_LEAVE_C,999999)}},n.prototype.shiftAllServerData=function(){for(t.trace("开始处理所有堆栈中的服务器消息");this.serverDataStack.length>0;){var e=this.serverDataStack.shift();this.executeServerData(e.cmd,e.data,e.fromData)}t.trace("所有堆栈中的服务器消息处理完毕")},n.prototype.handle=function(e,i,n){t.trace("receive cmd ["+e+"], data:",i);{if(e!=SocketProxy.CMD_REPLAY)return e==t.ERMJProtocol.REFRESH_SNAPSHOT_S||e==t.ERMJProtocol.TABLE_NOT_EXISTS_S||e==t.ERMJProtocol.TABLE_LEAVE_S||this.roomInfoInited?(this.executeServerData(e,i,n),!0):void t.trace("房间数据没有初始化, 当前消息抛弃!");if(i==t.dataProxy.replayVo.data[t.dataProxy.replayVo.data.length-1])t.dataProxy.gameComplete(i);else{var a=i;a.state=1,t.dataProxy.updateRoomDetailInfo(a),this.roomInfoInited=!0,t.sendNotification(t.ERMJResultMediator.HIDE)}}},n.prototype.cmdNeedToStack=function(e){return e==t.ERMJProtocol.TABLE_LEAVE_S?!1:!0},n.prototype.executeServerData=function(e,i,n){switch(e){case t.ERMJProtocol.REFRESH_SNAPSHOT_S:var a=i;t.dataProxy.updateRoomDetailInfo(a),this.roomInfoInited=!0,DevelopMain.dataInited=!0,t.sendNotification(t.ERMJGameSceneMediator.UPDATE_ROOM_DETAIL_INFO);break;case t.ERMJProtocol.INIT_FOR_NEXT_ROUND_B:t.dataProxy.clearReadyState();break;case t.ERMJProtocol.STATE_PREPARE_B:t.dataProxy.changeToPrepare(i);break;case t.ERMJProtocol.STATE_START_B:var a=i;t.dataProxy.updateRoomDetailInfo(a),t.sendNotification(t.ERMJGameSceneMediator.CHANGE_TO_START);break;case t.ERMJProtocol.STATE_END_B:t.dataProxy.gameComplete(i);break;case t.ERMJProtocol.JOIN_B:t.dataProxy.someOneJoin(i);break;case t.ERMJProtocol.LEAVE_B:t.dataProxy.someOneLeave(i);break;case t.ERMJProtocol.MAHJONG_TURN_B:var o=i;t.dataProxy.updateTurn(o);break;case t.ERMJProtocol.MAHJONG_ACTION_B:var r=i;t.dataProxy.updateAction(r);break;case t.ERMJProtocol.TRUSTEESHIP_S:t.dataProxy.updateTuoguan(i);break;case t.ERMJProtocol.MAHJONG_SHOW_ME_THE_MONEY_S:i&&i.length>0?t.sendNotification(t.ERMJHackMediator.SHOW,i):Toast.show("牌局开始后，才可使用选牌功能");break;case t.ERMJProtocol.TABLE_LEAVE_S:var s=i,h=s.s;if(0>h)Toast.show(t.i18n(s.m,s.a)),SimpleLoading.hide();else if(888888==h)this.roomInfoInited=!1,t.dataProxy.gameExited=!0,DevelopMain.dataInited=!1;else if(999999==h){this.roomInfoInited=!1,t.dataProxy.gameExited=!0,DevelopMain.dataInited=!1,t.dataProxy.lastGamePlayerIds=[],null!=s.m&&""!=s.m&&Toast.show(t.i18n(s.m,s.a));var l=new JoinDTO(t.dataProxy.centerConfig.moduleType,s.d);t.dataProxy.centerConfig.socketProxy.sendMessage(ModuleType.MODULE_LOBBY+TopicType.HD_SWITCHTABLE,t.dataProxy.centerConfig.type,t.dataProxy.centerConfig.area,0,l)}else this.roomInfoInited=!1,t.dataProxy.gameExited=!0,DevelopMain.dataInited=!1,SocketManager.getInstance().disconnect(),s.m?t.alert(format_XY2(t.i18n(s.m),s.a),function(){t.sendNotification(t.ERMJExitCommand.NAME)}):t.sendNotification(t.ERMJExitCommand.NAME);break;case t.ERMJProtocol.TABLE_NOT_EXISTS_S:t.alert(t.i18n("房间已解散，请重新进入房间."),function(){t.sendNotification(t.ERMJExitCommand.NAME)});break;case t.ERMJProtocol.REFRESH_TABLE_ID_B:t.dataProxy.updateTableId(i);break;case t.ERMJProtocol.READY_B:t.dataProxy.setPlayerReady(i);break;case t.ERMJProtocol.TABLE_CHAT_B:var d=i;if(!d)return;var c=t.dataProxy.findPlayerGameInfoByUid(d.uid);if(!c)return;ChatManager.showChatAt(c.uid==Global.uid?1:3,d,1==c.gender)}},n.prototype.onReconnecting=function(){this.roomInfoInited=!1,SimpleLoading.show(t.i18n("网络异常，游戏重连中...")),t.trace("网络断开，开始重连")},n.prototype.onReconnectOk=function(){SimpleLoading.hide(),t.trace("重连成功！"),this.sendMessage(t.ERMJProtocol.GET_SNAPSHOT_C)},n.prototype.sendMessage=function(e,i){t.dataProxy.centerConfig.socketProxy.sendMessage(this.topic,t.dataProxy.centerConfig.type,t.dataProxy.centerConfig.area,e,i),t.trace("send cmd ["+e+"], data:",i)},n.NAME=GameIdEnum.ERMJ+"ERMJSocketMediator",n.START_CONNECT=n.NAME+"START_CONNECT",n.SHIFT_ALL_SERVER_DATA=n.NAME+"SHIFT_ALL_SERVER_DATA",n.SWITCH_ROOM=n.NAME+"SWITCH_ROOM",n}(puremvc.Mediator);t.ERMJSocketMediator=i,__reflect(i.prototype,"ERMJ.ERMJSocketMediator",["ISocketDataHandler"]),t.sendSocketMessage=e}(ERMJ||(ERMJ={}));var ERMJ;!function(t){var e=function(t){function e(i,n,a,o,r){var s=t.call(this)||this;return s.id=e.counter++,s.source=i,s.callback=n,s.focusIncall=o,s.focusOutcall=r,s.thisObj=a,s.defaultY=i.y,s.setEnable(!0),i.addEventListener(egret.TouchEvent.TOUCH_BEGIN,s.onBegin,s),Global.stage.addEventListener(egret.TouchEvent.TOUCH_END,s.onEnd,s),e.allTaps.push(s),s}return __extends(e,t),e.init=function(){},e.prototype.onTap=function(t){t&&(t.stopPropagation(),t.stopImmediatePropagation(),t.preventDefault()),this.isSwiped||(this.focused?this.doCall():(this.focusIncall&&this.focusIncall.apply(this.thisObj,[this.source]),this.focused=!0,this.updateFocus()))},e.prototype.onBegin=function(t){this.locX=t.stageX,this.locY=t.stageY,this.isSwiped=!1,this.beginCanUse=!0,this.bornX=this.source.x,this.bornY=this.source.y,this.source.parent&&this.source.parent.addChild(this.source),this.source.parent&&this.source.parent.parent&&this.source.parent.parent.parent&&this.source.parent.parent.parent.addChild(this.source.parent.parent),Global.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMove,this)},e.prototype.onMove=function(t){this.source.x=this.bornX+t.stageX-this.locX,this.source.y=this.bornY+t.stageY-this.locY},e.prototype.onEnd=function(t){if(!this.beginCanUse)return void this.focusOut();Global.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMove,this),this.source.x=this.bornX,this.source.y=this.bornY,this.beginCanUse=!1;var e=t.stageX-this.locX,i=t.stageY-this.locY,n=0;return Math.abs(i)<150?(t.stopPropagation(),t.stopImmediatePropagation(),t.preventDefault(),void(Math.abs(i)<50&&Math.abs(e)<50?this.onTap():(this.isSwiped=!0,this.focusOut()))):(n=i>0?1:0,void(0==n?(this.focused=!1,this.updateFocus(),this.doCall(),this.isSwiped=!0):1==n&&(this.isSwiped=!0,this.focused=!1,this.focusOut())))},e.prototype.focusOut=function(){this.focused&&(this.focusOutcall&&this.focusOutcall.apply(this.thisObj,[this.source]),this.focused=!1,this.updateFocus())},e.prototype.doCall=function(){this.callback.apply(this.thisObj,[this.source]),this.focused=!1
},e.prototype.updateFocus=function(){if(this.updateView(),this.focused)for(var t=0,i=e.allTaps.length;i>t;t++){var n=e.allTaps[t];n!=this&&(n.focused=!1,n.updateView())}},e.prototype.updateView=function(){Tween$.removeTweens(this.source);var t=this.focused?this.defaultY-40:this.defaultY;Tween$.get(this.source).to({y:t},50)},e.prototype.setEnable=function(t){this.source.touchEnabled=t,this.source.touchChildren=!1,this.focused=!1},e.prototype.updateDefaultY=function(){this.defaultY=this.source.y},e.prototype.dispose=function(){this.source&&(this.source.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this),this.source.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBegin,this),this.source.removeEventListener(egret.TouchEvent.TOUCH_END,this.onEnd,this)),Global.stage.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.focusOut,this),Global.stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.onEnd,this),Global.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMove,this),this.source&&Tween$.removeTweens(this.source),this.source=null,this.callback=null,this.thisObj=null,this.focusIncall=null,this.focusOutcall=null;var t=e.allTaps.indexOf(this);e.allTaps.splice(t,1)},e.allTaps=[],e.counter=0,e.inited=!1,e}(egret.EventDispatcher);t.ERMJMahjongUserTap=e,__reflect(e.prototype,"ERMJ.ERMJMahjongUserTap")}(ERMJ||(ERMJ={}));var ERMJ;!function(t){var e=function(){function e(){}return e.getUIPosByServerPos=function(e){var i=t.dataProxy.selfIndex,n=this.DONG,a=this.NAN,o=this.XI,r=this.BEI;if(i==n){if(e==n)return 1;if(e==a)return 2;if(e==o)return 3;if(e==r)return 0}if(i==a){if(e==n)return 0;if(e==a)return 1;if(e==o)return 2;if(e==r)return 3}if(i==o){if(e==n)return 3;if(e==a)return 0;if(e==o)return 1;if(e==r)return 2}if(i==r){if(e==n)return 2;if(e==a)return 3;if(e==o)return 0;if(e==r)return 1}},e.DONG=0,e.NAN=1,e.XI=2,e.BEI=3,e}();t.ERMJPositionUtils=e,__reflect(e.prototype,"ERMJ.ERMJPositionUtils")}(ERMJ||(ERMJ={}));var ERMJ;!function(t){var e=function(){function e(){}return e.dispose=function(){this.stopBgm(),SoundManager.dispose(GameIdEnum.ERMJ)},e.bgm=function(){this.play("ready",!0)},e.stopBgm=function(){var t=GameIdEnum.ERMJ+"_ready_mp3";SoundManager.stop(t,!0)},e.dice=function(){this.play("roll_sice")},e.win=function(){this.play("win")},e.lose_liuju=function(){this.play("lose_liu")},e.chooseCard=function(){this.play("select")},e.gameStart=function(){this.play("beganGame")},e.clock=function(){this.play("clock")},e.dapai=function(){this.play("out_card")},e.hu=function(e,i){var n=1==t.dataProxy.findPlayerGameInfoByUid(e).gender?"man_":"woman_",a=n;a+=i?"zimo":"hu",this.play(a),this.play("hu_shan")},e.action=function(e){var i=1==t.dataProxy.findPlayerGameInfoByUid(e.uid).gender?"man_":"woman_",n="",a=mahjong.helpCard0.buildByCardID(e.card);switch(e.action){case t.Action.da_pai:this.dapai(),a.type==mahjong.Type.BAMBOO||a.type==mahjong.Type.CHARACTER||a.type==mahjong.Type.DOT?(a.type==mahjong.Type.BAMBOO?n="tiao":a.type==mahjong.Type.CHARACTER&&(n="w_"),a.type==mahjong.Type.DOT&&(n="tong"),n+=a.point+1+""):a.type==mahjong.Type.ZI?a.point==mahjong.Point.EAST_WIND?n="f_1":a.point==mahjong.Point.SOUTH_WIND?n="f_2":a.point==mahjong.Point.WEST_WIND?n="f_3":a.point==mahjong.Point.NORTH_WIND?n="f_4":a.point==mahjong.Point.RED_DRAGON?n="f_5":a.point==mahjong.Point.GREEN_DRAGON?n="f_6":a.point==mahjong.Point.WHITE_DRAGON&&(n="f_7"):t.warn("未处理的声音："+a.toString());break;case t.Action.chi:n="chi";break;case t.Action.peng:n="peng";break;case t.Action.ting:n="ting";break;case t.Action.ming_gang:case t.Action.bu_gang:n="gang";break;case t.Action.an_gang:n="angang";break;case t.Action.hu:n=e.lastOpUid==e.uid?"zimo":"hu";break;case t.Action.huan_hua:n="buhua"}""!=n&&(n=i+n),this.play(n)},e.play=function(t,e){void 0===e&&(e=!1),""!=t&&(t=GameIdEnum.ERMJ+"_"+t+"_mp3",RES.getRes(t)&&(e?SoundManager.playBg(t,0,-1):SoundManager.playEffect(t)))},e}();t.ERMJSoundPlayer=e,__reflect(e.prototype,"ERMJ.ERMJSoundPlayer")}(ERMJ||(ERMJ={}));var ERMJ;!function(t){var e=function(){function e(){}return e.getArtCardRes=function(e){var i=mahjong.helpCard0.buildByCardID(e),n=0;switch(mahjong.helpCard0.type){case mahjong.Type.BAMBOO:n=i.point+1;break;case mahjong.Type.DOT:n=i.point+11;break;case mahjong.Type.CHARACTER:n=i.point+21;break;case mahjong.Type.ZI:case mahjong.Type.FLOWER:switch(i.point){case mahjong.Point.RED_DRAGON:n=31;break;case mahjong.Point.GREEN_DRAGON:n=32;break;case mahjong.Point.WHITE_DRAGON:n=33;break;case mahjong.Point.EAST_WIND:n=34;break;case mahjong.Point.SOUTH_WIND:n=35;break;case mahjong.Point.WEST_WIND:n=36;break;case mahjong.Point.NORTH_WIND:n=37;break;case mahjong.Point.FLOWER_CHUN:n=42;break;case mahjong.Point.FLOWER_XIA:n=43;break;case mahjong.Point.FLOWER_QIU:n=44;break;case mahjong.Point.FLOWER_DONG:n=45;break;case mahjong.Point.FLOWER_MEI:n=38;break;case mahjong.Point.FLOWER_LAN:n=39;break;case mahjong.Point.FLOWER_ZHU:n=40;break;case mahjong.Point.FLOWER_JU:n=41}}return 0==n&&t.trace(1111),"ERMJ_card_"+n+"_png"},e}();t.ERMJStringUtils=e,__reflect(e.prototype,"ERMJ.ERMJStringUtils")}(ERMJ||(ERMJ={}));var ERMJ;!function(t){var e=function(e){function i(){var t=e.call(this,"ERMJAlertSkin")||this;return t.timer=0,remove_XY(t.btnGrp),t.tf.height=270,t.tf.lineSpacing=15,t}return __extends(i,e),i.getInstance=function(){return this.instance||(this.instance=new i),this.instance},i.dispose=function(){i.instance&&i.instance.dispose(),i.instance=null},i.prototype.show=function(){var t=puremvc.Facade.getInstance(GameIdEnum.ERMJ).layout;t.msgLayer.addChild(this),this.counter=0,this.onTimer(),this.startTimer()},i.prototype.startTimer=function(){egret.clearInterval(this.timer),this.timer=egret.setInterval(this.onTimer,this,500)},i.prototype.onTimer=function(){this.counter++;var e=this.counter%4;this.tf.text=t.i18n("正在为您匹配牌桌\n游戏即将开始，请耐心等待")+copyChar_XY(".",e)+copyChar_XY(" ",3-e)},i.prototype.stopTimer=function(){egret.clearInterval(this.timer)},i.prototype.hide=function(){this.stopTimer(),remove_XY(this)},i}(BaseComponent);t.ERMJLoading=e,__reflect(e.prototype,"ERMJ.ERMJLoading")}(ERMJ||(ERMJ={}));var ERMJ;!function(t){function e(t,e){n.init(),n.instance.showAlert(t,e)}function i(t,e,i){n.init(),n.instance.showConfirm(t,e,i)}var n=function(t){function e(){var e=t.call(this,"ERMJAlertSkin")||this;return i18nEUI(GameIdEnum.ERMJ,e,[e.okBtn,e.cancelBtn]),bindTapEvent_XY(e.okBtn,e.onOk,e,!1,null,!1,!0),bindTapEvent_XY(e.cancelBtn,e.onNo,e,!1,null,!1,!0),bindTapEvent_XY(e.closeBtn,e.onClose,e,!0),e}return __extends(e,t),e.init=function(){e.instance=e.instance||new e},e.dispose=function(){e.instance&&e.instance.dispose(),e.instance=null},e.prototype.dispose=function(){t.prototype.dispose.call(this),this.okCall=null,this.cancelCall=null,clearTapEvent_XY(this.okBtn,this.onOk,this),clearTapEvent_XY(this.cancelBtn,this.onNo,this),clearTapEvent_XY(this.closeBtn,this.onClose,this)},e.prototype.onOk=function(){this.okCall&&this.okCall(),this.hide()},e.prototype.onNo=function(){this.cancelCall&&this.cancelCall(),this.hide()},e.prototype.onClose=function(){this.hide()},e.prototype.showAlert=function(t,e){this.okCall=e;var i=puremvc.Facade.getInstance(GameIdEnum.ERMJ).layout;i.msgLayer.addChild(this),setHtmlText(this.tf,t),remove_XY(this.cancelBtn),this.okBtn.x=0,tween_XY_alphaShow(this)},e.prototype.showConfirm=function(t,e,i){this.okCall=e,this.cancelCall=i;var n=puremvc.Facade.getInstance(GameIdEnum.ERMJ).layout;n.msgLayer.addChild(this),setHtmlText(this.tf,t),this.btnGrp.addChild(this.cancelBtn),tween_XY_alphaShow(this),this.okBtn.x=248},e.prototype.hide=function(){this.okCall=null,this.cancelCall=null,remove_XY(this)},e}(BaseComponent);t.XYAlert=n,__reflect(n.prototype,"ERMJ.XYAlert"),t.alert=e,t.confirm=i}(ERMJ||(ERMJ={}));var ERMJ;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.mLabel="",e.mLabelSize=30,bindEuiCreateOkEventOnce_XY(e,e.onInit,e),e.isEnable=!0,e}return __extends(e,t),e.prototype.onInit=function(){setHtmlText(this.tf,this.mLabel),this.bg.source="ERMJ_btn_tb2_png",this.a_labelColor=14868963,this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onEffectBeginTouchHandler,this),this.addEventListener(egret.TouchEvent.TOUCH_CANCEL,this.onEffectEndTouchHandler,this),this.addEventListener(egret.TouchEvent.TOUCH_END,this.onEffectEndTouchHandler,this),this.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onEffectEndTouchHandler,this)},e.prototype.onEffectBeginTouchHandler=function(){this.isEnable&&(this.bg.source="ERMJ_btn_tb1_png",this.a_labelColor=4925952,this.useTapSound&&SoundManager.playEffect(__tapSound))},e.prototype.onEffectEndTouchHandler=function(){this.isEnable&&(this.bg.source="ERMJ_btn_tb2_png",this.a_labelColor=14868963)},e.prototype.setEnalble=function(t){this.touchEnabled=t,this.touchChildren=t,this.isEnable=t,t?(this.bg.source="ERMJ_btn_tb2_png",this.a_labelColor=14868963):(this.bg.source="ERMJ_btn_an2_png",this.a_labelColor=4211011)},e.prototype.dispose=function(){this.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onEffectBeginTouchHandler,this),this.removeEventListener(egret.TouchEvent.TOUCH_CANCEL,this.onEffectEndTouchHandler,this),this.removeEventListener(egret.TouchEvent.TOUCH_END,this.onEffectEndTouchHandler,this),this.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onEffectEndTouchHandler,this)},e.prototype.setHtmlLabel=function(t){this.mLabel=t,this.tf&&setHtmlText(this.tf,t)},Object.defineProperty(e.prototype,"a_label",{get:function(){return this.mLabel},set:function(t){this.mLabel=t,this.tf&&setHtmlText(this.tf,t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"a_labelSize",{get:function(){return this.mLabelSize},set:function(t){this.mLabelSize=t,this.tf&&(this.tf.size=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"a_labelColor",{get:function(){return this.mLabelColor},set:function(t){this.mLabelColor=t,this.tf&&(this.tf.textColor=t)},enumerable:!0,configurable:!0}),e}(eui.Component);t.XYButton=e,__reflect(e.prototype,"ERMJ.XYButton")}(ERMJ||(ERMJ={}));var ERMJ;!function(t){var e=function(e){function i(t){return e.call(this,i.NAME,t)||this}return __extends(i,e),i.prototype.onRemove=function(){e.prototype.onRemove.call(this),this.gameScene&&(this.gameScene.dispose(),remove_XY(this.gameScene),this.gameScene=null)},i.prototype.listNotificationInterests=function(){return[i.SHOW,i.UPDATE_ROOM_DETAIL_INFO,i.UPDATE_TABLE_ID,i.CHANGE_TO_PREPARE,i.CHANGE_TO_START,i.SOME_ONE_JOIN,i.SOME_ONE_LEAVE,i.UPDATE_TURN,i.DO_ACTION,i.UPDATE_TUOGUAN,i.SHOW_HU,i.UPDATE_PLAYER_READY]},i.prototype.handleNotification=function(e){var n=e.getBody();switch(e.getName()){case i.SHOW:this.gameScene||(this.gameScene=new t.ERMJGameScene,this.gameScene.init()),this.getLayer().addChild(this.gameScene);break;case i.UPDATE_ROOM_DETAIL_INFO:this.gameScene&&this.gameScene.updateRoomInfo();break;case i.UPDATE_TABLE_ID:this.gameScene&&this.gameScene.updateTableId();break;case i.CHANGE_TO_PREPARE:this.gameScene&&this.gameScene.updateRoomInfo();break;case i.CHANGE_TO_START:this.gameScene&&this.gameScene.gameStart();break;case i.SOME_ONE_JOIN:this.gameScene&&this.gameScene.someOneJoin();break;case i.SOME_ONE_LEAVE:this.gameScene&&this.gameScene.someOneLeave();break;case i.UPDATE_TURN:this.gameScene&&this.gameScene.updateTurn();break;case i.DO_ACTION:this.gameScene&&this.gameScene.doAction(n[0],n[1],n[2]);break;case i.UPDATE_TUOGUAN:this.gameScene&&this.gameScene.updateAiState();break;case i.SHOW_HU:this.gameScene&&this.gameScene.playHu();break;case i.UPDATE_PLAYER_READY:this.gameScene&&this.gameScene.updatePlayerReady(n)}},i.NAME=GameIdEnum.ERMJ+"ERMJGameSceneMediator",i.SHOW=i.NAME+"SHOW",i.UPDATE_ROOM_DETAIL_INFO=i.NAME+"UPDATE_ROOM_DETAIL_INFO",i.UPDATE_TABLE_ID=i.NAME+"UPDATE_TABLE_ID",i.CHANGE_TO_PREPARE=i.NAME+"CHANGE_TO_PREPARE",i.CHANGE_TO_START=i.NAME+"CHANGE_TO_START",i.SOME_ONE_JOIN=i.NAME+"SOME_ONE_JOIN",i.SOME_ONE_LEAVE=i.NAME+"SOME_ONE_LEAVE",i.UPDATE_TURN=i.NAME+"UPDATE_TURN",i.DO_ACTION=i.NAME+"DO_ACTION",i.UPDATE_TUOGUAN=i.NAME+"UPDATE_TUOGUAN",i.SHOW_HU=i.NAME+"SHOW_HU",i.UPDATE_PLAYER_READY=i.NAME+"UPDATE_PLAYER_READY",i}(t.AbstractMediator);t.ERMJGameSceneMediator=e,__reflect(e.prototype,"ERMJ.ERMJGameSceneMediator")}(ERMJ||(ERMJ={}));var ERMJ;!function(t){var e=function(e){function i(){var i=e.call(this,"ERMJGameSceneSkin")||this;return i.throwIndex=0,i.circleIndex=0,i.allPaidun=[],i18nEUI(GameIdEnum.ERMJ,i),i.initEvents(),t.dataProxy.centerConfig.replayMode&&(remove_XY(i.exitBtn),remove_XY(i.helpBtn),remove_XY(i.soundBtn),remove_XY(i.aiBtn)),i.updateSoundState(),ChatManager.setup(RES.getRes("chat_config_json"),[null,i.chatCtx1,null,i.chatCtx3],[1,1,1,3]),i}return __extends(i,e),i.prototype.updateTableId=function(){var e=t.dataProxy.roomDetailInfo,i=e?e.state:0;0==i?this.tableIdTf.text="":this.tableIdTf.text=e?t.i18n("牌局编号:")+e.tableId:"",e&&e.friends?(this.roomNoTf.visible=!0,this.roomNoTf.text=t.i18n("房间号:")+t.dataProxy.centerConfig.area,this.copyRoomInfoBtn.visible=!0):(this.roomNoTf.visible=!1,this.copyRoomInfoBtn.visible=!1)},i.prototype.updatePlayerReady=function(t){var e=this["readyState"+t];e&&e.updateData(),1==t&&this.updateReadyBtn()},i.prototype.updateReadyBtn=function(){var e=t.dataProxy.roomDetailInfo,i=t.dataProxy.findPlayerGameInfoByUid(Global.uid);this.readyBtn.visible=!1,i&&e&&1!=e.autoReadyConf&&1!=i.ready&&0==e.state&&(this.readyBtn.visible=!0)},i.prototype.updateWaiting=function(){var e=t.dataProxy.roomDetailInfo,i=e?e.state:0;Tween$.removeTweens(this.waitingImage);var n=t.ERMJFacade.getInstance(GameIdEnum.ERMJ).retrieveMediator(t.ERMJResultMediator.NAME).isShowing();e&&(0==i||9==i&&!n)?(this.addChild(this.waitingImage),this.waitingImage.alpha=1,Tween$.get(this.waitingImage,{loop:!0}).to({alpha:0},1e3).to({alpha:1},1e3)):remove_XY(this.waitingImage)},i.prototype.tryBuildAllPaidun=function(){var e=t.dataProxy.roomDetailInfo;if(0==this.allPaidun.length){var i=Math.min(e.dices[0],e.dices[1]),n=e.dices[0]+e.dices[1],a=0;a=n%2!=0?t.dataProxy.dealerIndex-1:t.dataProxy.dealerIndex+1,a=(a+4)%4;var o=t.ERMJPositionUtils.getUIPosByServerPos(a);0==o?this.allPaidun=this.paidun0.getAllPaiDun().concat(this.paidun2.getAllPaiDun()):this.allPaidun=this.paidun2.getAllPaiDun().concat(this.paidun0.getAllPaiDun());var r=this.allPaidun.splice(0,2*i);this.allPaidun=this.allPaidun.concat(r);for(var s=0,h=this.allPaidun.length;h>s;s++){var l=this.allPaidun[s];l.visible=!0}}},i.prototype.updatePaidun=function(){var e=t.dataProxy.roomDetailInfo,i=e?e.state:0;if(this.leftCardsTf.text=0==i?"72":e.remaining+"",0==i)this.paidun0.setAllReady(),this.paidun2.setAllReady();else{this.tryBuildAllPaidun();for(var n=0,a=e.ascDraw;a>n;n++){var o=this.allPaidun[n];o&&(o.visible=!1,Tween$.removeTweens(o),o.alpha=1)}for(var n=this.allPaidun.length-1,r=e.descDraw;n>=0&&r>0;n--,r--){var o;o=e.descDraw%2!=0&&1==r?this.allPaidun[n-1]:this.allPaidun[n],o&&(o.visible=!1,Tween$.removeTweens(o),o.alpha=1)}if(e.ascDraw+e.descDraw>=72)for(var n=0,a=this.allPaidun.length;a>n;n++){var o=this.allPaidun[n];o&&(o.visible=!1,Tween$.removeTweens(o),o.alpha=1)}}},i.prototype.updateTing=function(){var e=t.dataProxy.roomDetailInfo,i=e?e.state:0,n=t.dataProxy.findPlayerGameInfoByUISeat(1),a=t.dataProxy.findPlayerGameInfoByUISeat(3);this.tingState1.visible=0!=i&&n&&n.ting,this.tingState3.visible=0!=i&&a&&a.ting},i.prototype.setupEmptyDesk=function(){this.updateWaiting(),this.updateTing(),this.updateTableId(),this.updateAiState(),this.gameTimer.setupEmpty(),this.playerHead_1.updateData(),this.playerHead_3.updateData(),this.dapai1.setupEmpty(),this.dapai3.setupEmpty(),this.chipenggang1.setupEmpty(),this.chipenggang3.setupEmpty(),this.huapai1.setupEmpty(),this.huapai3.setupEmpty(),this.shoupai1.setupEmpty(),this.shoupai3.setupEmpty(),this.hupai1.setupEmpty(),this.hupai3.setupEmpty(),remove_XY(this.ctrlUI),remove_XY(this.chiChoosePanel),remove_XY(this.gangChoosePanel),remove_XY(this.huPanel),this.tryBuildAllPaidun(),this.paidun0.setAllReady(),this.paidun0.setAllReady()},i.prototype.updateRoomInfo=function(){var e=t.dataProxy.roomDetailInfo;e?e.state:0;this.updateWaiting(),this.updateTing(),this.updateTableId(),this.updateAiState(),this.gameTimer.updateData(),this.playerHead_1.updateData(),this.playerHead_3.updateData(),this.dapai1.updateData(),this.dapai3.updateData(),this.chipenggang1.updateData(),this.chipenggang3.updateData(),this.huapai1.updateData(),this.huapai3.updateData(),this.shoupai1.updateData(),this.shoupai3.updateData(),this.readyState1.updateData(),this.readyState3.updateData(),this.hupai1.updateData(),this.hupai3.updateData(),this.ctrlUI.updateData(this),remove_XY(this.chiChoosePanel),remove_XY(this.gangChoosePanel),remove_XY(this.huPanel),this.updatePaidun(),this.handCtrl.updateData(),this.updateReadyBtn()},i.prototype.initEvents=function(){this.chiChoosePanel.initEvents(),this.gangChoosePanel.initEvents(),this.ctrlUI.initEvents(),this.huPanel.initEvents(),this.gameTimer.initEvents(),bindTapEvent_XY(this.tableIdTf,this.onCopyTableId,this),bindTapEvent_XY(this.exitBtn,this.onExit,this,!0,["ERMJ_fanhui1_png","ERMJ_fanhui_png"]),bindTapEvent_XY(this.aiBtn,this.onAi,this,!0,["ERMJ_tuoguan1_png","ERMJ_tuoguan_png"]),bindTapEvent_XY(this.soundBtn,this.onSetting,this,!0,["ERMJ_yinliang1_png","ERMJ_yinliang1_png"]),bindTapEvent_XY(this.helpBtn,this.onReadMe,this,!0,["ERMJ_wenhao1_png","ERMJ_wenhao_png"]),bindTapEvent_XY(this.quxiaoTuoguanBtn,this.onCancelTuoguan,this,!0),bindTapEvent_XY(this.roomNoTf,this.onCopyRoomNO,this),bindTapEvent_XY(this.copyRoomInfoBtn,this.onCopyRoomNO,this,!0,["copy_btn_0_png","copy_btn_1_png"]),bindTapEvent_XY(this.readyBtn,this.onReady,this,!0),bindTapEvent_XY(this.chatBtn,this.onChat,this,!0),this.ctrlUI.addEventListener(t.ERMJ_ControllPanel.E_CHI,this.onChi,this),this.ctrlUI.addEventListener(t.ERMJ_ControllPanel.E_GANG,this.onGang,this),this.ctrlUI.addEventListener(t.ERMJ_ControllPanel.E_TING,this.onTing,this),this.ctrlUI.addEventListener(t.ERMJ_ControllPanel.E_PASS,this.onPass,this),this.chiChoosePanel.addEventListener(t.ERMJ_ChiChoosePanel.E_CHI,this.chooseChi,this),this.gangChoosePanel.addEventListener(t.ERMJ_GangChoosePanel.E_GANG,this.onChooseGang,this),this.paidun0.setIndex(0),this.paidun2.setIndex(2),this.playerHead_1.setIndex(1),this.playerHead_3.setIndex(3),this.dapai1.setIndex(1),this.dapai3.setIndex(3),this.readyState1.setIndex(1),this.readyState3.setIndex(3),this.chipenggang1.setIndex(1),this.chipenggang3.setIndex(3),this.huapai1.setIndex(1),this.huapai3.setIndex(3),this.shoupai1.setIndex(1),this.shoupai3.setIndex(3),this.hupai1.setIndex(1),this.hupai3.setIndex(3)},i.prototype.onCopyTableId=function(){copyTextToClipboard_XY(this.tableIdTf.text,function(){Toast.show(t.i18n("复制牌局编号成功！"))},function(){})},i.prototype.onReady=function(){t.sendSocketMessage(t.ERMJProtocol.READY_C)},i.prototype.onChat=function(){ChatManager.showPanel()},i.prototype.onExit=function(){t.dataProxy.gameExited?t.sendNotification(t.ERMJExitCommand.NAME):t.sendSocketMessage(t.ERMJProtocol.TABLE_TRY_TO_LEAVE_C)},i.prototype.onAi=function(){var e=t.dataProxy.findPlayerGameInfoByUid(Global.uid),i=e&&e.trusteeship;t.sendSocketMessage(t.ERMJProtocol.TRUSTEESHIP_C,!i)},i.prototype.onSetting=function(){var t=SoundManager.getBgMute()&&SoundManager.getEffectMute();SoundManager.setBgMute(!t),SoundManager.setEffectMute(!t),this.updateSoundState()},i.prototype.onReadMe=function(){t.sendNotification(t.ERMJReadmeMediator.SHOW)},i.prototype.onCancelTuoguan=function(){t.sendSocketMessage(t.ERMJProtocol.TRUSTEESHIP_C,!1)},i.prototype.onCopyRoomNO=function(){var e=t.dataProxy.roomDetailInfo;if(e&&e.friends){var i=t.i18n("底分：")+coin2Str_XY(e.basicChipConf);copyGameShareText_XY(GameIdEnum.ERMJ,t.dataProxy.centerConfig.area,i)}},i.prototype.onShare=function(){var e=t.dataProxy.roomDetailInfo;if(e&&e.friends){var i=t.i18n("底分：")+coin2Str_XY(e.basicChipConf);ShareMenu.getInstance().show(GameIdEnum.ERMJ,t.dataProxy.centerConfig.area,i)}},i.prototype.updateSoundState=function(){var t=SoundManager.getBgMute()&&SoundManager.getEffectMute();this.soundBtn.___switchSources=t?["ERMJ_jinyin1_png","ERMJ_jinyin_png"]:["ERMJ_yinliang1_png","ERMJ_yinliang_png"],this.soundBtn.source=this.soundBtn.___switchSources[0]},i.prototype.playHu=function(){var e=this;this.updateRoomInfo(),Tween$.removeTweens(this.waitingImage),remove_XY(this.waitingImage);var i=t.dataProxy.roomDetailInfo;if(egret.clearTimeout(this.gameResultTimer),i&&i.settlingDTO)if(i.settlingDTO.drawRound)t.sendNotification(t.ERMJResultMediator.SHOW);else{var n=t.dataProxy.findWinnerInSetting(),a=t.dataProxy.findPlayerGameInfoByUid(n.uid),o=t.ERMJPositionUtils.getUIPosByServerPos(a.position),r=function(){1==o?e.huapai1.playWinThunderMovie():e.huapai3.playWinThunderMovie()};t.ERMJSoundPlayer.hu(n.uid,n.isSelfDrawn);var s=1500;if(n.isSelfDrawn){for(var h=!1,l=0,d=n.details.length;d>l;l++){var c=n.details[l];c[0]==mahjong.ERMJ_WinType.GANG_SHANG_KAI_HUA&&(h=!0)}h?this.effectCtrl.playGangshanghua(o):this.effectCtrl.playZimo(o),r(),s=1500}else 1==o?this.dapai3.playThunder(i.settlingDTO.winCard,function(){r()}):this.dapai1.playThunder(i.settlingDTO.winCard,function(){r()}),s=2300;this.gameResultTimer=egret.setTimeout(function(){t.sendNotification(t.ERMJResultMediator.SHOW)},this,s)}},i.prototype.updateAiState=function(){var e=t.dataProxy.roomDetailInfo,i=e?e.state:0,n=t.dataProxy.findPlayerGameInfoByUid(Global.uid),a=1==i&&n&&n.trusteeship;this.aiBtn.___switchSources=a?["ERMJ_tuoguan_png","ERMJ_tuoguan1_png"]:["ERMJ_tuoguan1_png","ERMJ_tuoguan_png"],this.aiBtn.source=this.aiBtn.___switchSources[0],a&&!t.dataProxy.centerConfig.replayMode?this.addChild(this.tuoguanGrp):remove_XY(this.tuoguanGrp)},i.prototype.onShowHandReadyInfo=function(t){return this.huPanel.stage?void remove_XY(this.huPanel):(this.addChild(this.huPanel),tween_XY_alphaShow(this.huPanel),void this.huPanel.updateData(t.data))},i.prototype.chooseChi=function(e){var i=e.data;t.sendSocketMessage(t.ERMJProtocol.MAHJONG_CHI_C,i.type),remove_XY(this.chiChoosePanel),remove_XY(this.ctrlUI)},i.prototype.onChi=function(){var e=t.dataProxy.findPlayerGameInfoByUid(Global.uid),i=e.card.handCards,n=t.dataProxy.roomDetailInfo.currentDiscard,a=mahjong.MahjongTool.findAllChow(n,i);if(a)if(1==a.length){var o=new t.MahjongGameChowDTO;o.fromThreeCard(a[0],n),t.sendSocketMessage(t.ERMJProtocol.MAHJONG_CHI_C,o.type),remove_XY(this.ctrlUI)}else this.addChild(this.chiChoosePanel),this.chiChoosePanel.updateData(a,n),tween_XY_alphaShow(this.chiChoosePanel);else Toast.show(t.i18n("异常，吃牌失败"))},i.prototype.onTing=function(){this.handCtrl.setAsTingCtrl()},i.prototype.onPass=function(){this.handCtrl.cancelTingCtrl()},i.prototype.onGang=function(){for(var e=t.dataProxy.findPlayerGameInfoByUid(Global.uid),i=t.dataProxy.roomDetailInfo.actionable,n={},a=e.card.handCards,o=0,r=a.length;r>o;o++){var s=a[o];n[s]||(n[s]=0),n[s]++}s=e.card.currentCard,n[s]||(n[s]=0),n[s]++;var h=[];if(e.card.meldCards)for(var o=0,r=e.card.meldCards.length;r>o;o++){var l=e.card.meldCards[o];if(3==l.length&&l[0]==l[1]){var d=l[0];n[d]||(n[d]=0),n[d]+=3}}for(var c in n)n[c]>=4&&h.push(int_XY(c));-1!=i.indexOf(t.Action.ming_gang)?(this.sendGongActionToServer(e.card.currentCard),remove_XY(this.ctrlUI)):1==h.length?(this.sendGongActionToServer(h[0]),remove_XY(this.ctrlUI)):(this.addChild(this.gangChoosePanel),this.gangChoosePanel.updateData(h))},i.prototype.onChooseGang=function(t){var e=t.data;this.sendGongActionToServer(e),remove_XY(this.ctrlUI),remove_XY(this.gangChoosePanel)},i.prototype.sendGongActionToServer=function(e){var i=t.dataProxy.roomDetailInfo.actionable;-1!=i.indexOf(t.Action.ming_gang)?(t.sendSocketMessage(t.ERMJProtocol.MAHJONG_MING_GANG_C),remove_XY(this.gangChoosePanel)):-1!=i.indexOf(t.Action.bu_gang)?(t.sendSocketMessage(t.ERMJProtocol.MAHJONG_JIA_GANG_C,e),remove_XY(this.gangChoosePanel)):-1!=i.indexOf(t.Action.an_gang)?(t.sendSocketMessage(t.ERMJProtocol.MAHJONG_AN_GANG_C,e),remove_XY(this.gangChoosePanel)):t.warn("未找到可以杠的类型")},i.prototype.init=function(){this.effectCtrl||(this.effectCtrl=new t.ERMJ_EffectController([this.effect1,this.effect3],this));var e=new t.ERMJ_PlayerHandController(this.shoupai1);this.handCtrl=e,e.init(),e.addEventListener(t.ERMJ_PlayerHandController.E_SHOW_HU_PANEL,this.onShowHuPanel,this),e.addEventListener(t.ERMJ_PlayerHandController.E_HIDE_HU_PANEL,this.onHideHuPanel,this),e.addEventListener(t.ERMJ_PlayerHandController.E_UP_CARD,this.onUpCard,this),remove_XY(this.ctrlUI),remove_XY(this.chiChoosePanel),remove_XY(this.gangChoosePanel),remove_XY(this.huPanel),this.updateRoomInfo()},i.prototype.onShowHuPanel=function(t){this.addChild(this.huPanel),tween_XY_alphaShow(this.huPanel),this.huPanel.updateData(t.data)},i.prototype.onHideHuPanel=function(){remove_XY(this.huPanel)},i.prototype.onUpCard=function(t){var e=t.data;this.dapai1.updateUserSelectMajhong(e),this.dapai3.updateUserSelectMajhong(e)},i.prototype.updateTurn=function(){var e=t.dataProxy.roomDetailInfo;e?e.state:0;this.gameTimer.updateData(),e&&-1!=e.turnPlayers.indexOf(Global.uid)?this.shoupai1.updateData():this.shoupai1.removeTingFlag(),this.shoupai3.updateData(),this.hupai3.updateData(),this.ctrlUI.updateData(this),remove_XY(this.chiChoosePanel),remove_XY(this.gangChoosePanel),remove_XY(this.huPanel),this.updatePaidun(),this.handCtrl.updateData()},i.prototype.doAction=function(e,i,n){if(this.playActionEffect(e,i),this.updateRoomInfo(),i==t.Action.da_pai)if(e==Global.uid){var a=this.shoupai1.pai_6;this.dapai1.lastCardFlyFrom(Global.stage.stageWidth/2,Global.stage.stageHeight-200),this.handCtrl.lastUserCtrlDiscard==n&&-1!=this.handCtrl.lastUserMoCard&&this.shoupai1.playInsertCardMovie(this.handCtrl.lastUserMoCard),this.dapai1.updateUserSelectMajhong(-1),this.dapai3.updateUserSelectMajhong(-1)}else{var a=this.shoupai3.pai_13;a.localToGlobal(a.x+a.width/2,a.y+a.height/2,__point_XY),this.dapai3.lastCardFlyFrom(__point_XY.x,__point_XY.y)}},i.prototype.playActionEffect=function(e,i){var n=t.dataProxy.findPlayerGameInfoByUid(e);if(i==t.Action.chi||i==t.Action.peng||i==t.Action.ming_gang||i==t.Action.bu_gang||i==t.Action.an_gang||i==t.Action.ting){var a=t.ERMJPositionUtils.getUIPosByServerPos(n.position);this.effectCtrl.playAction(a,i)}},i.prototype.gameStart=function(){this.allPaidun=[];t.dataProxy.roomDetailInfo;this.setupEmptyDesk(),this.playStartMovie(),this.updateReadyBtn(),this.readyState1.updateData(),this.readyState3.updateData()},i.prototype.someOneJoin=function(){this.playerHead_3.updateData();var t=this.readyState3;t&&t.updateData()},i.prototype.someOneLeave=function(){this.playerHead_3.updateData();var t=this.readyState3;t&&t.updateData()},i.prototype.playStartMovie=function(){this.startDb||(this.startDb=Global.buildArmature(GameIdEnum.ERMJ,"ERMJ_start"),this.startDb.eventDispatcher.addDBEventListener(egret.Event.COMPLETE,this.onStartDbComplete,this)),this.addChild(this.startDb.display),this.startDb.display.x=Global.stage.stageWidth/2,this.startDb.display.y=Global.stage.stageHeight/2,dragonBones.WorldClock.clock.add(this.startDb),this.startDb.animation.play("Animation1",1),t.ERMJSoundPlayer.gameStart()},i.prototype.onStartDbComplete=function(){dragonBones.WorldClock.clock.remove(this.startDb),this.startDb&&remove_XY(this.startDb.display),this.gameTimer.playDiceMovie(this.playSendCardMovie.bind(this)),t.ERMJSoundPlayer.dice()},i.prototype.playSendCardMovie=function(){var e=this,i=t.dataProxy.roomDetailInfo;this.tryBuildAllPaidun();for(var n=0,a=i.ascDraw;a>n;n++){var o=this.allPaidun[n];o&&(Tween$.removeTweens(o),o.alpha=1,Tween$.get(o).set({alpha:1}).wait(50*n+50).to({alpha:0},100).call(function(t){t.alpha=1,t.visible=!1},this,[o]))}this.shoupai3.updateData(),this.shoupai1.showMyDisorderWithFlower(function(){e.huapai1.updateData(),e.huapai3.updateData()},function(){e.updateRoomInfo()})},i}(BaseComponent);t.ERMJGameScene=e,__reflect(e.prototype,"ERMJ.ERMJGameScene")}(ERMJ||(ERMJ={}));var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var ERMJ;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initEvents=function(){bindTapEvent_XY(this.chi,this.onChi,this,!0),bindTapEvent_XY(this.peng,this.onPeng,this,!0),bindTapEvent_XY(this.gang,this.onGang,this,!0),bindTapEvent_XY(this.hu,this.onHu,this,!0),bindTapEvent_XY(this.ting,this.onTing,this,!0),bindTapEvent_XY(this.pass,this.onPass,this,!0)},i.prototype.updateData=function(e){var i=t.dataProxy.roomDetailInfo,n=i?i.state:0,a=t.dataProxy.findPlayerGameInfoByUid(Global.uid);if(1==n&&a&&i.actionable&&-1!=i.turnPlayers.indexOf(Global.uid)){e.addChild(this);var o=(a.card.handCards,i.currentDiscard,i.actionable),r=-1!=o.indexOf(t.Action.chi),s=-1!=o.indexOf(t.Action.peng),h=-1!=o.indexOf(t.Action.ming_gang)||-1!=o.indexOf(t.Action.bu_gang)||-1!=o.indexOf(t.Action.an_gang),l=t.dataProxy.getTingCount()>=1&&!a.ting,d=-1!=o.indexOf(t.Action.hu),c=r||s||h||d||l;this.chi.visible=!1,this.peng.visible=!1,this.gang.visible=!1,this.hu.visible=!1,this.ting.visible=!1,this.pass.visible=!1;var u=120;r&&(this.chi.visible=!0,this.chi.x=u,u+=207),s&&(this.peng.visible=!0,this.peng.x=u,u+=207),h&&(this.gang.visible=!0,this.gang.x=u,u+=207),d&&(this.hu.visible=!0,this.hu.x=u,u+=207),l&&(this.ting.visible=!0,this.ting.x=u,u+=207),c&&(this.pass.visible=!0,this.pass.x=u,u+=125),u+=30,this.width=u}else remove_XY(this)},i.prototype.onChi=function(){this.dispatchEventWith(i.E_CHI)},i.prototype.onPeng=function(){t.trace("我碰牌"),t.sendSocketMessage(t.ERMJProtocol.MAHJONG_PENG_C),remove_XY(this)},i.prototype.onGang=function(){this.dispatchEventWith(i.E_GANG)},i.prototype.onTing=function(t){t.stopPropagation(),t.stopImmediatePropagation(),t.preventDefault(),this.dispatchEventWith(i.E_TING)},i.prototype.onHu=function(){t.sendSocketMessage(t.ERMJProtocol.MAHJONG_HU_C),remove_XY(this)},i.prototype.onPass=function(){var e=t.dataProxy.findPlayerGameInfoByUid(Global.uid);this.dispatchEventWith(i.E_PASS),e&&e.ting&&-1!=e.card.currentCard?t.sendSocketMessage(t.ERMJProtocol.MAHJONG_DA_C,e.card.currentCard):(t.sendSocketMessage(t.ERMJProtocol.MAHJONG_PASS_C),remove_XY(this))},i.E_CHI="E_CHI",i.E_GANG="E_GANG",i.E_TING="E_TING",i.E_PASS="E_PASS",i}(eui.Component);t.ERMJ_ControllPanel=e,__reflect(e.prototype,"ERMJ.ERMJ_ControllPanel")}(ERMJ||(ERMJ={}));var ERMJ;!function(t){var e=function(){function e(t,e){this.imgs=t,this.root=e;for(var i=0,n=t.length;n>i;i++){var a=t[i];a.touchEnabled=!1,remove_XY(a)}}return e.prototype.dispose=function(){this.imgs=null,this.root=null,this.tfs=null},e.prototype.hideAll=function(){for(var t=0,e=this.imgs.length;e>t;t++){var i=this.imgs[t];remove_XY(i)}},e.prototype.playDianpao=function(t){var e=1==t?this.imgs[0]:this.imgs[1];e.source="ERMJ_btn_dianpao_png",this.play(e)},e.prototype.playZimo=function(t){var e=1==t?this.imgs[0]:this.imgs[1];e.source="ERMJ_btn_zimo_png",this.play(e)},e.prototype.playGangshanghua=function(t){var e=1==t?this.imgs[0]:this.imgs[1];e.source="ERMJ_btn_gangshanghua_png",this.play(e)},e.prototype.playAction=function(e,i){var n=1==e?this.imgs[0]:this.imgs[1];i==t.Action.chi?n.source="ERMJ_btn_chi_png":i==t.Action.peng?n.source="ERMJ_btn_peng_png":i==t.Action.ming_gang||i==t.Action.bu_gang||i==t.Action.an_gang?n.source="ERMJ_btn_gang_png":i==t.Action.hu?n.source="ERMJ_btn_hu_png":i==t.Action.ting&&(n.source="ERMJ_btn_ting_png"),this.play(n)},e.prototype.play=function(t){Tween$.removeTweens(t),this.root.addChild(t),t.scaleX=3,t.scaleY=3,t.alpha=1,Tween$.get(t).to({scaleX:1,scaleY:1},300,Ease$.sineIn).wait(500).to({alpha:0},300).call(function(){remove_XY(t)
},this)},e}();t.ERMJ_EffectController=e,__reflect(e.prototype,"ERMJ.ERMJ_EffectController")}(ERMJ||(ERMJ={}));var ERMJ;!function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.onGifComplete=function(){this.point_0.visible=!0,this.point_1.visible=!0,this.gif.visible=!1,this.callback&&this.callback()},i.prototype.playDiceMovie=function(e){this.callback=e;var i=1,n=2;t.dataProxy.roomDetailInfo&&t.dataProxy.roomDetailInfo.dices&&(i=t.dataProxy.roomDetailInfo.dices[0],n=t.dataProxy.roomDetailInfo.dices[1]),this.point_0.visible=!1,this.point_1.visible=!1,this.gif.visible=!0,this.gifCtrl.gotoAndStop(0),this.gifCtrl.play(!1),this.point_0.source="ERMJ_sezi_value"+i+"_png",this.point_1.source="ERMJ_sezi_value"+n+"_png"},i.prototype.setTime=function(t){0>=t&&(t=0),this.leftTime=t,this.timeTf.text=this.leftTime+"",egret.clearInterval(this.timer),this.leftTime>0&&(this.timer=egret.setInterval(this.onTimer,this,1e3))},i.prototype.onTimer=function(){this.leftTime--,this.leftTime<=0&&(this.leftTime=0,egret.clearInterval(this.timer)),4==this.leftTime&&t.ERMJSoundPlayer.clock(),this.timeTf.text=this.leftTime+""},i.prototype.setupEmpty=function(){this.updateData(),this.gif.visible=!1,Tween$.removeTweens(this.light_1),Tween$.removeTweens(this.light_3),this.setTime(0),this.light_1.visible=!1,this.light_3.visible=!1,this.point_0.visible=!1,this.point_1.visible=!1,this.gifCtrl.gotoAndStop(0)},i.prototype.initEvents=function(){this.gifCtrl=new MovieclipController(this.gif,12,MovieclipController.makeResLoop("ERMJ_sezi_{0}_png",0,7)),this.gifCtrl.addEventListener(egret.Event.COMPLETE,this.onGifComplete,this)},i.prototype.updateData=function(){var e=t.dataProxy.roomDetailInfo,i=e?e.state:0;if(this.difenTf.text=t.i18n("底分：")+(e?coin2Str_XY(e.basicChipConf):"--"),this.gif.visible=!1,Tween$.removeTweens(this.light_1),Tween$.removeTweens(this.light_3),this.gifCtrl.gotoAndStop(0),this.setTime(0),0==i)this.light_1.visible=!1,this.light_3.visible=!1,this.point_0.visible=!1,this.point_1.visible=!1;else{var n=e.turnPlayers||[],a=-1!=n.indexOf(Global.uid);this.light_1.visible=a,this.light_3.visible=!a&&n.length>0,this.point_0.visible=!1,this.point_1.visible=!1,this.point_0.source="ERMJ_sezi_value"+e.dices[0]+"_png",this.point_1.source="ERMJ_sezi_value"+e.dices[1]+"_png";for(var o=0,r=4;r>o;o++){var s=t.ERMJPositionUtils.getUIPosByServerPos(o),h=["ERMJ_east","ERMJ_south","ERMJ_west","ERMJ_north"][o],l=t.dataProxy.findPlayerGameInfoBySeat(o);l&&-1!=n.indexOf(l.uid)&&(h+="_light"),this["dir_"+s].source=h+"_png"}if(1==i){this.setTime(e.timeout);var d=a?this.light_1:this.light_3;Tween$.removeTweens(d),d.alpha=1,Tween$.get(d,{loop:!0}).to({alpha:0},300).to({alpha:1},300)}}},i}(eui.Component);t.ERMJ_GameTimer=e,__reflect(e.prototype,"ERMJ.ERMJ_GameTimer")}(ERMJ||(ERMJ={}));var ERMJ;!function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initEvents=function(){bindTapEvent_XY(this.grp0,this.onChoose,this),bindTapEvent_XY(this.grp1,this.onChoose,this),bindTapEvent_XY(this.grp2,this.onChoose,this)},e.prototype.onChoose=function(t){for(var i=0,n=0,a=3;a>n;n++)if(t.currentTarget==this["grp"+n]){i=n;break}this.dispatchEventWith(e.E_GANG,!1,this.cards[i])},e.prototype.dispose=function(){clearTapEvent_XY(this.grp0,this.onChoose,this),clearTapEvent_XY(this.grp1,this.onChoose,this),clearTapEvent_XY(this.grp2,this.onChoose,this),this.cards=null},e.prototype.updateData=function(t){this.cards=t;for(var e=40,i=30,n=0,a=3;a>n;n++){var o=t[n],r=this["grp"+n];if(void 0!=o){for(var s=0,h=4;h>s;s++){var l=o,d=this["card"+(4*n+s)];d.setCard(l)}this.addChild(r),r.x=e,e+=r.width+i}else remove_XY(r)}this.width=e},e.E_GANG="E_GANG",e}(eui.Component);t.ERMJ_GangChoosePanel=e,__reflect(e.prototype,"ERMJ.ERMJ_GangChoosePanel")}(ERMJ||(ERMJ={}));var ERMJ;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return bindEuiCreateOkEventOnce_XY(e,e.onCreate,e),e}return __extends(e,t),e.prototype.onCreate=function(){},e.prototype.setHead=function(t){this.headImg.source=toAvatarSource_XY(t)||"ERMJ_head_png"},e}(eui.Component);t.ERMJ_Head=e,__reflect(e.prototype,"ERMJ.ERMJ_Head")}(ERMJ||(ERMJ={}));var ERMJ;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.skinName="ERMJ_HuItemSkin",t}return __extends(i,e),i.prototype.init=function(e,i,n){this.card.setCard(e);var a='<font color="#C9180C">'+i+"</font>"+t.i18n("番")+'\n<font color="#C9180C">'+n+"</font>"+t.i18n("张");setHtmlText(this.tf,a)},i}(eui.Component);t.ERMJ_HuItem=e,__reflect(e.prototype,"ERMJ.ERMJ_HuItem")}(ERMJ||(ERMJ={}));var ERMJ;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.items=[],t.touchEnabled=!1,t.touchChildren=!1,t}return __extends(i,e),i.prototype.initEvents=function(){bindTapEvent_XY(Global.stage,this.onClose,this,!1,null,!1,!1)},i.prototype.onClose=function(){remove_XY(this)},i.prototype.dispose=function(){clearTapEvent_XY(Global.stage,this.onClose,this)},i.prototype.updateData=function(e){for(var i=2*this.huImg.x+this.huImg.width,n=this.huImg.y,a=0,o=this.items.length;o>a;a++)remove_XY(this.items[a]);if(e.winCards.length>=27)return this.huImg.visible=!1,this.tf.visible=!1,void(this.allHuImg.visible=!0);this.huImg.visible=!0,this.tf.visible=!0,this.allHuImg.visible=!1;for(var r,s,h=6,l=0,d=0,c=0,a=0,o=e.winCards.length;o>a;a++){var u=e.winCards[a],p=e.winCount[a],f=e.winFactors[a],E=this.items[a];E||(E=this.items[a]=new t.ERMJ_HuItem),r=E.width,s=E.height,E.x=i+(r+40*.695)*int_XY(a%h),E.y=n+(s+30*.695)*int_XY(a/h),l=Math.max(l,E.x),d=Math.max(d,E.y),E.init(u.cardID,f,p),c+=p,this.addChild(E)}this.width=l+r+this.huImg.x,this.height=d+s+n;var _=t.i18n("(共{0}张)",'<font color="#C9180C">'+c+"</font>");setHtmlText(this.tf,_)},i}(eui.Component);t.ERMJ_HuPanel=e,__reflect(e.prototype,"ERMJ.ERMJ_HuPanel")}(ERMJ||(ERMJ={}));var ERMJ;!function(t){var e=function(e){function i(t){var i=e.call(this)||this;return i.pool=[],i.lastUserCtrlDiscard=-1,i.lastUserMoCard=-1,i.handCard=t,i}return __extends(i,e),i.prototype.init=function(){this.inited||(this.inited=!0,this.initEvents())},i.prototype.initEvents=function(){this.taps=[];for(var e=0,i=14;i>e;e++){var n=this.handCard["pai_"+e];n.index=e,this.taps[e]=new t.ERMJMahjongUserTap(n,this.onSendCard,this,this.onFocusIn,this.onFocusOut)}},i.prototype.onCancelTingCtrl=function(){if(this.tingCtrlMode){this.tingCtrlMode=!1;for(var t=0,e=14;e>t;t++){var i=this.handCard["pai_"+t],n=this.taps[t];i.setDark(!1),n.setEnable(!0)}}},i.prototype.cancelTingCtrl=function(){this.onCancelTingCtrl()},i.prototype.setAsTingCtrl=function(){if(this.tingCtrlMode)return void this.onCancelTingCtrl();this.tingCtrlMode=!0;for(var e=0,i=14;i>e;e++){var n=this.handCard["pai_"+e];if(n.stage&&n.visible){var a=t.dataProxy.findCheckResult(n.cardId),o=this.taps[e];a?(n.setDark(!1),o.setEnable(!0)):(n.setDark(!0),o.setEnable(!1))}}},i.prototype.updateData=function(){var e=t.dataProxy.roomDetailInfo,i=e?e.state:0,n=t.dataProxy.findPlayerGameInfoByUid(Global.uid);this.tingCtrlMode=!1;var a=1==i&&-1!=e.turnPlayers.indexOf(Global.uid)&&!n.ting;if(a&&(this.lastUserCtrlDiscard=-1,this.lastUserMoCard=-1),this.taps)for(var o=0,r=this.taps.length;r>o;o++){var s=this.taps[o];s.setEnable(a);var h=this.handCard["pai_"+o];n&&h.setDark(n.ting)}},i.prototype.onSendCard=function(e){this.tingCtrlMode?(t.trace("我听牌",e.cardId),t.sendSocketMessage(t.ERMJProtocol.MAHJONG_TING_C,e.cardId)):(t.trace("我打牌",e.cardId),t.sendSocketMessage(t.ERMJProtocol.MAHJONG_DA_C,e.cardId),13!=e.index&&(this.lastUserCtrlDiscard=e.cardId,this.handCard.pai_13.stage&&this.handCard.pai_13.visible?this.lastUserMoCard=this.handCard.pai_13.cardId:this.lastUserMoCard=-1))},i.prototype.onFocusIn=function(e){var n=this,a=t.dataProxy.findCheckResult(e.cardId);a?egret.setTimeout(function(){n.dispatchEventWith(i.E_SHOW_HU_PANEL,!1,a)},this,1):this.dispatchEventWith(i.E_HIDE_HU_PANEL),t.ERMJSoundPlayer.chooseCard(),this.dispatchEventWith(i.E_UP_CARD,!1,e.cardId)},i.prototype.onFocusOut=function(){this.dispatchEventWith(i.E_HIDE_HU_PANEL),this.dispatchEventWith(i.E_UP_CARD,!1,-1)},i.E_SHOW_HU_PANEL="E_SHOW_HU_PANEL",i.E_HIDE_HU_PANEL="E_HIDE_HU_PANEL",i.E_UP_CARD="E_UP_CARD",i}(egret.EventDispatcher);t.ERMJ_PlayerHandController=e,__reflect(e.prototype,"ERMJ.ERMJ_PlayerHandController")}(ERMJ||(ERMJ={}));var ERMJ;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.touchEnabled=!1,t.touchChildren=!1,bindEuiCreateOkEventOnce_XY(t,t.onCreate,t),t}return __extends(i,e),i.prototype.onCreate=function(){},i.prototype.setIndex=function(t){this.index=t},i.prototype.updateData=function(){var e=t.dataProxy.findPlayerGameInfoByUISeat(this.index);e?(this.visible=!0,this.head.setHead(e.avatar),this.nickTf.text=substrNick_XY(e.name),this.coinTf.text=coin2Str_XY(e.coin),this.dealer.visible=e.dealer):this.visible=!1},i}(eui.Component);t.ERMJ_PlayerHead=e,__reflect(e.prototype,"ERMJ.ERMJ_PlayerHead")}(ERMJ||(ERMJ={}));var ERMJ;!function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.setIndex=function(t){this.index=t},i.prototype.updateData=function(){var e=t.dataProxy.roomDetailInfo,i=e?e.state:0,n=t.dataProxy.findPlayerGameInfoByUISeat(this.index);this.visible=!1,0==i&&e&&1!=e.autoReadyConf&&n&&1==n.ready&&(this.visible=!0)},i}(eui.Component);t.ERMJ_Ready=e,__reflect(e.prototype,"ERMJ.ERMJ_Ready")}(ERMJ||(ERMJ={}));var ERMJ;!function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.setIndex=function(t){this.index=t},i.prototype.setupEmpty=function(){this.visible=!1},i.prototype.updateData=function(e){void 0===e&&(e=!1);var i=t.dataProxy.roomDetailInfo,n=i?i.state:0,a=t.dataProxy.findPlayerGameInfoByUISeat(this.index);if(e){var o=t.dataProxy.findWinnerInSetting();a=t.dataProxy.findPlayerGameInfoByUid(o.uid)}if(0!=n&&a){this.visible=!0;for(var r=0,s=4;s>r;r++){var h=a.card.meldCards[r],l=this["chi_"+r];h?(l.visible=!0,l.setMelds(h,this.index)):l.visible=!1}}else this.visible=!1},i}(eui.Component);t.ERMJ_Chipenggang=e,__reflect(e.prototype,"ERMJ.ERMJ_Chipenggang")}(ERMJ||(ERMJ={}));var ERMJ;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.userSelectedCardId=-1,t}return __extends(i,e),i.prototype.setIndex=function(t){this.index=t,this.da_0.init(),this.da_1.init(),this.da_2.init(),this.da_3.init()},i.prototype.setupEmpty=function(){this.visible=!1,this.userSelectedCardId=-1},i.prototype.playThunder=function(t,e){Tween$.removeTweens(this.focusImg),this.focusImg.visible=!1;for(var i,n,a=this.allBgs.length-1;a>=0&&null==i;a--){var o=this.allBgs[a],r=this.allPais[a];o.visible&&(i=o,n=r,this.huBg=i,this.huPai=r)}return null==i?void e():(this.callback=e,this.thunderDb||(this.thunderDb=Global.buildArmature(GameIdEnum.ERMJ,"ERMJ_dianpao"),this.thunderDb.eventDispatcher.addDBEventListener(egret.Event.COMPLETE,this.onthunderDbComplete,this)),i.parent.addChild(this.thunderDb.display),this.thunderDb.display.x=i.x+i.width/2,this.thunderDb.display.y=i.y+i.height/2,dragonBones.WorldClock.clock.add(this.thunderDb),void this.thunderDb.animation.play("Animation1",1))},i.prototype.onthunderDbComplete=function(){dragonBones.WorldClock.clock.remove(this.thunderDb),this.thunderDb&&remove_XY(this.thunderDb.display),this.huBg&&(this.huBg.visible=!1),this.huPai&&(this.huPai.visible=!1),this.callback&&this.callback()},i.prototype.lastCardFlyFrom=function(t,e){for(var i,n,a=this.allBgs.length-1;a>=0&&null==i;a--){var o=this.allBgs[a],r=this.allPais[a];o.visible&&(i=o,n=r)}if(null!=i){BornProperty.resetToBornProperty(i),BornProperty.resetToBornProperty(n),n.parent.globalToLocal(t,e,__point_XY),Tween$.removeTweens(i),Tween$.removeTweens(n);var s=BornProperty.getBornPropertyOf(n),h={x:__point_XY.x,y:__point_XY.y,scaleX:s.scaleX,scaleY:s.scaleY};BornProperty.tweenFrom(n,h,300,100);var l=BornProperty.getBornPropertyOf(i),d={x:__point_XY.x+(l.x-s.x),y:__point_XY.y+(l.y-s.y),scaleX:l.scaleX,scaleY:l.scaleY};BornProperty.tweenFrom(i,d,300,100)}},i.prototype.updateUserSelectMajhong=function(t){void 0===t&&(t=-1),this.userSelectedCardId=t,this.updateData()},i.prototype.updateData=function(){var e=t.dataProxy.roomDetailInfo,i=e?e.state:0,n=t.dataProxy.findPlayerGameInfoByUISeat(this.index);if(Tween$.removeTweens(this.focusImg),0!=i&&n){if(this.visible=!0,!this.allBgs){this.allBgs=[],this.allPais=[];for(var a=0,o=4;o>a;a++){var r=this["da_"+a];this.allBgs=this.allBgs.concat(r.getAllBgs()),this.allPais=this.allPais.concat(r.getAllPais())}}for(var s,a=0,o=this.allBgs.length;o>a;a++){var h=this.allBgs[a],l=this.allPais[a],d=n.card.discards[a];void 0!=d?(h.visible=!0,l.visible=!0,l.source=t.ERMJStringUtils.getArtCardRes(d),s=h,-1!=this.userSelectedCardId&&d==this.userSelectedCardId?h.filters=[Filters.littleDark]:h.filters=[],BornProperty.resetToBornProperty(h),BornProperty.resetToBornProperty(l)):(h.visible=!1,l.visible=!1)}this.focusImg.visible=!1,n.uid==e.lastDiscardUid&&s&&-1!=e.currentDiscard&&(this.focusImg.visible=!0,s.parent.localToGlobal(s.x+s.width/2,s.y+10,__point_XY),this.globalToLocal(__point_XY.x,__point_XY.y,__point_XY),this.focusImg.x=__point_XY.x,this.focusImg.y=__point_XY.y,Tween$.get(this.focusImg,{loop:!0}).to({y:__point_XY.y-10},500,Ease$.sineInOut).to({y:__point_XY.y},500,Ease$.sineInOut))}else this.visible=!1},i}(eui.Component);t.ERMJ_Dapai=e,__reflect(e.prototype,"ERMJ.ERMJ_Dapai")}(ERMJ||(ERMJ={}));var ERMJ;!function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.setIndex=function(t){this.index=t},i.prototype.setupEmpty=function(){this.visible=!1},i.prototype.playWinThunderMovie=function(){for(var t,e,i=0,n=10;n>i;i++){var a=this["hua_"+i];mahjong.helpCard0.buildByCardID(a.cardId),a.visible&&mahjong.helpCard0.type!=mahjong.Type.FLOWER&&(t=a.x+a.width/2,e=a.y+a.height/2)}void 0!=t&&(this.thunderDb||(this.thunderDb=Global.buildArmature(GameIdEnum.ERMJ,"ERMJ_hupai_guangxiao"),this.thunderDb.eventDispatcher.addDBEventListener(egret.Event.COMPLETE,this.onthunderDbComplete,this)),this.addChild(this.thunderDb.display),this.thunderDb.display.x=t,this.thunderDb.display.y=e,dragonBones.WorldClock.clock.add(this.thunderDb),this.thunderDb.animation.play("Animation1",1))},i.prototype.onthunderDbComplete=function(){dragonBones.WorldClock.clock.remove(this.thunderDb),this.thunderDb&&remove_XY(this.thunderDb.display)},i.prototype.updateData=function(){var e=t.dataProxy.roomDetailInfo,i=e?e.state:0,n=t.dataProxy.findPlayerGameInfoByUISeat(this.index);if(0!=i&&n){this.visible=!0;var a=n.card.flowerCards.concat();if(9==i&&e.settlingDTO){var o=t.dataProxy.findWinnerInSetting();o&&n&&o.uid==n.uid&&a.push(e.settlingDTO.winCard)}for(var r=0,s=10;s>r;r++){var h=this["hua_"+r],l=a[r];void 0!=l?(h.visible=!0,h.setCard(l)):h.visible=!1}}else this.visible=!1},i}(eui.Component);t.ERMJ_Huapai=e,__reflect(e.prototype,"ERMJ.ERMJ_Huapai")}(ERMJ||(ERMJ={}));var ERMJ;!function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.setIndex=function(t){this.index=t},i.prototype.setupEmpty=function(){this.visible=!1},i.prototype.updateData=function(){var e=t.dataProxy.roomDetailInfo,i=e?e.state:0,n=t.dataProxy.findPlayerGameInfoByUISeat(this.index),a=!1;if(t.dataProxy.centerConfig.replayMode&&3==this.index&&!t.dataProxy.centerConfig.replayHidePoke&&(a=!0),(9==i||a)&&n){this.visible=!0;for(var o=13-n.card.handCards.length,r=0,s=13;s>r;r++){var h=this["pai_"+r],l=this["bg_"+r];h.visible=r>=o,l.visible=r>=o,h.visible&&(h.source=t.ERMJStringUtils.getArtCardRes(n.card.handCards[r-o]))}3==this.index&&(this.pai_13.visible=!1,this.bg_13.visible=!1,a&&-1!=n.card.currentCard&&(this.pai_13.visible=!0,this.bg_13.visible=!0,this.pai_13.source=t.ERMJStringUtils.getArtCardRes(n.card.currentCard)))}else this.visible=!1},i}(eui.Component);t.ERMJ_Hupai=e,__reflect(e.prototype,"ERMJ.ERMJ_Hupai")}(ERMJ||(ERMJ={}));var ERMJ;!function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.setIndex=function(t){this.uiIndex=t},e.prototype.setAllReady=function(){for(var t=0,e=36;e>t;t++){var i=this["pai_"+t];i.visible=!0,Tween$.removeTweens(i),i.alpha=1}},e.prototype.getAllPaiDun=function(){if(!this.allArr){this.allArr=[];for(var t=0,e=36;e>t;t++)this.allArr[t]=this["pai_"+t]}return this.allArr},e}(eui.Component);t.ERMJ_Paidun=e,__reflect(e.prototype,"ERMJ.ERMJ_Paidun")}(ERMJ||(ERMJ={}));var ERMJ;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.timer=0,t}return __extends(i,e),i.prototype.setIndex=function(t){this.index=t,this.cardY=this.pai_0.y,this.bornX=[];for(var e=0,i=14;i>e;e++)this.bornX[e]=this["pai_"+e].x},i.prototype.setupEmpty=function(){if(clearTimeout(this.timer),this.visible=!1,1==this.index)for(var t=0,e=14;e>t;t++){var i=this["pai_"+t];i.setDark(!1)}},i.prototype.updateData=function(){clearTimeout(this.timer),1==this.index?this.updateDataAsSelf():this.updateDataAsOther()},i.prototype.removeTingFlag=function(){for(var t=0,e=13;e>t;t++){var i=this["pai_"+t];i.hideTing()}},i.prototype.playInsertCardMovie=function(t){for(var e=0,i=13;i>e;e++){var n=this["pai_"+e];if(n.stage&&n.visible&&n.cardId==t)return Tween$.removeTweens(n),void Tween$.get(n).set({x:this.bornX[13],y:this.cardY}).wait(50).to({x:this.bornX[13],y:this.cardY-130},100).wait(50).to({x:this.bornX[e],y:this.cardY-130},300).wait(50).to({x:this.bornX[e],y:this.cardY},100)}},i.prototype.showMyDisorderWithFlower=function(e,i){var n=this;this.updateDataAsSelf(),this.pai_13.visible=!1;var a=t.dataProxy.findPlayerGameInfoByUid(Global.uid);if(!a)return this.updateDataAsSelf(),void i();for(var o=a.card.handCards.concat(),r=0,s=a.card.flowerCards.length;s>r;r++){var h=a.card.flowerCards[r];o.shift(),o.push(h)}o=shuffleArray_XY(o);for(var r=0,s=13;s>r;r++){var l=this["pai_"+r];l.setCard(o[r]),l.alpha=0,Tween$.removeTweens(l),Tween$.get(l).set({alpha:0,y:this.cardY-30}).wait(100*r+100).to({alpha:1,y:this.cardY},200)}clearTimeout(this.timer),this.timer=egret.setTimeout(function(){o=mahjong.MahjongTool.sortHandleCardByCardI(o);for(var t=0,a=13;a>t;t++){var r=n["pai_"+t];r.setCard(o[t])}n.timer=egret.setTimeout(function(){n.updateDataAsSelf(),n.pai_13.visible=!1,e(),n.timer=egret.setTimeout(function(){n.updateDataAsSelf(),i()},n,300)},n,300)},this,2e3)},i.prototype.updateDataAsSelf=function(e){void 0===e&&(e=!1);var i,n=t.dataProxy.roomDetailInfo,a=n?n.state:0,o=t.dataProxy.findPlayerGameInfoByUid(Global.uid);if(o&&(i=o.card),e){var r=t.dataProxy.findWinnerInSetting();r&&(i=r.card)}if(1==a&&i&&!e||9==a&&e){this.visible=!0;var s=13-i.handCards.length,h=n&&n.turnPlayers&&n.actionable&&-1!=n.turnPlayers.indexOf(Global.uid)&&-1!=n.actionable.indexOf(t.Action.da_pai)&&-1==i.currentCard;h&&s++;for(var l=0,d=13;d>l;l++){var c=this["pai_"+l];if(c.visible=l>=s,c.alpha=1,c.y=this.cardY,c.x=this.bornX[l],Tween$.removeTweens(c),c.visible)if(c.setCard(i.handCards[l-s]),e)c.hideTing();else{var u=t.dataProxy.findCheckResult(c.cardId);u?c.showTing():c.hideTing()}}var p=i.currentCard;if(e&&(p=n.settlingDTO.winCard),h&&(p=i.handCards[i.handCards.length-1]),this.pai_13.visible=-1!=p,-1!=p)if(this.pai_13.setCard(p),this.pai_13.alpha=1,this.pai_13.y=this.cardY,Tween$.removeTweens(this.pai_13),e)this.pai_13.hideTing();else{var u=t.dataProxy.findCheckResult(this.pai_13.cardId);u?this.pai_13.showTing():this.pai_13.hideTing()}}else this.visible=!1},i.prototype.updateDataAsOther=function(){var e=t.dataProxy.roomDetailInfo,i=e?e.state:0,n=t.dataProxy.findPlayerGameInfoByUISeat(this.index);if(t.dataProxy.centerConfig.replayMode&&!t.dataProxy.centerConfig.replayHidePoke)return void(this.visible=!1);if(1==i&&n){this.visible=!0;for(var a=13-n.card.handCards.length,o=0,r=13;r>o;o++){var s=this["pai_"+o];s.visible=o>=a}this.pai_13.visible=-1!=n.card.currentCard}else this.visible=!1},i.prototype.updateTing=function(){for(var e=13;e>=0;e--){var i=this["hand"+e];if(i.stage&&i.visible){var n=t.dataProxy.findCheckResult(i.cardId);n?i.showTing():i.hideTing()}}},i.prototype.hideTing=function(){for(var t=13;t>=0;t--){var e=this["hand"+t];e.hideTing()}},i}(eui.Component);t.ERMJ_Shoupai=e,__reflect(e.prototype,"ERMJ.ERMJ_Shoupai")}(ERMJ||(ERMJ={}));var ERMJ;!function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.setMelds=function(t,e){if(t)for(var i=0,n=4;n>i;i++){var a=this["pai_"+i],o=t[i];void 0!=o?(a.visible=!0,a.setCard(o,e)):a.visible=!1}},e}(eui.Component);t.ERMJ_chi=e,__reflect(e.prototype,"ERMJ.ERMJ_chi")}(ERMJ||(ERMJ={}));var ERMJ;!function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.init=function(){for(var t=0,e=6;e>t;t++)BornProperty.buildFor(this["bg_"+t]),BornProperty.buildFor(this["pai_"+t])},e.prototype.getAllBgs=function(){this.allBgs||(this.allBgs=[]);for(var t=0,e=6;e>t;t++)this.allBgs[t]=this["bg_"+t];return this.allBgs},e.prototype.getAllPais=function(){this.allPais||(this.allPais=[]);for(var t=0,e=6;e>t;t++)this.allPais[t]=this["pai_"+t];return this.allPais},e}(eui.Component);t.ERMJ_da=e,__reflect(e.prototype,"ERMJ.ERMJ_da")}(ERMJ||(ERMJ={}));var ERMJ;!function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.setCard=function(e){this.cardId=e,this.pai.source=t.ERMJStringUtils.getArtCardRes(e)},i.prototype.setDark=function(t){t?(this.dark||(this.dark=new egret.ColorMatrixFilter([1,0,0,0,-80,0,1,0,0,-80,0,0,1,0,-80,0,0,0,1,0])),this.filters=[this.dark]):this.filters=null},i.prototype.showTing=function(){this.tingImg||(this.tingImg=new eui.Image("ERMJ_img_ting_png"),this.tingImg.x=-2,this.tingImg.y=12,this.tingImg.touchEnabled=!1),this.addChild(this.tingImg)},i.prototype.hideTing=function(){remove_XY(this.tingImg)},i}(eui.Component);t.ERMJ_hand=e,__reflect(e.prototype,"ERMJ.ERMJ_hand")}(ERMJ||(ERMJ={}));var ERMJ;!function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.setCard=function(e){this.cardId=e,this.pai.source=t.ERMJStringUtils.getArtCardRes(e)},i}(eui.Component);t.ERMJ_hua=e,__reflect(e.prototype,"ERMJ.ERMJ_hua")}(ERMJ||(ERMJ={}));var ERMJ;!function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.setCard=function(e,i){void 0!=e&&-1!=e?(this.pai.visible=!0,1==i?this.bg.source="ERMJ_j_1_1_png":this.bg.source="ERMJ_j_3_1_png",this.pai.source=t.ERMJStringUtils.getArtCardRes(e)):(this.pai.visible=!1,1==i?this.bg.source="ERMJ_an_gang_1_png":this.bg.source="ERMJ_an_gang_3_png")},i}(eui.Component);t.ERMJ_liang=e,__reflect(e.prototype,"ERMJ.ERMJ_liang")}(ERMJ||(ERMJ={}));var ERMJ;!function(t){var e=function(e){function i(t){return e.call(this,i.NAME,t)||this}return __extends(i,e),i.prototype.onRemove=function(){e.prototype.onRemove.call(this),this.hackPanel&&(this.hackPanel.dispose(),remove_XY(this.hackPanel),this.hackPanel=null)},i.prototype.listNotificationInterests=function(){return[i.SHOW,i.HIDE]},i.prototype.handleNotification=function(e){var n=e.getBody();switch(e.getName()){case i.SHOW:this.hackPanel||(this.hackPanel=new t.ERMJHack),this.hackPanel.stage||tween_XY_alphaShow(this.hackPanel),this.getLayer().addChild(this.hackPanel),this.hackPanel.initData(n);break;case i.HIDE:remove_XY(this.hackPanel)}},i.NAME=GameIdEnum.ERMJ+"ERMJHackMediator",i.SHOW=i.NAME+"SHOW",i.HIDE=i.NAME+"HIDE",i}(t.AbstractMediator);t.ERMJHackMediator=e,__reflect(e.prototype,"ERMJ.ERMJHackMediator")}(ERMJ||(ERMJ={}));var ERMJ;!function(t){var e=function(e){function i(){var t=e.call(this,"ERMJHackSkin")||this;bindTapEvent_XY(t.closeBtn,t.onClose,t,!0);for(var i=0,n=30;n>i;i++){var a=t["c"+i],o=t["tf"+i];o.touchEnabled=!1,a.touchEnabled=!0,bindTapEvent_XY(a,t.onChoose,t,!0)}return t}return __extends(i,e),i.prototype.onClose=function(){remove_XY(this)},i.prototype.onChoose=function(e){var i=e.currentTarget;t.sendSocketMessage(t.ERMJProtocol.MAHJONG_BLACK_SHEEP_WALL_C,i.cardId),t.dataProxy.hackedCard=i.cardId,this.chooseedCard.visible=!0,this.chooseedCard.setCard(i.cardId),this.helpTf.visible=!0},i.prototype.initData=function(e){e=e.sort(function(t,e){return e>t?-1:t>e?1:0}),-1==t.dataProxy.hackedCard?(this.chooseedCard.visible=!1,this.helpTf.visible=!1):(this.chooseedCard.visible=!0,this.helpTf.visible=!0,this.chooseedCard.setCard(t.dataProxy.hackedCard));for(var i=[],n=[],a=0,o=e.length;o>a;a++){var r=e[a],s=i.indexOf(r);-1==s&&(i.push(r),s=i.indexOf(r),n[s]=0),n[s]++}for(var a=0,o=30;o>a;a++){var h=this["c"+a],l=this["tf"+a],d=i[a],c=n[a];void 0!=d?(h.visible=!0,l.visible=!0,h.setCard(d),l.text="剩"+c+"张"):(h.visible=!1,l.visible=!1)}},i}(BaseComponent);t.ERMJHack=e,__reflect(e.prototype,"ERMJ.ERMJHack")}(ERMJ||(ERMJ={}));var ERMJ;!function(t){var e=function(){function t(t){this.gameLayer=new egret.DisplayObjectContainer,this.popupLayer=new egret.DisplayObjectContainer,this.msgLayer=new egret.DisplayObjectContainer,this.loadingLayer=new egret.DisplayObjectContainer,t.addChild(this.gameLayer),t.addChild(this.popupLayer),t.addChild(this.msgLayer),t.addChild(this.loadingLayer)}return t.prototype.dispose=function(){remove_XY(this.gameLayer),remove_XY(this.popupLayer),remove_XY(this.msgLayer),remove_XY(this.loadingLayer),this.gameLayer=null,this.popupLayer=null,this.msgLayer=null,this.loadingLayer=null},t}();t.ERMJLayout=e,__reflect(e.prototype,"ERMJ.ERMJLayout")}(ERMJ||(ERMJ={}));var ERMJ;!function(t){var e=function(e){function i(t){return e.call(this,i.NAME,t)||this}return __extends(i,e),i.prototype.onRemove=function(){e.prototype.onRemove.call(this),this.readme&&(this.readme.dispose(),remove_XY(this.readme),this.readme=null)},i.prototype.listNotificationInterests=function(){return[i.SHOW]},i.prototype.handleNotification=function(e){e.getBody();switch(e.getName()){case i.SHOW:this.readme||(this.readme=new t.ERMJReadMe),this.getLayer().addChild(this.readme),this.readme.init()}},i.NAME=GameIdEnum.ERMJ+"ERMJReadmeMediator",i.SHOW=i.NAME+"SHOW",i}(t.AbstractMediator);t.ERMJReadmeMediator=e,__reflect(e.prototype,"ERMJ.ERMJReadmeMediator")}(ERMJ||(ERMJ={}));var ERMJ;!function(t){var e=function(t){function e(){var e=t.call(this,"ERMJReadMeSkin")||this;return e.initEvents(),e.scl.setSliderBarAlwaysShow(!0),e.scl.scrollPolicyH=eui.ScrollPolicy.OFF,updateScrollerThumb_XY(e.scl),e}return __extends(e,t),e.prototype.initEvents=function(){bindTapEvent_XY(this.bg,this.onClose,this),bindTapEvent_XY(this.btn0,this.onTab,this),bindTapEvent_XY(this.btn1,this.onTab,this)},e.prototype.onTab=function(t){this.isRuleTab=t.currentTarget==this.btn0,this.updateTab()},e.prototype.init=function(){this.scl.stopAnimation(),this.grp.x=Global.stage.stageWidth,Tween$.removeTweens(this.grp),Tween$.get(this.grp).to({x:Global.stage.stageWidth-this.grp.width},300,Ease$.sineOut),this.isRuleTab=!0,this.updateTab()},e.prototype.updateTab=function(){var t=this;this.btn0.alpha=this.isRuleTab?1:0,this.btn1.alpha=this.isRuleTab?0:1,this.txt0.source=this.isRuleTab?"ERMJ_rule_yxgz1_png":"ERMJ_rule_yxgz2_png",this.txt1.source=this.isRuleTab?"ERMJ_rule_fan2_png":"ERMJ_rule_fan1_png",this.ctxGrp.removeChildren(),this.isRuleTab?(this.tab0Img||(this.tab0Img=new eui.Image,this.tab0Img.source="ERMJ_rule_rule1_png"),this.ctxGrp.addChild(this.tab0Img)):(this.tab1Img0||(this.tab1Img0=new eui.Image,this.tab1Img0.source="ERMJ_rule_rule2_1_png",this.tab1Img1=new eui.Image,this.tab1Img1.source="ERMJ_rule_rule2_2_png",egret.setTimeout(function(){t.tab1Img1.y=t.tab1Img0.height,updateScrollerThumb_XY(t.scl)},this,1)),this.ctxGrp.addChild(this.tab1Img0),this.ctxGrp.addChild(this.tab1Img1)),this.scl.stopAnimation(),this.scl.scrolltoTop(),updateScrollerThumb_XY(this.scl)},e.prototype.onClose=function(){var t=this;Tween$.removeTweens(this.grp),Tween$.get(this.grp).to({x:Global.stage.stageWidth},300,Ease$.sineOut).call(function(){remove_XY(t)})},e.prototype.dispose=function(){t.prototype.dispose.call(this),clearTapEvent_XY(this.bg,this.onClose,this),this.removeChildren()},e}(BaseComponent);t.ERMJReadMe=e,__reflect(e.prototype,"ERMJ.ERMJReadMe")}(ERMJ||(ERMJ={}));var ERMJ;!function(t){var e=function(e){function i(t){return e.call(this,i.NAME,t)||this}return __extends(i,e),i.prototype.onRemove=function(){e.prototype.onRemove.call(this),this.replayPanel&&(this.replayPanel.dispose(),remove_XY(this.replayPanel),this.replayPanel=null)},i.prototype.listNotificationInterests=function(){return[i.SHOW,i.HIDE]},i.prototype.handleNotification=function(e){e.getBody();switch(e.getName()){case i.SHOW:this.replayPanel||(this.replayPanel=new t.ERMJReplay),this.getLayer().addChild(this.replayPanel),this.replayPanel.initData();break;case i.HIDE:remove_XY(this.replayPanel)}},i.NAME=GameIdEnum.ERMJ+"ERMJReplayMediator",i.SHOW=i.NAME+"SHOW",i.HIDE=i.NAME+"HIDE",i}(t.AbstractMediator);t.ERMJReplayMediator=e,__reflect(e.prototype,"ERMJ.ERMJReplayMediator")}(ERMJ||(ERMJ={}));var ERMJ;!function(t){var e=function(e){function i(){var i=e.call(this,"ERMJReplaySkin")||this;i18nEUI(GameIdEnum.ERMJ,i,[i.bgmBtn,i.musicBtn,i.prevBtn,i.playBtn,i.nextBtn,i.exitBtn]),bindTapEvent_XY(i.bg,i.onBg,i),bindTapEvent_XY(i.prevBtn,i.onPrev,i,!0),bindTapEvent_XY(i.playBtn,i.onPlay,i,!0),bindTapEvent_XY(i.nextBtn,i.onNext,i,!0),bindTapEvent_XY(i.exitBtn,i.onExit,i,!0),bindTapEvent_XY(i.bgmBtn,i.onBgm,i,!0),bindTapEvent_XY(i.musicBtn,i.onMusic,i,!0);for(var n=0,a=4;a>n;n++){var o=i["spdBtn"+n];o.__speed__=[.5,1,2,3][n],bindTapEvent_XY(o,i.onSpeed,i,!0)}return t.dataProxy.replayVo.addEventListener(t.ERMJReplayVo.E_PROGRESS,i.updateUI,i),i}return __extends(i,e),i.prototype.onPrev=function(){t.dataProxy.replayVo.showPrevFrame(),this.updateUI()},i.prototype.onPlay=function(){t.dataProxy.replayVo.isPlaying?t.dataProxy.replayVo.pause():t.dataProxy.replayVo.resume(),this.updateUI()},i.prototype.onNext=function(){t.dataProxy.replayVo.showNextFrame(),this.updateUI()},i.prototype.onSpeed=function(e){var i=e.currentTarget.__speed__||1;t.dataProxy.replayVo.changePlaySpeed(i),this.updateUI()},i.prototype.updateUI=function(){var e=t.dataProxy.replayVo;this.progressTf.text=t.i18n("进度:")+e.index+"/"+e.max+"("+(e.index/e.max*100).toFixed(1)+"%)",this.playBtn.text=e.isPlaying?t.i18n("暂停"):t.i18n("播放");for(var i=0,n=4;n>i;i++){var a=this["spdBtn"+i];a.__speed__=[.5,1,2,3][i],a.backgroundColor=a.__speed__==e.speed?8026746:0}},i.prototype.onExit=function(){t.confirm(t.i18n("确定退出回放吗?"),function(){t.sendNotification(t.ERMJExitCommand.NAME)})},i.prototype.onBgm=function(){SoundManager.setBgMute(!SoundManager.getBgMute()),this.updateMusicBtnState()},i.prototype.onMusic=function(){SoundManager.setEffectMute(!SoundManager.getEffectMute()),this.updateMusicBtnState()},i.prototype.onBg=function(){Tween$.removeTweens(this.ctrlGrp),this.isUIShowed?Tween$.get(this.ctrlGrp).to({bottom:-this.ctrlGrp.height},300):Tween$.get(this.ctrlGrp).to({bottom:0},300),this.isUIShowed=!this.isUIShowed},i.prototype.initData=function(){this.isUIShowed=!0,Tween$.removeTweens(this.ctrlGrp),this.ctrlGrp.bottom=0,this.updateUI(),this.updateMusicBtnState()},i.prototype.updateMusicBtnState=function(){this.musicBtn.backgroundColor=SoundManager.getEffectMute()?0:8026746,this.bgmBtn.backgroundColor=SoundManager.getBgMute()?0:8026746},i.prototype.dispose=function(){e.prototype.dispose.call(this),Tween$.removeTweens(this.ctrlGrp),clearTapEvent_XY(this.bg,this.onBg,this),clearTapEvent_XY(this.prevBtn,this.onPrev,this),clearTapEvent_XY(this.playBtn,this.onPlay,this),clearTapEvent_XY(this.nextBtn,this.onNext,this),clearTapEvent_XY(this.exitBtn,this.onExit,this),clearTapEvent_XY(this.bgmBtn,this.onBgm,this),clearTapEvent_XY(this.musicBtn,this.onMusic,this);for(var i=0,n=4;n>i;i++){var a=this["spdBtn"+i];a.__speed__=[.5,1,2,3][i],clearTapEvent_XY(a,this.onSpeed,this)}t.dataProxy.replayVo.removeEventListener(t.ERMJReplayVo.E_PROGRESS,this.updateUI,this)},i}(BaseComponent);t.ERMJReplay=e,__reflect(e.prototype,"ERMJ.ERMJReplay")}(ERMJ||(ERMJ={}));var ERMJ;!function(t){var e=function(e){function i(t){return e.call(this,i.NAME,t)||this
}return __extends(i,e),i.prototype.onRemove=function(){e.prototype.onRemove.call(this),this.result&&(this.result.dispose(),remove_XY(this.result),this.result=null)},i.prototype.listNotificationInterests=function(){return[i.SHOW,i.HIDE]},i.prototype.isShowing=function(){return null!=this.result&&null!=this.result.stage},i.prototype.handleNotification=function(e){e.getBody();switch(e.getName()){case i.SHOW:if(!t.dataProxy.roomDetailInfo||9!=t.dataProxy.roomDetailInfo.state||!t.dataProxy.roomDetailInfo.settlingDTO)return;this.result||(this.result=new t.ERMJResult),this.getLayer().addChild(this.result),this.result.init();break;case i.HIDE:remove_XY(this.result)}},i.NAME=GameIdEnum.ERMJ+"ERMJResultMediator",i.SHOW=i.NAME+"SHOW",i.HIDE=i.NAME+"HIDE",i}(t.AbstractMediator);t.ERMJResultMediator=e,__reflect(e.prototype,"ERMJ.ERMJResultMediator")}(ERMJ||(ERMJ={}));var ERMJ;!function(t){var e=function(e){function i(){var i=e.call(this,"ERMJResultSkin")||this;return i.initEvents(),t.dataProxy.centerConfig.replayMode&&(remove_XY(i.exitBtn),remove_XY(i.nextBtn)),i}return __extends(i,e),i.prototype.initEvents=function(){bindTapEvent_XY(this.exitBtn,this.onExit,this,!0),bindTapEvent_XY(this.nextBtn,this.onNext,this,!0)},i.prototype.onExit=function(){t.dataProxy.gameExited?t.sendNotification(t.ERMJExitCommand.NAME):t.sendSocketMessage(t.ERMJProtocol.TABLE_TRY_TO_LEAVE_C)},i.prototype.onNext=function(){return remove_XY(this),t.dataProxy.roomDetailInfo&&!t.dataProxy.roomDetailInfo.friends&&1==t.dataProxy.roomDetailInfo.antiCheatConf?(SimpleLoading.show(t.i18n("匹配中...")),void egret.setTimeout(function(){DevelopMain.dataInited=!1,t.sendNotification(t.ERMJSocketMediator.SWITCH_ROOM)},this,randomInt_XY(1e3,3e3))):(t.sendNotification(t.ERMJGameSceneMediator.UPDATE_ROOM_DETAIL_INFO),void t.sendSocketMessage(t.ERMJProtocol.CONTINUE_C))},i.prototype.init=function(){this.chipenggang1.setIndex(1),this.shoupai1.setIndex(1),this.showEffect1();var e=t.dataProxy.roomDetailInfo,i=e&&e.settlingDTO;if(!e||!i)return void remove_XY(this);var n=t.dataProxy.findWinnerInSetting(),a=t.dataProxy.findSelfInSetting();if(this.tryBuildDb(),i.drawRound)this.fanTf0.text="",this.fanTf1.text="",this.fanTf2.text="",this.chipenggang1.updateData(!1),this.shoupai1.updateDataAsSelf(!0),this.allFanTf.visible=!1,this.totalTf.visible=!1,t.ERMJSoundPlayer.lose_liuju();else{a.isWin?t.ERMJSoundPlayer.win():t.ERMJSoundPlayer.lose_liuju(),this.allFanTf.visible=!0,this.totalTf.visible=!0,this.allFanTf.text=Math.abs(n.factor)+"",this.totalTf.text=(a.stageCoinOffset>0?"+":"")+coin2Str_XY(a.stageCoinOffset);for(var o=["","",""],r=n.details||[],s=0,h=r.length;h>s;s++){var l=r[s],d=mahjong.ERMJ_WinType.toString(l[0]),c=d+"    "+l[1]+t.i18n("番");o[s%3]+=c+"\n"}this.fanTf0.text=o[0],this.fanTf1.text=o[1],this.fanTf2.text=o[2],this.chipenggang1.updateData(!0),this.shoupai1.updateDataAsSelf(!0)}this.setTime(i.timeout)},i.prototype.setTime=function(t){(0>=t||void 0==t)&&(t=0),this.leftTime=t,this.timeTf.text=this.leftTime+"",egret.clearInterval(this.timer),this.leftTime>0&&(this.timer=egret.setInterval(this.onTimer,this,1e3))},i.prototype.onTimer=function(){this.leftTime--,this.leftTime<=0&&(this.leftTime=0,egret.clearInterval(this.timer)),this.timeTf.text=this.leftTime+""},i.prototype.onRemoved=function(){this.winDb&&(remove_XY(this.winDb.display),dragonBones.WorldClock.clock.add(this.winDb)),this.loseDb&&(remove_XY(this.loseDb.display),dragonBones.WorldClock.clock.add(this.loseDb)),this.liujuDb&&(remove_XY(this.liujuDb.display),dragonBones.WorldClock.clock.add(this.liujuDb))},i.prototype.tryBuildDb=function(){var e=t.dataProxy.roomDetailInfo,i=e&&e.settlingDTO;this.winDb&&remove_XY(this.winDb.display),this.loseDb&&remove_XY(this.loseDb.display),this.liujuDb&&remove_XY(this.liujuDb.display);var n="",a="",o="";if(i.drawRound)n="liujuDb",a="ERMJ_liuju",o="biaoqian_chuxian",this.ctxBg.source="ERMJ_result_liu_bg_png";else{var r=t.dataProxy.findSelfInSetting();r.isWin?(n="winDb",a="ERMJ_shengli",o="biaoqian_shengli_kaishi",this.ctxBg.source="ERMJ_result_win_bg_png"):(n="loseDb",a="ERNJ_shibai",o="biaoqian_chuxian",this.ctxBg.source="ERMJ_result_lose_bg_png")}var s=this[n];s||(s=Global.buildArmature(GameIdEnum.ERMJ,a),this[n]=s),this.uiGrp.addChild(s.display),s.display.x=586,s.display.y=170,dragonBones.WorldClock.clock.add(s),s.animation.play(o,1)},i}(BaseComponent);t.ERMJResult=e,__reflect(e.prototype,"ERMJ.ERMJResult")}(ERMJ||(ERMJ={}));