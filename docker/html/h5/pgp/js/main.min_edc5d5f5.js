function runAI(t){void 0===t&&(t=3),PGP.dataProxy.AIMode=!0,PGP.dataProxy.AIDelaySecond=t}var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o]);i.prototype=e.prototype,t.prototype=new i},__awaiter=this&&this.__awaiter||function(t,e,i,o){return new(i||(i=Promise))(function(n,a){function r(t){try{h(o.next(t))}catch(e){a(e)}}function s(t){try{h(o["throw"](t))}catch(e){a(e)}}function h(t){t.done?n(t.value):new i(function(e){e(t.value)}).then(r,s)}h((o=o.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function i(t){return function(e){return o([t,e])}}function o(i){if(n)throw new TypeError("Generator is already executing.");for(;h;)try{if(n=1,a&&(r=a[2&i[0]?"return":i[0]?"throw":"next"])&&!(r=r.call(a,i[1])).done)return r;switch(a=0,r&&(i=[0,r.value]),i[0]){case 0:case 1:r=i;break;case 4:return h.label++,{value:i[1],done:!1};case 5:h.label++,a=i[1],i=[0];continue;case 7:i=h.ops.pop(),h.trys.pop();continue;default:if(r=h.trys,!(r=r.length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){h=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){h.label=i[1];break}if(6===i[0]&&h.label<r[1]){h.label=r[1],r=i;break}if(r&&h.label<r[2]){h.label=r[2],h.ops.push(i);break}r[2]&&h.ops.pop(),h.trys.pop();continue}i=e.call(t,h)}catch(o){i=[6,o],a=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var n,a,r,s,h={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return s={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},PGP;!function(t){var e=function(t){function e(e,i){return t.call(this,e,i)||this}return __extends(e,t),e.prototype.getLayer=function(){return this.viewComponent},e}(puremvc.Mediator);t.AbstractMediator=e,__reflect(e.prototype,"PGP.AbstractMediator")}(PGP||(PGP={}));var PGP;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.touchChildren=!1,t}return __extends(i,e),i.prototype.init=function(){this.grp.visible=!1,this.icon.visible=!0,egret.Tween.removeTweens(this.icon),this.clearDark()},i.prototype.clearDark=function(){this.filters=null},i.prototype.setDark=function(t){t?(this.dark||(this.dark=new egret.ColorMatrixFilter([1,0,0,0,100,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0])),this.filters=[this.dark]):this.filters=null},i.prototype.checkGetHorse=function(e){t.dataProxy.isGetHorse(e)?this.setDark(!0):this.setDark(!1)},i.prototype.setCard=function(e,i){var o=this;void 0===i&&(i=!1),this.cardId=e,this.setDark(!1),i?(this.grp.visible=!1,this.icon.visible=!0,this.icon.scaleX=1,this.grp.scaleX=0,egret.Tween.get(this.icon).to({scaleX:0},500).call(function(){o.icon.visible=!1,o.grp.visible=!0,o.pai.source=t.PGPStringUtils.getArtCardRes(e),egret.Tween.removeTweens(o.icon),o.grp.scaleX=0,egret.Tween.get(o.grp).to({scaleX:1},500).call(function(){o.icon.scaleX=1,o.checkGetHorse(e),egret.Tween.removeTweens(o.grp)},o)},this)):(this.icon.visible=!1,this.grp.visible=!0,this.pai.source=t.PGPStringUtils.getArtCardRes(e),this.checkGetHorse(e))},i}(eui.Component);t.PGP_HandHorseCard=e,__reflect(e.prototype,"PGP.PGP_HandHorseCard")}(PGP||(PGP={}));var PGP;!function(t){function e(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=t.concat();i.splice(0,0,"<"+GameIdEnum.PGP+"> "+egret.getTimer()+" "),console.log.apply(console,i)}function i(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=t.concat();i.splice(0,0,"<"+GameIdEnum.PGP+"> "+egret.getTimer()+" "),console.warn.apply(console,i)}function o(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];if(null==t)return t;var o=I18N.getInstance(GameIdEnum.PGP);return o.toString.apply(o,arguments)}var n=function(i){function o(){var t=i.call(this)||this;return Global.eventCenter.addEventListener(EventEnum.SOME_ONE_PLAY_VOICE_P_to_G,t.someOnePlayVoice,t),Global.eventCenter.addEventListener(EventEnum.ACCOUNT_BEEN_KICKED,t.beenKicked,t),Global.eventCenter.addEventListener(EventEnum.SERVER_ERROR_MESSAGE,t.onServerErrorMsg,t),Global.eventCenter.addEventListener(EventEnum.SWITCH_TABLE_P_to_G,t.onSwitchTableOk,t),t}return __extends(o,i),o.prototype.someOnePlayVoice=function(t){},o.prototype.beenKicked=function(e){Global.isAccountBeenReplaced=!0;var i=e.data;t.alert(i[1],function(){Global.platform.exitApp()})},o.prototype.onSwitchTableOk=function(i){t.dataProxy.centerConfig.area=i.data[0],t.PGPLoading.getInstance().hide(),SimpleLoading.hide(),e("换桌成功！"),t.sendSocketMessage(t.PGPProtocol.PGP_GET_SNAPSHOT_C)},o.prototype.onServerErrorMsg=function(t){SimpleLoading.hide(),Toast.show(t.data[0])},o.prototype.setup=function(i){var o=this;e("setup"),RES.loadGroup("PGP.all",0),waitGroupAndExecute("PGP.all",function(){Global.onEvent(EventEnum.CLOSE_GAME_INIT_LOADING_G_to_P),bridge_iframe.sendMsgToHall(EventEnum.CLOSE_GAME_INIT_LOADING_G_to_P);var t=RES.getRes("i18n_json");I18N.getInstance(GameIdEnum.PGP).init(t,i.i18nType),o.start(i),egret.setTimeout(function(){RES.loadGroup("PGP.sound",0)},o,1)},this),waitGroupAndExecute("PGP.sound",function(){if(!o.destroied){egret.getDefinitionByName("Main");o.destroied||t.PGPSoundPlayer.bgm()}},this)},o.prototype.start=function(e){mahjong.Card.init(),__tapSound=GameIdEnum.PGP+"_ui_click_mp3";var i=new mahjong.TableSource;i.buildFromZipFile(RES.getRes("PGP_tbl"));var o=new mahjong.Card(mahjong.Type.ZI,20);mahjong.MahjongTool.init([o],i,!0),mahjong.MahjongTool.allow_7dui=!1;var n=new t.PGPFacade;t.dataProxy=new t.PGPDataProxy,t.dataProxy.centerConfig=e,t.dataProxy.myUid=e.loginDto?e.loginDto.id:-1,n.setup(this),this.facade=n,ResizeCall.addCall(this.onResize,this),this.onResize()},o.prototype.onResize=function(){var t=1120/1920,e=Global.stage.stageHeight/Global.stage.stageWidth;t>e?Global.stage.scaleMode=egret.StageScaleMode.FIXED_HEIGHT:Global.stage.scaleMode=egret.StageScaleMode.FIXED_WIDTH},o.prototype.destroy=function(){Global.eventCenter.removeEventListener(EventEnum.SOME_ONE_PLAY_VOICE_P_to_G,this.someOnePlayVoice,this),Global.eventCenter.removeEventListener(EventEnum.ACCOUNT_BEEN_KICKED,this.beenKicked,this),Global.eventCenter.removeEventListener(EventEnum.SERVER_ERROR_MESSAGE,this.onServerErrorMsg,this),this.destroied=!0,ResizeCall.del(this.onResize,this),RES.destroyRes("PGP.all"),Global.stage.scaleMode=egret.StageScaleMode.FIXED_WIDTH,mahjong.MahjongTool.dispose(),this.facade&&(t.sendNotification(t.PGPDisposeMVCCommand.NAME),this.facade.dispose(),t.PGPFacade.removeCore(GameIdEnum.PGP),this.facade=null),t.PGPSoundPlayer.dispose(),t.XYAlert.dispose()},o}(egret.DisplayObjectContainer);t.GameLauncher=n,__reflect(n.prototype,"PGP.GameLauncher",["IGameLauncher"]),t.trace=e,t.warn=i,t.i18n=o}(PGP||(PGP={}));var PGP;!function(t){function e(t,e,i){puremvc.Facade.getInstance(GameIdEnum.PGP).sendNotification(t,e,i)}function i(t){return t==I18NType.zh_tw?!0:t==I18NType.en_us?!0:!1}var o=function(i){function o(){return i.call(this,GameIdEnum.PGP)||this}return __extends(o,i),o.prototype.initializeController=function(){i.prototype.initializeController.call(this),this.registerCommand(t.PGPRegisteMVCCommand.NAME,t.PGPRegisteMVCCommand)},o.prototype.setup=function(i){this.layout||(this.layout=new t.PGPLayout(i)),e(t.PGPRegisteMVCCommand.NAME,[this.layout]),e(t.PGPGameSceneMediator.SHOW),t.dataProxy.centerConfig.replayMode?(t.dataProxy.initReplay(),t.dataProxy.replayVo.startAutoPlay(),e(t.PGPReplayMediator.SHOW)):DevelopMain.callWhenFastJoinCompleted(function(){t.sendSocketMessage(t.PGPProtocol.PGP_GET_SNAPSHOT_C)}),EnterFrameCall.add(function(){dragonBones.WorldClock.clock.advanceTime(-1)},this)},o.prototype.dispose=function(){this.layout&&this.layout.dispose(),this.layout=null},o}(puremvc.Facade);t.PGPFacade=o,__reflect(o.prototype,"PGP.PGPFacade"),t.sendNotification=e,t.isLanuageSupport=i}(PGP||(PGP={}));var Main=function(t){function e(){var i=t.call(this)||this;try{e.isInModule=!(window&&window.parent!=window&&window.parent.Global)}catch(o){}var n=egret.getOption("ip")||window.serverip||"172.16.236.21";return i.gameId="PGP",i.config.httpURI="http://"+n+":81",i.config.host=n,i.config.port=81,i.config.param1=2013110,i.config.param2=5,i.config.antiCheat=1,i.config.i18nType=I18NType.zh_cn,i.config.num=8,i.config.type=54,i.sendSnapshotWhenResume=!0,i.config.moduleType=ModuleType.MODULE_MAHJONG,SignalStatus.getInstace().setup(0/0,150,10,0/0),Global.useProfile=!0,i}return __extends(e,t),e.prototype.onExit=function(){t.prototype.onExit.call(this)},e.isInModule=!0,e}(DevelopMain);__reflect(Main.prototype,"Main");var PGP;!function(t){var e=function(e){function i(){var t=e.call(this,i.NAME)||this;t.hackedCard=-1,t.AIMode=!1,t.AIDelaySecond=3,t.lockTweener=!1,t.TOTAL_POSITION_NUM=4,t.fullCards=[];for(var o=0,n=34;n>o;o++){var a=mahjong.Card.createFromCardID(o);t.fullCards.push(a)}return t}return __extends(i,e),i.prototype.isBothInLastGamePlayers=function(t,e){return this.lastGamePlayerIds?-1!=this.lastGamePlayerIds.indexOf(t)&&-1!=this.lastGamePlayerIds.indexOf(e):!1},i.prototype.initReplay=function(){this.centerConfig.replayMode&&(this.replayVo?this.replayVo.stopAndClear():this.replayVo=new t.PGPReplayVo,this.replayVo.init(this.centerConfig.replayData))},i.prototype.findCheckResult=function(t){if(!this.currentCheckResults)return null;for(var e=0,i=this.currentCheckResults.length;i>e;e++){var o=this.currentCheckResults[e];if(o&&o.discard&&o.discard.cardID==t)return o}return null},i.prototype.getTingCount=function(){if(!this.currentCheckResults)return 0;for(var t=0,e=0,i=this.currentCheckResults.length;i>e;e++){var o=this.currentCheckResults[e];o&&o.discard&&t++}return t},i.prototype.calCheckResult=function(){var e=this.roomDetailInfo;if(2==e.state&&e.turnPlayers&&-1!=e.turnPlayers.indexOf(this.myUid)){var i,o,n=this.findPlayerGameInfoByUid(this.myUid),a=n.card.currentCard,r=n.card.handCards;-1!=n.card.currentCard?(i=mahjong.Card.createFronCardIds(r),o=mahjong.Card.createFromCardID(a)):(i=mahjong.Card.createFronCardIds(r),o=i.shift()),t.trace("计算我可以听、胡什么牌");var s=mahjong.MahjongTool.findWinCardsWhenDraw(i,o,t.dataProxy.fullCards,null,null,!1);mahjong.Meld.fromServerMelds(n.card.meldCards),n.card.flowerCards.length,n.position;if(s)for(var h=0,l=s.length;l>h;h++){var d=s[h];if(d){d.winFactors=d.winFactors||[];for(var c=0,P=d.winCards.length;P>c;c++){d.winCards[c];d.winFactors[c]=1}}}this.currentCheckResults=s}else this.currentCheckResults=null},i.prototype.getStartIndexByDeal=function(t,e){var i=0,o=e%4;switch(o){case 0:i=t-1;break;case 1:i=t;break;case 2:i=t+1;break;case 3:i=t+2}return i>3&&(i-=4),0>i&&(i=3),i},i.prototype.verifyHandCardNum=function(){if(this.roomDetailInfo)for(var e=0,i=this.roomDetailInfo.info.length;i>e;e++){var o=this.roomDetailInfo.info[e];if(o.card&&o.card.handCards){var n=o.card.handCards.length;if(o.card.meldCards&&(n+=3*o.card.meldCards.length),n>13)if(t.warn(o.uid+"玩家手牌数量为:"+o.card.handCards.length),o.uid==this.myUid||t.dataProxy.centerConfig.replayMode){if(-1!=o.card.currentCard){var a=o.card.handCards.indexOf(o.card.currentCard);o.card.handCards.splice(a,1)}}else o.card.handCards.pop()}}},i.prototype.updatePlayerCoins=function(e){if(e){for(var i=0;i<e.length;i++){var o=e[i][0],n=t.dataProxy.findPlayerGameInfoByUid(o);n&&(n.coin=e[i][1])}t.sendNotification(t.PGPGameSceneMediator.UPDATE_ROOM_DETAIL_INFO)}},i.prototype.updateRoomDetailInfo=function(e){this.roomDetailInfo=e,this.gameExited=!1;var i=this.roomDetailInfo.info;if(i)for(var o=0;o<i.length;o++)t.PlayerDTO.maskNick(i[o]);4!=e.state&&t.sendNotification(t.PGPResultMediator.HIDE),this.verifyHandCardNum(),this.lastGamePlayerIds=[];var n=this.findPlayerGameInfoByUid(this.myUid);if(2==e.state&&(this.calCheckResult(),this.refreshHuData(),t.sendNotification(t.PGPGameSceneMediator.REFRESH_MY_TING)),n)this.selfIndex=n.position;else for(var o=1,a=4;a>=o;o++){var r=this.findPlayerGameInfoBySeat(o);r||(this.selfIndex=o)}for(var o=0,a=3;a>=o;o++){var r=this.findPlayerGameInfoBySeat(o);r&&(r.dealer&&(this.dealerIndex=o),this.lastGamePlayerIds.push(r.uid))}if(t.trace("mySeat:"+this.selfIndex),this.updateRecordCard(),this.centerConfig.replayMode){var s=e.replayAction;if(!s){var s=new t.MahjongGameActionDTO;s.action=e.lastValidAction,s.card=e.currentDiscard,s.currentDiscard=e.currentDiscard,s.lastDiscardUid=e.lastDiscardUid,s.lastOpUid=e.lastOpUid,s.remaining=e.remaining,s.turnPlayers=e.turnPlayers,s.uid=e.lastOpUid}s.action!=t.Action.hu&&2==e.state&&t.PGPSoundPlayer.action(s),t.sendNotification(t.PGPGameSceneMediator.DO_ACTION,[s.uid,s.action,s.currentDiscard])}},i.prototype.changeToPrepare=function(e){this.roomDetailInfo.state=0,this.roomDetailInfo.actionable=null,this.roomDetailInfo.ascDraw=0,this.roomDetailInfo.currentDiscard=-1,this.roomDetailInfo.descDraw=0,this.roomDetailInfo.dices=[0,0],this.roomDetailInfo.lastDiscardUid=-1,this.roomDetailInfo.lastOpUid=-1,this.roomDetailInfo.lastValidAction=-1,this.roomDetailInfo.remaining=136,this.roomDetailInfo.tableId="",this.roomDetailInfo.turnPlayers=null,this.roomDetailInfo.timeout=e,t.dataProxy.roomDetailInfo.horse=null,this.dealerIndex=-1,t.dataProxy.lockTweener=!1,mahjong.MahjongTool.disableType=-1;for(var i=0,o=this.roomDetailInfo.info.length;o>i;i++){var n=this.roomDetailInfo.info[i];n.dealer=!1,-1==this.roomDetailInfo.autoReady||(n.ready=-1),n.trusteeship=!1,n.huCards=[],n.isHu=!1,n.isSelfDrawn=!1,n.card.handCards=[]}t.sendNotification(t.PGPGameSceneMediator.CHANGE_TO_PREPARE),t.sendNotification(t.PGPResultMediator.HIDE)},i.prototype.updateTableId=function(e){this.roomDetailInfo&&(this.roomDetailInfo.tableId=e,t.sendNotification(t.PGPGameSceneMediator.UPDATE_TABLE_ID))},i.prototype.showZiMoAni=function(e){if(e&&e.length>0){var i,o=e[1];if(1==o){i=e[0];var n=e[3],a=this.findPlayerGameInfoByUid(i);a.isHu=!0,a.huCards.length=0,a.huCards.push(n),t.sendNotification(t.PGPGameSceneMediator.GAME_SHOW_ZIMO,a)}else{var r=[];i=e[0];var s=e[2],h=e[3],l=this.findPlayerGameInfoByUid(i);l.isHu=!0,t.trace(l.name+"  胡牌的人"),l.huCards.length=0,l.huCards.push(h);var d=this.findPlayerGameInfoByUid(s);t.trace(d.name+"  放炮的人");var c=d.position;r.push(c),r.push(h),t.sendNotification(t.PGPGameSceneMediator.GAME_SHOW_DIAN_PAO,r),t.sendNotification(t.PGPGameSceneMediator.GAME_SHOW_DIAN_PAO_HU,l)}}},i.prototype.updateTurn=function(e){var i=this;if(this.roomDetailInfo.state=2,egret.clearTimeout(this.AITimer),e.uid==Global.uid&&(this.roomDetailInfo.actionable=e.actionable,-1!=e.card&&(this.hackedCard=-1),this.AIMode&&(this.AITimer=egret.setTimeout(function(){if(e.actionable)if(-1!=e.actionable.indexOf(99))t.sendSocketMessage(t.PGPProtocol.MAHJONG_HU_C);else if(-1!=e.actionable.indexOf(1)){var o,n=i.findPlayerGameInfoByUid(Global.uid),a=mahjong.Card.createFronCardIds(n.card.handCards),r=mahjong.Card.createFromCardID(n.card.currentCard);try{o=mahjong.ai.MSelector.getSuggest(a,r,t.dataProxy.fullCards),t.trace("AI打牌",o.cardID)}catch(s){o=r,error("AI报错! 手牌:"+a.join()+"  摸牌:"+r.toString())}t.sendSocketMessage(t.PGPProtocol.MAHJONG_DA_C,o.cardID)}else t.sendSocketMessage(t.PGPProtocol.MAHJONG_PASS_C)},this,Math.max(100,1e3*this.AIDelaySecond)))),-1!=e.card){var o=this.findPlayerGameInfoByUid(e.turnPlayers[0]);o&&(o.card.currentCard=e.card)}this.roomDetailInfo.turnPlayers=e.turnPlayers,this.roomDetailInfo.lastOpUid=e.lastOpUid,this.roomDetailInfo.remaining=e.remaining,this.roomDetailInfo.ascDraw=e.ascDraw,this.roomDetailInfo.descDraw=e.descDraw,this.roomDetailInfo.timeout=e.timeout,this.calCheckResult(),t.sendNotification(t.PGPGameSceneMediator.UPDATE_TURN)},i.prototype.refreshHuData=function(){var e=t.dataProxy.findPlayerGameInfoByUid(t.dataProxy.myUid);if(e&&e.card){var i=mahjong.Card.createFronCardIds(e.card.handCards);if(i){var o=mahjong.MahjongTool.findWinCards(i,t.dataProxy.fullCards);if(null==o)return void(t.dataProxy.tempHuData=null);t.dataProxy.tempHuData={},t.dataProxy.tempHuData.winCards=o.cards,t.dataProxy.tempHuData.winCount=o.count,t.dataProxy.tempHuData.winFactors=[];for(var n=0,a=0;a<t.dataProxy.tempHuData.winCards.length;a++){t.dataProxy.tempHuData.winCards[a],mahjong.Meld.fromServerMelds(e.card.meldCards);t.dataProxy.tempHuData.winFactors.push(n)}}}},i.prototype.updateAction=function(e){var i=e.uid==Global.uid,o=this.findPlayerGameInfoByUid(e.uid);if(i&&egret.clearTimeout(this.AITimer),this.roomDetailInfo.remaining=e.remaining,o.card=e.userMahjong,this.roomDetailInfo.turnPlayers=e.turnPlayers,this.roomDetailInfo.lastOpUid=e.lastOpUid,this.roomDetailInfo.currentDiscard=e.currentDiscard,this.roomDetailInfo.lastDiscardUid=e.lastDiscardUid,this.roomDetailInfo.lastValidAction=e.action,e.action==t.Action.chi||e.action==t.Action.peng||e.action==t.Action.ming_gang){var n=this.findPlayerGameInfoByUid(e.lastDiscardUid),a=n.card.discards.indexOf(e.currentDiscard);n.card.discards.splice(a,1)}e.action!=t.Action.hu&&t.PGPSoundPlayer.action(e),e.action==t.Action.da_pai&&e.uid==Global.uid&&(this.refreshHuData(),t.sendNotification(t.PGPGameSceneMediator.REFRESH_MY_TING)),this.verifyHandCardNum(),this.updateRecordCard(),t.sendNotification(t.PGPGameSceneMediator.DO_ACTION,[e.uid,e.action,e.currentDiscard])},i.prototype.updateTuoguan=function(e){var i=this.findPlayerGameInfoByUid(Global.uid);i.trusteeship=e,t.sendNotification(t.PGPGameSceneMediator.UPDATE_TUOGUAN)},i.prototype.updatePlayerActionEffect=function(e){t.sendNotification(t.PGPGameSceneMediator.GAME_FLOAT_SCORE,e)},i.prototype.updateHorseDTO=function(e){this.roomDetailInfo&&(this.roomDetailInfo.state=3,this.roomDetailInfo.horse=e),t.sendNotification(t.PGPGameSceneMediator.GAME_SHOW_HORSE)},i.prototype.isGetHorse=function(e){if(!t.dataProxy.roomDetailInfo)return!1;if(!t.dataProxy.roomDetailInfo.horse)return!1;var i=t.dataProxy.roomDetailInfo.horse.horseCard,o=t.dataProxy.roomDetailInfo.horse.getHorseCard;return!i||i.length<=0?!1:!o||o.length<=0?!1:-1!=i.indexOf(e)&&-1!=o.indexOf(e)},i.prototype.gameComplete=function(e){this.roomDetailInfo&&(this.roomDetailInfo.state=4,this.roomDetailInfo.settlingDTO=e,this.roomDetailInfo.timeout=e.timeout,this.roomDetailInfo.winner=e.winner);for(var i=0,o=e.info.length;o>i;i++){var n=e.info[i];t.SettlingInfoDTO.maskNick(n);var a=this.findPlayerGameInfoByUid(n.uid);a.coin=n.coin,a.card=n.card,a.trusteeship=!1}t.sendNotification(t.PGPGameSceneMediator.SHOW_HU)},i.prototype.findSettingById=function(e){if(t.dataProxy.roomDetailInfo.settlingDTO)for(var i=0,o=t.dataProxy.roomDetailInfo.settlingDTO.info.length;o>i;i++){var n=t.dataProxy.roomDetailInfo.settlingDTO.info[i];if(n.uid==e)return n}return null},i.prototype.getSettleZiMo=function(){var e=t.dataProxy.roomDetailInfo.settlingDTO;if(!e)return!1;for(var i=0,o=t.dataProxy.roomDetailInfo.settlingDTO.info.length;o>i;i++){var n=t.dataProxy.roomDetailInfo.settlingDTO.info[i];if(n.isSelfDrawn)return!0}return!1},i.prototype.findHorseInSetting=function(){if(t.dataProxy.roomDetailInfo.settlingDTO)for(var e=t.dataProxy.roomDetailInfo.horse,i=0,o=t.dataProxy.roomDetailInfo.settlingDTO.info.length;o>i;i++){var n=t.dataProxy.roomDetailInfo.settlingDTO.info[i];if(e&&n.uid==e.uid)return n}return null},i.prototype.someOneJoin=function(e){if(e.uid!=Global.uid){t.PlayerDTO.maskNick(e),t.dataProxy.roomDetailInfo.info.push(e);var i=t.PGPPositionUtils.getUIPosByServerPos(e.position);t.sendNotification(t.PGPGameSceneMediator.SOME_ONE_JOIN,i),t.PGPSoundPlayer.playComeIn()}},i.prototype.updatePlayerReadyStatus=function(e){var i=t.dataProxy.findPlayerGameInfoByUid(e);i.ready=1,t.sendNotification(t.PGPGameSceneMediator.GAME_UPDATE_READY),t.PGPSoundPlayer.playReady()},i.prototype.someOneLeave=function(e){var i=t.dataProxy.findPlayerGameInfoByUid(e);if(i&&-1!=i.uid){var o=t.dataProxy.roomDetailInfo.info.indexOf(i),n=t.PGPPositionUtils.getUIPosByServerPos(i.position);t.dataProxy.roomDetailInfo.info.splice(o,1),n>=0&&t.sendNotification(t.PGPGameSceneMediator.SOME_ONE_LEAVE,n)}},i.prototype.updateRecordCard=function(){if(this.roomDetailInfo&&this.roomDetailInfo.info){for(var e=[],i=0,o=this.roomDetailInfo.info.length;o>i;i++){var n=this.roomDetailInfo.info[i];if(n&&n.card&&(n.card.discards&&(e=e.concat(n.card.discards)),n.isHu&&n.huCards&&n.huCards.length>0&&e.push(n.huCards[0]),n.card.meldCards))for(var a=0,r=n.card.meldCards.length;r>a;a++){var s=n.card.meldCards[a];s&&-1!=s[0]?e=e.concat(s):n.uid==Global.uid&&s&&-1==s[0]&&-1!=s[3]&&(e.push(s[3]),e.push(s[3]),e.push(s[3]),e.push(s[3]))}}t.trace("更新记牌器("+e.length+"张): "+e.join(",")),mahjong.MahjongTool.updateDiscard(e)}},i.prototype.findPlayerGameInfoBySeat=function(t){if(!this.roomDetailInfo||!this.roomDetailInfo.info)return null;for(var e=0,i=this.roomDetailInfo.info.length;i>e;e++){var o=this.roomDetailInfo.info[e];if(o.position==t)return o}return null},i.prototype.findPlayerGameInfoByUISeat=function(e){if(!this.roomDetailInfo||!this.roomDetailInfo.info)return null;for(var i=0,o=this.roomDetailInfo.info.length;o>i;i++){var n=this.roomDetailInfo.info[i];if(t.PGPPositionUtils.getUIPosByServerPos(n.position)==e)return n}return null},i.prototype.findPlayeSettleInfoByServerPos=function(t){if(!this.roomDetailInfo||!this.roomDetailInfo.info||!this.roomDetailInfo.settlingDTO)return null;for(var e=0,i=this.roomDetailInfo.settlingDTO.info.length;i>e;e++){var o=this.roomDetailInfo.settlingDTO.info[e];if(o.position==t)return o}return null},i.prototype.getDealerPlayer=function(){if(!this.roomDetailInfo||!this.roomDetailInfo.info)return null;for(var t=0,e=this.roomDetailInfo.info.length;e>t;t++){var i=this.roomDetailInfo.info[t];if(i.dealer)return i}return null},i.prototype.getPositionByDealer=function(t,e){var i=0,o=1,n=2,a=3;if(e==i){if(t==i)return i;if(t==o)return o;if(t==n)return n;if(t==a)return a}if(e==o){if(t==i)return a;if(t==o)return i;if(t==n)return o;if(t==a)return n}if(e==n){if(t==i)return n;if(t==o)return a;if(t==n)return i;if(t==a)return o}if(e==a){if(t==i)return o;if(t==o)return n;if(t==n)return a;if(t==a)return i}return-1},i.prototype.checkHuPlayer=function(){if(!this.roomDetailInfo||!this.roomDetailInfo.info)return null;for(var t=0,e=this.roomDetailInfo.info.length;e>t;t++){var i=this.roomDetailInfo.info[t];if(i.isHu)return i}return null},i.prototype.getUIPosByServerPos=function(e){var i=t.dataProxy.findPlayerGameInfoByUid(t.dataProxy.myUid);if(null==i)return-1;var o=-1,n=i.position,a=1,r=this.TOTAL_POSITION_NUM,s=e-n;return o=a+s,o>=r&&(o-=r),0>o&&(o+=r),o},i.prototype.findPlayerGameInfoByUid=function(t){if(!this.roomDetailInfo||!this.roomDetailInfo.info)return null;for(var e=0,i=this.roomDetailInfo.info.length;i>e;e++){var o=this.roomDetailInfo.info[e];if(o.uid==t)return o}return null},i.prototype.dispose=function(){this.centerConfig=null,this.roomDetailInfo=null,this.fullCards=null,this.currentCheckResults=null,this.replayVo&&this.replayVo.stopAndClear(),this.replayVo=null},i.NAME=GameIdEnum.PGP+"PGPDataProxy",i}(puremvc.Proxy);t.PGPDataProxy=e,__reflect(e.prototype,"PGP.PGPDataProxy")}(PGP||(PGP={}));var PGP;!function(t){var e=function(){function t(){}return t}();t.HorseDTO=e,__reflect(e.prototype,"PGP.HorseDTO")}(PGP||(PGP={}));var PGP;!function(t){var e=function(){function t(){}return t}();t.KongScoreOffsetDTO=e,__reflect(e.prototype,"PGP.KongScoreOffsetDTO")}(PGP||(PGP={}));var PGP;!function(t){var e=function(){function t(){}return t}();t.MahjongGameActionDTO=e,__reflect(e.prototype,"PGP.MahjongGameActionDTO")}(PGP||(PGP={}));var PGP;!function(t){var e=function(){function t(){}return t.prototype.fromThreeCard=function(t,e){t.sort(function(t,e){return e>t?-1:t==e?0:1}),this.card=e,t[0]==e?this.type=1:t[1]==e?this.type=2:this.type=3},t}();t.MahjongGameChowDTO=e,__reflect(e.prototype,"PGP.MahjongGameChowDTO")}(PGP||(PGP={}));var PGP;!function(t){var e=function(){function t(){}return t}();t.MahjongGameTurnDTO=e,__reflect(e.prototype,"PGP.MahjongGameTurnDTO")}(PGP||(PGP={}));var PGP;!function(t){var e=function(){function t(){}return t}();t.PGP_ChatConfig=e,__reflect(e.prototype,"PGP.PGP_ChatConfig")}(PGP||(PGP={}));var PGP;!function(t){var e=function(){function t(){}return t}();t.PGP_EmojiConfig=e,__reflect(e.prototype,"PGP.PGP_EmojiConfig")}(PGP||(PGP={}));var PGP;!function(t){var e=function(){function t(){}return t}();t.PGPChatDTO=e,__reflect(e.prototype,"PGP.PGPChatDTO")}(PGP||(PGP={}));var PGP;!function(t){var e=function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t.stepTimeGapMs=1e3,t}return __extends(i,e),i.prototype.init=function(t){this.index=0,this.data=t,this.max=t.length,this.stepTimeGapMs=2e3,this.speed=1,this.autoPlay=!1,egret.clearInterval(this.autoPlayTimer)},i.prototype.startAutoPlay=function(){this.autoPlay=!0,t.dataProxy.centerConfig.socketProxy.replayData(this.data[0]),this.index=1,egret.clearInterval(this.autoPlayTimer),this.autoPlayTimer=egret.setInterval(this.onPlayTimer,this,this.stepTimeGapMs/this.speed),this.isPlaying=!0},i.prototype.showPrevFrame=function(){this.index<=1||(this.index--,t.dataProxy.centerConfig.socketProxy.replayData(this.data[this.index-1]))},i.prototype.showNextFrame=function(){this.index>=this.max||(this.index++,t.dataProxy.centerConfig.socketProxy.replayData(this.data[this.index-1]))},i.prototype.jumpToPersent=function(e){0>e&&(e=0),e>1&&(e=1),this.index=int_XY(this.max*e),t.dataProxy.centerConfig.socketProxy.replayData(this.data[this.index-1])},i.prototype.pause=function(){egret.clearInterval(this.autoPlayTimer),this.isPlaying=!1},i.prototype.resume=function(){egret.clearInterval(this.autoPlayTimer),this.autoPlayTimer=egret.setInterval(this.onPlayTimer,this,this.stepTimeGapMs/this.speed),this.isPlaying=!0},i.prototype.changePlaySpeed=function(t){this.speed=t,this.isPlaying&&(egret.clearInterval(this.autoPlayTimer),this.autoPlayTimer=egret.setInterval(this.onPlayTimer,this,this.stepTimeGapMs/this.speed))},i.prototype.stopAndClear=function(){egret.clearInterval(this.autoPlayTimer),this.data=null,this.isPlaying=!1},i.prototype.onPlayTimer=function(){this.index++,this.index>this.max?egret.clearInterval(this.autoPlayTimer):(t.dataProxy.centerConfig.socketProxy.replayData(this.data[this.index-1]),this.dispatchEventWith(i.E_PROGRESS,!1,this.index/this.max))},i.E_PROGRESS="E_PROGRESS",i}(egret.EventDispatcher);t.PGPReplayVo=e,__reflect(e.prototype,"PGP.PGPReplayVo")}(PGP||(PGP={}));var PGP;!function(t){var e=function(){function e(){this.isHu=!1}return e.maskNick=function(e){e&&(e.name=maskNick_XY(e.name,e.uid,t.dataProxy.roomDetailInfo&&t.dataProxy.roomDetailInfo.friends,t.dataProxy.centerConfig&&t.dataProxy.centerConfig.replayMode))},e}();t.PlayerDTO=e,__reflect(e.prototype,"PGP.PlayerDTO")}(PGP||(PGP={}));var PGP;!function(t){var e=function(){function t(){}return t}();t.SettlingDTO=e,__reflect(e.prototype,"PGP.SettlingDTO")}(PGP||(PGP={}));var PGP;!function(t){var e=function(){function e(){}return e.maskNick=function(e){e&&(e.name=maskNick_XY(e.name,e.uid,t.dataProxy.roomDetailInfo&&t.dataProxy.roomDetailInfo.friends,t.dataProxy.centerConfig&&t.dataProxy.centerConfig.replayMode))},e}();t.SettlingInfoDTO=e,__reflect(e.prototype,"PGP.SettlingInfoDTO")}(PGP||(PGP={}));var PGP;!function(t){var e=function(){function t(){}return t}();t.SnapshotDTO=e,__reflect(e.prototype,"PGP.SnapshotDTO")}(PGP||(PGP={}));var PGP;!function(t){var e=function(){function t(){}return t}();t.UserMahjongDTO=e,__reflect(e.prototype,"PGP.UserMahjongDTO")}(PGP||(PGP={}));var PGP;!function(t){var e=function(){function t(){}return t.hasValid=function(e){return-1!=e.indexOf(t.chi)||-1!=e.indexOf(t.peng)||-1!=e.indexOf(t.ming_gang)||-1!=e.indexOf(t.bu_gang)||-1!=e.indexOf(t.an_gang)||-1!=e.indexOf(t.ting)||-1!=e.indexOf(t.hu)},t.da_pai=1,t.mo_pai=2,t.chi=11,t.peng=22,t.ming_gang=31,t.bu_gang=32,t.an_gang=33,t.huan_hua=44,t.ting=88,t.hu=99,t.pass=999,t}();t.Action=e,__reflect(e.prototype,"PGP.Action")}(PGP||(PGP={}));var PGP;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.execute=function(e){var o=puremvc.Facade.getInstance(GameIdEnum.PGP);o.removeCommand(t.PGPExitCommand.NAME),o.removeCommand(i.NAME),o.removeMediator(t.PGPSocketMediator.NAME),o.removeMediator(t.PGPGameSceneMediator.NAME),o.removeProxy(t.PGPDataProxy.NAME),t.dataProxy&&t.dataProxy.dispose(),t.dataProxy=null},i.NAME=GameIdEnum.PGP+"RegisteMVCCommand",i}(puremvc.SimpleCommand);t.PGPDisposeMVCCommand=e,__reflect(e.prototype,"PGP.PGPDisposeMVCCommand")}(PGP||(PGP={}));var PGP;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.execute=function(t){Global.onEvent(EventEnum.EXIT_GAME_G_to_P),bridge_iframe.sendMsgToHall(EventEnum.EXIT_GAME_G_to_P)},e.NAME=GameIdEnum.PGP+"PGPExitCommand",e}(puremvc.SimpleCommand);t.PGPExitCommand=e,__reflect(e.prototype,"PGP.PGPExitCommand")}(PGP||(PGP={}));var PGP;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.execute=function(e){var i=puremvc.Facade.getInstance(GameIdEnum.PGP),o=e.getBody()[0];i.registerProxy(t.dataProxy),i.registerMediator(new t.PGPSocketMediator),i.registerMediator(new t.PGPGameSceneMediator(o.gameLayer)),i.registerMediator(new t.PGPReadmeMediator(o.popupLayer)),i.registerMediator(new t.PGPResultMediator(o.popupLayer)),i.registerMediator(new t.PGPHackMediator(o.popupLayer)),t.dataProxy.centerConfig.replayMode&&i.registerMediator(new t.PGPReplayMediator(o.msgLayer)),i.registerCommand(t.PGPExitCommand.NAME,t.PGPExitCommand),i.registerCommand(t.PGPDisposeMVCCommand.NAME,t.PGPDisposeMVCCommand)},i.NAME=GameIdEnum.PGP+"RegisteMVCCommand",i}(puremvc.SimpleCommand);t.PGPRegisteMVCCommand=e,__reflect(e.prototype,"PGP.PGPRegisteMVCCommand")}(PGP||(PGP={}));var PGP;!function(t){var e=function(){function t(){}return t.TABLE_CHAT_C=31,t.TABLE_CHAT_B=32,t.TABLE_TRY_TO_LEAVE_C=91,t.TABLE_LEAVE_S=92,t.TABLE_NOT_EXISTS_S=99,t.PGP_GET_SNAPSHOT_C=1e3,t.PGP_REFRESH_SNAPSHOT_S=1001,t.PGP_REFRESH_TABLE_ID_B=1002,t.PGP_STATE_PREPARE_B=1003,t.PGP_STATE_START_B=1004,t.PGP_TRUSTEESHIP_C=1005,t.PGP_TRUSTEESHIP_S=1006,t.PGP_PLAYER_KONG_SCOREOFFSET=1007,t.PGP_HORSE_B=1008,t.PGP_JOIN_B=1009,t.PGP_LEAVE_B=1010,t.PGP_CONTINUE_C=1011,t.PGP_SETTLEMENT_B=1012,t.PGP_HU_B=1013,t.PGP_PASS_WATER_S=1014,t.PGP_READY_C=1015,t.PGP_READY_B=1016,t.MAHJONG_DA_C=9001,t.MAHJONG_CHI_C=9002,t.MAHJONG_PENG_C=9003,t.MAHJONG_MING_GANG_C=9011,t.MAHJONG_JIA_GANG_C=9012,t.MAHJONG_AN_GANG_C=9013,t.MAHJONG_TING_C=9018,t.MAHJONG_HU_C=9020,t.MAHJONG_PASS_C=9031,t.MAHJONG_TURN_B=9901,t.MAHJONG_ACTION_B=9949,t.MAHJONG_SHOW_ME_THE_MONEY_C=9881,t.MAHJONG_SHOW_ME_THE_MONEY_S=9882,t.MAHJONG_BLACK_SHEEP_WALL_C=9883,t}();t.PGPProtocol=e,__reflect(e.prototype,"PGP.PGPProtocol")}(PGP||(PGP={}));var PGP;!function(t){function e(e,o){void 0===o&&(o={});var n=puremvc.Facade.getInstance(GameIdEnum.PGP);if(n){var a=n.retrieveMediator(i.NAME);a?a.sendMessage(e,o):t.warn("PGP的PGPSocketMediator已经销毁")}else t.warn("PGP的facade已经销毁")}var i=function(i){function o(){var e=i.call(this,o.NAME)||this;return e.currentIP=null,e.roomStr=0,e.serverDataStack=[],e.topic=t.dataProxy.centerConfig.moduleType+TopicType.HD_LOGIC,t.dataProxy.centerConfig.socketProxy.addHandler(e.topic,e),Global.eventCenter.addEventListener("mqtt_reconnecting",e.onReconnecting,e),Global.eventCenter.addEventListener("mqtt_reconnect_ok",e.onReconnectOk,e),e}return __extends(o,i),o.prototype.onRemove=function(){i.prototype.onRemove.call(this),t.dataProxy.centerConfig.socketProxy.clearHandlers(this.topic),Global.eventCenter.removeEventListener("mqtt_reconnecting",this.onReconnecting,this),Global.eventCenter.removeEventListener("mqtt_reconnect_ok",this.onReconnectOk,this)},o.prototype.listNotificationInterests=function(){return[o.START_CONNECT,o.SHIFT_ALL_SERVER_DATA,o.SWITCH_ROOM]},o.prototype.handleNotification=function(i){switch(i.getName()){case o.START_CONNECT:break;case o.SHIFT_ALL_SERVER_DATA:this.shiftAllServerData();break;case o.SWITCH_ROOM:e(t.PGPProtocol.TABLE_TRY_TO_LEAVE_C,999999)
}},o.prototype.shiftAllServerData=function(){for(t.trace("开始处理所有堆栈中的服务器消息");this.serverDataStack.length>0;){var e=this.serverDataStack.shift();this.executeServerData(e.cmd,e.data,e.fromData)}t.trace("所有堆栈中的服务器消息处理完毕")},o.prototype.handle=function(e,i,o){t.trace("receive cmd ["+e+"], data:",i);{if(e!=SocketProxy.CMD_REPLAY)return e==t.PGPProtocol.PGP_REFRESH_SNAPSHOT_S||e==t.PGPProtocol.TABLE_NOT_EXISTS_S||e==t.PGPProtocol.TABLE_LEAVE_S||this.roomInfoInited?(this.executeServerData(e,i,o),!0):void t.trace("房间数据没有初始化, 当前消息抛弃!");if(i==t.dataProxy.replayVo.data[t.dataProxy.replayVo.data.length-1])t.dataProxy.gameComplete(i);else{var n=i;t.dataProxy.updateRoomDetailInfo(n),this.roomInfoInited=!0,t.sendNotification(t.PGPResultMediator.HIDE)}}},o.prototype.cmdNeedToStack=function(e){return e==t.PGPProtocol.TABLE_LEAVE_S?!1:!0},o.prototype.executeServerData=function(e,i,o){switch(e){case t.PGPProtocol.PGP_REFRESH_SNAPSHOT_S:var n=i;t.dataProxy.updateRoomDetailInfo(n),this.roomInfoInited=!0,DevelopMain.dataInited=!0,t.sendNotification(t.PGPGameSceneMediator.UPDATE_ROOM_DETAIL_INFO);break;case t.PGPProtocol.PGP_STATE_PREPARE_B:t.dataProxy.changeToPrepare(i);break;case t.PGPProtocol.PGP_STATE_START_B:var n=i;t.dataProxy.updateRoomDetailInfo(n),t.sendNotification(t.PGPGameSceneMediator.CHANGE_TO_START);break;case t.PGPProtocol.PGP_HU_B:var a=i;t.dataProxy.showZiMoAni(a);break;case t.PGPProtocol.PGP_HORSE_B:var r=i;t.dataProxy.updateHorseDTO(r);break;case t.PGPProtocol.PGP_SETTLEMENT_B:var s=i;t.dataProxy.gameComplete(s);break;case t.PGPProtocol.PGP_PASS_WATER_S:var h=i,l="";h&&(l=format_XY2(t.i18n(h.m),h.a),Toast.show(l));break;case t.PGPProtocol.PGP_PLAYER_KONG_SCOREOFFSET:var d=i;t.dataProxy.updatePlayerActionEffect(d),4==d.length?t.sendNotification(t.PGPGameSceneMediator.GUA_FENG_OR_XIA_YU,1):t.sendNotification(t.PGPGameSceneMediator.GUA_FENG_OR_XIA_YU,0);break;case t.PGPProtocol.PGP_JOIN_B:t.dataProxy.someOneJoin(i);break;case t.PGPProtocol.PGP_LEAVE_B:t.dataProxy.someOneLeave(i);break;case t.PGPProtocol.MAHJONG_TURN_B:var c=i;t.dataProxy.updateTurn(c);break;case t.PGPProtocol.MAHJONG_ACTION_B:var P=i;t.dataProxy.updateAction(P);break;case t.PGPProtocol.PGP_TRUSTEESHIP_S:t.dataProxy.updateTuoguan(i);break;case t.PGPProtocol.PGP_READY_B:var u=i;t.dataProxy.updatePlayerReadyStatus(u);break;case t.PGPProtocol.MAHJONG_SHOW_ME_THE_MONEY_S:i&&i.length>0?t.sendNotification(t.PGPHackMediator.SHOW,i):Toast.show(t.i18n("牌局开始后，才可使用选牌功能"));break;case t.PGPProtocol.TABLE_CHAT_B:var p=i;if(!p)return;var f=t.dataProxy.findPlayerGameInfoByUid(p.uid);if(!f)return;var _=t.dataProxy.getUIPosByServerPos(f.position);if(-1==_)return;ChatManager.showChatAt(_,p,1==f.gender);break;case t.PGPProtocol.TABLE_LEAVE_S:var l="",y=i,g=y.s;if(0>g)l=format_XY2(t.i18n(i.m),i.a),Toast.show(l),SimpleLoading.hide();else if(888888==g)this.roomInfoInited=!1,t.dataProxy.gameExited=!0,DevelopMain.dataInited=!1;else if(999999==g){this.roomInfoInited=!1,t.dataProxy.gameExited=!0,DevelopMain.dataInited=!1,t.dataProxy.lastGamePlayerIds=[],null!=y.m&&""!=y.m&&(l=format_XY2(t.i18n(y.m),y.a),Toast.show(l));var m=new JoinDTO(t.dataProxy.centerConfig.moduleType,y.d);t.dataProxy.centerConfig.socketProxy.sendMessage(ModuleType.MODULE_LOBBY+TopicType.HD_SWITCHTABLE,t.dataProxy.centerConfig.type,t.dataProxy.centerConfig.area,0,m)}else this.roomInfoInited=!1,t.dataProxy.gameExited=!0,DevelopMain.dataInited=!1,SocketManager.getInstance().disconnect(),y.m?t.alert(format_XY2(t.i18n(y.m),y.a),function(){t.sendNotification(t.PGPExitCommand.NAME)}):t.sendNotification(t.PGPExitCommand.NAME);break;case t.PGPProtocol.TABLE_NOT_EXISTS_S:t.alert(t.i18n("房间已解散，请重新进入房间."),function(){t.sendNotification(t.PGPExitCommand.NAME)});break;case t.PGPProtocol.PGP_REFRESH_TABLE_ID_B:t.dataProxy.updateTableId(i)}},o.prototype.onReconnecting=function(){this.roomInfoInited=!1,SimpleLoading.show(t.i18n("网络异常，游戏重连中...")),t.trace("网络断开，开始重连")},o.prototype.onReconnectOk=function(){SimpleLoading.hide(),t.trace("重连成功！"),this.sendMessage(t.PGPProtocol.PGP_GET_SNAPSHOT_C)},o.prototype.sendMessage=function(e,i){t.dataProxy.centerConfig.socketProxy.sendMessage(this.topic,t.dataProxy.centerConfig.type,t.dataProxy.centerConfig.area,e,i),t.trace("send cmd ["+e+"], data:",i)},o.NAME=GameIdEnum.PGP+"PGPSocketMediator",o.START_CONNECT=o.NAME+"START_CONNECT",o.SHIFT_ALL_SERVER_DATA=o.NAME+"SHIFT_ALL_SERVER_DATA",o.SWITCH_ROOM=o.NAME+"SWITCH_ROOM",o}(puremvc.Mediator);t.PGPSocketMediator=i,__reflect(i.prototype,"PGP.PGPSocketMediator",["ISocketDataHandler"]),t.sendSocketMessage=e}(PGP||(PGP={}));var PGP;!function(t){var e=function(t){function e(i,o,n,a,r){var s=t.call(this)||this;return s.id=e.counter++,s.source=i,s.callback=o,s.focusIncall=a,s.focusOutcall=r,s.thisObj=n,s.defaultY=i.y,s.setEnable(!0),i.addEventListener(egret.TouchEvent.TOUCH_BEGIN,s.onBegin,s),Global.stage.addEventListener(egret.TouchEvent.TOUCH_END,s.onEnd,s),e.allTaps.push(s),s}return __extends(e,t),e.init=function(){},e.prototype.onTap=function(t){t&&(t.stopPropagation(),t.stopImmediatePropagation(),t.preventDefault()),this.isSwiped||(this.focused?this.doCall():(this.focusIncall&&this.focusIncall.apply(this.thisObj,[this.source]),this.focused=!0,this.updateFocus()))},e.prototype.onBegin=function(t){this.locX=t.stageX,this.locY=t.stageY,this.isSwiped=!1,this.beginCanUse=!0,this.bornX=this.source.x,this.bornY=this.source.y,this.source.parent&&this.source.parent.addChild(this.source),this.source.parent&&this.source.parent.parent&&this.source.parent.parent.parent&&this.source.parent.parent.parent.addChild(this.source.parent.parent),Global.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMove,this)},e.prototype.onMove=function(t){this.source.x=this.bornX+t.stageX-this.locX,this.source.y=this.bornY+t.stageY-this.locY},e.prototype.onEnd=function(t){if(!this.beginCanUse)return void this.focusOut();Global.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMove,this),this.source.x=this.bornX,this.source.y=this.bornY,this.beginCanUse=!1;var e=t.stageX-this.locX,i=t.stageY-this.locY,o=0;return Math.abs(i)<150?(t.stopPropagation(),t.stopImmediatePropagation(),t.preventDefault(),void(Math.abs(i)<50&&Math.abs(e)<50?this.onTap():(this.isSwiped=!0,this.focusOut()))):(o=i>0?1:0,void(0==o?(this.focused=!1,this.updateFocus(),this.doCall(),this.isSwiped=!0):1==o&&(this.isSwiped=!0,this.focused=!1,this.focusOut())))},e.prototype.focusOut=function(){this.focused&&(this.focusOutcall&&this.focusOutcall.apply(this.thisObj,[this.source]),this.focused=!1,this.updateFocus())},e.prototype.doCall=function(){this.callback.apply(this.thisObj,[this.source]),this.focused=!1},e.prototype.updateFocus=function(){if(this.updateView(),this.focused)for(var t=0,i=e.allTaps.length;i>t;t++){var o=e.allTaps[t];o!=this&&(o.focused=!1,o.updateView())}},e.prototype.updateView=function(){Tween$.removeTweens(this.source);var t=this.focused?this.defaultY-40:this.defaultY;Tween$.get(this.source).to({y:t},50)},e.prototype.setEnable=function(t){this.source.touchEnabled=t,this.source.touchChildren=!1,this.focused=!1},e.prototype.updateDefaultY=function(){this.defaultY=this.source.y},e.prototype.dispose=function(){this.source&&(this.source.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this),this.source.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBegin,this),this.source.removeEventListener(egret.TouchEvent.TOUCH_END,this.onEnd,this)),Global.stage.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.focusOut,this),Global.stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.onEnd,this),Global.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMove,this),this.source&&Tween$.removeTweens(this.source),this.source=null,this.callback=null,this.thisObj=null,this.focusIncall=null,this.focusOutcall=null;var t=e.allTaps.indexOf(this);e.allTaps.splice(t,1)},e.allTaps=[],e.counter=0,e.inited=!1,e}(egret.EventDispatcher);t.PGPMahjongUserTap=e,__reflect(e.prototype,"PGP.PGPMahjongUserTap")}(PGP||(PGP={}));var PGP;!function(t){var e=function(){function e(){}return e.getUIPosByServerPos=function(e){var i=t.dataProxy.selfIndex,o=this.DONG,n=this.NAN,a=this.XI,r=this.BEI;if(i==o){if(e==o)return 1;if(e==n)return 2;if(e==a)return 3;if(e==r)return 0}if(i==n){if(e==o)return 0;if(e==n)return 1;if(e==a)return 2;if(e==r)return 3}if(i==a){if(e==o)return 3;if(e==n)return 0;if(e==a)return 1;if(e==r)return 2}if(i==r){if(e==o)return 2;if(e==n)return 3;if(e==a)return 0;if(e==r)return 1}return-1},e.DONG=0,e.NAN=1,e.XI=2,e.BEI=3,e}();t.PGPPositionUtils=e,__reflect(e.prototype,"PGP.PGPPositionUtils")}(PGP||(PGP={}));var PGP;!function(t){var e=function(){function e(){}return e.dispose=function(){this.stopBgm(),SoundManager.dispose(GameIdEnum.PGP)},e.bgm=function(){this.play("ready",!0)},e.stopBgm=function(){var t=GameIdEnum.PGP+"_ready_mp3";SoundManager.stop(t,!0)},e.dice=function(){this.play("roll_sice")},e.win=function(){this.play("win")},e.lose_liuju=function(){this.play("lose_liu")},e.chooseCard=function(){this.play("select")},e.playHorse=function(){this.play("game_horse")},e.playComeIn=function(){this.play("enterroom")},e.playReady=function(){this.play("player_ready")},e.gameStart=function(){this.play("beganGame")},e.clock=function(){this.play("clock")},e.dapai=function(){this.play("out_card")},e.hu=function(e,i){var o=1==t.dataProxy.findPlayerGameInfoByUid(e).gender?"man_":"woman_",n=o;n+=i?"zimo":"hu",this.play(n),this.play("hu_shan")},e.action=function(e){var i=1==t.dataProxy.findPlayerGameInfoByUid(e.uid).gender?"man_":"woman_",o="",n=mahjong.helpCard0.buildByCardID(e.card);switch(e.action){case t.Action.da_pai:this.dapai(),n.type==mahjong.Type.BAMBOO||n.type==mahjong.Type.CHARACTER||n.type==mahjong.Type.DOT?(n.type==mahjong.Type.BAMBOO?o="tiao_":n.type==mahjong.Type.CHARACTER&&(o="w_"),n.type==mahjong.Type.DOT&&(o="tong_"),o+=n.point+1+""):n.type==mahjong.Type.ZI?n.point==mahjong.Point.EAST_WIND?o="f_1":n.point==mahjong.Point.SOUTH_WIND?o="f_2":n.point==mahjong.Point.WEST_WIND?o="f_3":n.point==mahjong.Point.NORTH_WIND?o="f_4":n.point==mahjong.Point.RED_DRAGON?o="f_5":n.point==mahjong.Point.GREEN_DRAGON?o="f_6":n.point==mahjong.Point.WHITE_DRAGON&&(o="f_7"):t.warn("未处理的声音："+n.toString());break;case t.Action.chi:o="chi";break;case t.Action.peng:o="peng";break;case t.Action.ting:o="ting";break;case t.Action.ming_gang:case t.Action.bu_gang:o="gang";break;case t.Action.an_gang:o="angang";break;case t.Action.hu:o=e.lastOpUid==e.uid?"zimo":"hu";break;case t.Action.huan_hua:o="buhua"}""!=o&&(o=i+o),this.play(o)},e.play=function(t,e){void 0===e&&(e=!1),""!=t&&(t=GameIdEnum.PGP+"_"+t+"_mp3",RES.getRes(t)&&(e?SoundManager.playBg(t,0,-1):SoundManager.playEffect(t)))},e}();t.PGPSoundPlayer=e,__reflect(e.prototype,"PGP.PGPSoundPlayer")}(PGP||(PGP={}));var PGP;!function(t){var e=function(){function e(){}return e.getHuName=function(t){var e=this.idArr.indexOf(t);return-1!=e?this.nameArr[e]:""},e.getArtCardRes=function(e){var i=mahjong.helpCard0.buildByCardID(e),o=0;switch(mahjong.helpCard0.type){case mahjong.Type.BAMBOO:o=i.point+1;break;case mahjong.Type.DOT:o=i.point+11;break;case mahjong.Type.CHARACTER:o=i.point+21;break;case mahjong.Type.ZI:case mahjong.Type.FLOWER:switch(i.point){case mahjong.Point.RED_DRAGON:o=31;break;case mahjong.Point.GREEN_DRAGON:o=32;break;case mahjong.Point.WHITE_DRAGON:o=33;break;case mahjong.Point.EAST_WIND:o=34;break;case mahjong.Point.SOUTH_WIND:o=35;break;case mahjong.Point.WEST_WIND:o=36;break;case mahjong.Point.NORTH_WIND:o=37;break;case mahjong.Point.FLOWER_CHUN:o=42;break;case mahjong.Point.FLOWER_XIA:o=43;break;case mahjong.Point.FLOWER_QIU:o=44;break;case mahjong.Point.FLOWER_DONG:o=45;break;case mahjong.Point.FLOWER_MEI:o=38;break;case mahjong.Point.FLOWER_LAN:o=39;break;case mahjong.Point.FLOWER_ZHU:o=40;break;case mahjong.Point.FLOWER_JU:o=41}}return 0==o&&t.trace(1111),"PGP_card_"+o+"_png"},e.getCardType=function(t){return int_XY(t/9)},e.getCardPoint=function(t){return t%9},e.idArr=[],e.nameArr=[],e}();t.PGPStringUtils=e,__reflect(e.prototype,"PGP.PGPStringUtils")}(PGP||(PGP={}));var PGP;!function(t){var e=function(e){function i(){var t=e.call(this,"PGPAlertSkin")||this;return t.timer=0,remove_XY(t.btnGrp),t.tf.height=270,t.tf.lineSpacing=15,t}return __extends(i,e),i.getInstance=function(){return this.instance||(this.instance=new i),this.instance},i.dispose=function(){i.instance&&i.instance.dispose(),i.instance=null},i.prototype.show=function(){var t=puremvc.Facade.getInstance(GameIdEnum.PGP).layout;t.msgLayer.addChild(this),this.counter=0,this.onTimer(),this.startTimer()},i.prototype.startTimer=function(){egret.clearInterval(this.timer),this.timer=egret.setInterval(this.onTimer,this,500)},i.prototype.onTimer=function(){this.counter++;var e=this.counter%4;this.tf.text=t.i18n("正在为您匹配牌桌{0}游戏即将开始，请耐心等待","\n")+copyChar_XY(".",e)+copyChar_XY(" ",3-e)},i.prototype.stopTimer=function(){egret.clearInterval(this.timer)},i.prototype.hide=function(){this.stopTimer(),remove_XY(this)},i}(BaseComponent);t.PGPLoading=e,__reflect(e.prototype,"PGP.PGPLoading")}(PGP||(PGP={}));var PGP;!function(t){function e(t,e){o.init(),o.instance.showAlert(t,e)}function i(t,e,i){o.init(),o.instance.showConfirm(t,e,i)}var o=function(t){function e(){var e=t.call(this,"PGPAlertSkin")||this;return i18nEUI(GameIdEnum.PGP,e,[e.okBtn,e.cancelBtn]),bindTapEvent_XY(e.okBtn,e.onOk,e,!1,null,!1,!0),bindTapEvent_XY(e.cancelBtn,e.onNo,e,!1,null,!1,!0),bindTapEvent_XY(e.closeBtn,e.onClose,e,!0),e}return __extends(e,t),e.init=function(){e.instance=e.instance||new e},e.dispose=function(){e.instance&&e.instance.dispose(),e.instance=null},e.prototype.dispose=function(){t.prototype.dispose.call(this),this.okCall=null,this.cancelCall=null,clearTapEvent_XY(this.okBtn,this.onOk,this),clearTapEvent_XY(this.cancelBtn,this.onNo,this),clearTapEvent_XY(this.closeBtn,this.onClose,this)},e.prototype.onOk=function(){this.okCall&&this.okCall(),this.hide()},e.prototype.onNo=function(){this.cancelCall&&this.cancelCall(),this.hide()},e.prototype.onClose=function(){this.hide()},e.prototype.showAlert=function(t,e){this.okCall=e;var i=puremvc.Facade.getInstance(GameIdEnum.PGP).layout;i.msgLayer.addChild(this),setHtmlText(this.tf,t),remove_XY(this.cancelBtn),this.okBtn.x=0,tween_XY_alphaShow(this)},e.prototype.showConfirm=function(t,e,i){this.okCall=e,this.cancelCall=i;var o=puremvc.Facade.getInstance(GameIdEnum.PGP).layout;o.msgLayer.addChild(this),setHtmlText(this.tf,t),this.btnGrp.addChild(this.cancelBtn),tween_XY_alphaShow(this),this.okBtn.x=248},e.prototype.hide=function(){this.okCall=null,this.cancelCall=null,remove_XY(this)},e}(BaseComponent);t.XYAlert=o,__reflect(o.prototype,"PGP.XYAlert"),t.alert=e,t.confirm=i}(PGP||(PGP={}));var PGP;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.mLabel="",e.mLabelSize=30,bindEuiCreateOkEventOnce_XY(e,e.onInit,e),e.isEnable=!0,e}return __extends(e,t),e.prototype.onInit=function(){setHtmlText(this.tf,this.mLabel),this.bg.source="PGP_btn_tb2_png",this.a_labelColor=14868963,this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onEffectBeginTouchHandler,this),this.addEventListener(egret.TouchEvent.TOUCH_CANCEL,this.onEffectEndTouchHandler,this),this.addEventListener(egret.TouchEvent.TOUCH_END,this.onEffectEndTouchHandler,this),this.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onEffectEndTouchHandler,this)},e.prototype.onEffectBeginTouchHandler=function(){this.isEnable&&(this.bg.source="PGP_btn_tb1_png",this.a_labelColor=4925952,this.useTapSound&&SoundManager.playEffect(__tapSound))},e.prototype.onEffectEndTouchHandler=function(){this.isEnable&&(this.bg.source="PGP_btn_tb2_png",this.a_labelColor=14868963)},e.prototype.setEnalble=function(t){this.touchEnabled=t,this.touchChildren=t,this.isEnable=t,t?(this.bg.source="PGP_btn_tb2_png",this.a_labelColor=14868963):(this.bg.source="PGP_btn_an2_png",this.a_labelColor=4211011)},e.prototype.dispose=function(){this.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onEffectBeginTouchHandler,this),this.removeEventListener(egret.TouchEvent.TOUCH_CANCEL,this.onEffectEndTouchHandler,this),this.removeEventListener(egret.TouchEvent.TOUCH_END,this.onEffectEndTouchHandler,this),this.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onEffectEndTouchHandler,this)},e.prototype.setHtmlLabel=function(t){this.mLabel=t,this.tf&&setHtmlText(this.tf,t)},Object.defineProperty(e.prototype,"a_label",{get:function(){return this.mLabel},set:function(t){this.mLabel=t,this.tf&&setHtmlText(this.tf,t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"a_labelSize",{get:function(){return this.mLabelSize},set:function(t){this.mLabelSize=t,this.tf&&(this.tf.size=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"a_labelColor",{get:function(){return this.mLabelColor},set:function(t){this.mLabelColor=t,this.tf&&(this.tf.textColor=t)},enumerable:!0,configurable:!0}),e}(eui.Component);t.XYButton=e,__reflect(e.prototype,"PGP.XYButton")}(PGP||(PGP={}));var PGP;!function(t){var e=function(e){function i(t){return e.call(this,i.NAME,t)||this}return __extends(i,e),i.prototype.onRemove=function(){e.prototype.onRemove.call(this),this.gameScene&&(this.gameScene.dispose(),remove_XY(this.gameScene),this.gameScene=null)},i.prototype.listNotificationInterests=function(){return[i.SHOW,i.UPDATE_ROOM_DETAIL_INFO,i.UPDATE_TABLE_ID,i.CHANGE_TO_PREPARE,i.CHANGE_TO_START,i.SOME_ONE_JOIN,i.SOME_ONE_LEAVE,i.UPDATE_TURN,i.DO_ACTION,i.UPDATE_TUOGUAN,i.SHOW_HU,i.REFRESH_MY_TING,i.GUA_FENG_OR_XIA_YU,i.GAME_FLOAT_SCORE,i.GAME_SHOW_HORSE,i.GAME_SHOW_DIAN_PAO_HU,i.GAME_SHOW_DIAN_PAO,i.GAME_SHOW_ZIMO,i.GAME_SHOW_GANG_SHANG_HUA,i.GAME_UPDATE_READY]},i.prototype.handleNotification=function(e){var o=e.getBody();switch(e.getName()){case i.SHOW:this.gameScene||(this.gameScene=new t.PGPGameScene,this.gameScene.init()),this.getLayer().addChild(this.gameScene);break;case i.UPDATE_ROOM_DETAIL_INFO:this.gameScene&&this.gameScene.updateRoomInfo();break;case i.UPDATE_TABLE_ID:this.gameScene&&this.gameScene.updateTableId();break;case i.CHANGE_TO_PREPARE:this.gameScene&&this.gameScene.updateRoomInfo();break;case i.CHANGE_TO_START:this.gameScene&&this.gameScene.gameStart();break;case i.SOME_ONE_JOIN:this.gameScene&&this.gameScene.someOneJoin(o);break;case i.SOME_ONE_LEAVE:this.gameScene&&this.gameScene.someOneLeave(o);break;case i.UPDATE_TURN:this.gameScene&&this.gameScene.updateTurn();break;case i.GAME_UPDATE_READY:this.gameScene&&this.gameScene.updatePlayerStatus();break;case i.DO_ACTION:this.gameScene&&this.gameScene.doAction(o[0],o[1],o[2]);break;case i.UPDATE_TUOGUAN:this.gameScene&&this.gameScene.updateAiState();break;case i.SHOW_HU:this.gameScene&&this.gameScene.playHu();break;case i.REFRESH_MY_TING:this.gameScene&&this.gameScene.refreshTingFlag();break;case i.GUA_FENG_OR_XIA_YU:this.gameScene&&this.gameScene.playEffectGuaFengOrXiaYu(o);break;case i.GAME_FLOAT_SCORE:this.gameScene&&this.gameScene.showTotalOffset(o);break;case i.GAME_SHOW_HORSE:this.gameScene&&this.gameScene.showHorse();break;case i.GAME_SHOW_DIAN_PAO:this.gameScene&&this.gameScene.showDianPaoEffect(o);break;case i.GAME_SHOW_DIAN_PAO_HU:this.gameScene&&this.gameScene.showHuEffect(o);break;case i.GAME_SHOW_ZIMO:this.gameScene&&this.gameScene.showZiMo(o);break;case i.GAME_SHOW_GANG_SHANG_HUA:this.gameScene&&this.gameScene.showGangShangKaiHua(o)}},i.NAME=GameIdEnum.PGP+"PGPGameSceneMediator",i.SHOW=i.NAME+"SHOW",i.UPDATE_ROOM_DETAIL_INFO=i.NAME+"UPDATE_ROOM_DETAIL_INFO",i.UPDATE_TABLE_ID=i.NAME+"UPDATE_TABLE_ID",i.CHANGE_TO_PREPARE=i.NAME+"CHANGE_TO_PREPARE",i.CHANGE_TO_START=i.NAME+"CHANGE_TO_START",i.SOME_ONE_JOIN=i.NAME+"SOME_ONE_JOIN",i.SOME_ONE_LEAVE=i.NAME+"SOME_ONE_LEAVE",i.UPDATE_TURN=i.NAME+"UPDATE_TURN",i.DO_ACTION=i.NAME+"DO_ACTION",i.UPDATE_TUOGUAN=i.NAME+"UPDATE_TUOGUAN",i.SHOW_HU=i.NAME+"SHOW_HU",i.REFRESH_MY_TING=i.NAME+"REFRESH_MY_TING",i.GUA_FENG_OR_XIA_YU=i.NAME+"GUA_FENG_OR_XIA_YU",i.GAME_FLOAT_SCORE=i.NAME+"GAME_FLOAT_SCORE",i.GAME_SHOW_ZIMO=i.NAME+"GAME_SHOW_ZIMO",i.GAME_SHOW_DIAN_PAO=i.NAME+"GAME_SHOW_DIAN_PAO",i.GAME_SHOW_DIAN_PAO_HU=i.NAME+"GAME_SHOW_DIAN_PAO_HU",i.GAME_SHOW_HORSE=i.NAME+"GAME_SHOW_HORSE",i.GAME_SHOW_GANG_SHANG_HUA=i.NAME+"GAME_SHOW_GANG_SHANG_HUA",i.GAME_UPDATE_READY=i.NAME+"GAME_UPDATE_READY",i}(t.AbstractMediator);t.PGPGameSceneMediator=e,__reflect(e.prototype,"PGP.PGPGameSceneMediator")}(PGP||(PGP={}));var PGP;!function(t){var e=function(e){function i(){var i=e.call(this,"PGPGameSceneSkin")||this;return i.throwIndex=0,i.circleIndex=0,i.allPaidun=[],i.initEvents(),t.dataProxy.centerConfig.replayMode&&(remove_XY(i.exitBtn),remove_XY(i.helpBtn),remove_XY(i.soundBtn)),i.updateSoundState(),i}return __extends(i,e),i.prototype.updateTableId=function(){var e=t.dataProxy.roomDetailInfo,i=e?e.state:0;0==i?this.tableIdTf.text=t.i18n("牌局编号:{0}"," --"):this.tableIdTf.text=e?t.i18n("牌局编号:{0}",e.tableId):" --",this.infoUi.setData(),e&&e.friends?(this.roomNoTf.visible=!0,this.roomNoTf.text=t.i18n("房间号:{0}",t.dataProxy.centerConfig.area),this.roundTf.visible=!0,0==e.battleRound?this.roundTf.text=t.i18n("局数:{0}",t.i18n("无限制")):this.roundTf.text=t.i18n("局数:{0}",e.battleRound),t.dataProxy.centerConfig.replayMode?this.copyRoomInfoBtn.visible=!1:this.copyRoomInfoBtn.visible=!0):(this.roundTf.text="",this.roundTf.visible=!1,this.roomNoTf.visible=!1,this.copyRoomInfoBtn.visible=!1)},i.prototype.updateWaiting=function(){var e=t.dataProxy.roomDetailInfo,i=e?e.state:0;Tween$.removeTweens(this.waitingImage);var o=t.PGPFacade.getInstance(GameIdEnum.PGP).retrieveMediator(t.PGPResultMediator.NAME).isShowing();if(0==i&&e&&e.info.length<4){var n=t.dataProxy.findPlayerGameInfoByUid(t.dataProxy.myUid);-1==e.autoReady?n&&(1==n.ready?(this.addChild(this.waitingImage),this.waitingImage.alpha=1,Tween$.get(this.waitingImage,{loop:!0}).to({alpha:0},1e3).to({alpha:1},1e3)):remove_XY(this.waitingImage)):(this.addChild(this.waitingImage),this.waitingImage.alpha=1,Tween$.get(this.waitingImage,{loop:!0}).to({alpha:0},1e3).to({alpha:1},1e3))}else 4!=i||o?remove_XY(this.waitingImage):(this.addChild(this.waitingImage),this.waitingImage.alpha=1,Tween$.get(this.waitingImage,{loop:!0}).to({alpha:0},1e3).to({alpha:1},1e3))},i.prototype.tryBuildAllPaidun=function(){var e=t.dataProxy.roomDetailInfo;if(0==this.allPaidun.length){var i=Math.min(e.dices[0],e.dices[1]),o=e.dices[0]+e.dices[1],n=0;n=t.dataProxy.getStartIndexByDeal(t.dataProxy.dealerIndex,o),n=(n+4)%4;var a=t.PGPPositionUtils.getUIPosByServerPos(n);if(0>a)return;for(var r=0,s=0;4>s;s++)r=0==s?a:0>r-1?3:r-1,t.trace(r+" uiIndex "),this.allPaidun=this.allPaidun.concat(this["paidun"+r].getAllPaiDun());var h=this.allPaidun.splice(0,2*i);this.allPaidun=this.allPaidun.concat(h);for(var s=0,l=this.allPaidun.length;l>s;s++){var d=this.allPaidun[s];d.visible=!1}}},i.prototype.updatePaidun=function(){var e=t.dataProxy.roomDetailInfo,i=e?e.state:0;if(this.infoUi.updateCardNum(),0==i)this.paidun0.setAllReady(),this.paidun1.setAllReady(),this.paidun2.setAllReady(),this.paidun3.setAllReady();else{this.tryBuildAllPaidun();for(var o=0,n=e.ascDraw;n>o;o++){var a=this.allPaidun[o];a&&(a.visible=!1,Tween$.removeTweens(a),a.alpha=1)}for(var o=this.allPaidun.length-1,r=e.descDraw;o>=0&&r>0;o--,r--){var a;a=e.descDraw%2!=0&&1==r?this.allPaidun[o-1]:this.allPaidun[o],a&&(a.visible=!1,Tween$.removeTweens(a),a.alpha=1)}if(e.ascDraw+e.descDraw>=136)for(var o=0,n=this.allPaidun.length;n>o;o++){var a=this.allPaidun[o];a&&(a.visible=!1,Tween$.removeTweens(a),a.alpha=1)}}},i.prototype.setupEmptyDesk=function(){this.updateWaiting(),this.updateTableId(),this.updateAiState(),this.gameTimer.setupEmpty(),this.touchHand.init(),this.menuBtn.setupEmpty(),this.effectCtrl.hideAll(),this.checkReady(),this.infoUi.setData();for(var t=0;4>t;t++)this["playerHead_"+t].updateData(),this["playerReady"+t].updateData(),this["dapai"+t].setupEmpty(),this["offset"+t].setupEmpty(),this["chipenggang"+t].setupEmpty(),this["huapai"+t].setupEmpty(),this["shoupai"+t].setupEmpty(),this["hupai"+t].setupEmpty();remove_XY(this.ctrlUI),remove_XY(this.gangChoosePanel),this.huPanel.hide(),this.tryBuildAllPaidun(),this.paidun0.setAllReady(),this.paidun1.setAllReady(),this.paidun2.setAllReady(),this.paidun3.setAllReady()},i.prototype.updatePlayerStatus=function(){for(var t=0;4>t;t++)this["playerReady"+t].updateData();this.checkReady(),this.updateWaiting()},i.prototype.updateRoomInfo=function(){var e=t.dataProxy.roomDetailInfo,i=e?e.state:0;this.updateWaiting(),this.updateTableId(),this.updateAiState(),this.gameTimer.updateData(),this.menuBtn.updateData(),this.infoUi.setData(),this.checkReady();for(var o=0;4>o;o++)this["playerHead_"+o].updateData(),this["playerReady"+o].updateData(),this["dapai"+o].updateData(),this["chipenggang"+o].updateData(),this["huapai"+o].updateData(),this["shoupai"+o].updateData(),this["hupai"+o].updateData();this.ctrlUI.updateData(this),this.horsePanel.updateData(),0==i&&(this.effectCtrl.hideAll(),this.huPanel.hide()),remove_XY(this.gangChoosePanel),this.updatePaidun(),this.handCtrl.updateData(),this.showReplayHu()},i.prototype.showReplayHu=function(){var e=t.dataProxy.roomDetailInfo;if(this.effectCtrl&&t.dataProxy.centerConfig.replayMode&&e&&e.state>1)for(var i=0;i<e.info.length;i++){var o=e.info[i];if(null!=o&&o.huCards&&o.huCards.length>0){var n=t.PGPPositionUtils.getUIPosByServerPos(o.position),a=this["effect"+n];egret.Tween.removeTweens(a),a.source="PGP_btn_hu_png",a.alpha=1,this.effectGrp.addChild(a)}}},i.prototype.initEvents=function(){i18nEUI(GameIdEnum.PGP,this,[this.tableIdTf,this.roomNoTf]),this.gangChoosePanel.initEvents(),this.ctrlUI.initEvents(),this.huPanel.initEvents(),this.gameTimer.initEvents(),bindTapEvent_XY(this.tableIdTf,this.onCopyTableId,this),bindTapEvent_XY(this.roomNoTf,this.onCopyRoomId,this),bindTapEvent_XY(this.exitBtn,this.onExit,this,!0,["PGP_fanhui1_png","PGP_fanhui_png"]),bindTapEvent_XY(this.readyBtnGrp,this.clickReady,this,!0),bindTapEvent_XY(this.chatBtn,this.onChatMe,this),bindTapEvent_XY(this.soundBtn,this.onSetting,this,!0,["PGP_yinliang1_png","PGP_yinliang1_png"]),bindTapEvent_XY(this.helpBtn,this.onReadMe,this,!0,["PGP_wenhao1_png","PGP_wenhao_png"]),bindTapEvent_XY(this.quxiaoTuoguanBtn,this.onCancelTuoguan,this,!0),bindTapEvent_XY(this.copyRoomInfoBtn,this.onCopyRoomId,this,!0,["copy_btn_1_png","copy_btn_0_png"]),this.ctrlUI.addEventListener(t.PGP_ControllPanel.E_GANG,this.onGang,this),this.ctrlUI.addEventListener(t.PGP_ControllPanel.E_TING,this.onTing,this),this.ctrlUI.addEventListener(t.PGP_ControllPanel.E_PASS,this.onPass,this),this.gangChoosePanel.addEventListener(t.PGP_GangChoosePanel.E_GANG,this.onChooseGang,this),this.touchHand.addEventListener("animationOk",this.callOver,this),ChatManager.setup(RES.getRes("chat_config_json"),[this.chatCtx0,this.chatCtx1,this.chatCtx2,this.chatCtx3],[1,1,2,2]);for(var e=0;3>=e;e++)this["paidun"+e].setIndex(e),this["playerHead_"+e].setIndex(e),this["playerReady"+e].setIndex(e),this["dapai"+e].setIndex(e),this["chipenggang"+e].setIndex(e),this["huapai"+e].setIndex(e),this["shoupai"+e].setIndex(e),this["hupai"+e].setIndex(e);this.infoUi.init()},i.prototype.onCopyRoomId=function(){var e=t.dataProxy.roomDetailInfo;if(e&&e.friends){var i=t.i18n("底分:")+coin2Str_XY(t.dataProxy.roomDetailInfo.basicChipConf)+"，"+t.i18n("奖马数:{0}",t.dataProxy.roomDetailInfo.horseNum);copyGameShareText_XY(GameIdEnum.PGP,t.dataProxy.centerConfig.area,i)}},i.prototype.onShare=function(){var e=t.dataProxy.roomDetailInfo;if(e&&e.friends){var i=t.i18n("底分：")+coin2Str_XY(t.dataProxy.roomDetailInfo.basicChipConf);ShareMenu.getInstance().show(GameIdEnum.PGP,t.dataProxy.centerConfig.area,i)}},i.prototype.onCopyTableId=function(){copyTextToClipboard_XY(this.tableIdTf.text,function(){Toast.show(t.i18n("复制牌局编号成功！"))},function(){})},i.prototype.onExit=function(){t.dataProxy.gameExited?t.sendNotification(t.PGPExitCommand.NAME):t.sendSocketMessage(t.PGPProtocol.TABLE_TRY_TO_LEAVE_C)},i.prototype.onAi=function(){if(t.dataProxy.roomDetailInfo&&2==t.dataProxy.roomDetailInfo.state){var e=t.dataProxy.findPlayerGameInfoByUid(Global.uid),i=e&&e.trusteeship;t.sendSocketMessage(t.PGPProtocol.PGP_TRUSTEESHIP_C,!i)}},i.prototype.onSetting=function(){var t=SoundManager.getBgMute()&&SoundManager.getEffectMute();SoundManager.setBgMute(!t),SoundManager.setEffectMute(!t),this.updateSoundState()},i.prototype.onChatMe=function(){ChatManager.showPanel()},i.prototype.onReadMe=function(){t.sendNotification(t.PGPReadmeMediator.SHOW)},i.prototype.clickReady=function(){t.sendSocketMessage(t.PGPProtocol.PGP_READY_C)},i.prototype.checkReady=function(){var e=t.dataProxy.roomDetailInfo;if(e){var i=e.state;if(-1==e.autoReady){var o=t.dataProxy.findPlayerGameInfoByUid(t.dataProxy.myUid);0==i&&o&&-1==o.ready?this.readyBtnGrp.visible=!0:this.readyBtnGrp.visible=!1}else this.readyBtnGrp.visible=!1}},i.prototype.onCancelTuoguan=function(){t.sendSocketMessage(t.PGPProtocol.PGP_TRUSTEESHIP_C,!1)},i.prototype.updateSoundState=function(){var t=SoundManager.getBgMute()&&SoundManager.getEffectMute();this.soundBtn.___switchSources=t?["PGP_jinyin1_png","PGP_jinyin_png"]:["PGP_yinliang1_png","PGP_yinliang_png"],this.soundBtn.source=this.soundBtn.___switchSources[0]},i.prototype.playHu=function(){this.huPanel.hide(),this.updateRoomInfo(),Tween$.removeTweens(this.waitingImage),remove_XY(this.waitingImage);t.dataProxy.roomDetailInfo;egret.clearTimeout(this.gameResultTimer),t.sendNotification(t.PGPResultMediator.SHOW)},i.prototype.updateAiState=function(){var e=t.dataProxy.roomDetailInfo,i=e?e.state:0,o=t.dataProxy.findPlayerGameInfoByUid(Global.uid),n=2==i&&o&&o.trusteeship;n&&!t.dataProxy.centerConfig.replayMode?this.addChild(this.tuoguanGrp):remove_XY(this.tuoguanGrp)},i.prototype.onTing=function(){this.handCtrl.setAsTingCtrl()},i.prototype.onPass=function(){this.handCtrl.cancelTingCtrl()},i.prototype.onGang=function(){for(var e=t.dataProxy.findPlayerGameInfoByUid(Global.uid),i=t.dataProxy.roomDetailInfo.actionable,o={},n=e.card.handCards,a=0,r=n.length;r>a;a++){var s=n[a];o[s]||(o[s]=0),o[s]++}s=e.card.currentCard,o[s]||(o[s]=0),o[s]++;var h=[];if(e.card.meldCards)for(var a=0,r=e.card.meldCards.length;r>a;a++){var l=e.card.meldCards[a];if(3==l.length&&l[0]==l[1]){var d=l[0];o[d]||(o[d]=0),o[d]+=3}}var c=-1;for(var P in o)if(o[P]>=4){if(t.dataProxy.roomDetailInfo.lastValidAction==t.Action.peng&&t.dataProxy.roomDetailInfo.lastOpUid==Global.uid&&e.card.meldCards&&e.card.meldCards.length>0){var u=e.card.meldCards[e.card.meldCards.length-1];u&&u.length>0&&(c=u[0])}if(void 0!=c&&c>=0&&int_XY(P)==c)continue;h.push(int_XY(P))}-1!=i.indexOf(t.Action.ming_gang)?(this.sendGongActionToServer(e.card.currentCard),remove_XY(this.ctrlUI)):1==h.length?(this.sendGongActionToServer(h[0]),remove_XY(this.ctrlUI)):(this.addChild(this.gangChoosePanel),this.gangChoosePanel.updateData(h))},i.prototype.onChooseGang=function(t){var e=t.data;this.sendGongActionToServer(e),remove_XY(this.ctrlUI),remove_XY(this.gangChoosePanel)},i.prototype.sendGongActionToServer=function(e){var i=t.dataProxy.roomDetailInfo.actionable;-1!=i.indexOf(t.Action.ming_gang)?(t.sendSocketMessage(t.PGPProtocol.MAHJONG_MING_GANG_C),remove_XY(this.gangChoosePanel)):-1!=i.indexOf(t.Action.bu_gang)?(t.sendSocketMessage(t.PGPProtocol.MAHJONG_JIA_GANG_C,e),remove_XY(this.gangChoosePanel)):-1!=i.indexOf(t.Action.an_gang)?(t.sendSocketMessage(t.PGPProtocol.MAHJONG_AN_GANG_C,e),remove_XY(this.gangChoosePanel)):t.warn("未找到可以杠的类型")},i.prototype.init=function(){this.effectCtrl||(this.effectCtrl=new t.PGP_EffectController([this.effect0,this.effect1,this.effect2,this.effect3],this.effectGrp));var e=new t.PGP_PlayerHandController(this.shoupai1);this.handCtrl=e,e.init(),this.menuBtn.init(),this.horsePanel.init(),this.touchHand.init(),e.addEventListener(t.PGP_PlayerHandController.E_SHOW_HU_PANEL,this.onShowHuPanel,this),e.addEventListener(t.PGP_PlayerHandController.E_HIDE_HU_PANEL,this.onHideHuPanel,this),e.addEventListener(t.PGP_PlayerHandController.E_UP_CARD,this.onUpCard,this),this.menuBtn.addEventListener("clickTing",this.showTingPanel,this),remove_XY(this.ctrlUI),remove_XY(this.gangChoosePanel),this.huPanel.hide(),this.copyRoomInfoBtn.visible=!1,this.readyBtnGrp.visible=!1,this.updateRoomInfo()
},i.prototype.onShowHuPanel=function(t){this.addChild(this.huPanel),tween_XY_alphaShow(this.huPanel),this.huPanel.updateData(t.data)},i.prototype.onHideHuPanel=function(){this.huPanel.hide()},i.prototype.onUpCard=function(t){var e=t.data;this.dapai0.updateUserSelectMajhong(e),this.dapai1.updateUserSelectMajhong(e),this.dapai2.updateUserSelectMajhong(e),this.dapai3.updateUserSelectMajhong(e)},i.prototype.showTingPanel=function(){var e=t.dataProxy.findPlayerGameInfoByUid(t.dataProxy.myUid);e&&e.card&&t.dataProxy.tempHuData&&this.handCtrl.dispatchEventWith(t.PGP_PlayerHandController.E_SHOW_HU_PANEL,!1,t.dataProxy.tempHuData)},i.prototype.refreshTingFlag=function(){this.menuBtn.updateData()},i.prototype.playEffectGuaFengOrXiaYu=function(t){0==t?this.playGuaFeng():1==t&&this.playXiaYu()},i.prototype.playGuaFeng=function(){this.guaFeng||(this.guaFeng=Global.buildArmature(GameIdEnum.PGP,"PGP_guafeng"),this.guaFeng.eventDispatcher.addDBEventListener(egret.Event.COMPLETE,this.onguafengComplete,this)),this.addChild(this.guaFeng.display),this.guaFeng.display.x=Global.stage.stageWidth/2,this.guaFeng.display.y=Global.stage.stageHeight/2,dragonBones.WorldClock.clock.add(this.guaFeng),this.guaFeng.animation.play("animation",1)},i.prototype.onguafengComplete=function(){dragonBones.WorldClock.clock.remove(this.guaFeng),this.guaFeng&&remove_XY(this.guaFeng.display)},i.prototype.playXiaYu=function(){this.xiaYu||(this.xiaYu=Global.buildArmature(GameIdEnum.PGP,"PGP_xiayu"),this.xiaYu.eventDispatcher.addDBEventListener(egret.Event.COMPLETE,this.onXiaYuComplete,this)),this.addChild(this.xiaYu.display),this.xiaYu.display.x=Global.stage.stageWidth/2,this.xiaYu.display.y=Global.stage.stageHeight/2,dragonBones.WorldClock.clock.add(this.xiaYu),this.xiaYu.animation.play("animation",1)},i.prototype.onXiaYuComplete=function(){dragonBones.WorldClock.clock.remove(this.xiaYu),this.xiaYu&&remove_XY(this.xiaYu.display)},i.prototype.showTotalOffset=function(e){if(null!=e){for(var i=0;i<e.length;i++){var o=t.dataProxy.findPlayerGameInfoByUid(e[i].uid);if(null!=o){var n=t.PGPPositionUtils.getUIPosByServerPos(o.position);if(0>n)return;o.coin=e[i].coin,this["offset"+n].setData(e[i].scoreOffset)}}this.updateRoomInfo()}},i.prototype.showHorse=function(){this.touchHand.setData()},i.prototype.callOver=function(){this.horsePanel.updateData(!0)},i.prototype.showDianPaoEffect=function(e){var i=e[0],o=t.PGPPositionUtils.getUIPosByServerPos(i);if(!(0>o)){var n=e[1];this["dapai"+o].playThunder(n,function(){}),this.effectCtrl.playDianpao(o),this["dapai"+o].updateData()}},i.prototype.showHuEffect=function(e){if(null!=e){var i=t.PGPPositionUtils.getUIPosByServerPos(e.position);0>i||(this["huapai"+i].updateData(),this["huapai"+i].playWinThunderMovie(),this["shoupai"+i].updateData(),this.effectCtrl.playAction(i,t.Action.hu),t.PGPSoundPlayer.hu(e.uid,!1))}},i.prototype.showZiMo=function(e){if(null!=e){var i=t.PGPPositionUtils.getUIPosByServerPos(e.position);0>i||(this["huapai"+i].updateData(),this["huapai"+i].playWinThunderMovie(),this["shoupai"+i].updateData(),this.effectCtrl.playZimo(i),t.PGPSoundPlayer.hu(e.uid,!0))}},i.prototype.showGangShangKaiHua=function(e){var i=t.PGPPositionUtils.getUIPosByServerPos(e);0>i||this.effectCtrl.playGangshanghua(i)},i.prototype.updateTurn=function(){var e=t.dataProxy.roomDetailInfo;e?e.state:0;this.gameTimer.updateData(),e&&-1!=e.turnPlayers.indexOf(Global.uid)?(this.shoupai1.updateData(),t.dataProxy.tempHuData=null,this.refreshTingFlag()):this.shoupai1.removeTingFlag();for(var i=0;4>i;i++)1!=i&&(this["shoupai"+i].updateData(),this["hupai"+i].updateData());this.ctrlUI.updateData(this),remove_XY(this.gangChoosePanel),this.updatePaidun(),this.handCtrl.updateData()},i.prototype.doAction=function(e,i,o){if(this.playActionEffect(e,i),this.updateRoomInfo(),i==t.Action.da_pai)if(e==Global.uid){var n=this.shoupai1.pai_6;this.dapai1.lastCardFlyFrom(Global.stage.stageWidth/2,Global.stage.stageHeight-200),this.handCtrl.lastUserCtrlDiscard==o&&-1!=this.handCtrl.lastUserMoCard&&this.shoupai1.playInsertCardMovie(this.handCtrl.lastUserMoCard),this.dapai0.updateUserSelectMajhong(-1),this.dapai1.updateUserSelectMajhong(-1),this.dapai2.updateUserSelectMajhong(-1),this.dapai3.updateUserSelectMajhong(-1)}else{var a=t.dataProxy.findPlayerGameInfoByUid(e);if(a){var r=t.PGPPositionUtils.getUIPosByServerPos(a.position);t.trace(r+" uiPos");var s,h,n=this["shoupai"+r].pai_13;s=this["shoupai"+r].x+n.x+n.width/2,h=this["shoupai"+r].y+n.y+n.height/2,this["dapai"+r].lastCardFlyFrom(s,h)}}},i.prototype.playActionEffect=function(e,i){var o=t.dataProxy.findPlayerGameInfoByUid(e);if(i==t.Action.chi||i==t.Action.peng||i==t.Action.ming_gang||i==t.Action.bu_gang||i==t.Action.an_gang||i==t.Action.ting){var n=t.PGPPositionUtils.getUIPosByServerPos(o.position);this.effectCtrl.playAction(n,i)}},i.prototype.gameStart=function(){this.allPaidun=[];t.dataProxy.roomDetailInfo;this.setupEmptyDesk(),this.playStartMovie()},i.prototype.someOneJoin=function(t){this["playerHead_"+t].updateData()},i.prototype.someOneLeave=function(t){this["playerHead_"+t].updateData()},i.prototype.playStartMovie=function(){this.startDb||(this.startDb=Global.buildArmature(GameIdEnum.PGP,"PGP_start"),this.startDb.eventDispatcher.addDBEventListener(egret.Event.COMPLETE,this.onStartDbComplete,this)),this.addChild(this.startDb.display),this.startDb.display.x=Global.stage.stageWidth/2,this.startDb.display.y=Global.stage.stageHeight/2,dragonBones.WorldClock.clock.add(this.startDb),this.startDb.animation.play("Animation1",1),t.PGPSoundPlayer.gameStart()},i.prototype.onStartDbComplete=function(){dragonBones.WorldClock.clock.remove(this.startDb),this.startDb&&remove_XY(this.startDb.display),this.gameTimer.playDiceMovie(this.playSendCardMovie.bind(this)),t.PGPSoundPlayer.dice()},i.prototype.playSendCardMovie=function(){var e=this,i=t.dataProxy.roomDetailInfo;this.tryBuildAllPaidun();for(var o=0,n=i.ascDraw;n>o;o++){var a=this.allPaidun[o];a&&(Tween$.removeTweens(a),a.alpha=1,Tween$.get(a).set({alpha:1}).wait(50*o+50).to({alpha:0},100).call(function(t){t.alpha=1,t.visible=!1},this,[a]))}this.shoupai0.updateData(),this.shoupai2.updateData(),this.shoupai3.updateData(),this.shoupai1.showMyDisorderWithFlower(function(){e.huapai0.updateData(),e.huapai1.updateData(),e.huapai2.updateData(),e.huapai3.updateData()},function(){e.updateRoomInfo()})},i.prototype.dispose=function(){this.menuBtn.dispose(),this.effectCtrl.hideAll();for(var e=0;4>e;e++)this["dapai"+e].dispose(),this["offset"+e].dispose(),this["chipenggang"+e].setupEmpty(),this["huapai"+e].dispose(),this["shoupai"+e].dispose(),this["hupai"+e].setupEmpty();this.startDb&&(dragonBones.WorldClock.clock.remove(this.startDb),remove_XY(this.startDb.display)),this.gangChoosePanel.dispose(),this.ctrlUI.dispose(),this.huPanel.dispose(),this.gameTimer.dispose(),clearTapEvent_XY(this.tableIdTf,this.onCopyTableId,this),clearTapEvent_XY(this.exitBtn,this.onExit),clearTapEvent_XY(this.soundBtn,this.onSetting),clearTapEvent_XY(this.helpBtn,this.onReadMe),clearTapEvent_XY(this.quxiaoTuoguanBtn,this.onCancelTuoguan),this.ctrlUI.removeEventListener(t.PGP_ControllPanel.E_GANG,this.onGang,this),this.ctrlUI.removeEventListener(t.PGP_ControllPanel.E_TING,this.onTing,this),this.ctrlUI.removeEventListener(t.PGP_ControllPanel.E_PASS,this.onPass,this),this.gangChoosePanel.removeEventListener(t.PGP_GangChoosePanel.E_GANG,this.onChooseGang,this),remove_XY(this.ctrlUI),remove_XY(this.gangChoosePanel),this.huPanel.hide(),this.paidun0.setAllReady(),this.paidun1.setAllReady(),this.paidun2.setAllReady(),this.paidun3.setAllReady(),this.allPaidun=[],t.dataProxy.tempHuData=null,this.removeChildren()},i}(BaseComponent);t.PGPGameScene=e,__reflect(e.prototype,"PGP.PGPGameScene")}(PGP||(PGP={}));var PGP;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initEvents=function(){bindTapEvent_XY(this.peng,this.onPeng,this,!0),bindTapEvent_XY(this.gang,this.onGang,this,!0),bindTapEvent_XY(this.hu,this.onHu,this,!0),bindTapEvent_XY(this.ting,this.onTing,this,!0),bindTapEvent_XY(this.pass,this.onPass,this,!0)},i.prototype.updateData=function(e){var i=t.dataProxy.roomDetailInfo,o=i?i.state:0,n=t.dataProxy.findPlayerGameInfoByUid(Global.uid);if(2==o&&n&&i.actionable&&-1!=i.turnPlayers.indexOf(Global.uid)){e.addChild(this);var a=(n.card.handCards,i.currentDiscard,i.actionable),r=-1!=a.indexOf(t.Action.chi),s=-1!=a.indexOf(t.Action.peng),h=-1!=a.indexOf(t.Action.ming_gang)||-1!=a.indexOf(t.Action.bu_gang)||-1!=a.indexOf(t.Action.an_gang),l=!1,d=-1!=a.indexOf(t.Action.hu),c=r||s||h||d||l;this.chi.visible=!1,this.peng.visible=!1,this.gang.visible=!1,this.hu.visible=!1,this.ting.visible=!1,this.pass.visible=!1;var P=120;r&&(this.chi.visible=!0,this.chi.x=P,P+=207),s&&(this.peng.visible=!0,this.peng.x=P,P+=207),h&&(this.gang.visible=!0,this.gang.x=P,P+=207),d&&(this.hu.visible=!0,this.hu.x=P,P+=207),l&&(this.ting.visible=!0,this.ting.x=P,P+=207),c&&(this.pass.visible=!0,this.pass.x=P,P+=125),P+=30,this.width=P}else remove_XY(this)},i.prototype.onPeng=function(){t.trace("我碰牌"),t.sendSocketMessage(t.PGPProtocol.MAHJONG_PENG_C),remove_XY(this)},i.prototype.onGang=function(){this.dispatchEventWith(i.E_GANG)},i.prototype.onTing=function(t){t.stopPropagation(),t.stopImmediatePropagation(),t.preventDefault(),this.dispatchEventWith(i.E_TING)},i.prototype.onHu=function(){t.sendSocketMessage(t.PGPProtocol.MAHJONG_HU_C),remove_XY(this)},i.prototype.dispose=function(){clearTapEvent_XY(this.peng,this.onPeng),clearTapEvent_XY(this.gang,this.onGang),clearTapEvent_XY(this.hu,this.onHu),clearTapEvent_XY(this.ting,this.onTing),clearTapEvent_XY(this.pass,this.onPass)},i.prototype.onPass=function(){t.dataProxy.findPlayerGameInfoByUid(Global.uid);this.dispatchEventWith(i.E_PASS),t.sendSocketMessage(t.PGPProtocol.MAHJONG_PASS_C),remove_XY(this)},i.E_GANG="E_GANG",i.E_TING="E_TING",i.E_PASS="E_PASS",i}(eui.Component);t.PGP_ControllPanel=e,__reflect(e.prototype,"PGP.PGP_ControllPanel")}(PGP||(PGP={}));var PGP;!function(t){var e=function(){function e(t,e){this.imgs=t,this.root=e;for(var i=0,o=t.length;o>i;i++){var n=t[i];n.touchEnabled=!1,remove_XY(n)}}return e.prototype.dispose=function(){this.imgs=null,this.root=null,this.tfs=null},e.prototype.hideAll=function(){for(var t=0,e=this.imgs.length;e>t;t++){var i=this.imgs[t];remove_XY(i)}},e.prototype.playDianpao=function(t){var e=this.imgs[t];e.source="PGP_btn_dianpao_png",this.play(e)},e.prototype.playZimo=function(t){var e=this.imgs[t];e.source="PGP_btn_zimo_png",this.play(e,9999999)},e.prototype.playGangshanghua=function(t){var e=this.imgs[t];e.source="PGP_btn_gangshanghua_png",this.play(e,9999999)},e.prototype.playAction=function(e,i){var o=this.imgs[e];i==t.Action.chi?o.source="PGP_btn_chi_png":i==t.Action.peng?o.source="PGP_btn_peng_png":i==t.Action.ming_gang||i==t.Action.bu_gang||i==t.Action.an_gang?o.source="PGP_btn_gang_png":i==t.Action.hu?o.source="PGP_btn_hu_png":i==t.Action.ting&&(o.source="PGP_btn_ting_png"),this.play(o,i)},e.prototype.play=function(e,i){void 0===i&&(i=-1),Tween$.removeTweens(e),this.root.addChild(e),e.scaleX=3,e.scaleY=3,e.alpha=1,i!=t.Action.hu&&9999999!=i?Tween$.get(e).to({scaleX:1,scaleY:1},300,Ease$.sineIn).wait(500).to({alpha:0},300).call(function(){remove_XY(e)},this):Tween$.get(e).to({scaleX:1,scaleY:1},300,Ease$.sineIn)},e}();t.PGP_EffectController=e,__reflect(e.prototype,"PGP.PGP_EffectController")}(PGP||(PGP={}));var PGP;!function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.onGifComplete=function(){this.point_0.visible=!0,this.point_1.visible=!0,this.gif.visible=!1,this.callback&&this.callback()},i.prototype.playDiceMovie=function(e){this.callback=e;var i=1,o=2;t.dataProxy.roomDetailInfo&&t.dataProxy.roomDetailInfo.dices&&(i=t.dataProxy.roomDetailInfo.dices[0],o=t.dataProxy.roomDetailInfo.dices[1]),this.point_0.visible=!1,this.point_1.visible=!1,this.gif.visible=!0,this.gifCtrl.gotoAndStop(0),this.gifCtrl.play(!1),this.point_0.source="PGP_sezi_value"+i+"_png",this.point_1.source="PGP_sezi_value"+o+"_png"},i.prototype.setTime=function(e){0>=e&&(e=0),this.leftTime=e;var i=t.dataProxy.roomDetailInfo,o=i?i.state:0;i&&(0==o?-1==i.autoReady?(this.leftTime>0?(this.readyTf.text=t.i18n("游戏即将开始:{0}",this.leftTime),this.readyImage.visible=!0):(this.readyTf.text="",this.readyImage.visible=!1),this.timeTf.text=""):(this.readyTf.text="",this.readyImage.visible=!1,this.timeTf.text=""):(1==o?this.timeTf.text="":this.timeTf.text=this.leftTime+"",this.readyTf.text="",this.readyImage.visible=!1),egret.clearInterval(this.timer),this.leftTime>0&&(this.timer=egret.setInterval(this.onTimer,this,1e3)))},i.prototype.onTimer=function(){this.leftTime--,this.leftTime<=0&&(this.leftTime=0,egret.clearInterval(this.timer)),4==this.leftTime&&t.PGPSoundPlayer.clock();var e=t.dataProxy.roomDetailInfo,i=e?e.state:0;e&&(0==i?-1==e.autoReady?(this.leftTime>0?(this.readyTf.text=t.i18n("游戏即将开始:{0}",this.leftTime),this.readyImage.visible=!0):(this.readyTf.text="",this.readyImage.visible=!1),this.timeTf.text=""):(this.readyTf.text="",this.readyImage.visible=!1,this.timeTf.text=""):this.timeTf.text=this.leftTime+"")},i.prototype.dispose=function(){egret.clearInterval(this.timer),Tween$.removeTweens(this.light_1),Tween$.removeTweens(this.light_3),Tween$.removeTweens(this.light_0),Tween$.removeTweens(this.light_2),this.gifCtrl&&this.gifCtrl.removeEventListener(egret.Event.COMPLETE,this.onGifComplete,this),this.gifCtrl.dispose(),this.callback=null},i.prototype.setupEmpty=function(){this.updateData(),this.gif.visible=!1,Tween$.removeTweens(this.light_1),Tween$.removeTweens(this.light_3),Tween$.removeTweens(this.light_0),Tween$.removeTweens(this.light_2),this.setTime(0),this.light_1.visible=!1,this.light_3.visible=!1,this.light_0.visible=!1,this.light_2.visible=!1,this.dir_1.visible=!1,this.dir_3.visible=!1,this.dir_0.visible=!1,this.dir_2.visible=!1,this.light_d_0.visible=!1,this.light_d_1.visible=!1,this.light_d_2.visible=!1,this.light_d_3.visible=!1,this.point_0.visible=!1,this.point_1.visible=!1,this.gifCtrl.gotoAndStop(0)},i.prototype.initEvents=function(){this.gifCtrl=new MovieclipController(this.gif,12,MovieclipController.makeResLoop("PGP_sezi_{0}_png",0,7)),this.gifCtrl.addEventListener(egret.Event.COMPLETE,this.onGifComplete,this),i18nEUI(GameIdEnum.PGP,this,[])},i.prototype.updateData=function(){var e=t.dataProxy.roomDetailInfo,i=e?e.state:0;if(e){this.gif.visible=!1,Tween$.removeTweens(this.light_0),Tween$.removeTweens(this.light_2),Tween$.removeTweens(this.light_1),Tween$.removeTweens(this.light_3),this.gifCtrl.gotoAndStop(0),this.setTime(0);var o=e.turnPlayers||[];if(0==i){0==i&&this.setTime(e.timeout),this.light_1.visible=!1,this.light_3.visible=!1,this.light_0.visible=!1,this.light_2.visible=!1,this.light_d_0.visible=!1,this.light_d_1.visible=!1,this.light_d_2.visible=!1,this.light_d_3.visible=!1,this.point_0.visible=!1,this.point_1.visible=!1;for(var n=0,a=4;a>n;n++){var r=t.PGPPositionUtils.getUIPosByServerPos(n),s=["PGP_east","PGP_south","PGP_west","PGP_north"][n],h=t.dataProxy.findPlayerGameInfoBySeat(n);h&&-1!=o.indexOf(h.uid)&&(s+="_light"),this["dir_"+r].visible=!1}}else{this.point_0.visible=!1,this.point_1.visible=!1,this.point_0.source="PGP_sezi_value"+e.dices[0]+"_png",this.point_1.source="PGP_sezi_value"+e.dices[1]+"_png";var l=t.dataProxy.getDealerPlayer();if(!l)return;var d=-1,c=-1;l&&(d=l.position,c=t.PGPPositionUtils.getUIPosByServerPos(d));for(var P=[{keyIndex:0,value:"PGP_east"},{keyIndex:1,value:"PGP_south"},{keyIndex:2,value:"PGP_west"},{keyIndex:3,value:"PGP_north"}],u=0,p=0;4>p;p++)u=c+p,u>=4&&(u=0),P[p].keyIndex=u;for(var n=0,a=4;a>n;n++){var r=t.PGPPositionUtils.getUIPosByServerPos(n),h=t.dataProxy.findPlayerGameInfoBySeat(n);h&&-1!=o.indexOf(h.uid)?(this["light_"+r].visible=!0,this["light_d_"+r].visible=!0):(this["light_"+r].visible=!1,this["light_d_"+r].visible=!1),this["dir_"+r].visible=!0;var f=r-c,_="";h&&-1!=o.indexOf(h.uid)&&(_+="_light"),_+="_png",0>f?this["dir_"+r].source=P[f+4].value+_:0==f?this["dir_"+r].source=P[f].value+_:this["dir_"+r].source=P[f].value+_}2==i&&this.setTime(e.timeout)}}},i}(eui.Component);t.PGP_GameTimer=e,__reflect(e.prototype,"PGP.PGP_GameTimer")}(PGP||(PGP={}));var PGP;!function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initEvents=function(){bindTapEvent_XY(this.grp0,this.onChoose,this),bindTapEvent_XY(this.grp1,this.onChoose,this),bindTapEvent_XY(this.grp2,this.onChoose,this)},e.prototype.onChoose=function(t){for(var i=0,o=0,n=3;n>o;o++)if(t.currentTarget==this["grp"+o]){i=o;break}this.dispatchEventWith(e.E_GANG,!1,this.cards[i])},e.prototype.dispose=function(){clearTapEvent_XY(this.grp0,this.onChoose,this),clearTapEvent_XY(this.grp1,this.onChoose,this),clearTapEvent_XY(this.grp2,this.onChoose,this),this.cards=null},e.prototype.updateData=function(t){this.cards=t;for(var e=40,i=30,o=0,n=3;n>o;o++){var a=t[o],r=this["grp"+o];if(void 0!=a){for(var s=0,h=4;h>s;s++){var l=a,d=this["card"+(4*o+s)];d.setCard(l)}this.addChild(r),r.x=e,e+=r.width+i}else remove_XY(r)}this.width=e},e.E_GANG="E_GANG",e}(eui.Component);t.PGP_GangChoosePanel=e,__reflect(e.prototype,"PGP.PGP_GangChoosePanel")}(PGP||(PGP={}));var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var PGP;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return bindEuiCreateOkEventOnce_XY(e,e.onCreate,e),e}return __extends(e,t),e.prototype.onCreate=function(){this.headImg.mask=this.bg},e.prototype.setHead=function(t){this.headImg.source=toAvatarSource_XY(t)||"PGP_head_png"},e}(eui.Component);t.PGP_Head=e,__reflect(e.prototype,"PGP.PGP_Head")}(PGP||(PGP={}));var PGP;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.skinName="PGP_HuItemSkin",t}return __extends(i,e),i.prototype.init=function(e,i,o){i18nEUI(GameIdEnum.PGP,this,[]),this.card.setCard(e);var n="<font color='#C9180C'>"+o+"</font>"+t.i18n("张");setHtmlText(this.tf,n)},i}(eui.Component);t.PGP_HuItem=e,__reflect(e.prototype,"PGP.PGP_HuItem")}(PGP||(PGP={}));var PGP;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.showTimeOut=0,t.items=[],t.touchEnabled=!1,t.touchChildren=!1,t}return __extends(i,e),i.prototype.initEvents=function(){i18nEUI(GameIdEnum.PGP,this,[this.tf]),bindTapEvent_XY(Global.stage,this.onClose,this,!1,null,!1,!1)},i.prototype.onClose=function(){remove_XY(this)},i.prototype.dispose=function(){clearTapEvent_XY(Global.stage,this.onClose,this)},i.prototype.hide=function(){egret.clearTimeout(this.showTimeOut),remove_XY(this)},i.prototype.updateData=function(e){var i=this;egret.clearTimeout(this.showTimeOut);for(var o=2*this.huImg.x+this.huImg.width,n=this.huImg.y,a=0,r=this.items.length;r>a;a++)remove_XY(this.items[a]);this.huImg.visible=!0,this.tf.visible=!0,this.allHuImg.visible=!1;for(var s,h,l=6,d=0,c=0,P=0,a=0,r=e.winCards.length;r>a;a++){var u=e.winCards[a],p=e.winCount[a],f=e.winFactors[a],_=this.items[a];_||(_=this.items[a]=new t.PGP_HuItem),s=_.width,h=_.height,_.x=o+(s+40*.695)*int_XY(a%l),_.y=n+(h+30*.695)*int_XY(a/l),d=Math.max(d,_.x),c=Math.max(c,_.y),_.init(u.cardID,f,p),P+=p,this.addChild(_)}this.width=d+s+this.huImg.x,this.height=c+h+n;var y="("+t.i18n("共")+"<font color='#C9180C'>"+P+"</font>"+t.i18n("张")+")";setHtmlText(this.tf,y),this.showTimeOut=egret.setTimeout(function(){i.onClose()},this,3e3)},i}(eui.Component);t.PGP_HuPanel=e,__reflect(e.prototype,"PGP.PGP_HuPanel")}(PGP||(PGP={}));var PGP;!function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.init=function(){i18nEUI(GameIdEnum.PGP,this,[this.difenTf,this.tf_0_i18n,this.tf_1_i18n])},i.prototype.setData=function(){var e=t.dataProxy.roomDetailInfo;if(e){var i=t.dataProxy.findPlayerGameInfoByUid(t.dataProxy.myUid);null!=i&&(this.money.text=coin2Str_XY(i.coin),this.difenTf.text=this.difenTf.text=t.i18n("底分:")+(coin2Str_XY(.5*e.basicChipConf)+"/"+coin2Str_XY(e.basicChipConf)),this.horseNum.text=t.i18n("奖马数:{0}",t.dataProxy.roomDetailInfo.horseNum),this.updateCardNum())}},i.prototype.updateCardNum=function(){var e=t.dataProxy.roomDetailInfo;e&&(this.leftCardsTf.text=this.leftCardsTf.text=0==e.state?"136":e.remaining+"")},i}(eui.Component);t.PGP_InfoUI=e,__reflect(e.prototype,"PGP.PGP_InfoUI")}(PGP||(PGP={}));var PGP;!function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.init=function(){bindTapEvent_XY(this.image_ting,this.clickTing,this)},i.prototype.setupEmpty=function(){this.image_ting.visible=!1},i.prototype.clickTing=function(t){t.stopPropagation(),this.dispatchEvent(new egret.Event("clickTing"))},i.prototype.updateData=function(){var e=t.dataProxy.roomDetailInfo,i=e?e.state:0;2==i?e&&-1!=e.turnPlayers.indexOf(Global.uid)?this.image_ting.visible=!1:this.image_ting.visible=null!=t.dataProxy.tempHuData:this.image_ting.visible=!1},i.prototype.dispose=function(){clearTapEvent_XY(this.image_ting,this.clickTing,this)},i}(eui.Component);t.PGP_Menu=e,__reflect(e.prototype,"PGP.PGP_Menu")}(PGP||(PGP={}));var PGP;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.offsetX=0,t.offsetY=0,t}return __extends(i,e),i.prototype.setupEmpty=function(){egret.Tween.removeTweens(this.scoreInfo),this.offsetX=this.scoreInfo.x,this.offsetY=this.scoreInfo.y,this.visible=!1},i.prototype.setData=function(e){if(this.visible=!0,t.trace(e+"  漂粉"),e>0)this.scoreInfo.font="PGP_win_fnt",this.scoreInfo.text="+ "+coin2Str_XY(e);else{this.scoreInfo.font="PGP_lose_fnt";var i=Math.abs(e);this.scoreInfo.text="-"+coin2Str_XY(i)}this.scoreInfo.alpha=0,egret.Tween.removeTweens(this.scoreInfo),egret.Tween.get(this.scoreInfo).to({y:this.offsetY+30,alpha:1},500).call(this.passComplete,this)},i.prototype.passComplete=function(){var t=this;egret.Tween.removeTweens(this.scoreInfo),egret.Tween.get(this.scoreInfo).wait(1e3).to({alpha:0},500).call(function(){t.scoreInfo.y=t.offsetY,egret.Tween.removeTweens(t.scoreInfo),t.visible=!1},this)},i.prototype.dispose=function(){egret.Tween.removeTweens(this.scoreInfo)},i}(eui.Component);t.PGP_Offset=e,__reflect(e.prototype,"PGP.PGP_Offset")}(PGP||(PGP={}));var PGP;!function(t){var e=function(e){function i(t){var i=e.call(this)||this;return i.pool=[],i.lastUserCtrlDiscard=-1,i.lastUserMoCard=-1,i.handCard=t,i}return __extends(i,e),i.prototype.init=function(){this.inited||(this.inited=!0,this.initEvents())},i.prototype.initEvents=function(){this.taps=[];for(var e=0,i=14;i>e;e++){var o=this.handCard["pai_"+e];o.index=e,this.taps[e]=new t.PGPMahjongUserTap(o,this.onSendCard,this,this.onFocusIn,this.onFocusOut)}},i.prototype.onCancelTingCtrl=function(){if(this.tingCtrlMode){this.tingCtrlMode=!1;for(var t=0,e=14;e>t;t++){var i=this.handCard["pai_"+t],o=this.taps[t];i.setDark(!1),o.setEnable(!0)}}},i.prototype.cancelTingCtrl=function(){this.onCancelTingCtrl()},i.prototype.setAsTingCtrl=function(){if(this.tingCtrlMode)return void this.onCancelTingCtrl();this.tingCtrlMode=!0;for(var e=0,i=14;i>e;e++){var o=this.handCard["pai_"+e];if(o.stage&&o.visible){var n=t.dataProxy.findCheckResult(o.cardId),a=this.taps[e];n?(o.setDark(!1),a.setEnable(!0)):(o.setDark(!0),a.setEnable(!1))}}},i.prototype.updateData=function(){var e=t.dataProxy.roomDetailInfo,i=e?e.state:0,o=t.dataProxy.findPlayerGameInfoByUid(Global.uid);this.tingCtrlMode=!1;var n=2==i&&-1!=e.turnPlayers.indexOf(Global.uid);if(n&&(this.lastUserCtrlDiscard=-1,this.lastUserMoCard=-1),this.taps)for(var a=0,r=this.taps.length;r>a;a++){var s=this.taps[a];s.setEnable(n);var h=this.handCard["pai_"+a];o&&h.setDark(!1)}},i.prototype.onSendCard=function(e){this.tingCtrlMode?(t.trace("我听牌",e.cardId),t.sendSocketMessage(t.PGPProtocol.MAHJONG_TING_C,e.cardId)):(t.trace("我打牌",e.cardId),t.sendSocketMessage(t.PGPProtocol.MAHJONG_DA_C,e.cardId),13!=e.index&&(this.lastUserCtrlDiscard=e.cardId,this.handCard.pai_13.stage&&this.handCard.pai_13.visible?this.lastUserMoCard=this.handCard.pai_13.cardId:this.lastUserMoCard=-1))},i.prototype.onFocusIn=function(e){var o=this,n=t.dataProxy.findCheckResult(e.cardId);n?egret.setTimeout(function(){o.dispatchEventWith(i.E_SHOW_HU_PANEL,!1,n)},this,1):this.dispatchEventWith(i.E_HIDE_HU_PANEL),t.PGPSoundPlayer.chooseCard(),this.dispatchEventWith(i.E_UP_CARD,!1,e.cardId)},i.prototype.onFocusOut=function(){this.dispatchEventWith(i.E_HIDE_HU_PANEL),this.dispatchEventWith(i.E_UP_CARD,!1,-1)},i.E_SHOW_HU_PANEL="E_SHOW_HU_PANEL",i.E_HIDE_HU_PANEL="E_HIDE_HU_PANEL",i.E_UP_CARD="E_UP_CARD",i.CHANGE_CARD_OVER="CHANGE_CARD_OVER",i}(egret.EventDispatcher);t.PGP_PlayerHandController=e,__reflect(e.prototype,"PGP.PGP_PlayerHandController")}(PGP||(PGP={}));var PGP;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.touchEnabled=!1,t.touchChildren=!1,t}return __extends(i,e),i.prototype.setIndex=function(t){this.index=t},i.prototype.updateData=function(){var e=t.dataProxy.roomDetailInfo,i=(e?e.state:0,t.dataProxy.findPlayerGameInfoByUISeat(this.index));i?(this.visible=!0,t.dataProxy.roomDetailInfo&&1==t.dataProxy.roomDetailInfo.antiCheatConf?0==t.dataProxy.roomDetailInfo.state?i.uid==Global.uid||t.dataProxy.roomDetailInfo.friends?(this.head.setHead(i.avatar),this.coinTf&&(this.coinTf.text=coin2Str_XY(i.coin)),this.nickTf.text=substrNick_XY(i.name)):(this.head.headImg.source="tAvatarnull_png",this.coinTf&&(this.coinTf.text="--"),this.nickTf.text=copyChar_XY("*",6)):(this.head.setHead(i.avatar),this.nickTf.text=substrNick_XY(i.name),this.coinTf&&(this.coinTf.text=coin2Str_XY(i.coin))):(this.head.setHead(i.avatar),this.nickTf.text=substrNick_XY(i.name),i.uid==t.dataProxy.myUid||(this.coinTf.text=coin2Str_XY(i.coin))),this.dealer.visible=i.dealer):this.visible=!1},i}(eui.Component);t.PGP_PlayerHead=e,__reflect(e.prototype,"PGP.PGP_PlayerHead")}(PGP||(PGP={}));var PGP;!function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.setIndex=function(t){this.index=t},i.prototype.init=function(){this.visible=!1},i.prototype.updateData=function(){var e=t.dataProxy.roomDetailInfo,i=e?e.state:0,o=t.dataProxy.findPlayerGameInfoByUISeat(this.index);0==i&&o?this.visible=1==o.ready:this.visible=!1},i}(eui.Component);t.PGP_PlayerReady=e,__reflect(e.prototype,"PGP.PGP_PlayerReady")}(PGP||(PGP={}));var PGP;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.horse_cards_pos=[],t.positionArr=[],t}return __extends(i,e),i.prototype.init=function(){this.horse_cards_pos.length=0;var t=[27,18,22,26,9,13,17,0,4,8],e=[28,19,23,10,14,1,5,31,32,33],i=[29,20,24,11,15,2,6,31,32,33],o=[30,21,25,12,16,3,7,31,32,33];this.horse_cards_pos.push(t),this.horse_cards_pos.push(e),this.horse_cards_pos.push(i),this.horse_cards_pos.push(o);for(var n=0;5>n;n++){var a=this["horseCard"+n],r=new egret.Point(a.x,a.y);this.positionArr.push(r)}this.visible=!1,this.horse||(this.horse=Global.buildArmature(GameIdEnum.PGP,"PGP_win_horse"),this.horse.eventDispatcher.addDBEventListener(egret.Event.COMPLETE,this.onXiaYuComplete,this))},i.prototype.onXiaYuComplete=function(){dragonBones.WorldClock.clock.remove(this.horse),this.horse&&remove_XY(this.horse.display)},i.prototype.updateData=function(e){void 0===e&&(e=!1);var i=t.dataProxy.roomDetailInfo,o=i?i.state:0;3==o?(this.visible=!0,this.updateDataUI(e)):this.visible=!1},i.prototype.playHorse=function(){this.horse&&(this.addChild(this.horse.display),this.horse.display.x=Global.stage.stageWidth/2,this.horse.display.y=Global.stage.stageHeight/2,dragonBones.WorldClock.clock.add(this.horse),this.horse.animation.play("animation",1))},i.prototype.updateDataUI=function(e){this.conCon.removeChildren();var i=null;i=t.dataProxy.roomDetailInfo.horse,this.posInfoTf.text="";var o=t.dataProxy.checkHuPlayer(),n=-1;if(o){var a=o.position,r=t.dataProxy.getDealerPlayer(),s=r.position;switch(n=t.dataProxy.getPositionByDealer(a,s)){case t.PGPPositionUtils.DONG:this.posInfoTf.text=t.i18n("东位:");break;case t.PGPPositionUtils.NAN:this.posInfoTf.text=t.i18n("南位:");break;case t.PGPPositionUtils.XI:this.posInfoTf.text=t.i18n("西位:");break;case t.PGPPositionUtils.BEI:this.posInfoTf.text=t.i18n("北位:")}for(var h=0;10>h;h++){var l=this.horse_cards_pos[n],d=this["hand"+h];h<l.length?(d.visible=!0,d.setCard(l[h])):d.visible=!1}}else for(var h=0;10>h;h++){var d=this["hand"+h];d.visible=!1}if(i){var c=i.uid,P=t.dataProxy.findPlayerGameInfoByUid(c);this.info0.text=P.name+" "+t.i18n("开始抓马");var u="",p=!1;if(i.horseType&&i.horseType.length>0)for(var h=0;h<i.horseType.length;h++){var f=i.horseType[h];1==f?(u+=t.i18n("位置中马"),p=!0):2==f&&(u+=t.i18n("未中马"))}p&&(this.playHorse(),t.PGPSoundPlayer.playHorse()),this.info1.text=t.i18n("中马类型:{0}",u),this.info2.text=t.i18n("获得马数:x{0}",i.horseNum);for(var _=i.horseCard.length,h=0;_>h;h++){var y=this["horseCard"+h];_>h&&(y.setCard(i.horseCard[h],e),this.conCon.addChild(y),y.x=this.positionArr[h].x,y.y=this.positionArr[h].y)}}},i}(eui.Component);t.PGP_ShowHorse=e,__reflect(e.prototype,"PGP.PGP_ShowHorse")}(PGP||(PGP={}));var PGP;!function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.init=function(){this.visible=!1,this.finger1.anchorOffsetX=64,this.finger1.anchorOffsetY=172},i.prototype.setData=function(){var e=t.dataProxy.roomDetailInfo.horse,i=[];e&&e.horseCard.length>0?(i=e.horseCard.slice(0,e.horseCard.length),this.visible=!0,this.doRender(i)):(this.visible=!1,this.dispatchEvent(new egret.Event("animationOk")))},i.prototype.doRender=function(t){var e=this;if(t.length<=0)this.visible=!1,this.dispatchEvent(new egret.Event("animationOk"));else{egret.Tween.removeTweens(this.finger1),this.finger1.rotation=0;var i=t.shift();this.handUI.init(),this.handUI.setCard(i),egret.Tween.get(this.finger1).to({rotation:28},1e3).wait(500).call(function(){e.doRender(t)})}},i}(eui.Component);t.PGP_TouchCard=e,__reflect(e.prototype,"PGP.PGP_TouchCard")}(PGP||(PGP={}));var PGP;!function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.setIndex=function(t){this.index=t},i.prototype.setupEmpty=function(){this.visible=!1},i.prototype.updateData=function(e){void 0===e&&(e=!1);var i=t.dataProxy.roomDetailInfo,o=i?i.state:0,n=t.dataProxy.findPlayerGameInfoByUISeat(this.index);if(e&&(n=t.dataProxy.findPlayerGameInfoByUid(t.dataProxy.roomDetailInfo.winner)),2>o||!n)this.visible=!1;else{this.visible=!0;for(var a=0,r=4;r>a;a++){var s=n.card.meldCards[a],h=this["chi_"+a];s?(h.visible=!0,h.setMelds(s,this.index)):h.visible=!1}}},i}(eui.Component);t.PGP_Chipenggang=e,__reflect(e.prototype,"PGP.PGP_Chipenggang")}(PGP||(PGP={}));var PGP;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.userSelectedCardId=-1,t}return __extends(i,e),i.prototype.setIndex=function(t){this.index=t,this.da_0.init(),this.da_1.init(),this.da_2.init()},i.prototype.setupEmpty=function(){this.visible=!1,this.userSelectedCardId=-1},i.prototype.playThunder=function(t,e){Tween$.removeTweens(this.focusImg),this.focusImg.visible=!1;for(var i,o,n=this.allBgs.length-1;n>=0&&null==i;n--){var a=this.allBgs[n],r=this.allPais[n];a.visible&&(i=a,o=r,this.huBg=i,this.huPai=r)}return null==i?void e():(this.callback=e,this.thunderDb||(this.thunderDb=Global.buildArmature(GameIdEnum.ZJH,"PGP_dianpao"),this.thunderDb.eventDispatcher.addDBEventListener(egret.Event.COMPLETE,this.onthunderDbComplete,this)),i.parent.addChild(this.thunderDb.display),this.thunderDb.display.x=i.x+i.width/2,this.thunderDb.display.y=i.y+i.height/2,dragonBones.WorldClock.clock.add(this.thunderDb),void this.thunderDb.animation.play("Animation1",1))
},i.prototype.onthunderDbComplete=function(){dragonBones.WorldClock.clock.remove(this.thunderDb),this.thunderDb&&remove_XY(this.thunderDb.display),this.huBg&&(this.huBg.visible=!1),this.huPai&&(this.huPai.visible=!1),this.callback&&this.callback()},i.prototype.lastCardFlyFrom=function(t,e){for(var i,o,n=this.allBgs.length-1;n>=0&&null==i;n--){var a=this.allBgs[n],r=this.allPais[n];a.visible&&(i=a,o=r)}if(null!=i){BornProperty.resetToBornProperty(i),BornProperty.resetToBornProperty(o),o.parent.globalToLocal(t,e,__point_XY),Tween$.removeTweens(i),Tween$.removeTweens(o);var s=BornProperty.getBornPropertyOf(o),h={x:__point_XY.x,y:__point_XY.y,scaleX:s.scaleX,scaleY:s.scaleY};BornProperty.tweenFrom(o,h,300,100);var l=BornProperty.getBornPropertyOf(i),d={x:__point_XY.x+(l.x-s.x),y:__point_XY.y+(l.y-s.y),scaleX:l.scaleX,scaleY:l.scaleY};BornProperty.tweenFrom(i,d,300,100)}},i.prototype.updateUserSelectMajhong=function(t){void 0===t&&(t=-1),this.userSelectedCardId=t,this.updateData()},i.prototype.updateData=function(){var e=t.dataProxy.roomDetailInfo,i=e?e.state:0,o=t.dataProxy.findPlayerGameInfoByUISeat(this.index);if(Tween$.removeTweens(this.focusImg),2>i||!o)this.visible=!1;else{if(this.visible=!0,!this.allBgs){this.allBgs=[],this.allPais=[];for(var n=0,a=3;a>n;n++){var r=this["da_"+n];this.allBgs=this.allBgs.concat(r.getAllBgs()),this.allPais=this.allPais.concat(r.getAllPais())}}for(var s,n=0,a=this.allBgs.length;a>n;n++){var h,l=this.allBgs[n],d=this.allPais[n];if(o.card.discards&&o.card.discards.length>0&&(h=o.card.discards[n]),void 0!=h){if(l.visible=!0,d.visible=!0,d&&d.numChildren>0){var c=d.getChildAt(0);c&&(c.source=t.PGPStringUtils.getArtCardRes(h))}s=l,-1!=this.userSelectedCardId&&h==this.userSelectedCardId?l.filters=[Filters.littleDark]:l.filters=[],BornProperty.resetToBornProperty(l),BornProperty.resetToBornProperty(d)}else l.visible=!1,d.visible=!1}this.focusImg.visible=!1,o.uid==e.lastDiscardUid&&s&&-1!=e.currentDiscard&&(this.focusImg.visible=!0,s.parent.localToGlobal(s.x+s.width/2,s.y+10,__point_XY),this.globalToLocal(__point_XY.x,__point_XY.y,__point_XY),this.focusImg.x=__point_XY.x,this.focusImg.y=__point_XY.y,Tween$.get(this.focusImg,{loop:!0}).to({y:__point_XY.y-10},500,Ease$.sineInOut).to({y:__point_XY.y},500,Ease$.sineInOut))}},i.prototype.dispose=function(){this.thunderDb&&(dragonBones.WorldClock.clock.remove(this.thunderDb),this.thunderDb&&remove_XY(this.thunderDb.display)),this.callback=null,Tween$.removeTweens(this.focusImg)},i}(eui.Component);t.PGP_Dapai=e,__reflect(e.prototype,"PGP.PGP_Dapai")}(PGP||(PGP={}));var PGP;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.huCards=[],t.huaArr=[],t}return __extends(i,e),i.prototype.setIndex=function(t){this.index=t},i.prototype.setupEmpty=function(){this.visible=!1,this.huCards=[]},i.prototype.dispose=function(){this.thunderDb&&(dragonBones.WorldClock.clock.remove(this.thunderDb),this.thunderDb&&remove_XY(this.thunderDb.display))},i.prototype.playWinThunderMovie=function(){this.thunderDb||(this.thunderDb=Global.buildArmature(GameIdEnum.PGP,"PGP_hupai_guangxiao"),this.thunderDb.eventDispatcher.addDBEventListener(egret.Event.COMPLETE,this.onthunderDbComplete,this)),this.addChild(this.thunderDb.display),this.thunderDb.display.x=this.hua_0.x,this.thunderDb.display.y=this.hua_0.y,dragonBones.WorldClock.clock.add(this.thunderDb),this.thunderDb.animation.play("Animation1",1)},i.prototype.onthunderDbComplete=function(){dragonBones.WorldClock.clock.remove(this.thunderDb),this.thunderDb&&remove_XY(this.thunderDb.display)},i.prototype.updateData=function(){var e=t.dataProxy.roomDetailInfo,i=e?e.state:0,o=t.dataProxy.findPlayerGameInfoByUISeat(this.index);if(0!=i&&o){if(i>=2&&o.huCards&&o.huCards.length>0){var n=o.huCards[0];if(-1!=n){this.visible=!0;for(var a=0;9>a;a++){var r=this["hua_"+a];0==a?(r.visible=!0,r.setCard(n)):r.visible=!1}}}}else this.visible=!1},i}(eui.Component);t.PGP_Huapai=e,__reflect(e.prototype,"PGP.PGP_Huapai")}(PGP||(PGP={}));var PGP;!function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.setIndex=function(t){this.index=t},i.prototype.setupEmpty=function(){this.visible=!1},i.prototype.updateData=function(){var e=t.dataProxy.roomDetailInfo,i=e?e.state:0,o=t.dataProxy.findPlayerGameInfoByUISeat(this.index),n=!1;if(t.dataProxy.centerConfig.replayMode&&1!=this.index&&!t.dataProxy.centerConfig.replayHidePoke&&(n=!0),(i>2||n)&&o){this.visible=!0;for(var a=13-o.card.handCards.length,r=0,s=13;s>r;r++){var h=this["pai_"+r],l=this["bg_"+r];h.visible=r>=a,l.visible=r>=a,h.visible&&(h.source=t.PGPStringUtils.getArtCardRes(o.card.handCards[r-a]))}1!=this.index&&(this.pai_13.visible=!1,this.bg_13.visible=!1)}else this.visible=!1},i}(eui.Component);t.PGP_Hupai=e,__reflect(e.prototype,"PGP.PGP_Hupai")}(PGP||(PGP={}));var PGP;!function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.setIndex=function(t){this.uiIndex=t},e.prototype.setAllReady=function(){for(var t=0,e=34;e>t;t++){var i=this["pai_"+t];i&&(i.visible=!0,Tween$.removeTweens(i),i.alpha=1)}},e.prototype.getAllPaiDun=function(){if(!this.allArr){this.allArr=[];for(var t=0,e=34;e>t;t++)this["pai_"+t]&&(this.allArr[t]=this["pai_"+t])}return this.allArr},e}(eui.Component);t.PGP_Paidun=e,__reflect(e.prototype,"PGP.PGP_Paidun")}(PGP||(PGP={}));var PGP;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.timer=0,t.uiArr=[],t}return __extends(i,e),i.prototype.setIndex=function(t){this.index=t,this.cardY=this.pai_0.y,this.bornX=[],this.uiArr.length=0;for(var e=0,i=14;i>e;e++)this.bornX[e]=this["pai_"+e].x,this.uiArr.push(this["pai_"+e])},i.prototype.setupEmpty=function(){if(clearTimeout(this.timer),this.visible=!1,this.cardY=this.pai_0.y,1==this.index)for(var t=0,e=14;e>t;t++){var i=this["pai_"+t];i.setDark(!1)}},i.prototype.dispose=function(){clearTimeout(this.timer)},i.prototype.updateData=function(){clearTimeout(this.timer),1==this.index?this.updateDataAsSelf():this.updateDataAsOther()},i.prototype.removeTingFlag=function(){for(var t=0,e=13;e>t;t++){var i=this["pai_"+t];i.hideTing()}},i.prototype.playInsertCardMovie=function(t){for(var e=0,i=13;i>e;e++){var o=this["pai_"+e];if(o.stage&&o.visible&&o.cardId==t)return Tween$.removeTweens(o),void Tween$.get(o).set({x:this.bornX[13],y:this.cardY}).wait(50).to({x:this.bornX[13],y:this.cardY-130},100).wait(50).to({x:this.bornX[e],y:this.cardY-130},300).wait(50).to({x:this.bornX[e],y:this.cardY},100)}},i.prototype.showMyDisorderWithFlower=function(e,i){var o=this;this.updateDataAsSelf(),this.pai_13.visible=!1;var n=t.dataProxy.findPlayerGameInfoByUid(Global.uid);if(!n)return this.updateDataAsSelf(),void i();var a=n.card.handCards.concat();a=shuffleArray_XY(a);for(var r=0,s=13;s>r;r++){var h=this["pai_"+r];h.setCard(a[r]),h.alpha=0,Tween$.removeTweens(h),Tween$.get(h).set({alpha:0,y:this.cardY-30}).wait(100*r+100).to({alpha:1,y:this.cardY},200)}clearTimeout(this.timer),this.timer=egret.setTimeout(function(){for(var t=0,e=13;e>t;t++){var n=o["pai_"+t];n.setCard(a[t])}o.timer=egret.setTimeout(function(){o.updateDataAsSelf(),i()},o,300)},this,2e3)},i.prototype.updateDataAsSelf=function(e){void 0===e&&(e=!1);var i,o=t.dataProxy.roomDetailInfo,n=o?o.state:0,a=t.dataProxy.findPlayerGameInfoByUid(Global.uid);if(a&&(i=a.card),e){var r=t.dataProxy.findPlayerGameInfoByUid(t.dataProxy.roomDetailInfo.winner);r&&(i=r.card)}if((1==n||2==n)&&i&&!e||e){this.visible=!0;var s=13-i.handCards.length,h=o&&o.turnPlayers&&o.actionable&&-1!=o.turnPlayers.indexOf(Global.uid)&&-1!=o.actionable.indexOf(t.Action.da_pai)&&-1==i.currentCard;h&&s++;for(var l=0,d=13;d>l;l++){var c=this["pai_"+l];if(c.visible=l>=s,c.alpha=1,c.y=this.cardY,c.x=this.bornX[l],Tween$.removeTweens(c),c.visible){var P=i.handCards[l-s];if(c.setCard(P),e)c.hideTing();else{var u=t.dataProxy.findCheckResult(c.cardId);u&&2==n?c.showTing():c.hideTing()}}}var p=i.currentCard;if(e&&a.huCards.length>0&&(p=a.huCards[0]),h&&(p=i.handCards[i.handCards.length-1]),-1!=p)if(this.pai_13.setCard(p),this.pai_13.alpha=1,this.pai_13.y=this.cardY,Tween$.removeTweens(this.pai_13),e)this.pai_13.hideTing();else{var u=t.dataProxy.findCheckResult(this.pai_13.cardId);u?this.pai_13.showTing():this.pai_13.hideTing()}a.isHu&&a.isSelfDrawn?this.pai_13.visible=!1:this.pai_13.visible=-1!=p}else this.visible=!1},i.prototype.updateDataAsOther=function(){var e=t.dataProxy.roomDetailInfo,i=e?e.state:0,o=t.dataProxy.findPlayerGameInfoByUISeat(this.index);if(t.dataProxy.centerConfig.replayMode&&!t.dataProxy.centerConfig.replayHidePoke)return void(this.visible=!1);if(1!=i&&2!=i||!o)this.visible=!1;else{this.visible=!0;for(var n=13-o.card.handCards.length,a=0,r=13;r>a;a++){var s=this["pai_"+a];s.visible=a>=n}o.isHu&&o.isSelfDrawn?this.pai_13.visible=!1:this.pai_13.visible=-1!=o.card.currentCard}},i.prototype.updateTing=function(){for(var e=13;e>=0;e--){var i=this["hand"+e];if(i.stage&&i.visible){var o=t.dataProxy.findCheckResult(i.cardId);o?i.showTing():i.hideTing()}}},i.prototype.hideTing=function(){for(var t=13;t>=0;t--){var e=this["hand"+t];e.hideTing()}},i}(eui.Component);t.PGP_Shoupai=e,__reflect(e.prototype,"PGP.PGP_Shoupai")}(PGP||(PGP={}));var PGP;!function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.setMelds=function(t,e){if(t)for(var i=0,o=4;o>i;i++){var n=this["pai_"+i],a=t[i];void 0!=a?(n.visible=!0,n.setCard(a,e)):n.visible=!1}},e}(eui.Component);t.PGP_chi=e,__reflect(e.prototype,"PGP.PGP_chi")}(PGP||(PGP={}));var PGP;!function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.init=function(){for(var t=0,e=10;e>t;t++)BornProperty.buildFor(this["bg_"+t]),BornProperty.buildFor(this["grp_"+t])},e.prototype.getAllBgs=function(){this.allBgs||(this.allBgs=[]);for(var t=0,e=10;e>t;t++)this.allBgs[t]=this["bg_"+t];return this.allBgs},e.prototype.getAllPais=function(){this.allPais||(this.allPais=[]);for(var t=0,e=10;e>t;t++)this.allPais[t]=this["grp_"+t];return this.allPais},e}(eui.Component);t.PGP_da_first=e,__reflect(e.prototype,"PGP.PGP_da_first")}(PGP||(PGP={}));var PGP;!function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.init=function(){for(var t=0,e=8;e>t;t++)BornProperty.buildFor(this["bg_"+t]),BornProperty.buildFor(this["grp_"+t])},e.prototype.getAllBgs=function(){this.allBgs||(this.allBgs=[]);for(var t=0,e=8;e>t;t++)this.allBgs[t]=this["bg_"+t];return this.allBgs},e.prototype.getAllPais=function(){this.allPais||(this.allPais=[]);for(var t=0,e=8;e>t;t++)this.allPais[t]=this["grp_"+t];return this.allPais},e}(eui.Component);t.PGP_da_second=e,__reflect(e.prototype,"PGP.PGP_da_second")}(PGP||(PGP={}));var PGP;!function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.init=function(){for(var t=0,e=6;e>t;t++)BornProperty.buildFor(this["bg_"+t]),BornProperty.buildFor(this["grp_"+t])},e.prototype.getAllBgs=function(){this.allBgs||(this.allBgs=[]);for(var t=0,e=6;e>t;t++)this.allBgs[t]=this["bg_"+t];return this.allBgs},e.prototype.getAllPais=function(){this.allPais||(this.allPais=[]);for(var t=0,e=6;e>t;t++)this.allPais[t]=this["grp_"+t];return this.allPais},e}(eui.Component);t.PGP_da_third=e,__reflect(e.prototype,"PGP.PGP_da_third")}(PGP||(PGP={}));var PGP;!function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.init=function(){for(var t=0,e=8;e>t;t++)BornProperty.buildFor(this["bg_"+t]),BornProperty.buildFor(this["grp_"+t])},e.prototype.getAllBgs=function(){this.allBgs||(this.allBgs=[]);for(var t=0,e=8;e>t;t++)this.allBgs[t]=this["bg_"+t];return this.allBgs},e.prototype.getAllPais=function(){this.allPais||(this.allPais=[]);for(var t=0,e=8;e>t;t++)this.allPais[t]=this["grp_"+t];return this.allPais},e}(eui.Component);t.PGP_da=e,__reflect(e.prototype,"PGP.PGP_da")}(PGP||(PGP={}));var PGP;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.touchChildren=!1,t}return __extends(i,e),i.prototype.init=function(){this.pai.visible=!1},i.prototype.setCard=function(e){this.cardId=e,this.pai.source=t.PGPStringUtils.getArtCardRes(e),this.pai.visible=!0},i.prototype.setDark=function(t){t?(this.dark||(this.dark=new egret.ColorMatrixFilter([1,0,0,0,-80,0,1,0,0,-80,0,0,1,0,-80,0,0,0,1,0])),this.filters=[this.dark]):this.filters=null},i.prototype.showTing=function(){this.tingImg||(this.tingImg=new eui.Image("PGP_img_ting_png"),this.tingImg.x=-2,this.tingImg.y=12,this.tingImg.touchEnabled=!1),this.addChild(this.tingImg)},i.prototype.hideTing=function(){remove_XY(this.tingImg)},i}(eui.Component);t.PGP_hand=e,__reflect(e.prototype,"PGP.PGP_hand")}(PGP||(PGP={}));var PGP;!function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.setCard=function(e){this.cardId=e,this.pai.source=t.PGPStringUtils.getArtCardRes(e)},i}(eui.Component);t.PGP_hua=e,__reflect(e.prototype,"PGP.PGP_hua")}(PGP||(PGP={}));var PGP;!function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.setCard=function(e,i){void 0!=e&&-1!=e?(this.pai.visible=!0,2==i?this.bg.source="PGP_j_"+i+"_14_png":this.bg.source="PGP_j_"+i+"_1_png",this.pai.source=t.PGPStringUtils.getArtCardRes(e)):(this.pai.visible=!1,this.bg.source="PGP_an_gang_"+i+"_png")},i}(eui.Component);t.PGP_liang=e,__reflect(e.prototype,"PGP.PGP_liang")}(PGP||(PGP={}));var PGP;!function(t){var e=function(e){function i(t){return e.call(this,i.NAME,t)||this}return __extends(i,e),i.prototype.onRemove=function(){e.prototype.onRemove.call(this),this.hackPanel&&(this.hackPanel.dispose(),remove_XY(this.hackPanel),this.hackPanel=null)},i.prototype.listNotificationInterests=function(){return[i.SHOW,i.HIDE]},i.prototype.handleNotification=function(e){var o=e.getBody();switch(e.getName()){case i.SHOW:this.hackPanel||(this.hackPanel=new t.PGPHack),this.hackPanel.stage||tween_XY_alphaShow(this.hackPanel),this.getLayer().addChild(this.hackPanel),this.hackPanel.initData(o);break;case i.HIDE:remove_XY(this.hackPanel)}},i.NAME=GameIdEnum.PGP+"PGPHackMediator",i.SHOW=i.NAME+"SHOW",i.HIDE=i.NAME+"HIDE",i}(t.AbstractMediator);t.PGPHackMediator=e,__reflect(e.prototype,"PGP.PGPHackMediator")}(PGP||(PGP={}));var PGP;!function(t){var e=function(e){function i(){var t=e.call(this,"PGPHackSkin")||this;bindTapEvent_XY(t.closeBtn,t.onClose,t,!0);for(var i=0,o=30;o>i;i++){var n=t["c"+i],a=t["tf"+i];a.touchEnabled=!1,n.touchEnabled=!0,bindTapEvent_XY(n,t.onChoose,t,!0)}return i18nEUI(GameIdEnum.PGP,t,[t.helpTf]),t}return __extends(i,e),i.prototype.onClose=function(){remove_XY(this)},i.prototype.onChoose=function(e){var i=e.currentTarget;t.sendSocketMessage(t.PGPProtocol.MAHJONG_BLACK_SHEEP_WALL_C,i.cardId),t.dataProxy.hackedCard=i.cardId,this.chooseedCard.visible=!0,this.chooseedCard.setCard(i.cardId),this.helpTf.visible=!0},i.prototype.initData=function(e){e=e.sort(function(t,e){return e>t?-1:t>e?1:0}),-1==t.dataProxy.hackedCard?(this.chooseedCard.visible=!1,this.helpTf.visible=!1):(this.chooseedCard.visible=!0,this.helpTf.visible=!0,this.chooseedCard.setCard(t.dataProxy.hackedCard));for(var i=[],o=[],n=0,a=e.length;a>n;n++){var r=e[n],s=i.indexOf(r);-1==s&&(i.push(r),s=i.indexOf(r),o[s]=0),o[s]++}for(var n=0,a=30;a>n;n++){var h=this["c"+n],l=this["tf"+n],d=i[n],c=o[n];void 0!=d?(h.visible=!0,l.visible=!0,h.setCard(d),l.text=t.i18n("剩{0}张",c)):(h.visible=!1,l.visible=!1)}},i}(BaseComponent);t.PGPHack=e,__reflect(e.prototype,"PGP.PGPHack")}(PGP||(PGP={}));var PGP;!function(t){var e=function(){function t(t){this.gameLayer=new egret.DisplayObjectContainer,this.popupLayer=new egret.DisplayObjectContainer,this.msgLayer=new egret.DisplayObjectContainer,this.loadingLayer=new egret.DisplayObjectContainer,t.addChild(this.gameLayer),t.addChild(this.popupLayer),t.addChild(this.msgLayer),t.addChild(this.loadingLayer)}return t.prototype.dispose=function(){remove_XY(this.gameLayer),remove_XY(this.popupLayer),remove_XY(this.msgLayer),remove_XY(this.loadingLayer),this.gameLayer=null,this.popupLayer=null,this.msgLayer=null,this.loadingLayer=null},t}();t.PGPLayout=e,__reflect(e.prototype,"PGP.PGPLayout")}(PGP||(PGP={}));var PGP;!function(t){var e=function(e){function i(t){return e.call(this,i.NAME,t)||this}return __extends(i,e),i.prototype.onRemove=function(){e.prototype.onRemove.call(this),this.readme&&(this.readme.dispose(),remove_XY(this.readme),this.readme=null)},i.prototype.listNotificationInterests=function(){return[i.SHOW]},i.prototype.handleNotification=function(e){e.getBody();switch(e.getName()){case i.SHOW:this.readme||(this.readme=new t.PGPReadMe),this.getLayer().addChild(this.readme),this.readme.init()}},i.NAME=GameIdEnum.PGP+"PGPReadmeMediator",i.SHOW=i.NAME+"SHOW",i}(t.AbstractMediator);t.PGPReadmeMediator=e,__reflect(e.prototype,"PGP.PGPReadmeMediator")}(PGP||(PGP={}));var PGP;!function(t){var e=function(t){function e(){var e=t.call(this,"PGPReadMeSkin")||this;return e.isRuleTab=!1,e.initEvents(),e.scl.setSliderBarAlwaysShow(!0),updateScrollerThumb_XY(e.scl),e}return __extends(e,t),e.prototype.initEvents=function(){bindTapEvent_XY(this.bg,this.onClose,this),bindTapEvent_XY(this.btn0,this.onTab,this),bindTapEvent_XY(this.btn1,this.onTab,this)},e.prototype.onTab=function(t){this.isRuleTab=t.currentTarget==this.btn0,this.updateTab()},e.prototype.init=function(){this.scl.stopAnimation(),this.grp.x=Global.stage.stageWidth,Tween$.removeTweens(this.grp),Tween$.get(this.grp).to({x:Global.stage.stageWidth-this.grp.width},300,Ease$.sineOut),this.updateTab()},e.prototype.updateTab=function(){this.btn0.alpha=this.isRuleTab?1:0,this.btn1.alpha=this.isRuleTab?0:1,this.txt0.source=this.isRuleTab?"PGP_rule_yxgz1_png":"PGP_rule_yxgz2_png",this.txt1.source=this.isRuleTab?"PGP_rule_fan2_png":"PGP_rule_fan1_png",this.ctxGrp.removeChildren(),this.isRuleTab?(this.tab0Img||(this.tab0Img=new eui.Image,this.tab0Img.source="PGP_rule_rule1_png"),this.ctxGrp.addChild(this.tab0Img)):(this.tab1Img1||(this.tab1Img1=new eui.Image,this.tab1Img1.source="PGP_rule_rule2_1_png"),this.ctxGrp.addChild(this.tab1Img1)),this.scl.stopAnimation(),this.scl.scrolltoTop(),updateScrollerThumb_XY(this.scl)},e.prototype.onClose=function(){var t=this;Tween$.removeTweens(this.grp),Tween$.get(this.grp).to({x:Global.stage.stageWidth},300,Ease$.sineOut).call(function(){remove_XY(t)})},e.prototype.dispose=function(){t.prototype.dispose.call(this),clearTapEvent_XY(this.bg,this.onClose,this),this.removeChildren()},e}(BaseComponent);t.PGPReadMe=e,__reflect(e.prototype,"PGP.PGPReadMe")}(PGP||(PGP={}));var PGP;!function(t){var e=function(e){function i(t){return e.call(this,i.NAME,t)||this}return __extends(i,e),i.prototype.onRemove=function(){e.prototype.onRemove.call(this),this.replayPanel&&(this.replayPanel.dispose(),remove_XY(this.replayPanel),this.replayPanel=null)},i.prototype.listNotificationInterests=function(){return[i.SHOW,i.HIDE]},i.prototype.handleNotification=function(e){e.getBody();switch(e.getName()){case i.SHOW:this.replayPanel||(this.replayPanel=new t.PGPReplay),this.getLayer().addChild(this.replayPanel),this.replayPanel.initData();break;case i.HIDE:remove_XY(this.replayPanel)}},i.NAME=GameIdEnum.PGP+"PGPReplayMediator",i.SHOW=i.NAME+"SHOW",i.HIDE=i.NAME+"HIDE",i}(t.AbstractMediator);t.PGPReplayMediator=e,__reflect(e.prototype,"PGP.PGPReplayMediator")}(PGP||(PGP={}));var PGP;!function(t){var e=function(e){function i(){var i=e.call(this,"PGPReplaySkin")||this;bindTapEvent_XY(i.bg,i.onBg,i),bindTapEvent_XY(i.prevBtn,i.onPrev,i,!0),bindTapEvent_XY(i.playBtn,i.onPlay,i,!0),bindTapEvent_XY(i.nextBtn,i.onNext,i,!0),bindTapEvent_XY(i.exitBtn,i.onExit,i,!0),bindTapEvent_XY(i.bgmBtn,i.onBgm,i,!0),bindTapEvent_XY(i.musicBtn,i.onMusic,i,!0);for(var o=0,n=4;n>o;o++){var a=i["spdBtn"+o];a.__speed__=[.5,1,2,3][o],bindTapEvent_XY(a,i.onSpeed,i,!0)}return t.dataProxy.replayVo.addEventListener(t.PGPReplayVo.E_PROGRESS,i.updateUI,i),i18nEUI(GameIdEnum.PGP,i,[i.bgmBtn,i.musicBtn,i.prevBtn,i.playBtn,i.nextBtn,i.progressTf,i.exitBtn]),i}return __extends(i,e),i.prototype.onPrev=function(){t.dataProxy.replayVo.showPrevFrame(),this.updateUI()},i.prototype.onPlay=function(){t.dataProxy.replayVo.isPlaying?t.dataProxy.replayVo.pause():t.dataProxy.replayVo.resume(),this.updateUI()},i.prototype.onNext=function(){t.dataProxy.replayVo.showNextFrame(),this.updateUI()},i.prototype.onSpeed=function(e){var i=e.currentTarget.__speed__||1;t.dataProxy.replayVo.changePlaySpeed(i),this.updateUI()},i.prototype.updateUI=function(){var e=t.dataProxy.replayVo;this.progressTf.text=t.i18n("进度:{0}{1}{2}{3}{4}{5}",e.index,"/",e.max,"(",(e.index/e.max*100).toFixed(1),"%)"),this.playBtn.text=e.isPlaying?t.i18n("暂停"):t.i18n("播放");for(var i=0,o=4;o>i;i++){var n=this["spdBtn"+i];n.__speed__=[.5,1,2,3][i],n.backgroundColor=n.__speed__==e.speed?8026746:0}},i.prototype.onExit=function(){t.confirm(t.i18n("确定退出回放吗?"),function(){t.sendNotification(t.PGPExitCommand.NAME)})},i.prototype.onBgm=function(){SoundManager.setBgMute(!SoundManager.getBgMute()),this.updateMusicBtnState()},i.prototype.onMusic=function(){SoundManager.setEffectMute(!SoundManager.getEffectMute()),this.updateMusicBtnState()},i.prototype.onBg=function(){Tween$.removeTweens(this.ctrlGrp),this.isUIShowed?Tween$.get(this.ctrlGrp).to({bottom:-this.ctrlGrp.height},300):Tween$.get(this.ctrlGrp).to({bottom:0},300),this.isUIShowed=!this.isUIShowed},i.prototype.initData=function(){this.isUIShowed=!0,Tween$.removeTweens(this.ctrlGrp),this.ctrlGrp.bottom=0,this.updateUI(),this.updateMusicBtnState()},i.prototype.updateMusicBtnState=function(){this.musicBtn.backgroundColor=SoundManager.getEffectMute()?0:8026746,this.bgmBtn.backgroundColor=SoundManager.getBgMute()?0:8026746},i.prototype.dispose=function(){e.prototype.dispose.call(this),Tween$.removeTweens(this.ctrlGrp),clearTapEvent_XY(this.bg,this.onBg,this),clearTapEvent_XY(this.prevBtn,this.onPrev,this),clearTapEvent_XY(this.playBtn,this.onPlay,this),clearTapEvent_XY(this.nextBtn,this.onNext,this),clearTapEvent_XY(this.exitBtn,this.onExit,this),clearTapEvent_XY(this.bgmBtn,this.onBgm,this),clearTapEvent_XY(this.musicBtn,this.onMusic,this);for(var i=0,o=4;o>i;i++){var n=this["spdBtn"+i];n.__speed__=[.5,1,2,3][i],clearTapEvent_XY(n,this.onSpeed,this)}t.dataProxy.replayVo.removeEventListener(t.PGPReplayVo.E_PROGRESS,this.updateUI,this)},i}(BaseComponent);t.PGPReplay=e,__reflect(e.prototype,"PGP.PGPReplay")}(PGP||(PGP={}));var PGP;!function(t){var e=function(e){function i(t){return e.call(this,i.NAME,t)||this}return __extends(i,e),i.prototype.onRemove=function(){e.prototype.onRemove.call(this),this.result&&(this.result.dispose(),remove_XY(this.result),this.result=null)},i.prototype.listNotificationInterests=function(){return[i.SHOW,i.HIDE]},i.prototype.isShowing=function(){return null!=this.result&&null!=this.result.stage},i.prototype.handleNotification=function(e){e.getBody();switch(e.getName()){case i.SHOW:if(!t.dataProxy.roomDetailInfo||4!=t.dataProxy.roomDetailInfo.state||!t.dataProxy.roomDetailInfo.settlingDTO)return;this.result||(this.result=new t.PGPResult),this.getLayer().addChild(this.result),this.result.init();break;case i.HIDE:remove_XY(this.result)}},i.NAME=GameIdEnum.PGP+"PGPResultMediator",i.SHOW=i.NAME+"SHOW",i.HIDE=i.NAME+"HIDE",i}(t.AbstractMediator);t.PGPResultMediator=e,__reflect(e.prototype,"PGP.PGPResultMediator")}(PGP||(PGP={}));var PGP;!function(t){var e=function(e){function i(){var i=e.call(this,"PGPResultSkin")||this;i.positionArr=[],i.initEvents(),t.dataProxy.centerConfig.replayMode&&(remove_XY(i.exitBtn),remove_XY(i.nextBtn));for(var o=0;5>o;o++){var n=i["horseCard"+o];n.clearDark();var a=new egret.Point(n.x,n.y);remove_XY(n),i.positionArr.push(a)}return i}return __extends(i,e),i.prototype.clearDark=function(){for(var t=0;5>t;t++){var e=this["horseCard"+t];e.clearDark()}},i.prototype.initEvents=function(){bindTapEvent_XY(this.exitBtn,this.onExit,this,!0),bindTapEvent_XY(this.nextBtn,this.onNext,this,!0)},i.prototype.onExit=function(){t.dataProxy.gameExited?t.sendNotification(t.PGPExitCommand.NAME):t.sendSocketMessage(t.PGPProtocol.TABLE_TRY_TO_LEAVE_C)},i.prototype.onNext=function(){remove_XY(this),t.dataProxy.roomDetailInfo.friends?(t.sendNotification(t.PGPGameSceneMediator.UPDATE_ROOM_DETAIL_INFO),t.sendSocketMessage(t.PGPProtocol.PGP_CONTINUE_C)):1==t.dataProxy.roomDetailInfo.antiCheatConf?(t.sendNotification(t.PGPGameSceneMediator.UPDATE_ROOM_DETAIL_INFO),t.PGPLoading.getInstance().show(),egret.setTimeout(function(){t.sendNotification(t.PGPSocketMediator.SWITCH_ROOM)},this,randomInt_XY(1e3,3e3))):(t.sendNotification(t.PGPGameSceneMediator.UPDATE_ROOM_DETAIL_INFO),t.sendSocketMessage(t.PGPProtocol.PGP_CONTINUE_C))},i.prototype.init=function(){this.showEffect1(),this.clearDark();var e=t.dataProxy.roomDetailInfo;this.setTime(e.timeout),this.conCon.removeChildren();var i=e&&e.settlingDTO;if(!e||!i)return void remove_XY(this);var o=i.horse;if(o)for(var n=o.horseCard.length,a=0;n>a;a++){var r=this["horseCard"+a];n>a&&(r.clearDark(),r.setCard(o.horseCard[a]),this.conCon.addChild(r),r.x=this.positionArr[a].x,r.y=this.positionArr[a].y)}var s=-1,h=t.dataProxy.findHorseInSetting();if(null!=h){s=h.position;for(var a=0;4>a;a++){s>=4&&(s=0);var l=t.dataProxy.findPlayeSettleInfoByServerPos(s);this["render"+a].init(),this["render"+a].setData(l),s++}}else{var d=t.dataProxy.checkHuPlayer();s=d?d.position:0;for(var a=0;4>a;a++){s>=4&&(s=0);var l=t.dataProxy.findPlayeSettleInfoByServerPos(s);this["render"+a].init(),this["render"+a].setData(l),s++}}},i.prototype.setTime=function(e){(0>=e||void 0==e)&&(e=0),this.leftTime=e,this.timeTf.text=this.leftTime+"",egret.clearInterval(this.timer),t.dataProxy.roomDetailInfo&&1==t.dataProxy.roomDetailInfo.antiCheatConf?(this.timeTf.text="",this.continueImage.x=40):(this.continueImage.x=19,this.leftTime>0&&(this.timer=egret.setInterval(this.onTimer,this,1e3)))},i.prototype.onTimer=function(){this.leftTime--,this.leftTime<=0&&(this.leftTime=0,egret.clearInterval(this.timer)),this.timeTf.text=this.leftTime+""},i.prototype.onRemoved=function(){},i}(BaseComponent);t.PGPResult=e,__reflect(e.prototype,"PGP.PGPResult")}(PGP||(PGP={}));var PGP;!function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.updateData=function(e){var i=t.dataProxy.roomDetailInfo;i?i.state:0;if(e){this.visible=!0;for(var o=0,n=4;n>o;o++){var a=e.card.meldCards[o],r=this["chi_"+o];a?(r.visible=!0,r.setMelds(a,1)):r.visible=!1}}else this.visible=!1},i}(eui.Component);t.PGPResultChi=e,__reflect(e.prototype,"PGP.PGPResultChi")}(PGP||(PGP={}));var PGP;!function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.clearUiInfo=function(){this.info0.text="--",this.info1.text="--",this.info2.text="--",this.info3.text="--",this.info4.text="--",this.info5.text="--",this.info6.text="--",this.info7.text="--"},i.prototype.setData=function(e,i){i18nEUI(GameIdEnum.PGP,this,[]),this.clearUiInfo();for(var o=t.dataProxy.getSettleZiMo(),n=0,a=0,r=0,s=0;s<e.length;s++){var h=e[s],l=h[0],d=h[1];switch(l){case t.Action.ming_gang:case t.Action.bu_gang:n+=d;break;case t.Action.an_gang:a+=d;break;case t.Action.hu:r+=d}}n>0?this.info0.text=coin2Str_XY(n)+"":0>n&&(this.info2.text=coin2Str_XY(n)+""),a>0?this.info1.text=coin2Str_XY(a)+"":0>a&&(this.info3.text=coin2Str_XY(a)+""),r>0?(this.info4.text=coin2Str_XY(r)+"",i&&(this.info6.text=coin2Str_XY(r))):0>r&&(this.info5.text=coin2Str_XY(r)+"",o||(this.info7.text=coin2Str_XY(r)))},i.prototype.getTypeInfo=function(t,e){var i=0,o=0;if(t.length>0)for(var n=0;n<t.length;n++){var a=t[n],r=a[0],s=a[1];e==r&&(s>0?i+=s:o+=s)}return[i,o]},i}(eui.Component);t.PGPResultInfo=e,__reflect(e.prototype,"PGP.PGPResultInfo")}(PGP||(PGP={}));var PGP;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.inited=!1,t}return __extends(i,e),i.prototype.init=function(){this.resultInfo.visible=!1,this.inited||(this.inited=!0,bindTapEvent_XY(this.image_detail,this.clickFunc,this))},i.prototype.clickFunc=function(){this.resultInfo.visible=!this.resultInfo.visible},i.prototype.setData=function(e){var i=t.dataProxy.roomDetailInfo.settlingDTO;this.dealer.visible=e.uid==i.dealerId,this.head.setHead(e.head),this.isSelf.visible=e.uid==t.dataProxy.myUid,this.nameTf0.text=substrNick_XY(e.name),this.resultInfo.setData(e.scoreOffset,e.isSelfDrawn);var o=this.getTotalInfo(e.scoreOffset);o>0?(this.offset.font="PGP_win_fnt",this.offset.text="+"+coin2Str_XY(o)):(this.offset.font="PGP_lose_fnt",this.offset.text=coin2Str_XY(o));var n=this.getGangInfo(e.scoreOffset);this.gangInfo.text="("+t.i18n("杠分:{0}",coin2Str_XY(n))+")",this.chiUi.updateData(e),this.shouUi.updateData(e),0==e.coin?this.image_tyoe.source="PGP_pochan_png":e.isFucked?this.image_tyoe.source="PGP_chuchong_png":e.uid==i.winner?this.image_tyoe.source="PGP_shihu_png":this.image_tyoe.source="",null!=t.dataProxy.roomDetailInfo.horse&&e.uid==t.dataProxy.roomDetailInfo.horse.uid?0==t.dataProxy.roomDetailInfo.horse.getHorseCard.length?this.horseInfo.text=t.i18n("未中马"):this.horseInfo.text=t.i18n("中马"):this.horseInfo.text=""},i.prototype.getTotalInfo=function(t){var e=0;if(t.length>0)for(var i=0;i<t.length;i++){var o=t[i],n=(o[0],o[1]);e+=n}return e},i.prototype.getGangInfo=function(e){var i=0;if(e.length>0)for(var o=0;o<e.length;o++){var n=e[o],a=n[0],r=n[1];a!=t.Action.hu&&(i+=r)}return i},i}(eui.Component);t.PGPResultRender=e,__reflect(e.prototype,"PGP.PGPResultRender")}(PGP||(PGP={}));var PGP;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.timer=0,t.uiArr=[],t}return __extends(i,e),i.prototype.init=function(){this.cardY=this.pai_0.y,this.bornX=[],this.uiArr.length=0;for(var t=0,e=14;e>t;t++)this.bornX[t]=this["pai_"+t].x,this.uiArr.push(this["pai_"+t])},i.prototype.updateData=function(e){var i;e&&(i=e.card);for(var o=13-i.handCards.length,n=0,a=13;a>n;n++){var r=this["pai_"+n];if(r.visible=n>=o,r.alpha=1,Tween$.removeTweens(r),r.visible){var s=i.handCards[n-o];r.setCard(s),r.hideTing()}}var h=i.currentCard,l=t.dataProxy.findPlayerGameInfoByUid(e.uid);l&&l.huCards.length>0&&(h=l.huCards[0]),-1!=h&&this.pai_13.setCard(h),this.pai_13.visible=-1!=h},i}(eui.Component);t.PGPResultShou=e,__reflect(e.prototype,"PGP.PGPResultShou")}(PGP||(PGP={}));