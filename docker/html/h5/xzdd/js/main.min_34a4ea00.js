function runAI(t){void 0===t&&(t=3),XZDD.dataProxy.AIMode=!0,XZDD.dataProxy.AIDelaySecond=t}var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a]);i.prototype=e.prototype,t.prototype=new i},__awaiter=this&&this.__awaiter||function(t,e,i,a){return new(i||(i=Promise))(function(n,o){function r(t){try{h(a.next(t))}catch(e){o(e)}}function s(t){try{h(a["throw"](t))}catch(e){o(e)}}function h(t){t.done?n(t.value):new i(function(e){e(t.value)}).then(r,s)}h((a=a.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function i(t){return function(e){return a([t,e])}}function a(i){if(n)throw new TypeError("Generator is already executing.");for(;h;)try{if(n=1,o&&(r=o[2&i[0]?"return":i[0]?"throw":"next"])&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[0,r.value]),i[0]){case 0:case 1:r=i;break;case 4:return h.label++,{value:i[1],done:!1};case 5:h.label++,o=i[1],i=[0];continue;case 7:i=h.ops.pop(),h.trys.pop();continue;default:if(r=h.trys,!(r=r.length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){h=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){h.label=i[1];break}if(6===i[0]&&h.label<r[1]){h.label=r[1],r=i;break}if(r&&h.label<r[2]){h.label=r[2],h.ops.push(i);break}r[2]&&h.ops.pop(),h.trys.pop();continue}i=e.call(t,h)}catch(a){i=[6,a],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var n,o,r,s,h={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return s={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},XZDD;!function(t){var e=function(t){function e(e,i){return t.call(this,e,i)||this}return __extends(e,t),e.prototype.getLayer=function(){return this.viewComponent},e}(puremvc.Mediator);t.AbstractMediator=e,__reflect(e.prototype,"XZDD.AbstractMediator")}(XZDD||(XZDD={}));var XZDD;!function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.setIndex=function(t){this.index=t},i.prototype.setupEmpty=function(){this.visible=!1},i.prototype.updateData=function(){var e=t.dataProxy.roomDetailInfo,i=e?e.state:0,a=t.dataProxy.findPlayerGameInfoByUISeat(this.index);3==i&&a&&1!=this.index?a.dq>=0?this.visible=!1:this.visible=!0:this.visible=!1},i}(eui.Component);t.XZDD_DingQueIng=e,__reflect(e.prototype,"XZDD.XZDD_DingQueIng")}(XZDD||(XZDD={}));var XZDD;!function(t){function e(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=t.concat();i.splice(0,0,"<"+GameIdEnum.XZDD+"> "+egret.getTimer()+" "),console.log.apply(console,i)}function i(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=t.concat();i.splice(0,0,"<"+GameIdEnum.XZDD+"> "+egret.getTimer()+" "),console.warn.apply(console,i)}function a(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];if(null==t)return t;var a=I18N.getInstance(GameIdEnum.XZDD);return a.toString.apply(a,arguments)}var n=function(i){function a(){var t=i.call(this)||this;return Global.eventCenter.addEventListener(EventEnum.SOME_ONE_PLAY_VOICE_P_to_G,t.someOnePlayVoice,t),Global.eventCenter.addEventListener(EventEnum.ACCOUNT_BEEN_KICKED,t.beenKicked,t),Global.eventCenter.addEventListener(EventEnum.SERVER_ERROR_MESSAGE,t.onServerErrorMsg,t),Global.eventCenter.addEventListener(EventEnum.SWITCH_TABLE_P_to_G,t.onSwitchTableOk,t),t}return __extends(a,i),a.prototype.someOnePlayVoice=function(t){},a.prototype.beenKicked=function(e){Global.isAccountBeenReplaced=!0;var i=e.data;t.alert(i[1],function(){Global.platform.exitApp()})},a.prototype.onSwitchTableOk=function(i){t.dataProxy.centerConfig.area=i.data[0],t.XZDDLoading.getInstance().hide(),SimpleLoading.hide(),e("换桌成功！"),t.sendSocketMessage(t.XZDDProtocol.XZDD_GET_SNAPSHOT_C)},a.prototype.onServerErrorMsg=function(t){SimpleLoading.hide(),Toast.show(t.data[0])},a.prototype.setup=function(i){var a=this;e("setup"),RES.loadGroup("XZDD.all",0),waitGroupAndExecute("XZDD.all",function(){Global.onEvent(EventEnum.CLOSE_GAME_INIT_LOADING_G_to_P),bridge_iframe.sendMsgToHall(EventEnum.CLOSE_GAME_INIT_LOADING_G_to_P);var e=RES.getRes("i18n_json");I18N.getInstance(GameIdEnum.XZDD).init(e,i.i18nType),a.start(i),t.XZDDStringUtils.init(),egret.setTimeout(function(){RES.loadGroup("XZDD.sound",0)},a,1)},this),waitGroupAndExecute("XZDD.sound",function(){if(!a.destroied){egret.getDefinitionByName("Main");a.destroied||t.XZDDSoundPlayer.bgm()}},this)},a.prototype.start=function(e){mahjong.Card.init(),__tapSound=GameIdEnum.XZDD+"_ui_click_mp3";var i=new mahjong.TableSource;i.buildFromZipFile(RES.getRes("XZDD_tbl"));var a=new mahjong.Card(mahjong.Type.ZI,0);mahjong.MahjongTool.init([a],i,!0),mahjong.MahjongTool.allow_7dui=!0,mahjong.XZDDTool.init();var n=new t.XZDDFacade;t.dataProxy=new t.XZDDDataProxy,t.dataProxy.centerConfig=e,t.dataProxy.myUid=e.loginDto?e.loginDto.id:-1,n.setup(this),MarqueeNotice.getInstace().setup(350,5,420),this.facade=n,ResizeCall.addCall(this.onResize,this),this.onResize()},a.prototype.onResize=function(){var t=1120/1920,e=Global.stage.stageHeight/Global.stage.stageWidth;t>e?Global.stage.scaleMode=egret.StageScaleMode.FIXED_HEIGHT:Global.stage.scaleMode=egret.StageScaleMode.FIXED_WIDTH},a.prototype.destroy=function(){Global.eventCenter.removeEventListener(EventEnum.SOME_ONE_PLAY_VOICE_P_to_G,this.someOnePlayVoice,this),Global.eventCenter.removeEventListener(EventEnum.ACCOUNT_BEEN_KICKED,this.beenKicked,this),Global.eventCenter.removeEventListener(EventEnum.SERVER_ERROR_MESSAGE,this.onServerErrorMsg,this),this.destroied=!0,ResizeCall.del(this.onResize,this),RES.destroyRes("XZDD.all"),Global.stage.scaleMode=egret.StageScaleMode.FIXED_WIDTH,mahjong.MahjongTool.dispose(),this.facade&&(t.sendNotification(t.XZDDDisposeMVCCommand.NAME),this.facade.dispose(),t.XZDDFacade.removeCore(GameIdEnum.XZDD),this.facade=null),t.XZDDSoundPlayer.dispose(),t.XYAlert.dispose()},a}(egret.DisplayObjectContainer);t.GameLauncher=n,__reflect(n.prototype,"XZDD.GameLauncher",["IGameLauncher"]),t.trace=e,t.warn=i,t.i18n=a}(XZDD||(XZDD={}));var XZDD;!function(t){function e(t,e,i){puremvc.Facade.getInstance(GameIdEnum.XZDD).sendNotification(t,e,i)}function i(t){return t==I18NType.zh_tw?!0:t==I18NType.en_us?!0:!1}var a=function(i){function a(){return i.call(this,GameIdEnum.XZDD)||this}return __extends(a,i),a.prototype.initializeController=function(){i.prototype.initializeController.call(this),this.registerCommand(t.XZDDRegisteMVCCommand.NAME,t.XZDDRegisteMVCCommand)},a.prototype.setup=function(i){this.layout||(this.layout=new t.XZDDLayout(i)),e(t.XZDDRegisteMVCCommand.NAME,[this.layout]),e(t.XZDDGameSceneMediator.SHOW),t.dataProxy.centerConfig.replayMode?(t.dataProxy.initReplay(),t.dataProxy.replayVo.startAutoPlay(),e(t.XZDDReplayMediator.SHOW)):DevelopMain.callWhenFastJoinCompleted(function(){t.sendSocketMessage(t.XZDDProtocol.XZDD_GET_SNAPSHOT_C)}),EnterFrameCall.add(function(){dragonBones.WorldClock.clock.advanceTime(-1)},this)},a.prototype.dispose=function(){this.layout&&this.layout.dispose(),this.layout=null},a}(puremvc.Facade);t.XZDDFacade=a,__reflect(a.prototype,"XZDD.XZDDFacade"),t.sendNotification=e,t.isLanuageSupport=i}(XZDD||(XZDD={}));var Main=function(t){function e(){var i=t.call(this)||this;try{e.isInModule=!(window&&window.parent!=window&&window.parent.Global)}catch(a){}var n=egret.getOption("ip")||window.serverip||"172.16.236.21";return i.gameId="XZDD",i.config.httpURI="http://"+n+":81",i.config.host=n,i.config.port=81,i.config.param1=2013110,i.config.param2=5,i.config.antiCheat=1,i.config.i18nType=I18NType.zh_cn,i.config.num=8,i.config.type=45,i.sendSnapshotWhenResume=!0,i.config.moduleType=ModuleType.MODULE_MAHJONG,Global.useProfile=!0,i}return __extends(e,t),e.prototype.onExit=function(){t.prototype.onExit.call(this)},e.isInModule=!0,e}(DevelopMain);__reflect(Main.prototype,"Main");var XZDD;!function(t){var e=function(e){function i(){var t=e.call(this,i.NAME)||this;t.hackedCard=-1,t.AIMode=!1,t.AIDelaySecond=3,t.lockTweener=!1,t.tempCards=[],t.fullCards=[];for(var a=0,n=27;n>a;a++){var o=mahjong.Card.createFromCardID(a);t.fullCards.push(o)}return t}return __extends(i,e),i.prototype.isBothInLastGamePlayers=function(t,e){return this.lastGamePlayerIds?-1!=this.lastGamePlayerIds.indexOf(t)&&-1!=this.lastGamePlayerIds.indexOf(e):!1},i.prototype.initReplay=function(){this.centerConfig.replayMode&&(this.replayVo?this.replayVo.stopAndClear():this.replayVo=new t.XZDDReplayVo,this.replayVo.init(this.centerConfig.replayData))},i.prototype.setDingQCard=function(t){this.fullCards=[];var e=0,i=0;if(1==t){for(var a=0,n=9;n>a;a++){var o=mahjong.Card.createFromCardID(a);this.fullCards.push(o)}for(var a=18,n=27;n>a;a++){var o=mahjong.Card.createFromCardID(a);this.fullCards.push(o)}}else{0==t?(e=9,i=27):2==t&&(e=0,i=18);for(var a=e,n=i;n>a;a++){var o=mahjong.Card.createFromCardID(a);this.fullCards.push(o)}}},i.prototype.getCardTypeIndex=function(e){for(var i=this.centerConfig.loginDto.id,a=this.findPlayerGameInfoByUid(i),n=null==a.card?[]:a.card.handCards,o=0;o<n.length;o++){var r=n[o],s=t.XZDDStringUtils.getCardType(r);if(s==e)return o}return-1},i.prototype.checkCardsEqualDQ=function(e){var i=this.findPlayerGameInfoByUid(t.dataProxy.myUid),a=i.dq,n=t.XZDDStringUtils.getCardType(e);return n==a?!0:!1},i.prototype.checkContainsDq=function(){var e=0,i=this.findPlayerGameInfoByUid(Global.uid),a=t.dataProxy.roomDetailInfo,n=a?a.state:0;if(4==n&&i&&i.dq>=0)for(var o=i.card.handCards,r=0;r<o.length;r++){var s=o[r],h=t.XZDDStringUtils.getCardType(s);h==i.dq&&e++}return e},i.prototype.findCheckResult=function(t){if(!this.currentCheckResults)return null;for(var e=0,i=this.currentCheckResults.length;i>e;e++){var a=this.currentCheckResults[e];if(a&&a.discard&&a.discard.cardID==t)return a}return null},i.prototype.getTingCount=function(){if(!this.currentCheckResults)return 0;for(var t=0,e=0,i=this.currentCheckResults.length;i>e;e++){var a=this.currentCheckResults[e];a&&a.discard&&t++}return t},i.prototype.getCountMornThanThreeArr=function(){var t=[],e=null;e=this.getCountMornThanThreeByType(mahjong.Type.BAMBOO);var i=null;i=this.getCountMornThanThreeByType(mahjong.Type.DOT);var a=null;return a=this.getCountMornThanThreeByType(mahjong.Type.CHARACTER),null!=e&&t.push(e),null!=i&&t.push(i),null!=a&&t.push(a),t=t.sort(this.compareCount)},i.prototype.compareCount=function(t,e){return t.count<e.count?-1:t.count>e.count?1:0},i.prototype.calCheckResult=function(){var e=this.roomDetailInfo;if(4==e.state&&e.turnPlayers&&-1!=e.turnPlayers.indexOf(this.myUid)){var i,a,n=this.findPlayerGameInfoByUid(this.myUid),o=n.card.currentCard,r=n.card.handCards;-1!=n.card.currentCard?(i=mahjong.Card.createFronCardIds(r),a=mahjong.Card.createFromCardID(o)):(i=mahjong.Card.createFronCardIds(r),a=i.shift()),t.trace("计算我可以听、胡什么牌");var s=mahjong.MahjongTool.findWinCardsWhenDraw(i,a,t.dataProxy.fullCards,null,null,!1),h=mahjong.Meld.fromServerMelds(n.card.meldCards);n.card.flowerCards.length,t.dataProxy.roomDetailInfo.roundRec,n.position;if(s)for(var l=0,d=s.length;d>l;l++){var c=s[l];if(c){c.winFactors=c.winFactors||[];for(var u=0,D=c.winCards.length;D>u;u++){var p=c.winCards[u],f=mahjong.XZDDTool.getWinTypeAndFactors(h,i,p);c.winFactors[u]=f.factor}}}this.currentCheckResults=s}else this.currentCheckResults=null},i.prototype.getStartIndexByDeal=function(t,e){var i=0,a=e%4;switch(a){case 0:i=t-1;break;case 1:i=t;break;case 2:i=t+1;break;case 3:i=t+2}return i>3&&(i-=4),0>i&&(i=3),i},i.prototype.verifyHandCardNum=function(){if(this.roomDetailInfo)for(var e=0,i=this.roomDetailInfo.info.length;i>e;e++){var a=this.roomDetailInfo.info[e];if(a.card&&a.card.handCards){var n=a.card.handCards.length;if(a.card.meldCards&&(n+=3*a.card.meldCards.length),n>13)if(t.warn(a.uid+"玩家手牌数量为:"+a.card.handCards.length),a.uid==this.myUid||t.dataProxy.centerConfig.replayMode){if(-1!=a.card.currentCard){var o=a.card.handCards.indexOf(a.card.currentCard);a.card.handCards.splice(o,1)}}else a.card.handCards.pop()}}},i.prototype.changeSnapshotDTO=function(e){if(this.roomDetailInfo){this.roomDetailInfo.state=2,this.roomDetailInfo.timeout=e;for(var i=0;i<this.roomDetailInfo.info.length;i++)this.roomDetailInfo.info[i].threeState=-1;t.sendNotification(t.XZDDGameSceneMediator.UPDATE_ROOM_DETAIL_INFO)}},i.prototype.changePlayerCards=function(e){var i=t.dataProxy.findPlayerGameInfoByUid(e);if(i.threeState=0,e==Global.uid){var a=t.dataProxy.tempCards;if(a)for(var n=a.length,o=0;n>o;o++){var r=a.shift(),s=i.card.handCards.indexOf(r);-1!=s&&i.card.handCards.splice(s,1)}}else i.card&&13==i.card.handCards.length&&(i.card.handCards.shift(),i.card.handCards.shift(),i.card.handCards.shift());t.sendNotification(t.XZDDGameSceneMediator.SOME_ONE_SELECT_CARD_OK,e)},i.prototype.changeCardOver=function(e,i){this.roomDetailInfo&&(this.roomDetailInfo.currentThreeCount+=1);for(var a=t.dataProxy.roomDetailInfo.info,n=0;n<a.length;n++){var o=a[n];if(o.threeState=1,o.uid==Global.uid){if(o.card)if(10==o.card.handCards.length)o.card.handCards=o.card.handCards.concat(i);else if(13==o.card.handCards.length){for(var r=0;r<e.length;r++){var s=o.card.handCards.indexOf(e[r]);-1!=s&&o.card.handCards.splice(s,1)}o.card.handCards=o.card.handCards.concat(i)}}else o.card&&10==o.card.handCards.length&&(o.card.handCards.push(-1),o.card.handCards.push(-1),o.card.handCards.push(-1))}t.sendNotification(t.XZDDGameSceneMediator.ALL_FLOAT_CARDS_ANIMATION,i)},i.prototype.sortDqHandCards=function(e,i){if(i=mahjong.MahjongTool.sortHandleCardByCardI(i),e>=0){for(var a=[],n=i.length,o=n-1;o>=0;o--){var r=t.XZDDStringUtils.getCardType(i[o]);r==e&&(a=a.concat(i.splice(o,1)))}a.length>0&&(a=a.reverse()),i=i.concat(a)}return i},i.prototype.changeDqState=function(e){if(this.roomDetailInfo){this.roomDetailInfo.state=3,this.roomDetailInfo.timeout=e;var i=t.dataProxy.findPlayerGameInfoByUid(Global.uid);i.card.handCards&&(i.card.handCards=this.sortDqHandCards(i.dq,i.card.handCards)),t.sendNotification(t.XZDDGameSceneMediator.UPDATE_ROOM_DETAIL_INFO)}},i.prototype.someOneDQ=function(e){t.sendNotification(t.XZDDGameSceneMediator.SOME_ONE_SELECT_DQ_OK,e)},i.prototype.changeFucked=function(e){var i=t.dataProxy.findPlayerGameInfoByUid(e);i&&(i.isFucked=!0),t.sendNotification(t.XZDDGameSceneMediator.UPDATE_ROOM_DETAIL_INFO)},i.prototype.setAllDqOver=function(e){this.roomDetailInfo.state=4,t.dataProxy.lockTweener=!0;for(var i=0;i<e.length;i++){var a=e[i],n=t.dataProxy.findPlayerGameInfoByUid(a.uid);n&&(n.dq=a.dq,a.uid==Global.uid&&(n.card.handCards&&(n.card.handCards=this.sortDqHandCards(n.dq,n.card.handCards),t.trace("定缺类型 "+n.dq+" "+n.card.handCards+" setAllDqOver over")),this.setDingQCard(a.dq),mahjong.MahjongTool.disableType=a.dq,this.calCheckResult(),this.refreshHuData()))}t.sendNotification(t.XZDDGameSceneMediator.ALL_FLOAT_DQ_ANIMATION)},i.prototype.updatePlayerCoins=function(e){if(e){for(var i=0;i<e.length;i++){var a=e[i][0],n=t.dataProxy.findPlayerGameInfoByUid(a);n&&(n.coin=e[i][1])}t.sendNotification(t.XZDDGameSceneMediator.UPDATE_ROOM_DETAIL_INFO)}},i.prototype.updateRoomDetailInfo=function(e){this.roomDetailInfo=e,this.gameExited=!1;var i=this.roomDetailInfo.info;if(i)for(var a=0;a<i.length;a++)t.PlayerDTO.maskNick(i[a]);if(2==this.roomDetailInfo.state)for(var a=0;a<this.roomDetailInfo.info.length;a++){var n=this.roomDetailInfo.info[a];if(13!=n.card.handCards.length&&(null==n.three||0==n.three.length))throw new Error("手牌错误");if(n.three&&n.three.length>0&&0==n.threeState)for(var o=0;o<n.three.length;o++){var r=n.card.handCards,s=r.indexOf(n.three[o]);Global.uid==n.uid||t.dataProxy.centerConfig.replayMode?-1!=s&&r.splice(s,1):r.shift()}}5!=e.state&&t.sendNotification(t.XZDDResultMediator.HIDE),this.verifyHandCardNum(),this.lastGamePlayerIds=[];var h=this.findPlayerGameInfoByUid(this.myUid);if(4==e.state&&(this.setDingQCard(h.dq),mahjong.MahjongTool.disableType=h.dq,this.calCheckResult(),this.refreshHuData(),t.sendNotification(t.XZDDGameSceneMediator.REFRESH_MY_TING)),h)this.selfIndex=h.position;else for(var a=1,l=4;l>=a;a++){var d=this.findPlayerGameInfoBySeat(a);d||(this.selfIndex=a)}for(var a=0,l=3;l>=a;a++){var d=this.findPlayerGameInfoBySeat(a);d&&(d.dealer&&(this.dealerIndex=a),this.lastGamePlayerIds.push(d.uid))}if(t.trace("mySeat:"+this.selfIndex),this.updateRecordCard(),this.centerConfig.replayMode){var c=e.replayAction;if(!c){var c=new t.MahjongGameActionDTO;c.action=e.lastValidAction,c.card=e.currentDiscard,c.currentDiscard=e.currentDiscard,c.lastDiscardUid=e.lastDiscardUid,c.lastOpUid=e.lastOpUid,c.remaining=e.remaining,c.turnPlayers=e.turnPlayers,c.uid=e.lastOpUid}c.action!=t.Action.hu&&4==e.state&&t.XZDDSoundPlayer.action(c),t.sendNotification(t.XZDDGameSceneMediator.DO_ACTION,[c.uid,c.action,c.currentDiscard])}},i.prototype.changeToPrepare=function(e){this.roomDetailInfo.state=0,this.roomDetailInfo.actionable=null,this.roomDetailInfo.ascDraw=0,this.roomDetailInfo.currentDiscard=-1,this.roomDetailInfo.descDraw=0,this.roomDetailInfo.dices=[0,0],this.roomDetailInfo.lastDiscardUid=-1,this.roomDetailInfo.lastOpUid=-1,this.roomDetailInfo.lastValidAction=-1,this.roomDetailInfo.remaining=108,this.roomDetailInfo.tableId="",this.roomDetailInfo.turnPlayers=null,this.roomDetailInfo.timeout=e,this.dealerIndex=-1,t.dataProxy.tempCards=[],t.dataProxy.lockTweener=!1,mahjong.MahjongTool.disableType=-1,t.dataProxy.tempHuData=null,this.roomDetailInfo.currentThreeCount=0;for(var i=0,a=this.roomDetailInfo.info.length;a>i;i++){var n=this.roomDetailInfo.info[i];n.dealer=!1,n.trusteeship=!1,n.huCard=-1,n.isSelfDrawn=!1,n.dq=-1,-1==this.roomDetailInfo.autoReady||(n.ready=-1),n.threeState=-1,n.card.handCards=[],n.three=[]}t.sendNotification(t.XZDDGameSceneMediator.CHANGE_TO_PREPARE),t.sendNotification(t.XZDDResultMediator.HIDE)},i.prototype.updateTableId=function(e){this.roomDetailInfo&&(this.roomDetailInfo.tableId=e,t.sendNotification(t.XZDDGameSceneMediator.UPDATE_TABLE_ID))},i.prototype.updateTurn=function(e){var i=this;if(this.roomDetailInfo.state=4,egret.clearTimeout(this.AITimer),e.uid==Global.uid&&(this.roomDetailInfo.actionable=e.actionable,-1!=e.card&&(this.hackedCard=-1),this.AIMode&&(this.AITimer=egret.setTimeout(function(){if(e.actionable)if(-1!=e.actionable.indexOf(99))t.sendSocketMessage(t.XZDDProtocol.MAHJONG_HU_C);else if(-1!=e.actionable.indexOf(1)){var a,n=i.findPlayerGameInfoByUid(Global.uid),o=mahjong.Card.createFronCardIds(n.card.handCards),r=mahjong.Card.createFromCardID(n.card.currentCard);try{a=mahjong.ai.MSelector.getSuggest(o,r,t.dataProxy.fullCards),t.trace("AI打牌",a.cardID)}catch(s){a=r,error("AI报错! 手牌:"+o.join()+"  摸牌:"+r.toString())}i.checkCanDealCards(a.cardID)?t.sendSocketMessage(t.XZDDProtocol.MAHJONG_DA_C,a.cardID):Toast.show(t.i18n("请优先打定缺花色的牌型!"))}else t.sendSocketMessage(t.XZDDProtocol.MAHJONG_PASS_C)},this,Math.max(100,1e3*this.AIDelaySecond)))),-1!=e.card){var a=this.findPlayerGameInfoByUid(e.turnPlayers[0]);a&&(a.card.currentCard=e.card)}this.roomDetailInfo.turnPlayers=e.turnPlayers,this.roomDetailInfo.lastOpUid=e.lastOpUid,this.roomDetailInfo.remaining=e.remaining,this.roomDetailInfo.ascDraw=e.ascDraw,this.roomDetailInfo.descDraw=e.descDraw,this.roomDetailInfo.timeout=e.timeout,this.calCheckResult(),t.sendNotification(t.XZDDGameSceneMediator.UPDATE_TURN)},i.prototype.refreshHuData=function(){var e=t.dataProxy.findPlayerGameInfoByUid(t.dataProxy.myUid);if(e&&e.card){var i=mahjong.Card.createFronCardIds(e.card.handCards);if(i){var a=mahjong.MahjongTool.findWinCards(i,t.dataProxy.fullCards);if(null==a)return void(t.dataProxy.tempHuData=null);t.dataProxy.tempHuData={},t.dataProxy.tempHuData.winCards=a.cards,t.dataProxy.tempHuData.winCount=a.count,t.dataProxy.tempHuData.winFactors=[];for(var n=0,o=0;o<t.dataProxy.tempHuData.winCards.length;o++){var r=t.dataProxy.tempHuData.winCards[o],s=mahjong.Meld.fromServerMelds(e.card.meldCards),h=mahjong.XZDDTool.getWinTypeAndFactors(s,i,r);h&&(n=h.factor),t.dataProxy.tempHuData.winFactors.push(n)}}}},i.prototype.updateAction=function(e){var i=e.uid==Global.uid,a=this.findPlayerGameInfoByUid(e.uid);if(i&&egret.clearTimeout(this.AITimer),this.roomDetailInfo.remaining=e.remaining,a.card=e.userMahjong,this.roomDetailInfo.turnPlayers=e.turnPlayers,this.roomDetailInfo.lastOpUid=e.lastOpUid,this.roomDetailInfo.currentDiscard=e.currentDiscard,this.roomDetailInfo.lastDiscardUid=e.lastDiscardUid,this.roomDetailInfo.lastValidAction=e.action,e.action==t.Action.chi||e.action==t.Action.peng||e.action==t.Action.ming_gang){var n=this.findPlayerGameInfoByUid(e.lastDiscardUid),o=n.card.discards.indexOf(e.currentDiscard);n.card.discards.splice(o,1)}e.action!=t.Action.hu&&t.XZDDSoundPlayer.action(e),e.action==t.Action.da_pai&&e.uid==Global.uid&&(this.refreshHuData(),t.sendNotification(t.XZDDGameSceneMediator.REFRESH_MY_TING)),this.verifyHandCardNum(),this.updateRecordCard(),t.sendNotification(t.XZDDGameSceneMediator.DO_ACTION,[e.uid,e.action,e.currentDiscard])},i.prototype.updateTuoguan=function(e){var i=this.findPlayerGameInfoByUid(Global.uid);i.trusteeship=e,t.sendNotification(t.XZDDGameSceneMediator.UPDATE_TUOGUAN)},i.prototype.updatePlayerActionEffect=function(e){for(var i=!1,a=!1,n=-1,o=[],r=!1,s=!1,h=!1,l=0,d=0;d<e.length;d++){var c=t.dataProxy.findPlayerGameInfoByUid(e[d].uid);if(null==c)return;if(c.coin=e[d].coin,999999==e[d].opType||666666==e[d].opType)if(666666==e[d].opType&&(h=!0),e[d].scoreOffset>0){c.isHu=!0,c.huCard=e[d].huCard,n=c.huCard;var u=e[d].relationType?-1!=e[d].relationType.indexOf(mahjong.XZDD_WinType.MAHJONG_XZDD_ZI_MO):!1;a=e[d].relationType?-1!=e[d].relationType.indexOf(mahjong.XZDD_WinType.MAHJONG_XZDD_HU_GANG_SHANG_HUA):!1,c.isSelfDrawn=u,i=u,r=e[d].relationType?-1!=e[d].relationType.indexOf(mahjong.XZDD_WinType.MAHJONG_XZDD_HU_QIANG_GANG):!1,s=e[d].relationType?-1!=e[d].relationType.indexOf(mahjong.XLCH_WinType.MAHJONG_XLCH_HU_HAI_DI_LAO_YUE):!1,o.push(c.uid)}else l++}t.trace(i+" hasZiMO "),h&&3==l&&(i=!0);for(var D=0;D<o.length;D++){var p=o[D],f=t.dataProxy.findPlayerGameInfoByUid(p);if(i)!f||a||s||t.sendNotification(t.XZDDGameSceneMediator.GAME_SHOW_ZIMO,f);else if(h&&3>l||!h){for(var _=0;_<e.length;_++)if(-1!=n&&e[_].scoreOffset<0){var y=t.dataProxy.findPlayerGameInfoByUid(e[_].uid),g=y.card.discards.indexOf(n);if(t.trace("点炮的人 打的牌要删除掉 "+n),-1!=g&&y.card.discards.splice(g,1),t.sendNotification(t.XZDDGameSceneMediator.GAME_SHOW_DIAN_PAO,[y.position,n]),r){var m=y.card.meldCards;if(m)for(var _=0;_<m.length;_++){var v=m[_];if(4==v.length&&n==v[0]){v.pop(),t.trace("抢杠的牌被删除掉了");break}}}}t.sendNotification(t.XZDDGameSceneMediator.GAME_SHOW_DIAN_PAO_HU,f)}}for(var _=0;_<e.length;_++){var X=e[_],c=t.dataProxy.findPlayerGameInfoByUid(X.uid);null!=c&&(X.relationType&&-1!=X.relationType.indexOf(mahjong.XZDD_WinType.MAHJONG_XZDD_HU_GANG_SHANG_HUA)&&t.sendNotification(t.XZDDGameSceneMediator.GAME_SHOW_GANG_SHANG_HUA,c.position),X.relationType&&-1!=X.relationType.indexOf(mahjong.XZDD_WinType.MAHJONG_XZDD_HU_HAI_DI_LAO_YUE)&&t.sendNotification(t.XZDDGameSceneMediator.GAME_SHOW_HAI_DI_LAO_YUE,c.position),X.scoreOffset>0&&X.opType==mahjong.XZDD_WinType.MAHJONG_XZDD_GUA_FENG?t.sendNotification(t.XZDDGameSceneMediator.GUA_FENG_OR_XIA_YU,0):X.scoreOffset>0&&X.opType==mahjong.XZDD_WinType.MAHJONG_XZDD_XIA_YU&&t.sendNotification(t.XZDDGameSceneMediator.GUA_FENG_OR_XIA_YU,1))}t.sendNotification(t.XZDDGameSceneMediator.GAME_FLOAT_SCORE,e)},i.prototype.updatePlayerReadyStatus=function(e){var i=t.dataProxy.findPlayerGameInfoByUid(e);i.ready=1,t.sendNotification(t.XZDDGameSceneMediator.GAME_UPDATE_READY)},i.prototype.checkCanDealCards=function(e){var i=t.dataProxy.roomDetailInfo;if(!i)return!1;var a=i?i.state:0;if(4!=a)return!1;var n=t.XZDDStringUtils.getCardType(e),o=t.dataProxy.findPlayerGameInfoByUid(Global.uid);if(o&&o.dq>=0&&n==o.dq)return!0;if(o.card&&-1!=o.card.currentCard){var r=t.XZDDStringUtils.getCardType(o.card.currentCard);if(r==o.dq)return!1}var s=o.card.handCards;if(s){for(var h=0;h<s.length;h++)if(s[h]!=e){var n=t.XZDDStringUtils.getCardType(s[h]);if(n==o.dq)return!1}return!0}return!1},i.prototype.gameComplete=function(e){this.roomDetailInfo&&(this.roomDetailInfo.state=5,this.roomDetailInfo.settlingDTO=e,this.roomDetailInfo.timeout=e.timeout);for(var i=0,a=e.info.length;a>i;i++){var n=e.info[i];t.SettlingInfoDTO.maskNick(n);var o=this.findPlayerGameInfoByUid(n.uid);o.coin=n.coin,o.card=n.card,o.trusteeship=!1}t.sendNotification(t.XZDDGameSceneMediator.SHOW_HU)},i.prototype.findWinnerInSetting=function(){if(t.dataProxy.roomDetailInfo.settlingDTO)for(var e=0,i=t.dataProxy.roomDetailInfo.settlingDTO.info.length;i>e;e++){var a=t.dataProxy.roomDetailInfo.settlingDTO.info[e];if(a.scoreOffset>0)return a}return null},i.prototype.findFuckedInSetting=function(){if(t.dataProxy.roomDetailInfo.settlingDTO)for(var e=0,i=t.dataProxy.roomDetailInfo.settlingDTO.info.length;i>e;e++){var a=t.dataProxy.roomDetailInfo.settlingDTO.info[e];if(a.scoreOffset<0)return a}return null},i.prototype.findSettingById=function(e){if(t.dataProxy.roomDetailInfo.settlingDTO)for(var i=0,a=t.dataProxy.roomDetailInfo.settlingDTO.info.length;a>i;i++){var n=t.dataProxy.roomDetailInfo.settlingDTO.info[i];if(n.uid==e)return n}return null},i.prototype.findSelfInSetting=function(){if(t.dataProxy.roomDetailInfo.settlingDTO)for(var e=0,i=t.dataProxy.roomDetailInfo.settlingDTO.info.length;i>e;e++){var a=t.dataProxy.roomDetailInfo.settlingDTO.info[e];if(a.uid==Global.uid)return a}return null},i.prototype.someOneJoin=function(e){if(e.uid!=Global.uid){t.PlayerDTO.maskNick(e),t.dataProxy.roomDetailInfo.info.push(e);var i=t.XZDDPositionUtils.getUIPosByServerPos(e.position);t.sendNotification(t.XZDDGameSceneMediator.SOME_ONE_JOIN,i)}},i.prototype.someOneLeave=function(e){var i=t.dataProxy.findPlayerGameInfoByUid(e);if(i&&-1!=i.uid){var a=t.dataProxy.roomDetailInfo.info.indexOf(i),n=t.XZDDPositionUtils.getUIPosByServerPos(i.position);t.dataProxy.roomDetailInfo.info.splice(a,1),n>=0&&t.sendNotification(t.XZDDGameSceneMediator.SOME_ONE_LEAVE,n)}},i.prototype.updateRecordCard=function(){if(this.roomDetailInfo&&this.roomDetailInfo.info){for(var e=[],i=0,a=this.roomDetailInfo.info.length;a>i;i++){var n=this.roomDetailInfo.info[i];if(n&&n.card&&(n.card.discards&&(e=e.concat(n.card.discards)),n.isHu&&-1!=n.huCard&&e.push(n.huCard),n.card.meldCards))for(var o=0,r=n.card.meldCards.length;r>o;o++){var s=n.card.meldCards[o];s&&-1!=s[0]?e=e.concat(s):n.uid==Global.uid&&s&&-1==s[0]&&-1!=s[3]&&(e.push(s[3]),e.push(s[3]),e.push(s[3]),e.push(s[3]))}}t.trace("更新记牌器("+e.length+"张): "+e.join(",")),mahjong.MahjongTool.updateDiscard(e)}},i.prototype.findPlayerGameInfoBySeat=function(t){if(!this.roomDetailInfo||!this.roomDetailInfo.info)return null;for(var e=0,i=this.roomDetailInfo.info.length;i>e;e++){var a=this.roomDetailInfo.info[e];if(a.position==t)return a}return null},i.prototype.findPlayerGameInfoByUISeat=function(e){if(!this.roomDetailInfo||!this.roomDetailInfo.info)return null;for(var i=0,a=this.roomDetailInfo.info.length;a>i;i++){var n=this.roomDetailInfo.info[i];if(t.XZDDPositionUtils.getUIPosByServerPos(n.position)==e)return n}return null},i.prototype.getCountMornThanThreeByType=function(t){for(var e=this.findPlayerGameInfoByUid(Global.uid),i=null==e.card?[]:e.card.handCards,a=null,n=0,o=0;o<i.length;o++){var r=i[o];int_XY(r/9)==t&&n++}return n>=3&&(a={type:t,count:n}),a},i.prototype.checkMyLessType=function(){var e=this.findPlayerGameInfoByUid(t.dataProxy.myUid),i=null==e.card?[]:e.card.handCards,a=[],n=[],o=[];if(i&&i.length>0){for(var r=0;r<i.length;r++){var s=i[r];0==int_XY(s/9)?a.push(0):1==int_XY(s/9)?n.push(1):2==int_XY(s/9)&&o.push(2)}return a.length<=n.length?a.length<=o.length?0:2:n.length<=o.length?1:2}return-1},i.prototype.findPlayerGameInfoByUid=function(t){if(!this.roomDetailInfo||!this.roomDetailInfo.info)return null;for(var e=0,i=this.roomDetailInfo.info.length;i>e;e++){var a=this.roomDetailInfo.info[e];if(a.uid==t)return a}return null},i.prototype.dispose=function(){this.centerConfig=null,this.roomDetailInfo=null,this.fullCards=null,this.currentCheckResults=null,this.replayVo&&this.replayVo.stopAndClear(),this.replayVo=null},i.NAME=GameIdEnum.XZDD+"XZDDDataProxy",i}(puremvc.Proxy);t.XZDDDataProxy=e,__reflect(e.prototype,"XZDD.XZDDDataProxy")}(XZDD||(XZDD={}));var XZDD;!function(t){var e=function(){function t(){}return t}();t.DqResultDTO=e,__reflect(e.prototype,"XZDD.DqResultDTO")}(XZDD||(XZDD={}));var XZDD;!function(t){var e=function(){function t(){}return t}();t.MahjongGameActionDTO=e,__reflect(e.prototype,"XZDD.MahjongGameActionDTO")}(XZDD||(XZDD={}));var XZDD;!function(t){var e=function(){function t(){}return t.prototype.fromThreeCard=function(t,e){t.sort(function(t,e){return e>t?-1:t==e?0:1}),this.card=e,t[0]==e?this.type=1:t[1]==e?this.type=2:this.type=3},t}();t.MahjongGameChowDTO=e,__reflect(e.prototype,"XZDD.MahjongGameChowDTO")}(XZDD||(XZDD={}));var XZDD;!function(t){var e=function(){function t(){}return t}();t.MahjongGameTurnDTO=e,__reflect(e.prototype,"XZDD.MahjongGameTurnDTO")}(XZDD||(XZDD={}));var XZDD;!function(t){var e=function(){function t(){this.isYiPaoDuoXiang=!1}return t}();t.OpScoreOffsetDTO=e,__reflect(e.prototype,"XZDD.OpScoreOffsetDTO")}(XZDD||(XZDD={}));var XZDD;!function(t){var e=function(){function e(){this.isHu=!1,this.isFucked=!1}return e.maskNick=function(e){e&&(e.name=maskNick_XY(e.name,e.uid,t.dataProxy.roomDetailInfo&&t.dataProxy.roomDetailInfo.friends,t.dataProxy.centerConfig&&t.dataProxy.centerConfig.replayMode))},e}();t.PlayerDTO=e,__reflect(e.prototype,"XZDD.PlayerDTO")}(XZDD||(XZDD={}));var XZDD;!function(t){var e=function(){function t(){}return t}();t.PlayerOpDTO=e,__reflect(e.prototype,"XZDD.PlayerOpDTO")}(XZDD||(XZDD={}));var XZDD;!function(t){var e=function(){function t(){}return t}();t.SettlingDTO=e,__reflect(e.prototype,"XZDD.SettlingDTO")}(XZDD||(XZDD={}));var XZDD;!function(t){var e=function(){function e(){}return e.maskNick=function(e){e&&(e.name=maskNick_XY(e.name,e.uid,t.dataProxy.roomDetailInfo&&t.dataProxy.roomDetailInfo.friends,t.dataProxy.centerConfig&&t.dataProxy.centerConfig.replayMode))},e}();t.SettlingInfoDTO=e,__reflect(e.prototype,"XZDD.SettlingInfoDTO")}(XZDD||(XZDD={}));var XZDD;!function(t){var e=function(){function t(){}return t}();t.SettlingPlayerDTO=e,__reflect(e.prototype,"XZDD.SettlingPlayerDTO")}(XZDD||(XZDD={}));var XZDD;!function(t){var e=function(){function t(){}return t}();t.SnapshotDTO=e,__reflect(e.prototype,"XZDD.SnapshotDTO")}(XZDD||(XZDD={}));var XZDD;!function(t){var e=function(){function t(){}return t}();t.UserMahjongDTO=e,__reflect(e.prototype,"XZDD.UserMahjongDTO")}(XZDD||(XZDD={}));var XZDD;!function(t){var e=function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t.stepTimeGapMs=1e3,t}return __extends(i,e),i.prototype.init=function(t){this.index=0,this.data=t,this.max=t.length,this.stepTimeGapMs=2e3,this.speed=1,this.autoPlay=!1,egret.clearInterval(this.autoPlayTimer)},i.prototype.startAutoPlay=function(){this.autoPlay=!0,t.dataProxy.centerConfig.socketProxy.replayData(this.data[0]),this.index=1,egret.clearInterval(this.autoPlayTimer),this.autoPlayTimer=egret.setInterval(this.onPlayTimer,this,this.stepTimeGapMs/this.speed),this.isPlaying=!0},i.prototype.showPrevFrame=function(){this.index<=1||(this.index--,t.dataProxy.centerConfig.socketProxy.replayData(this.data[this.index-1]))},i.prototype.showNextFrame=function(){this.index>=this.max||(this.index++,t.dataProxy.centerConfig.socketProxy.replayData(this.data[this.index-1]))},i.prototype.jumpToPersent=function(e){0>e&&(e=0),e>1&&(e=1),this.index=int_XY(this.max*e),t.dataProxy.centerConfig.socketProxy.replayData(this.data[this.index-1])},i.prototype.pause=function(){egret.clearInterval(this.autoPlayTimer),this.isPlaying=!1},i.prototype.resume=function(){egret.clearInterval(this.autoPlayTimer),this.autoPlayTimer=egret.setInterval(this.onPlayTimer,this,this.stepTimeGapMs/this.speed),this.isPlaying=!0},i.prototype.changePlaySpeed=function(t){this.speed=t,this.isPlaying&&(egret.clearInterval(this.autoPlayTimer),this.autoPlayTimer=egret.setInterval(this.onPlayTimer,this,this.stepTimeGapMs/this.speed))
},i.prototype.stopAndClear=function(){egret.clearInterval(this.autoPlayTimer),this.data=null,this.isPlaying=!1},i.prototype.onPlayTimer=function(){this.index++,this.index>this.max?egret.clearInterval(this.autoPlayTimer):(t.dataProxy.centerConfig.socketProxy.replayData(this.data[this.index-1]),this.dispatchEventWith(i.E_PROGRESS,!1,this.index/this.max))},i.E_PROGRESS="E_PROGRESS",i}(egret.EventDispatcher);t.XZDDReplayVo=e,__reflect(e.prototype,"XZDD.XZDDReplayVo")}(XZDD||(XZDD={}));var XZDD;!function(t){var e=function(){function t(){}return t.hasValid=function(e){return-1!=e.indexOf(t.chi)||-1!=e.indexOf(t.peng)||-1!=e.indexOf(t.ming_gang)||-1!=e.indexOf(t.bu_gang)||-1!=e.indexOf(t.an_gang)||-1!=e.indexOf(t.ting)||-1!=e.indexOf(t.hu)},t.da_pai=1,t.mo_pai=2,t.chi=11,t.peng=22,t.ming_gang=31,t.bu_gang=32,t.an_gang=33,t.huan_hua=44,t.ting=88,t.hu=99,t.pass=999,t}();t.Action=e,__reflect(e.prototype,"XZDD.Action")}(XZDD||(XZDD={}));var XZDD;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.execute=function(e){var a=puremvc.Facade.getInstance(GameIdEnum.XZDD);a.removeCommand(t.XZDDExitCommand.NAME),a.removeCommand(i.NAME),a.removeMediator(t.XZDDSocketMediator.NAME),a.removeMediator(t.XZDDGameSceneMediator.NAME),a.removeProxy(t.XZDDDataProxy.NAME),t.dataProxy&&t.dataProxy.dispose(),t.dataProxy=null},i.NAME=GameIdEnum.XZDD+"RegisteMVCCommand",i}(puremvc.SimpleCommand);t.XZDDDisposeMVCCommand=e,__reflect(e.prototype,"XZDD.XZDDDisposeMVCCommand")}(XZDD||(XZDD={}));var XZDD;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.execute=function(t){Global.onEvent(EventEnum.EXIT_GAME_G_to_P),bridge_iframe.sendMsgToHall(EventEnum.EXIT_GAME_G_to_P)},e.NAME=GameIdEnum.XZDD+"XZDDExitCommand",e}(puremvc.SimpleCommand);t.XZDDExitCommand=e,__reflect(e.prototype,"XZDD.XZDDExitCommand")}(XZDD||(XZDD={}));var XZDD;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.execute=function(e){var i=puremvc.Facade.getInstance(GameIdEnum.XZDD),a=e.getBody()[0];i.registerProxy(t.dataProxy),i.registerMediator(new t.XZDDSocketMediator),i.registerMediator(new t.XZDDGameSceneMediator(a.gameLayer)),i.registerMediator(new t.XZDDReadmeMediator(a.popupLayer)),i.registerMediator(new t.XZDDResultMediator(a.popupLayer)),i.registerMediator(new t.XZDDHackMediator(a.popupLayer)),t.dataProxy.centerConfig.replayMode&&i.registerMediator(new t.XZDDReplayMediator(a.msgLayer)),i.registerCommand(t.XZDDExitCommand.NAME,t.XZDDExitCommand),i.registerCommand(t.XZDDDisposeMVCCommand.NAME,t.XZDDDisposeMVCCommand)},i.NAME=GameIdEnum.XZDD+"RegisteMVCCommand",i}(puremvc.SimpleCommand);t.XZDDRegisteMVCCommand=e,__reflect(e.prototype,"XZDD.XZDDRegisteMVCCommand")}(XZDD||(XZDD={}));var XZDD;!function(t){var e=function(){function t(){}return t.TABLE_CHAT_C=31,t.TABLE_CHAT_B=32,t.TABLE_TRY_TO_LEAVE_C=91,t.TABLE_LEAVE_S=92,t.TABLE_NOT_EXISTS_S=99,t.XZDD_GET_SNAPSHOT_C=1e3,t.XZDD_REFRESH_SNAPSHOT_S=1001,t.XZDD_REFRESH_TABLE_ID_B=1002,t.XZDD_STATE_PREPARE_B=1003,t.XZDD_STATE_START_B=1004,t.XZDD_TRUSTEESHIP_C=1005,t.XZDD_TRUSTEESHIP_S=1006,t.XZDD_STATE_THREE_B=1007,t.XZDD_THREE_C=1008,t.XZDD_THREE_MY_B=1009,t.XZDD_THREE_S=1010,t.XZDD_STATE_DQ_B=1011,t.XZDD_DQ_C=1012,t.XZDD_DQ_MY_B=1013,t.XZDD_DQ_ALL_B=1014,t.XZDD_PLAYER_OP_SCOREOFFSET=1015,t.XZDD_CONTINUE_C=1016,t.XZDD_STATE_END_B=1017,t.XZDD_JOIN_B=1018,t.XZDD_LEAVE_B=1019,t.XZDD_OP_C=1020,t.XZDD_OP_S=1021,t.XZDD_DEFEAT_B=1022,t.XZDD_OPERATE_FAIL_S=1023,t.XZDD_QIANG_GANG_HU_REFUND_GANG_COIN_B=1024,t.XZDD_READY_C=1025,t.XZDD_READY_B=1026,t.MAHJONG_DA_C=9001,t.MAHJONG_CHI_C=9002,t.MAHJONG_PENG_C=9003,t.MAHJONG_MING_GANG_C=9011,t.MAHJONG_JIA_GANG_C=9012,t.MAHJONG_AN_GANG_C=9013,t.MAHJONG_TING_C=9018,t.MAHJONG_HU_C=9020,t.MAHJONG_PASS_C=9031,t.MAHJONG_TURN_B=9901,t.MAHJONG_ACTION_B=9949,t.MAHJONG_SHOW_ME_THE_MONEY_C=9881,t.MAHJONG_SHOW_ME_THE_MONEY_S=9882,t.MAHJONG_BLACK_SHEEP_WALL_C=9883,t}();t.XZDDProtocol=e,__reflect(e.prototype,"XZDD.XZDDProtocol")}(XZDD||(XZDD={}));var XZDD;!function(t){function e(e,a){void 0===a&&(a={});var n=puremvc.Facade.getInstance(GameIdEnum.XZDD);if(n){var o=n.retrieveMediator(i.NAME);o?o.sendMessage(e,a):t.warn("XZDD的XZDDSocketMediator已经销毁")}else t.warn("XZDD的facade已经销毁")}var i=function(i){function a(){var e=i.call(this,a.NAME)||this;return e.currentIP=null,e.roomStr=0,e.serverDataStack=[],e.topic=t.dataProxy.centerConfig.moduleType+TopicType.HD_LOGIC,t.dataProxy.centerConfig.socketProxy.addHandler(e.topic,e),Global.eventCenter.addEventListener("mqtt_reconnecting",e.onReconnecting,e),Global.eventCenter.addEventListener("mqtt_reconnect_ok",e.onReconnectOk,e),e}return __extends(a,i),a.prototype.onRemove=function(){i.prototype.onRemove.call(this),t.dataProxy.centerConfig.socketProxy.clearHandlers(this.topic),Global.eventCenter.removeEventListener("mqtt_reconnecting",this.onReconnecting,this),Global.eventCenter.removeEventListener("mqtt_reconnect_ok",this.onReconnectOk,this)},a.prototype.listNotificationInterests=function(){return[a.START_CONNECT,a.SHIFT_ALL_SERVER_DATA,a.SWITCH_ROOM]},a.prototype.handleNotification=function(i){switch(i.getName()){case a.START_CONNECT:break;case a.SHIFT_ALL_SERVER_DATA:this.shiftAllServerData();break;case a.SWITCH_ROOM:e(t.XZDDProtocol.TABLE_TRY_TO_LEAVE_C,999999)}},a.prototype.shiftAllServerData=function(){for(t.trace("开始处理所有堆栈中的服务器消息");this.serverDataStack.length>0;){var e=this.serverDataStack.shift();this.executeServerData(e.cmd,e.data,e.fromData)}t.trace("所有堆栈中的服务器消息处理完毕")},a.prototype.handle=function(e,i,a){t.trace("receive cmd ["+e+"], data:",i);{if(e!=SocketProxy.CMD_REPLAY)return e==t.XZDDProtocol.XZDD_REFRESH_SNAPSHOT_S||e==t.XZDDProtocol.TABLE_NOT_EXISTS_S||e==t.XZDDProtocol.TABLE_LEAVE_S||this.roomInfoInited?(this.executeServerData(e,i,a),!0):void t.trace("房间数据没有初始化, 当前消息抛弃!");if(i==t.dataProxy.replayVo.data[t.dataProxy.replayVo.data.length-1])t.dataProxy.gameComplete(i);else{var n=i;t.dataProxy.updateRoomDetailInfo(n),this.roomInfoInited=!0,t.sendNotification(t.XZDDResultMediator.HIDE)}}},a.prototype.cmdNeedToStack=function(e){return e==t.XZDDProtocol.TABLE_LEAVE_S?!1:!0},a.prototype.executeServerData=function(e,i,a){switch(e){case t.XZDDProtocol.XZDD_REFRESH_SNAPSHOT_S:var n=i;t.dataProxy.updateRoomDetailInfo(n),this.roomInfoInited=!0,DevelopMain.dataInited=!0,t.sendNotification(t.XZDDGameSceneMediator.UPDATE_ROOM_DETAIL_INFO);break;case t.XZDDProtocol.XZDD_STATE_PREPARE_B:t.dataProxy.changeToPrepare(i);break;case t.XZDDProtocol.XZDD_STATE_START_B:var n=i;t.dataProxy.updateRoomDetailInfo(n),t.sendNotification(t.XZDDGameSceneMediator.CHANGE_TO_START);break;case t.XZDDProtocol.XZDD_OPERATE_FAIL_S:var o=i,r="";o&&(r=format_XY2(t.i18n(o.m),o.a),Toast.show(r));break;case t.XZDDProtocol.XZDD_STATE_THREE_B:var s=i;t.dataProxy.changeSnapshotDTO(s);break;case t.XZDDProtocol.XZDD_READY_B:var h=i;t.dataProxy.updatePlayerReadyStatus(h);break;case t.XZDDProtocol.TABLE_CHAT_B:var l=i;if(!l)return;var d=t.dataProxy.findPlayerGameInfoByUid(l.uid);if(!d)return;var c=t.XZDDPositionUtils.getUIPosByServerPos(d.position);if(-1==c)return;ChatManager.showChatAt(c,l,1==d.gender);break;case t.XZDDProtocol.XZDD_THREE_MY_B:var u=i;t.dataProxy.changePlayerCards(u);break;case t.XZDDProtocol.XZDD_THREE_S:var D=i,p=D[0],f=D[1];t.dataProxy.changeCardOver(p,f);break;case t.XZDDProtocol.XZDD_STATE_DQ_B:var _=i;t.dataProxy.changeDqState(_);break;case t.XZDDProtocol.XZDD_DQ_MY_B:var y=i;t.dataProxy.someOneDQ(y);break;case t.XZDDProtocol.XZDD_DQ_ALL_B:var g=i;t.dataProxy.setAllDqOver(g);break;case t.XZDDProtocol.XZDD_PLAYER_OP_SCOREOFFSET:var m=i;t.dataProxy.updatePlayerActionEffect(m);break;case t.XZDDProtocol.XZDD_QIANG_GANG_HU_REFUND_GANG_COIN_B:var v=i;t.dataProxy.updatePlayerCoins(v);break;case t.XZDDProtocol.XZDD_STATE_END_B:t.dataProxy.gameComplete(i);break;case t.XZDDProtocol.XZDD_JOIN_B:t.dataProxy.someOneJoin(i);break;case t.XZDDProtocol.XZDD_LEAVE_B:t.dataProxy.someOneLeave(i);break;case t.XZDDProtocol.MAHJONG_TURN_B:var X=i;t.dataProxy.updateTurn(X);break;case t.XZDDProtocol.MAHJONG_ACTION_B:var T=i;t.dataProxy.updateAction(T);break;case t.XZDDProtocol.XZDD_TRUSTEESHIP_S:t.dataProxy.updateTuoguan(i);break;case t.XZDDProtocol.MAHJONG_SHOW_ME_THE_MONEY_S:i&&i.length>0?t.sendNotification(t.XZDDHackMediator.SHOW,i):Toast.show(t.i18n("牌局开始后，才可使用选牌功能"));break;case t.XZDDProtocol.XZDD_OP_S:var E=i;t.sendNotification(t.XZDDGameSceneMediator.ALL_DETAIL_INFO,E);break;case t.XZDDProtocol.XZDD_DEFEAT_B:var C=i;t.dataProxy.changeFucked(C);break;case t.XZDDProtocol.TABLE_LEAVE_S:var r="",P=i,I=P.s;if(0>I)r=format_XY2(t.i18n(i.m),i.a),Toast.show(r),SimpleLoading.hide();else if(888888==I)this.roomInfoInited=!1,t.dataProxy.gameExited=!0,DevelopMain.dataInited=!1;else if(999999==I){this.roomInfoInited=!1,t.dataProxy.gameExited=!0,DevelopMain.dataInited=!1,t.dataProxy.lastGamePlayerIds=[],null!=P.m&&""!=P.m&&(r=format_XY2(t.i18n(P.m),P.a),Toast.show(r));var Z=new JoinDTO(t.dataProxy.centerConfig.moduleType,P.d);t.dataProxy.centerConfig.socketProxy.sendMessage(ModuleType.MODULE_LOBBY+TopicType.HD_SWITCHTABLE,t.dataProxy.centerConfig.type,t.dataProxy.centerConfig.area,0,Z)}else this.roomInfoInited=!1,t.dataProxy.gameExited=!0,DevelopMain.dataInited=!1,SocketManager.getInstance().disconnect(),P.m?t.alert(format_XY2(t.i18n(P.m),P.a),function(){t.sendNotification(t.XZDDExitCommand.NAME)}):t.sendNotification(t.XZDDExitCommand.NAME);break;case t.XZDDProtocol.TABLE_NOT_EXISTS_S:t.alert(t.i18n("房间已解散，请重新进入房间."),function(){t.sendNotification(t.XZDDExitCommand.NAME)});break;case t.XZDDProtocol.XZDD_REFRESH_TABLE_ID_B:t.dataProxy.updateTableId(i)}},a.prototype.onReconnecting=function(){this.roomInfoInited=!1,SimpleLoading.show(t.i18n("网络异常，游戏重连中...")),t.trace("网络断开，开始重连")},a.prototype.onReconnectOk=function(){SimpleLoading.hide(),t.trace("重连成功！"),this.sendMessage(t.XZDDProtocol.XZDD_GET_SNAPSHOT_C)},a.prototype.sendMessage=function(e,i){t.dataProxy.centerConfig.socketProxy.sendMessage(this.topic,t.dataProxy.centerConfig.type,t.dataProxy.centerConfig.area,e,i),t.trace("send cmd ["+e+"], data:",i)},a.NAME=GameIdEnum.XZDD+"XZDDSocketMediator",a.START_CONNECT=a.NAME+"START_CONNECT",a.SHIFT_ALL_SERVER_DATA=a.NAME+"SHIFT_ALL_SERVER_DATA",a.SWITCH_ROOM=a.NAME+"SWITCH_ROOM",a}(puremvc.Mediator);t.XZDDSocketMediator=i,__reflect(i.prototype,"XZDD.XZDDSocketMediator",["ISocketDataHandler"]),t.sendSocketMessage=e}(XZDD||(XZDD={}));var XZDD;!function(t){var e=function(t){function e(i,a,n,o,r){var s=t.call(this)||this;return s.id=e.counter++,s.source=i,s.callback=a,s.focusIncall=o,s.focusOutcall=r,s.thisObj=n,s.defaultY=i.y,s.setEnable(!0),i.addEventListener(egret.TouchEvent.TOUCH_BEGIN,s.onBegin,s),Global.stage.addEventListener(egret.TouchEvent.TOUCH_END,s.onEnd,s),e.allTaps.push(s),s}return __extends(e,t),e.init=function(){},e.prototype.onTap=function(t){t&&(t.stopPropagation(),t.stopImmediatePropagation(),t.preventDefault()),this.isSwiped||(this.focused?this.doCall():(this.focusIncall&&this.focusIncall.apply(this.thisObj,[this.source]),this.focused=!0,this.updateFocus()))},e.prototype.onBegin=function(t){this.locX=t.stageX,this.locY=t.stageY,this.isSwiped=!1,this.beginCanUse=!0,this.bornX=this.source.x,this.bornY=this.source.y,this.source.parent&&this.source.parent.addChild(this.source),this.source.parent&&this.source.parent.parent&&this.source.parent.parent.parent&&this.source.parent.parent.parent.addChild(this.source.parent.parent),Global.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMove,this)},e.prototype.onMove=function(t){this.source.x=this.bornX+t.stageX-this.locX,this.source.y=this.bornY+t.stageY-this.locY},e.prototype.onEnd=function(t){if(!this.beginCanUse)return void this.focusOut();Global.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMove,this),this.source.x=this.bornX,this.source.y=this.bornY,this.beginCanUse=!1;var e=t.stageX-this.locX,i=t.stageY-this.locY,a=0;return Math.abs(i)<150?(t.stopPropagation(),t.stopImmediatePropagation(),t.preventDefault(),void(Math.abs(i)<50&&Math.abs(e)<50?this.onTap():(this.isSwiped=!0,this.focusOut()))):(a=i>0?1:0,void(0==a?(this.focused=!1,this.updateFocus(),this.doCall(),this.isSwiped=!0):1==a&&(this.isSwiped=!0,this.focused=!1,this.focusOut())))},e.prototype.focusOut=function(){this.focused&&(this.focusOutcall&&this.focusOutcall.apply(this.thisObj,[this.source]),this.focused=!1,this.updateFocus())},e.prototype.doCall=function(){this.callback.apply(this.thisObj,[this.source]),this.focused=!1},e.prototype.updateFocus=function(){if(this.updateView(),this.focused)for(var t=0,i=e.allTaps.length;i>t;t++){var a=e.allTaps[t];a!=this&&(a.focused=!1,a.updateView())}},e.prototype.updateView=function(){Tween$.removeTweens(this.source);var t=this.focused?this.defaultY-40:this.defaultY;Tween$.get(this.source).to({y:t},50)},e.prototype.setEnable=function(t){this.source.touchEnabled=t,this.source.touchChildren=!1,this.focused=!1},e.prototype.updateDefaultY=function(){this.defaultY=this.source.y},e.prototype.dispose=function(){this.source&&(this.source.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this),this.source.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBegin,this),this.source.removeEventListener(egret.TouchEvent.TOUCH_END,this.onEnd,this)),Global.stage.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.focusOut,this),Global.stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.onEnd,this),Global.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMove,this),this.source&&Tween$.removeTweens(this.source),this.focused=!1,this.beginCanUse=!1,this.isSwiped=!1,this.source=null,this.callback=null,this.thisObj=null,this.focusIncall=null,this.focusOutcall=null;var t=e.allTaps.indexOf(this);e.allTaps.splice(t,1)},e.allTaps=[],e.counter=0,e.inited=!1,e}(egret.EventDispatcher);t.XZDDMahjongUserTap=e,__reflect(e.prototype,"XZDD.XZDDMahjongUserTap")}(XZDD||(XZDD={}));var XZDD;!function(t){var e=function(){function e(){}return e.getUIPosByServerPos=function(e){var i=t.dataProxy.selfIndex,a=this.DONG,n=this.NAN,o=this.XI,r=this.BEI;if(i==a){if(e==a)return 1;if(e==n)return 2;if(e==o)return 3;if(e==r)return 0}if(i==n){if(e==a)return 0;if(e==n)return 1;if(e==o)return 2;if(e==r)return 3}if(i==o){if(e==a)return 3;if(e==n)return 0;if(e==o)return 1;if(e==r)return 2}if(i==r){if(e==a)return 2;if(e==n)return 3;if(e==o)return 0;if(e==r)return 1}return-1},e.DONG=0,e.NAN=1,e.XI=2,e.BEI=3,e}();t.XZDDPositionUtils=e,__reflect(e.prototype,"XZDD.XZDDPositionUtils")}(XZDD||(XZDD={}));var XZDD;!function(t){var e=function(){function e(){}return e.dispose=function(){this.stopBgm(),SoundManager.dispose(GameIdEnum.XZDD)},e.bgm=function(){this.play("ready",!0)},e.stopBgm=function(){var t=GameIdEnum.XZDD+"_ready_mp3";SoundManager.stop(t,!0)},e.dice=function(){this.play("roll_sice")},e.win=function(){this.play("win")},e.lose_liuju=function(){this.play("lose_liu")},e.chooseCard=function(){this.play("select")},e.gameStart=function(){this.play("beganGame")},e.clock=function(){this.play("clock")},e.dapai=function(){this.play("out_card")},e.hu=function(e,i){var a=1==t.dataProxy.findPlayerGameInfoByUid(e).gender?"man_":"woman_",n=a;n+=i?"zimo":"hu",this.play(n),this.play("hu_shan")},e.action=function(e){var i=1==t.dataProxy.findPlayerGameInfoByUid(e.uid).gender?"man_":"woman_",a="",n=mahjong.helpCard0.buildByCardID(e.card);switch(e.action){case t.Action.da_pai:this.dapai(),n.type==mahjong.Type.BAMBOO||n.type==mahjong.Type.CHARACTER||n.type==mahjong.Type.DOT?(n.type==mahjong.Type.BAMBOO?a="tiao_":n.type==mahjong.Type.CHARACTER&&(a="w_"),n.type==mahjong.Type.DOT&&(a="tong_"),a+=n.point+1+""):n.type==mahjong.Type.ZI?n.point==mahjong.Point.EAST_WIND?a="f_1":n.point==mahjong.Point.SOUTH_WIND?a="f_2":n.point==mahjong.Point.WEST_WIND?a="f_3":n.point==mahjong.Point.NORTH_WIND?a="f_4":n.point==mahjong.Point.RED_DRAGON?a="f_5":n.point==mahjong.Point.GREEN_DRAGON?a="f_6":n.point==mahjong.Point.WHITE_DRAGON&&(a="f_7"):t.warn("未处理的声音："+n.toString());break;case t.Action.chi:a="chi";break;case t.Action.peng:a="peng";break;case t.Action.ting:a="ting";break;case t.Action.ming_gang:case t.Action.bu_gang:a="gang";break;case t.Action.an_gang:a="angang";break;case t.Action.hu:a=e.lastOpUid==e.uid?"zimo":"hu";break;case t.Action.huan_hua:a="buhua"}""!=a&&(a=i+a),this.play(a)},e.play=function(t,e){void 0===e&&(e=!1),""!=t&&(t=GameIdEnum.XZDD+"_"+t+"_mp3",RES.getRes(t)&&(e?SoundManager.playBg(t,0,-1):SoundManager.playEffect(t)))},e}();t.XZDDSoundPlayer=e,__reflect(e.prototype,"XZDD.XZDDSoundPlayer")}(XZDD||(XZDD={}));var XZDD;!function(t){var e=function(){function e(){}return e.init=function(){this.idArr=mahjong.XZDDTool.idArr,this.nameArr=[t.i18n("平胡"),t.i18n("对对胡"),t.i18n("清一色"),t.i18n("带幺九"),t.i18n("七对"),t.i18n("大清对"),t.i18n("将对"),t.i18n("龙七对"),t.i18n("清七对"),t.i18n("清幺九"),t.i18n("清龙七对"),t.i18n("地胡"),t.i18n("天胡"),t.i18n("刮风"),t.i18n("补杠"),t.i18n("下雨"),t.i18n("海底捞月"),t.i18n("杠上花"),t.i18n("自摸"),t.i18n("杠上炮"),t.i18n("抢杠"),t.i18n("1根"),t.i18n("2根"),t.i18n("3根"),t.i18n("金钩钩"),t.i18n("杠牌"),t.i18n("查大叫"),t.i18n("查花猪"),t.i18n("退税")]},e.getHuName=function(t){var e=this.idArr.indexOf(t);return-1!=e?this.nameArr[e]:""},e.getArtCardRes=function(e){var i=mahjong.helpCard0.buildByCardID(e),a=0;switch(mahjong.helpCard0.type){case mahjong.Type.BAMBOO:a=i.point+1;break;case mahjong.Type.DOT:a=i.point+11;break;case mahjong.Type.CHARACTER:a=i.point+21;break;case mahjong.Type.ZI:case mahjong.Type.FLOWER:switch(i.point){case mahjong.Point.RED_DRAGON:a=31;break;case mahjong.Point.GREEN_DRAGON:a=32;break;case mahjong.Point.WHITE_DRAGON:a=33;break;case mahjong.Point.EAST_WIND:a=34;break;case mahjong.Point.SOUTH_WIND:a=35;break;case mahjong.Point.WEST_WIND:a=36;break;case mahjong.Point.NORTH_WIND:a=37;break;case mahjong.Point.FLOWER_CHUN:a=42;break;case mahjong.Point.FLOWER_XIA:a=43;break;case mahjong.Point.FLOWER_QIU:a=44;break;case mahjong.Point.FLOWER_DONG:a=45;break;case mahjong.Point.FLOWER_MEI:a=38;break;case mahjong.Point.FLOWER_LAN:a=39;break;case mahjong.Point.FLOWER_ZHU:a=40;break;case mahjong.Point.FLOWER_JU:a=41}}return 0==a&&t.trace(1111),"XZDD_card_"+a+"_png"},e.getCardType=function(t){return int_XY(t/9)},e.getCardPoint=function(t){return t%9},e.idArr=[],e.nameArr=[],e}();t.XZDDStringUtils=e,__reflect(e.prototype,"XZDD.XZDDStringUtils")}(XZDD||(XZDD={}));var XZDD;!function(t){function e(t,e){a.init(),a.instance.showAlert(t,e)}function i(t,e,i){a.init(),a.instance.showConfirm(t,e,i)}var a=function(t){function e(){var e=t.call(this,"XZDDAlertSkin")||this;return i18nEUI(GameIdEnum.XZDD,e,[e.okBtn,e.cancelBtn]),bindTapEvent_XY(e.okBtn,e.onOk,e,!1,null,!1,!0),bindTapEvent_XY(e.cancelBtn,e.onNo,e,!1,null,!1,!0),bindTapEvent_XY(e.closeBtn,e.onClose,e,!0),e}return __extends(e,t),e.init=function(){e.instance=e.instance||new e},e.dispose=function(){e.instance&&e.instance.dispose(),e.instance=null},e.prototype.dispose=function(){t.prototype.dispose.call(this),this.okCall=null,this.cancelCall=null,clearTapEvent_XY(this.okBtn,this.onOk,this),clearTapEvent_XY(this.cancelBtn,this.onNo,this),clearTapEvent_XY(this.closeBtn,this.onClose,this)},e.prototype.onOk=function(){this.okCall&&this.okCall(),this.hide()},e.prototype.onNo=function(){this.cancelCall&&this.cancelCall(),this.hide()},e.prototype.onClose=function(){this.hide()},e.prototype.showAlert=function(t,e){this.okCall=e;var i=puremvc.Facade.getInstance(GameIdEnum.XZDD).layout;i.msgLayer.addChild(this),setHtmlText(this.tf,t),remove_XY(this.cancelBtn),this.okBtn.x=0,tween_XY_alphaShow(this)},e.prototype.showConfirm=function(t,e,i){this.okCall=e,this.cancelCall=i;var a=puremvc.Facade.getInstance(GameIdEnum.XZDD).layout;a.msgLayer.addChild(this),setHtmlText(this.tf,t),this.btnGrp.addChild(this.cancelBtn),tween_XY_alphaShow(this),this.okBtn.x=248},e.prototype.hide=function(){this.okCall=null,this.cancelCall=null,remove_XY(this)},e}(BaseComponent);t.XYAlert=a,__reflect(a.prototype,"XZDD.XYAlert"),t.alert=e,t.confirm=i}(XZDD||(XZDD={}));var XZDD;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.mLabel="",e.mLabelSize=30,bindEuiCreateOkEventOnce_XY(e,e.onInit,e),e.isEnable=!0,e}return __extends(e,t),e.prototype.onInit=function(){setHtmlText(this.tf,this.mLabel),this.bg.source="XZDD_btn_tb2_png",this.a_labelColor=14868963,this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onEffectBeginTouchHandler,this),this.addEventListener(egret.TouchEvent.TOUCH_CANCEL,this.onEffectEndTouchHandler,this),this.addEventListener(egret.TouchEvent.TOUCH_END,this.onEffectEndTouchHandler,this),this.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onEffectEndTouchHandler,this)},e.prototype.onEffectBeginTouchHandler=function(){this.isEnable&&(this.bg.source="XZDD_btn_tb1_png",this.a_labelColor=4925952,this.useTapSound&&SoundManager.playEffect(__tapSound))},e.prototype.onEffectEndTouchHandler=function(){this.isEnable&&(this.bg.source="XZDD_btn_tb2_png",this.a_labelColor=14868963)},e.prototype.setEnalble=function(t){this.touchEnabled=t,this.touchChildren=t,this.isEnable=t,t?(this.bg.source="XZDD_btn_tb2_png",this.a_labelColor=14868963):(this.bg.source="XZDD_btn_an2_png",this.a_labelColor=4211011)},e.prototype.dispose=function(){this.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onEffectBeginTouchHandler,this),this.removeEventListener(egret.TouchEvent.TOUCH_CANCEL,this.onEffectEndTouchHandler,this),this.removeEventListener(egret.TouchEvent.TOUCH_END,this.onEffectEndTouchHandler,this),this.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onEffectEndTouchHandler,this)},e.prototype.setHtmlLabel=function(t){this.mLabel=t,this.tf&&setHtmlText(this.tf,t)},Object.defineProperty(e.prototype,"a_label",{get:function(){return this.mLabel},set:function(t){this.mLabel=t,this.tf&&setHtmlText(this.tf,t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"a_labelSize",{get:function(){return this.mLabelSize},set:function(t){this.mLabelSize=t,this.tf&&(this.tf.size=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"a_labelColor",{get:function(){return this.mLabelColor},set:function(t){this.mLabelColor=t,this.tf&&(this.tf.textColor=t)},enumerable:!0,configurable:!0}),e}(eui.Component);t.XYButton=e,__reflect(e.prototype,"XZDD.XYButton")}(XZDD||(XZDD={}));var XZDD;!function(t){var e=function(e){function i(){var t=e.call(this,"XZDDAlertSkin")||this;return t.timer=0,remove_XY(t.btnGrp),t.tf.height=270,t.tf.lineSpacing=15,t}return __extends(i,e),i.getInstance=function(){return this.instance||(this.instance=new i),this.instance},i.dispose=function(){i.instance&&i.instance.dispose(),i.instance=null},i.prototype.show=function(){var t=puremvc.Facade.getInstance(GameIdEnum.XZDD).layout;t.msgLayer.addChild(this),this.counter=0,this.onTimer(),this.startTimer()},i.prototype.startTimer=function(){egret.clearInterval(this.timer),this.timer=egret.setInterval(this.onTimer,this,500)},i.prototype.onTimer=function(){this.counter++;var e=this.counter%4;this.tf.text=t.i18n("正在为您匹配牌桌{0}游戏即将开始，请耐心等待","\n")+copyChar_XY(".",e)+copyChar_XY(" ",3-e)},i.prototype.stopTimer=function(){egret.clearInterval(this.timer)},i.prototype.hide=function(){this.stopTimer(),remove_XY(this)},i}(BaseComponent);t.XZDDLoading=e,__reflect(e.prototype,"XZDD.XZDDLoading")}(XZDD||(XZDD={}));var XZDD;!function(t){var e=function(e){function i(t){return e.call(this,i.NAME,t)||this}return __extends(i,e),i.prototype.onRemove=function(){e.prototype.onRemove.call(this),this.gameScene&&(this.gameScene.dispose(),remove_XY(this.gameScene),this.gameScene=null)},i.prototype.listNotificationInterests=function(){return[i.SHOW,i.UPDATE_ROOM_DETAIL_INFO,i.UPDATE_TABLE_ID,i.CHANGE_TO_PREPARE,i.CHANGE_TO_START,i.SOME_ONE_JOIN,i.SOME_ONE_LEAVE,i.UPDATE_TURN,i.DO_ACTION,i.UPDATE_TUOGUAN,i.SHOW_HU,i.SOME_ONE_SELECT_CARD_OK,i.SOME_ONE_SELECT_DQ_OK,i.ALL_FLOAT_CARDS_ANIMATION,i.ALL_FLOAT_DQ_ANIMATION,i.ALL_DETAIL_INFO,i.REFRESH_MY_TING,i.GUA_FENG_OR_XIA_YU,i.GAME_FLOAT_SCORE,i.GAME_SHOW_DIAN_PAO,i.GAME_SHOW_DIAN_PAO_HU,i.GAME_SHOW_ZIMO,i.GAME_SHOW_GANG_SHANG_HUA,i.GAME_SHOW_HAI_DI_LAO_YUE,i.GAME_SHOW_YI_PAO_DUO_XIANG,i.GAME_UPDATE_READY]},i.prototype.handleNotification=function(e){var a=e.getBody();switch(e.getName()){case i.SHOW:this.gameScene||(this.gameScene=new t.XZDDGameScene,this.gameScene.init()),this.getLayer().addChild(this.gameScene);break;case i.UPDATE_ROOM_DETAIL_INFO:this.gameScene&&this.gameScene.updateRoomInfo();break;case i.UPDATE_TABLE_ID:this.gameScene&&this.gameScene.updateTableId();break;case i.CHANGE_TO_PREPARE:this.gameScene&&this.gameScene.updateRoomInfo();break;case i.CHANGE_TO_START:this.gameScene&&this.gameScene.gameStart();break;case i.SOME_ONE_JOIN:this.gameScene&&this.gameScene.someOneJoin(a);break;case i.SOME_ONE_LEAVE:this.gameScene&&this.gameScene.someOneLeave(a);break;case i.UPDATE_TURN:this.gameScene&&this.gameScene.updateTurn();break;case i.DO_ACTION:this.gameScene&&this.gameScene.doAction(a[0],a[1],a[2]);break;case i.UPDATE_TUOGUAN:this.gameScene&&this.gameScene.updateAiState();break;case i.SHOW_HU:this.gameScene&&this.gameScene.playHu();break;case i.SOME_ONE_SELECT_CARD_OK:this.gameScene&&this.gameScene.updatePlayerChangeCardState(a);break;case i.SOME_ONE_SELECT_DQ_OK:this.gameScene&&this.gameScene.updatePlayerDQState(a);break;case i.ALL_FLOAT_CARDS_ANIMATION:this.gameScene&&this.gameScene.playFloatAnimation(a);break;case i.ALL_FLOAT_DQ_ANIMATION:this.gameScene&&this.gameScene.playDqAnimation();break;case i.ALL_DETAIL_INFO:this.gameScene&&this.gameScene.showDetail(a);break;case i.REFRESH_MY_TING:this.gameScene&&this.gameScene.refreshTingFlag();break;case i.GUA_FENG_OR_XIA_YU:this.gameScene&&this.gameScene.playEffectGuaFengOrXiaYu(a);break;case i.GAME_FLOAT_SCORE:this.gameScene&&this.gameScene.showTotalOffset(a);break;case i.GAME_SHOW_DIAN_PAO:this.gameScene&&this.gameScene.showDianPaoEffect(a);break;case i.GAME_SHOW_DIAN_PAO_HU:this.gameScene&&this.gameScene.showHuEffect(a);break;case i.GAME_SHOW_ZIMO:this.gameScene&&this.gameScene.showZiMo(a);break;case i.GAME_SHOW_GANG_SHANG_HUA:this.gameScene&&this.gameScene.showGangShangKaiHua(a);break;case i.GAME_SHOW_HAI_DI_LAO_YUE:this.gameScene&&this.gameScene.showHaiDiLaoYue(a);break;case i.GAME_SHOW_YI_PAO_DUO_XIANG:this.gameScene&&this.gameScene.showYiPaoDuoXiang();break;case i.GAME_UPDATE_READY:this.gameScene&&this.gameScene.updatePlayerStatus()}},i.NAME=GameIdEnum.XZDD+"XZDDGameSceneMediator",i.SHOW=i.NAME+"SHOW",i.UPDATE_ROOM_DETAIL_INFO=i.NAME+"UPDATE_ROOM_DETAIL_INFO",i.UPDATE_TABLE_ID=i.NAME+"UPDATE_TABLE_ID",i.CHANGE_TO_PREPARE=i.NAME+"CHANGE_TO_PREPARE",i.CHANGE_TO_START=i.NAME+"CHANGE_TO_START",i.SOME_ONE_SELECT_CARD_OK=i.NAME+"SOME_ONE_SELECT_CARD_OK",i.ALL_FLOAT_CARDS_ANIMATION=i.NAME+"ALL_FLOAT_CARDS_ANIMATION",i.ALL_FLOAT_DQ_ANIMATION=i.NAME+"ALL_FLOAT_DQ_ANIMATION",i.ALL_DETAIL_INFO=i.NAME+"ALL_DETAIL_INFO",i.SOME_ONE_SELECT_DQ_OK=i.NAME+"SOME_ONE_SELECT_DQ_OK",i.SOME_ONE_JOIN=i.NAME+"SOME_ONE_JOIN",i.SOME_ONE_LEAVE=i.NAME+"SOME_ONE_LEAVE",i.UPDATE_TURN=i.NAME+"UPDATE_TURN",i.DO_ACTION=i.NAME+"DO_ACTION",i.UPDATE_TUOGUAN=i.NAME+"UPDATE_TUOGUAN",i.SHOW_HU=i.NAME+"SHOW_HU",i.REFRESH_MY_TING=i.NAME+"REFRESH_MY_TING",i.GUA_FENG_OR_XIA_YU=i.NAME+"GUA_FENG_OR_XIA_YU",i.GAME_FLOAT_SCORE=i.NAME+"GAME_FLOAT_SCORE",i.GAME_SHOW_ZIMO=i.NAME+"GAME_SHOW_ZIMO",i.GAME_SHOW_DIAN_PAO=i.NAME+"GAME_SHOW_DIAN_PAO",i.GAME_SHOW_DIAN_PAO_HU=i.NAME+"GAME_SHOW_DIAN_PAO_HU",i.GAME_SHOW_GANG_SHANG_HUA=i.NAME+"GAME_SHOW_GANG_SHANG_HUA",i.GAME_SHOW_HAI_DI_LAO_YUE=i.NAME+"GAME_SHOW_HAI_DI_LAO_YUE",i.GAME_SHOW_YI_PAO_DUO_XIANG=i.NAME+"GAME_SHOW_YI_PAO_DUO_XIANG",i.GAME_UPDATE_READY=i.NAME+"GAME_UPDATE_READY",i}(t.AbstractMediator);t.XZDDGameSceneMediator=e,__reflect(e.prototype,"XZDD.XZDDGameSceneMediator")}(XZDD||(XZDD={}));var XZDD;!function(t){var e=function(e){function i(){var i=e.call(this,"XZDDGameSceneSkin")||this;return i.throwIndex=0,i.circleIndex=0,i.allPaidun=[],i.currentChangeObj=null,i.changeCardArr=[],i.changeIndex=0,i.initEvents(),t.dataProxy.centerConfig.replayMode&&(remove_XY(i.exitBtn),remove_XY(i.helpBtn),remove_XY(i.soundBtn),remove_XY(i.aiBtn)),i.updateSoundState(),i}return __extends(i,e),i.prototype.updateTableId=function(){var e=t.dataProxy.roomDetailInfo,i=e?e.state:0;0==i?this.tableIdTf.text="":this.tableIdTf.text=e?t.i18n("牌局编号:{0}",e.tableId):"",e?this.difenTf.text=t.i18n("底分:")+coin2Str_XY(e.basicChipConf):this.difenTf.text="",e&&e.friends?(this.roomNoTf.visible=!0,this.roomNoTf.text=t.i18n("房间号:{0}",t.dataProxy.centerConfig.area),t.dataProxy.centerConfig.replayMode?this.copyRoomInfoBtn.visible=!1:this.copyRoomInfoBtn.visible=!0):(this.roomNoTf.visible=!1,this.copyRoomInfoBtn.visible=!1)},i.prototype.updateWaiting=function(){var e=t.dataProxy.roomDetailInfo,i=e?e.state:0;Tween$.removeTweens(this.waitingImage);var a=t.XZDDFacade.getInstance(GameIdEnum.XZDD).retrieveMediator(t.XZDDResultMediator.NAME).isShowing();if(0==i&&e&&e.info.length<4){var n=t.dataProxy.findPlayerGameInfoByUid(t.dataProxy.myUid);-1==e.autoReady?n&&(1==n.ready?(this.addChild(this.waitingImage),this.waitingImage.alpha=1,Tween$.get(this.waitingImage,{loop:!0}).to({alpha:0},1e3).to({alpha:1},1e3)):remove_XY(this.waitingImage)):(this.addChild(this.waitingImage),this.waitingImage.alpha=1,Tween$.get(this.waitingImage,{loop:!0}).to({alpha:0},1e3).to({alpha:1},1e3))}else 5!=i||a?remove_XY(this.waitingImage):(this.addChild(this.waitingImage),this.waitingImage.alpha=1,Tween$.get(this.waitingImage,{loop:!0}).to({alpha:0},1e3).to({alpha:1},1e3))},i.prototype.tryBuildAllPaidun=function(){var e=t.dataProxy.roomDetailInfo;if(0==this.allPaidun.length){var i=Math.min(e.dices[0],e.dices[1]),a=e.dices[0]+e.dices[1],n=0;n=t.dataProxy.getStartIndexByDeal(t.dataProxy.dealerIndex,a),n=(n+4)%4;var o=t.XZDDPositionUtils.getUIPosByServerPos(n);if(0>o)return;for(var r=0,s=0;4>s;s++)r=0==s?o:0>r-1?3:r-1,t.trace(r+" uiIndex "),this.allPaidun=this.allPaidun.concat(this["paidun"+r].getAllPaiDun());var h=this.allPaidun.splice(0,2*i);this.allPaidun=this.allPaidun.concat(h);for(var s=0,l=this.allPaidun.length;l>s;s++){var d=this.allPaidun[s];d.visible=!0}}},i.prototype.updatePaidun=function(){var e=t.dataProxy.roomDetailInfo,i=e?e.state:0;if(this.leftCardsTf.text=0==i?"108":e.remaining+"",0==i)this.paidun0.setAllReady(),this.paidun1.setAllReady(),this.paidun2.setAllReady(),this.paidun3.setAllReady();else{this.tryBuildAllPaidun();for(var a=0,n=e.ascDraw;n>a;a++){var o=this.allPaidun[a];o&&(o.visible=!1,Tween$.removeTweens(o),o.alpha=1)}for(var a=this.allPaidun.length-1,r=e.descDraw;a>=0&&r>0;a--,r--){var o;o=e.descDraw%2!=0&&1==r?this.allPaidun[a-1]:this.allPaidun[a],o&&(o.visible=!1,Tween$.removeTweens(o),o.alpha=1)}if(e.ascDraw+e.descDraw>=108)for(var a=0,n=this.allPaidun.length;n>a;a++){var o=this.allPaidun[a];o&&(o.visible=!1,Tween$.removeTweens(o),o.alpha=1)}}},i.prototype.setupEmptyDesk=function(){this.updateWaiting(),this.updateTableId(),this.updateAiState(),this.gameTimer.setupEmpty(),this.detailInfo.visible=!1,this.menuBtn.setupEmpty(),this.checkReady(),this.effectCtrl.hideAll();for(var t=0;4>t;t++)this["playerHead_"+t].updateData(),this["playerReady"+t].updateData(),this["dapai"+t].setupEmpty(),this["offset"+t].setupEmpty(),this["koupai"+t].setupEmpty(),this["lose"+t].setupEmpty(),this["noListen"+t].setupEmpty(),this["dingIng"+t].setupEmpty(),this["chipenggang"+t].setupEmpty(),this["huapai"+t].setupEmpty(),this["image_ani_que"+t].setupEmpty(),this["changeCards"+t].setupEmpty(),this["shoupai"+t].setupEmpty(),this["hupai"+t].setupEmpty();remove_XY(this.ctrlUI),remove_XY(this.gangChoosePanel),this.huPanel.hide(),this.tryBuildAllPaidun(),this.paidun0.setAllReady(),this.paidun1.setAllReady(),this.paidun2.setAllReady(),this.paidun3.setAllReady()},i.prototype.updatePlayerChangeCardState=function(e){var i=t.dataProxy.findPlayerGameInfoByUid(e);if(i){var a=t.XZDDPositionUtils.getUIPosByServerPos(i.position);this["koupai"+a].updateData(),this["changeCards"+a].updateData(),this["shoupai"+a].updateData(),e==Global.uid&&(this.chooseCard.visible=!1,this.clearChangeCardListener())
}},i.prototype.updatePlayerDQState=function(e){var i=t.dataProxy.findPlayerGameInfoByUid(e);if(i){var a=t.XZDDPositionUtils.getUIPosByServerPos(i.position);this["dingIng"+a].visible=!1,e==Global.uid&&(t.dataProxy.lockTweener=!0,this.dingQue.clearTweener(),this.playerHead_1.updateData(),this.dingQue.visible=!1)}},i.prototype.playFloatAnimation=function(t){for(var e=this,i=0;4>i;i++){var a=this["changeCards"+i];egret.Tween.removeTweens(a);for(var n=this["shoupai"+i],o=n.localToGlobal(),r=[],s=0;3>s;s++){var h=new eui.Image,l=a["image_"+s];h.source=l.source,h.x=l.localToGlobal().x,h.y=l.localToGlobal().y,r.push(h),a.parent.addChild(h)}a.updateData();for(var d=i,c=r.length,u=t,D=0;c>D;D++){var p=r.shift();egret.Tween.removeTweens(p),egret.Tween.get(p).to({x:o.x+n.width/2,y:o.y},300).call(function(t,i,a){remove_XY(t),1==i&&(e.shoupai1.updateData(),e.shoupai1.upThreeCards(a),e.shoupai1.showChangeCardsCard(a))},this,[p,d,u])}}},i.prototype.playDqAnimation=function(){for(var e=0;4>e;e++){var i=t.dataProxy.findPlayerGameInfoByUISeat(e);if(i){var a=this["image_ani_que"+e];a.updateData();var n=new eui.Image;n.source=a.image_Info.source,a.parent.addChild(n),n.visible=!1,n.x=a.image_Info.localToGlobal().x,n.y=a.image_Info.localToGlobal().y;var o=this["playerHead_"+e],r=o.image_queType.localToGlobal();egret.Tween.get(n).set({visible:!0}).wait(500).to({x:r.x,y:r.y},300).call(function(t,e){a.visible=!1,egret.Tween.removeTweens(e),remove_XY(e),t.updateData()},this,[o,n])}}this.handCtrl.init();for(var e=0;4>e;e++)this["shoupai"+e].updateData()},i.prototype.updateRoomInfo=function(){var e=t.dataProxy.roomDetailInfo,i=e?e.state:0;this.updateWaiting(),this.updateTableId(),this.checkReady(),this.updateAiState(),this.gameTimer.updateData(),this.menuBtn.updateData(),3!=i&&this.dingQue.clearTweener();for(var a=0;4>a;a++)this["playerHead_"+a].updateData(),this["playerReady"+a].updateData(),this["dapai"+a].updateData(),this["lose"+a].updateData(),this["noListen"+a].updateData(),this["chipenggang"+a].updateData(),this["huapai"+a].updateData(),this["shoupai"+a].updateData(),this["changeCards"+a].updateData(),this["hupai"+a].updateData(),this["koupai"+a].updateData(),this["dingIng"+a].updateData(),this["image_ani_que"+a].updateData();this.chooseCard.init(),this.ctrlUI.updateData(this),0==i&&(this.effectCtrl.hideAll(),this.huPanel.hide()),i>0&&4>i&&this.handCtrl&&this.handCtrl.dispose(),remove_XY(this.gangChoosePanel),this.updatePaidun(),2==i||3==i?2==i?this.startChangeCard():this.startDq():(4==i&&this.handCtrl.init(),this.handCtrl.updateData()),this.showReplayHu()},i.prototype.showReplayHu=function(){var e=t.dataProxy.roomDetailInfo;if(this.effectCtrl&&t.dataProxy.centerConfig.replayMode&&e&&e.state>3)for(var i=0;i<e.info.length;i++){var a=e.info[i];if(null!=a&&-1!=a.huCard){var n=t.XZDDPositionUtils.getUIPosByServerPos(a.position),o=this["effect"+n],r=a.huSpecialType;egret.Tween.removeTweens(o),r&&r.length>0?(-1!=r.indexOf(mahjong.XZDD_WinType.MAHJONG_XZDD_HU_HAI_DI_LAO_YUE)?(o.source="XZDD_btn_zimo_png",this.effectGrp.addChild(o)):-1!=r.indexOf(mahjong.XZDD_WinType.MAHJONG_XZDD_HU_GANG_SHANG_HUA)?(o.source="XZDD_btn_gangshanghua_png",this.effectGrp.addChild(o)):-1!=r.indexOf(mahjong.XZDD_WinType.MAHJONG_XZDD_ZI_MO)&&(o.source="XZDD_btn_zimo_png",this.effectGrp.addChild(o)),o.alpha=1):(o.source="XZDD_btn_hu_png",o.alpha=1,this.effectGrp.addChild(o))}}},i.prototype.startChangeCard=function(){var e=t.dataProxy.roomDetailInfo;if(e&&e.currentThreeCount<e.threeCountConf){this.clearChangeCardListener(),this.chooseCard.updateData();var i=t.dataProxy.findPlayerGameInfoByUid(t.dataProxy.myUid);if(-1==i.threeState){var a=t.dataProxy.getCountMornThanThreeArr();this.currentChangeObj=a[0];var n=this.handCtrl.handCard.uiArr,o=0;o=t.dataProxy.getCardTypeIndex(this.currentChangeObj.type),this.changeCardArr.push(n[o]),this.changeCardArr.push(n[o+1]),this.changeCardArr.push(n[o+2]);for(var r=0;r<this.changeCardArr.length;r++){var s=this.changeCardArr[r];s.y-=30}for(var r=0;r<n.length;r++){var h=n[r];h.touchEnabled=!0,bindTapEvent_XY(h,this.clickHandle,this)}bindTapEvent_XY(this.chooseCard.image_sure,this.showOKlistener,this)}}},i.prototype.showOKlistener=function(e){var i=(e.target,this.changeCardArr);if(3!=i.length)return void Toast.show(t.i18n("请选择3张牌替换"));for(var a=[],n=0;n<i.length;n++){var o=i[n],r=this.handCtrl.handCard.uiArr.indexOf(o);if(-1!=r){var s=Global.uid,h=t.dataProxy.findPlayerGameInfoByUid(s),l=h.card.handCards[r];a.push(l)}}this.clearChangeCardListener(),this.handCtrl.dispatchEventWith(t.XZDD_PlayerHandController.CHANGE_CARD_OVER,!1,a)},i.prototype.startDq=function(){var e=t.dataProxy.findPlayerGameInfoByUid(Global.uid);if(null!=e&&(this.dingQue.updateData(),-1==e.dq)){var i=t.dataProxy.checkMyLessType(),a=null;0==i?a=this.dingQue.image_0:1==i?a=this.dingQue.image_2:2==i&&(a=this.dingQue.image_1),this.addDQ(a,a.y,i)}},i.prototype.addDQ=function(e,i,a){if(!t.dataProxy.centerConfig.replayMode){if(t.dataProxy.lockTweener)return;egret.Tween.removeTweens(e),e.y==i?egret.Tween.get(e).to({y:e.y-10},300).call(this.passComplete,this,[e,i,a]):egret.Tween.get(e).to({y:i},300).call(this.passComplete,this,[e,i,a])}},i.prototype.passComplete=function(t,e,i){this.addDQ(t,e,i)},i.prototype.initEvents=function(){i18nEUI(GameIdEnum.XZDD,this,[this.tableIdTf,this.roomNoTf]),this.gangChoosePanel.initEvents(),this.ctrlUI.initEvents(),this.huPanel.initEvents(),this.gameTimer.initEvents(),bindTapEvent_XY(this.copyRoomInfoBtn,this.onCopyRoomId,this,!0,["copy_btn_0_png","copy_btn_1_png"]),bindTapEvent_XY(this.tableIdTf,this.onCopyTableId,this),bindTapEvent_XY(this.roomNoTf,this.onCopyRoomId,this),bindTapEvent_XY(this.exitBtn,this.onExit,this,!0,["XZDD_fanhui1_png","XZDD_fanhui_png"]),bindTapEvent_XY(this.aiBtn,this.onAi,this,!0,["XZDD_tuoguan1_png","XZDD_tuoguan_png"]),bindTapEvent_XY(this.soundBtn,this.onSetting,this,!0,["XZDD_yinliang1_png","XZDD_yinliang1_png"]),bindTapEvent_XY(this.helpBtn,this.onReadMe,this,!0,["XZDD_wenhao1_png","XZDD_wenhao_png"]),bindTapEvent_XY(this.quxiaoTuoguanBtn,this.onCancelTuoguan,this,!0),bindTapEvent_XY(this.chatBtn,this.onChat,this,!0),bindTapEvent_XY(this.readyBtnGrp,this.clickReady,this,!0),this.ctrlUI.addEventListener(t.XZDD_ControllPanel.E_GANG,this.onGang,this),this.ctrlUI.addEventListener(t.XZDD_ControllPanel.E_TING,this.onTing,this),this.ctrlUI.addEventListener(t.XZDD_ControllPanel.E_PASS,this.onPass,this),this.gangChoosePanel.addEventListener(t.XZDD_GangChoosePanel.E_GANG,this.onChooseGang,this);for(var e=0;3>=e;e++)this["paidun"+e].setIndex(e),this["playerHead_"+e].setIndex(e),this["playerReady"+e].setIndex(e),this["playerReady"+e].init(),this["dapai"+e].setIndex(e),this["chipenggang"+e].setIndex(e),this["huapai"+e].setIndex(e),this["shoupai"+e].setIndex(e),this["lose"+e].setIndex(e),this["noListen"+e].setIndex(e),this["changeCards"+e].setIndex(e),this["hupai"+e].setIndex(e),this["koupai"+e].setIndex(e),this["dingIng"+e].setIndex(e),this["image_ani_que"+e].setIndex(e);this.dingQue.init(),this.detailInfo.init(),ChatManager.setup(RES.getRes("chat_config_json"),[this.chatCtx0,this.chatCtx1,this.chatCtx2,this.chatCtx3],[1,1,2,2])},i.prototype.onUpCard=function(t){var e=t.data;this.dapai0.updateUserSelectMajhong(e),this.dapai1.updateUserSelectMajhong(e),this.dapai2.updateUserSelectMajhong(e),this.dapai3.updateUserSelectMajhong(e)},i.prototype.onCopyRoomId=function(){var e=t.dataProxy.roomDetailInfo;if(e&&e.friends){var i=t.dataProxy.roomDetailInfo.threeCountConf,a="";a=-1==i?t.i18n("底分:{0}",coin2Str_XY(t.dataProxy.roomDetailInfo.basicChipConf)):t.i18n("底分:{0}",coin2Str_XY(t.dataProxy.roomDetailInfo.basicChipConf))+"，"+t.i18n("换三张的总次数:{0}",t.dataProxy.roomDetailInfo.threeCountConf),copyGameShareText_XY(GameIdEnum.XZDD,t.dataProxy.centerConfig.area,a)}},i.prototype.onCopyTableId=function(){copyTextToClipboard_XY(this.tableIdTf.text,function(){Toast.show(t.i18n("复制牌局编号成功！"))},function(){})},i.prototype.onExit=function(){t.dataProxy.gameExited?t.sendNotification(t.XZDDExitCommand.NAME):t.sendSocketMessage(t.XZDDProtocol.TABLE_TRY_TO_LEAVE_C)},i.prototype.onAi=function(){if(t.dataProxy.roomDetailInfo&&4==t.dataProxy.roomDetailInfo.state){var e=t.dataProxy.findPlayerGameInfoByUid(Global.uid),i=e&&e.trusteeship;t.sendSocketMessage(t.XZDDProtocol.XZDD_TRUSTEESHIP_C,!i)}},i.prototype.onSetting=function(){var t=SoundManager.getBgMute()&&SoundManager.getEffectMute();SoundManager.setBgMute(!t),SoundManager.setEffectMute(!t),this.updateSoundState()},i.prototype.updatePlayerStatus=function(){for(var t=0;4>t;t++)this["playerReady"+t].updateData();this.checkReady(),this.updateWaiting()},i.prototype.checkReady=function(){var e=t.dataProxy.roomDetailInfo;if(e){var i=e.state;if(-1==e.autoReady){var a=t.dataProxy.findPlayerGameInfoByUid(t.dataProxy.myUid);0==i&&a&&-1==a.ready?this.readyBtnGrp.visible=!0:this.readyBtnGrp.visible=!1}else this.readyBtnGrp.visible=!1}},i.prototype.onReadMe=function(){t.sendNotification(t.XZDDReadmeMediator.SHOW)},i.prototype.onChat=function(){ChatManager.showPanel()},i.prototype.clickReady=function(){t.sendSocketMessage(t.XZDDProtocol.XZDD_READY_C)},i.prototype.onCancelTuoguan=function(){t.sendSocketMessage(t.XZDDProtocol.XZDD_TRUSTEESHIP_C,!1)},i.prototype.onShare=function(){var e=t.dataProxy.roomDetailInfo;if(e&&e.friends){var i=t.i18n("底分：")+coin2Str_XY(e.basicChipConf);ShareMenu.getInstance().show(GameIdEnum.XZDD,t.dataProxy.centerConfig.area,i)}},i.prototype.updateSoundState=function(){var t=SoundManager.getBgMute()&&SoundManager.getEffectMute();this.soundBtn.___switchSources=t?["XZDD_jinyin1_png","XZDD_jinyin_png"]:["XZDD_yinliang1_png","XZDD_yinliang_png"],this.soundBtn.source=this.soundBtn.___switchSources[0]},i.prototype.playHu=function(){this.huPanel.hide(),this.updateRoomInfo(),Tween$.removeTweens(this.waitingImage),remove_XY(this.waitingImage);var e=t.dataProxy.roomDetailInfo;if(egret.clearTimeout(this.gameResultTimer),e&&e.settlingDTO)if(999==e.settlingDTO.roundResult)t.sendNotification(t.XZDDResultMediator.SHOW);else{var i=2e3;this.gameResultTimer=egret.setTimeout(function(){t.sendNotification(t.XZDDResultMediator.SHOW)},this,i)}},i.prototype.updateAiState=function(){var e=t.dataProxy.roomDetailInfo,i=e?e.state:0,a=t.dataProxy.findPlayerGameInfoByUid(Global.uid),n=4==i&&a&&a.trusteeship;this.aiBtn.___switchSources=n?["XZDD_tuoguan_png","XZDD_tuoguan1_png"]:["XZDD_tuoguan1_png","XZDD_tuoguan_png"],this.aiBtn.source=this.aiBtn.___switchSources[0],n&&!t.dataProxy.centerConfig.replayMode?this.addChild(this.tuoguanGrp):remove_XY(this.tuoguanGrp)},i.prototype.onTing=function(){this.handCtrl.setAsTingCtrl()},i.prototype.onPass=function(){this.handCtrl.cancelTingCtrl()},i.prototype.onGang=function(){for(var e=t.dataProxy.findPlayerGameInfoByUid(Global.uid),i=t.dataProxy.roomDetailInfo.actionable,a={},n=e.card.handCards,o=0,r=n.length;r>o;o++){var s=n[o];a[s]||(a[s]=0),a[s]++}s=e.card.currentCard,a[s]||(a[s]=0),a[s]++;var h=[];if(e.card.meldCards)for(var o=0,r=e.card.meldCards.length;r>o;o++){var l=e.card.meldCards[o];if(3==l.length&&l[0]==l[1]){var d=l[0];a[d]||(a[d]=0),a[d]+=3}}var c=-1;for(var u in a)if(a[u]>=4){if(t.dataProxy.roomDetailInfo.lastValidAction==t.Action.peng&&t.dataProxy.roomDetailInfo.lastOpUid==Global.uid&&e.card.meldCards&&e.card.meldCards.length>0){var D=e.card.meldCards[e.card.meldCards.length-1];D&&D.length>0&&(c=D[0])}if(void 0!=c&&c>=0&&int_XY(u)==c)continue;h.push(int_XY(u))}-1!=i.indexOf(t.Action.ming_gang)?(this.sendGongActionToServer(e.card.currentCard),remove_XY(this.ctrlUI)):1==h.length?(this.sendGongActionToServer(h[0]),remove_XY(this.ctrlUI)):(this.addChild(this.gangChoosePanel),this.gangChoosePanel.updateData(h))},i.prototype.onChooseGang=function(t){var e=t.data;this.sendGongActionToServer(e),remove_XY(this.ctrlUI),remove_XY(this.gangChoosePanel)},i.prototype.sendGongActionToServer=function(e){var i=t.dataProxy.roomDetailInfo.actionable;-1!=i.indexOf(t.Action.ming_gang)?(t.sendSocketMessage(t.XZDDProtocol.MAHJONG_MING_GANG_C),remove_XY(this.gangChoosePanel)):-1!=i.indexOf(t.Action.bu_gang)?(t.sendSocketMessage(t.XZDDProtocol.MAHJONG_JIA_GANG_C,e),remove_XY(this.gangChoosePanel)):-1!=i.indexOf(t.Action.an_gang)?(t.sendSocketMessage(t.XZDDProtocol.MAHJONG_AN_GANG_C,e),remove_XY(this.gangChoosePanel)):t.warn("未找到可以杠的类型")},i.prototype.init=function(){this.effectCtrl||(this.effectCtrl=new t.XZDD_EffectController([this.effect0,this.effect1,this.effect2,this.effect3],this.effectGrp));var e=new t.XZDD_PlayerHandController(this.shoupai1);this.handCtrl=e,this.menuBtn.init(),e.addEventListener(t.XZDD_PlayerHandController.E_SHOW_HU_PANEL,this.onShowHuPanel,this),e.addEventListener(t.XZDD_PlayerHandController.E_HIDE_HU_PANEL,this.onHideHuPanel,this),e.addEventListener(t.XZDD_PlayerHandController.CHANGE_CARD_OVER,this.changeOver,this),e.addEventListener(t.XZDD_PlayerHandController.E_UP_CARD,this.onUpCard,this),this.menuBtn.addEventListener("clickTing",this.showTingPanel,this),this.readyBtnGrp.visible=!1,remove_XY(this.ctrlUI),remove_XY(this.gangChoosePanel),this.huPanel.hide(),this.copyRoomInfoBtn.visible=!1,this.updateRoomInfo()},i.prototype.onShowHuPanel=function(t){this.addChild(this.huPanel),tween_XY_alphaShow(this.huPanel),this.huPanel.updateData(t.data)},i.prototype.onHideHuPanel=function(){this.huPanel.hide()},i.prototype.showTingPanel=function(){var e=t.dataProxy.findPlayerGameInfoByUid(t.dataProxy.myUid);e&&e.card&&t.dataProxy.tempHuData&&this.handCtrl.dispatchEventWith(t.XZDD_PlayerHandController.E_SHOW_HU_PANEL,!1,t.dataProxy.tempHuData)},i.prototype.showDetail=function(t){this.detailInfo.setData(t)},i.prototype.changeOver=function(e){this.clearChangeCardListener();var i=e.data;this.shoupai1.updateData(),t.sendSocketMessage(t.XZDDProtocol.XZDD_THREE_C,i),t.dataProxy.tempCards=i,t.trace("发送换牌协议 "+i)},i.prototype.clearChangeCardListener=function(){for(var t=this.handCtrl.handCard.uiArr,e=0;e<t.length;e++){var i=t[e];egret.Tween.removeTweens(i),clearTapEvent_XY(i,this.clickHandle,this),i.y=this.handCtrl.handCard.cardY}this.changeCardArr=[],clearTapEvent_XY(this.chooseCard.image_sure,this.showOKlistener,this)},i.prototype.clickHandle=function(e){e.stopPropagation();var i=e.target,a=-1;if(a=this.changeCardArr.indexOf(i),-1==a){var n=this.handCtrl.handCard.uiArr.indexOf(i),o=Global.uid,r=t.dataProxy.findPlayerGameInfoByUid(o),s=r.card.handCards[n],h=t.XZDDStringUtils.getCardType(s),l=0;if(l=this.changeCardArr.length,l>0){var d=this.changeCardArr[0].cardId,c=t.XZDDStringUtils.getCardType(d);if(c==h){if(this.changeCardArr.length>=3)return;this.changeCardArr.push(i),i.y=-30}else{l=this.changeCardArr.length;for(var u=0;l>u;u++){var D=this.changeCardArr.shift();D.y=this.handCtrl.handCard.cardY}this.changeCardArr.push(i),i.y=-30}}else this.changeCardArr.push(i),i.y=-30}else{var a=this.changeCardArr.indexOf(i);this.changeCardArr.splice(a,1),i.y=0}},i.prototype.refreshTingFlag=function(){this.menuBtn.updateData()},i.prototype.playEffectGuaFengOrXiaYu=function(t){0==t?this.playGuaFeng():1==t&&this.playXiaYu()},i.prototype.playGuaFeng=function(){this.guaFeng||(this.guaFeng=Global.buildArmature(GameIdEnum.XZDD,"XZDD_guafeng"),this.guaFeng.eventDispatcher.addDBEventListener(egret.Event.COMPLETE,this.onguafengComplete,this)),this.addChild(this.guaFeng.display),this.guaFeng.display.x=Global.stage.stageWidth/2,this.guaFeng.display.y=Global.stage.stageHeight/2,dragonBones.WorldClock.clock.add(this.guaFeng),this.guaFeng.animation.play("animation",1)},i.prototype.onguafengComplete=function(){dragonBones.WorldClock.clock.remove(this.guaFeng),this.guaFeng&&remove_XY(this.guaFeng.display)},i.prototype.playXiaYu=function(){this.xiaYu||(this.xiaYu=Global.buildArmature(GameIdEnum.XZDD,"XZDD_xiayu"),this.xiaYu.eventDispatcher.addDBEventListener(egret.Event.COMPLETE,this.onXiaYuComplete,this)),this.addChild(this.xiaYu.display),this.xiaYu.display.x=Global.stage.stageWidth/2,this.xiaYu.display.y=Global.stage.stageHeight/2,dragonBones.WorldClock.clock.add(this.xiaYu),this.xiaYu.animation.play("animation",1)},i.prototype.onXiaYuComplete=function(){dragonBones.WorldClock.clock.remove(this.xiaYu),this.xiaYu&&remove_XY(this.xiaYu.display)},i.prototype.showTotalOffset=function(e){if(this.updateRoomInfo(),null!=e)for(var i=0;i<e.length;i++){var a=t.dataProxy.findPlayerGameInfoByUid(e[i].uid);if(null!=a){var n=t.XZDDPositionUtils.getUIPosByServerPos(a.position);if(0>n)return;this["offset"+n].setData(e[i].scoreOffset)}}},i.prototype.showDianPaoEffect=function(e){var i=e[0],a=t.XZDDPositionUtils.getUIPosByServerPos(i);if(!(0>a)){var n=e[1];this["dapai"+a].playThunder(n,function(){}),this.effectCtrl.playDianpao(a),this["dapai"+a].updateData()}},i.prototype.showHuEffect=function(e){if(null!=e){var i=t.XZDDPositionUtils.getUIPosByServerPos(e.position);0>i||(this["huapai"+i].updateData(),this["huapai"+i].playWinThunderMovie(),this["shoupai"+i].updateData(),this.effectCtrl.playAction(i,t.Action.hu),t.XZDDSoundPlayer.hu(e.uid,!1))}},i.prototype.showZiMo=function(e){if(null!=e){var i=t.XZDDPositionUtils.getUIPosByServerPos(e.position);0>i||(this["huapai"+i].updateData(),this["huapai"+i].playWinThunderMovie(),this["shoupai"+i].updateData(),this.effectCtrl.playZimo(i),t.XZDDSoundPlayer.hu(e.uid,!0))}},i.prototype.showGangShangKaiHua=function(e){var i=t.XZDDPositionUtils.getUIPosByServerPos(e);0>i||this.effectCtrl.playGangshanghua(i)},i.prototype.showHaiDiLaoYue=function(e){var i=t.XZDDPositionUtils.getUIPosByServerPos(e);if(!(0>i)){this.laoyue||(this.laoyue=Global.buildArmature(GameIdEnum.XZDD,"XZDD_haidilaoyue"),this.laoyue.eventDispatcher.addDBEventListener(egret.Event.COMPLETE,this.onLaoYueComplete,this));var a=this["effect"+i],n=a.localToGlobal();this.effectGrp.addChild(this.laoyue.display),this.laoyue.display.x=n.x,this.laoyue.display.y=n.y,dragonBones.WorldClock.clock.add(this.laoyue),this.laoyue.animation.play("Animation1",1)}},i.prototype.showYiPaoDuoXiang=function(){},i.prototype.onLaoYueComplete=function(){dragonBones.WorldClock.clock.remove(this.laoyue),this.laoyue&&remove_XY(this.laoyue.display)},i.prototype.onYiPaoComplete=function(){},i.prototype.updateTurn=function(){var e=t.dataProxy.roomDetailInfo;e?e.state:0;this.gameTimer.updateData(),e&&-1!=e.turnPlayers.indexOf(Global.uid)?(this.shoupai1.updateData(),t.dataProxy.tempHuData=null,this.refreshTingFlag()):this.shoupai1.removeTingFlag();for(var i=0;4>i;i++)1!=i&&(this["shoupai"+i].updateData(),this["hupai"+i].updateData());this.ctrlUI.updateData(this),remove_XY(this.gangChoosePanel),this.updatePaidun(),this.handCtrl.updateData()},i.prototype.doAction=function(e,i,a){if(this.playActionEffect(e,i),this.updateRoomInfo(),i==t.Action.da_pai)if(e==Global.uid){var n=this.shoupai1.pai_6;this.dapai1.lastCardFlyFrom(Global.stage.stageWidth/2,Global.stage.stageHeight-200),this.handCtrl.lastUserCtrlDiscard==a&&-1!=this.handCtrl.lastUserMoCard&&this.shoupai1.playInsertCardMovie(this.handCtrl.lastUserMoCard),this.dapai0.updateUserSelectMajhong(-1),this.dapai1.updateUserSelectMajhong(-1),this.dapai2.updateUserSelectMajhong(-1),this.dapai3.updateUserSelectMajhong(-1)}else{var o=t.dataProxy.findPlayerGameInfoByUid(e);if(o){var r=t.XZDDPositionUtils.getUIPosByServerPos(o.position);t.trace(r+" uiPos");var s,h,n=this["shoupai"+r].pai_13;s=this["shoupai"+r].x+n.x+n.width/2,h=this["shoupai"+r].y+n.y+n.height/2,this["dapai"+r].lastCardFlyFrom(s,h)}}},i.prototype.playActionEffect=function(e,i){var a=t.dataProxy.findPlayerGameInfoByUid(e);if(i==t.Action.chi||i==t.Action.peng||i==t.Action.ming_gang||i==t.Action.bu_gang||i==t.Action.an_gang||i==t.Action.ting){var n=t.XZDDPositionUtils.getUIPosByServerPos(a.position);this.effectCtrl.playAction(n,i)}},i.prototype.gameStart=function(){this.allPaidun=[];t.dataProxy.roomDetailInfo;this.setupEmptyDesk(),this.playStartMovie()},i.prototype.someOneJoin=function(t){this["playerHead_"+t].updateData()},i.prototype.someOneLeave=function(t){this["playerHead_"+t].updateData()},i.prototype.playStartMovie=function(){this.startDb||(this.startDb=Global.buildArmature(GameIdEnum.XZDD,"XZDD_start"),this.startDb.eventDispatcher.addDBEventListener(egret.Event.COMPLETE,this.onStartDbComplete,this)),this.addChild(this.startDb.display),this.startDb.display.x=Global.stage.stageWidth/2,this.startDb.display.y=Global.stage.stageHeight/2,dragonBones.WorldClock.clock.add(this.startDb),this.startDb.animation.play("Animation1",1),t.XZDDSoundPlayer.gameStart()},i.prototype.onStartDbComplete=function(){dragonBones.WorldClock.clock.remove(this.startDb),this.startDb&&remove_XY(this.startDb.display),this.gameTimer.playDiceMovie(this.playSendCardMovie.bind(this)),t.XZDDSoundPlayer.dice()},i.prototype.playSendCardMovie=function(){var e=this,i=t.dataProxy.roomDetailInfo;this.tryBuildAllPaidun();for(var a=0,n=i.ascDraw;n>a;a++){var o=this.allPaidun[a];o&&(Tween$.removeTweens(o),o.alpha=1,Tween$.get(o).set({alpha:1}).wait(50*a+50).to({alpha:0},100).call(function(t){t.alpha=1,t.visible=!1},this,[o]))}this.shoupai0.updateData(),this.shoupai2.updateData(),this.shoupai3.updateData(),this.shoupai1.showMyDisorderWithFlower(function(){e.huapai0.updateData(),e.huapai1.updateData(),e.huapai2.updateData(),e.huapai3.updateData()},function(){e.updateRoomInfo()})},i.prototype.dispose=function(){this.detailInfo.visible=!1,this.menuBtn.dispose(),this.effectCtrl.hideAll();for(var e=0;4>e;e++)this["dapai"+e].dispose(),this["offset"+e].dispose(),this["koupai"+e].setupEmpty(),this["lose"+e].setupEmpty(),this["dingIng"+e].setupEmpty(),this["chipenggang"+e].setupEmpty(),this["huapai"+e].dispose(),this["image_ani_que"+e].setupEmpty(),this["changeCards"+e].setupEmpty(),this["shoupai"+e].dispose(),this["hupai"+e].setupEmpty();this.startDb&&(dragonBones.WorldClock.clock.remove(this.startDb),remove_XY(this.startDb.display)),this.detailInfo.dispose(),this.gangChoosePanel.dispose(),this.ctrlUI.dispose(),this.huPanel.dispose(),this.gameTimer.dispose(),clearTapEvent_XY(this.tableIdTf,this.onCopyTableId,this),clearTapEvent_XY(this.exitBtn,this.onExit),clearTapEvent_XY(this.aiBtn,this.onAi),clearTapEvent_XY(this.soundBtn,this.onSetting),clearTapEvent_XY(this.helpBtn,this.onReadMe),clearTapEvent_XY(this.quxiaoTuoguanBtn,this.onCancelTuoguan),this.ctrlUI.removeEventListener(t.XZDD_ControllPanel.E_GANG,this.onGang,this),this.ctrlUI.removeEventListener(t.XZDD_ControllPanel.E_TING,this.onTing,this),this.ctrlUI.removeEventListener(t.XZDD_ControllPanel.E_PASS,this.onPass,this),this.gangChoosePanel.removeEventListener(t.XZDD_GangChoosePanel.E_GANG,this.onChooseGang,this),remove_XY(this.ctrlUI),remove_XY(this.gangChoosePanel),this.huPanel.hide(),this.paidun0.setAllReady(),this.paidun1.setAllReady(),this.paidun2.setAllReady(),this.paidun3.setAllReady(),this.allPaidun=[],t.dataProxy.tempHuData=null,t.dataProxy.tempCards=[],this.removeChildren()},i}(BaseComponent);t.XZDDGameScene=e,__reflect(e.prototype,"XZDD.XZDDGameScene")}(XZDD||(XZDD={}));var XZDD;!function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.init=function(){this.visible=!1},i.prototype.updateData=function(){var e=t.dataProxy.roomDetailInfo,i=e?e.state:0,a=t.dataProxy.findPlayerGameInfoByUid(Global.uid);a&&2==i&&e.currentThreeCount<e.threeCountConf&&-1==a.threeState?this.visible=!0:this.visible=!1},i.prototype.destory=function(){},i}(eui.Component);t.XZDD_ChooseCards=e,__reflect(e.prototype,"XZDD.XZDD_ChooseCards")}(XZDD||(XZDD={}));var XZDD;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initEvents=function(){bindTapEvent_XY(this.peng,this.onPeng,this,!0),bindTapEvent_XY(this.gang,this.onGang,this,!0),bindTapEvent_XY(this.hu,this.onHu,this,!0),bindTapEvent_XY(this.ting,this.onTing,this,!0),bindTapEvent_XY(this.pass,this.onPass,this,!0)},i.prototype.updateData=function(e){var i=t.dataProxy.roomDetailInfo,a=i?i.state:0,n=t.dataProxy.findPlayerGameInfoByUid(Global.uid);if(4==a&&n&&i.actionable&&-1!=i.turnPlayers.indexOf(Global.uid)){e.addChild(this);var o=(n.card.handCards,i.currentDiscard,i.actionable),r=-1!=o.indexOf(t.Action.chi),s=-1!=o.indexOf(t.Action.peng),h=-1!=o.indexOf(t.Action.ming_gang)||-1!=o.indexOf(t.Action.bu_gang)||-1!=o.indexOf(t.Action.an_gang),l=!1,d=-1!=o.indexOf(t.Action.hu),c=r||s||h||d||l;this.chi.visible=!1,this.peng.visible=!1,this.gang.visible=!1,this.hu.visible=!1,this.ting.visible=!1,this.pass.visible=!1;var u=120;r&&(this.chi.visible=!0,this.chi.x=u,u+=207),s&&(this.peng.visible=!0,this.peng.x=u,u+=207),h&&(this.gang.visible=!0,this.gang.x=u,u+=207),d&&(this.hu.visible=!0,this.hu.x=u,u+=207),l&&(this.ting.visible=!0,this.ting.x=u,u+=207),c&&(this.pass.visible=!0,this.pass.x=u,u+=125),u+=30,this.width=u}else remove_XY(this)},i.prototype.onPeng=function(){t.trace("我碰牌"),t.sendSocketMessage(t.XZDDProtocol.MAHJONG_PENG_C),remove_XY(this)},i.prototype.onGang=function(){this.dispatchEventWith(i.E_GANG)},i.prototype.onTing=function(t){t.stopPropagation(),t.stopImmediatePropagation(),t.preventDefault(),this.dispatchEventWith(i.E_TING)},i.prototype.onHu=function(){t.sendSocketMessage(t.XZDDProtocol.MAHJONG_HU_C),remove_XY(this)},i.prototype.dispose=function(){clearTapEvent_XY(this.peng,this.onPeng),clearTapEvent_XY(this.gang,this.onGang),clearTapEvent_XY(this.hu,this.onHu),clearTapEvent_XY(this.ting,this.onTing),clearTapEvent_XY(this.pass,this.onPass)},i.prototype.onPass=function(){t.dataProxy.findPlayerGameInfoByUid(Global.uid);this.dispatchEventWith(i.E_PASS),t.sendSocketMessage(t.XZDDProtocol.MAHJONG_PASS_C),remove_XY(this)},i.E_GANG="E_GANG",i.E_TING="E_TING",i.E_PASS="E_PASS",i}(eui.Component);t.XZDD_ControllPanel=e,__reflect(e.prototype,"XZDD.XZDD_ControllPanel")}(XZDD||(XZDD={}));var XZDD;!function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.init=function(){this.visible=!1,i18nEUI(GameIdEnum.XZDD,this,[]),this.scroller.setSliderBarAlwaysShow(!1),bindTapEvent_XY(Global.stage,this.onClose,this,!1,null,!1,!1)},i.prototype.onClose=function(){this.clickBg()},i.prototype.clickBg=function(){var t=this;this.visible&&(egret.Tween.removeTweens(this),egret.Tween.get(this).to({x:Global.stage.stageWidth+100},300).call(function(){t.visible=!1},this))},i.prototype.setData=function(e){if(this.visible)return void this.clickBg();this.visible=!0,this.x=Global.stage.stageWidth+100,null==this.list.dataProvider?this.list.dataProvider=new eui.ArrayCollection(e):this.list.dataProvider.source=e;for(var i=0,a=0;a<e.length;a++)i+=e[a].scoreOffset;this.moneyTf.text=t.i18n("本局当前流水:{0}",coin2Str_XY(i)),this.list.itemRenderer=t.XZDD_DetailRender,egret.Tween.removeTweens(this),egret.Tween.get(this).to({x:Global.stage.stageWidth-this.width-80},500).call(function(){},this)},i.prototype.dispose=function(){clearTapEvent_XY(Global.stage,this.onClose)},i}(eui.Component);t.XZDD_DetailInfo=e,__reflect(e.prototype,"XZDD.XZDD_DetailInfo")}(XZDD||(XZDD={}));var XZDD;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.skinName="XZDD_DetailInfoRenderSkin",i18nEUI(GameIdEnum.XZDD,t,[t.label0,t.label1,t.label3]),t}return __extends(i,e),i.prototype.dataChanged=function(){var e=this.data,i=e.opType,a=t.XZDDStringUtils.getHuName(i),n="";if(e.relationType&&e.relationType.length>0)for(var o=0;o<e.relationType.length;o++){var r=e.relationType[o];n+=t.XZDDStringUtils.getHuName(r)+" "}var s="";s=""!=n?a+"("+n+")":a;var h=e.scoreOffset;0>h?(this.label0.text=t.i18n("被")+" "+s,this.label2.textColor=246055):(this.label0.text=s,this.label2.textColor=15667982),this.label2.text=coin2Str_XY(h);for(var l=[],d=e.relationUids,o=0;o<d.length;o++){var c=t.dataProxy.findPlayerGameInfoByUid(d[o]);if(null!=c){var u=t.XZDDPositionUtils.getUIPosByServerPos(c.position);0==u?l.push(t.i18n("上家")):2==u?l.push(t.i18n("下家")):3==u&&l.push(t.i18n("对家"))}}2==l.length?this.label3.text=t.i18n("两家"):3==l.length?this.label3.text=t.i18n("三家"):1==l.length&&(this.label3.text=l[0]);var D=-1,p=-1==mahjong.XZDDTool.huIdArr.indexOf(i);p?this.label1.text="":(D=e.factor,this.label1.text=D+t.i18n("番"))},i}(eui.ItemRenderer);t.XZDD_DetailRender=e,__reflect(e.prototype,"XZDD.XZDD_DetailRender")}(XZDD||(XZDD={}));var XZDD;!function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.init=function(){bindTapEvent_XY(this.image_0,this.clickW,this),bindTapEvent_XY(this.image_1,this.clickTiao,this),bindTapEvent_XY(this.image_2,this.clickTong,this),this.visible=!1},i.prototype.clickW=function(){t.sendSocketMessage(t.XZDDProtocol.XZDD_DQ_C,0)},i.prototype.clickTong=function(){t.sendSocketMessage(t.XZDDProtocol.XZDD_DQ_C,1)},i.prototype.clickTiao=function(){t.sendSocketMessage(t.XZDDProtocol.XZDD_DQ_C,2)},i.prototype.updateData=function(){var e=t.dataProxy.roomDetailInfo,i=e?e.state:0,a=t.dataProxy.findPlayerGameInfoByUid(Global.uid);a&&3==i&&-1==a.dq?(this.clearTweener(),this.visible=!0):this.visible=!1},i.prototype.clearTweener=function(){egret.Tween.removeTweens(this.image_0),egret.Tween.removeTweens(this.image_1),egret.Tween.removeTweens(this.image_2),this.image_0.y=10,this.image_1.y=10,this.image_2.y=10,t.dataProxy.lockTweener=!1},i.prototype.destory=function(){clearTapEvent_XY(this.image_0,this.clickW,this),clearTapEvent_XY(this.image_1,this.clickTiao,this),clearTapEvent_XY(this.image_2,this.clickTong,this),this.clearTweener()},i}(eui.Component);t.XZDD_DingQue=e,__reflect(e.prototype,"XZDD.XZDD_DingQue")}(XZDD||(XZDD={}));var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var XZDD;!function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.setIndex=function(t){this.index=t},i.prototype.setupEmpty=function(){this.visible=!1},i.prototype.updateData=function(){var e=t.dataProxy.roomDetailInfo,i=e?e.state:0,a=t.dataProxy.findPlayerGameInfoByUISeat(this.index);if(a&&4==i){var n="";0==a.dq?n="XZDD_wan_png":1==a.dq?n="XZDD_tong_png":2==a.dq&&(n="XZDD_tiao_png"),this.image_Info.source=n,this.visible=!1}else this.visible=!1},i}(eui.Component);t.XZDD_DqAnimation=e,__reflect(e.prototype,"XZDD.XZDD_DqAnimation")}(XZDD||(XZDD={}));var XZDD;!function(t){var e=function(){function e(t,e){this.imgs=t,this.root=e;for(var i=0,a=t.length;a>i;i++){var n=t[i];n.touchEnabled=!1,remove_XY(n)}}return e.prototype.dispose=function(){this.imgs=null,this.root=null,this.tfs=null},e.prototype.hideAll=function(){for(var t=0,e=this.imgs.length;e>t;t++){var i=this.imgs[t];remove_XY(i)}},e.prototype.playDianpao=function(t){var e=this.imgs[t];e.source="XZDD_btn_dianpao_png",this.play(e)},e.prototype.playZimo=function(t){var e=this.imgs[t];e.source="XZDD_btn_zimo_png",this.play(e,9999999)},e.prototype.playGangshanghua=function(t){var e=this.imgs[t];e.source="XZDD_btn_gangshanghua_png",this.play(e,9999999)},e.prototype.playAction=function(e,i){var a=this.imgs[e];i==t.Action.chi?a.source="XZDD_btn_chi_png":i==t.Action.peng?a.source="XZDD_btn_peng_png":i==t.Action.ming_gang||i==t.Action.bu_gang||i==t.Action.an_gang?a.source="XZDD_btn_gang_png":i==t.Action.hu?a.source="XZDD_btn_hu_png":i==t.Action.ting&&(a.source="XZDD_btn_ting_png"),this.play(a,i)},e.prototype.play=function(e,i){void 0===i&&(i=-1),Tween$.removeTweens(e),this.root.addChild(e),e.scaleX=3,e.scaleY=3,e.alpha=1,i!=t.Action.hu&&9999999!=i?Tween$.get(e).to({scaleX:1,scaleY:1},300,Ease$.sineIn).wait(500).to({alpha:0},300).call(function(){remove_XY(e)},this):Tween$.get(e).to({scaleX:1,scaleY:1},300,Ease$.sineIn)},e}();t.XZDD_EffectController=e,__reflect(e.prototype,"XZDD.XZDD_EffectController")}(XZDD||(XZDD={}));var XZDD;!function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.onGifComplete=function(){this.point_0.visible=!0,this.point_1.visible=!0,this.gif.visible=!1,this.callback&&this.callback()
},i.prototype.playDiceMovie=function(e){this.callback=e;var i=1,a=2;t.dataProxy.roomDetailInfo&&t.dataProxy.roomDetailInfo.dices&&(i=t.dataProxy.roomDetailInfo.dices[0],a=t.dataProxy.roomDetailInfo.dices[1]),this.point_0.visible=!1,this.point_1.visible=!1,this.gif.visible=!0,this.gifCtrl.gotoAndStop(0),this.gifCtrl.play(!1),this.point_0.source="XZDD_sezi_value"+i+"_png",this.point_1.source="XZDD_sezi_value"+a+"_png"},i.prototype.setTime=function(e){0>=e&&(e=0),this.leftTime=e;var i=t.dataProxy.roomDetailInfo,a=i?i.state:0;i&&(0==a?-1==i.autoReady?(this.leftTime>0?this.readyTf.text=t.i18n("游戏即将开始:{0}",this.leftTime):this.readyTf.text="",this.timeTf.text=""):(this.readyTf.text="",this.timeTf.text=""):(this.timeTf.text=this.leftTime+"",this.readyTf.text=""),egret.clearInterval(this.timer),this.leftTime>0&&(this.timer=egret.setInterval(this.onTimer,this,1e3)))},i.prototype.onTimer=function(){this.leftTime--,this.leftTime<=0&&(this.leftTime=0,egret.clearInterval(this.timer)),4==this.leftTime&&t.XZDDSoundPlayer.clock();var e=t.dataProxy.roomDetailInfo,i=e?e.state:0;0==i?-1==e.autoReady?(this.leftTime>0?this.readyTf.text=t.i18n("游戏即将开始:{0}",this.leftTime):this.readyTf.text="",this.timeTf.text=""):(this.readyTf.text="",this.timeTf.text=""):this.timeTf.text=this.leftTime+""},i.prototype.dispose=function(){egret.clearInterval(this.timer),Tween$.removeTweens(this.light_1),Tween$.removeTweens(this.light_3),Tween$.removeTweens(this.light_0),Tween$.removeTweens(this.light_2),this.gifCtrl&&this.gifCtrl.removeEventListener(egret.Event.COMPLETE,this.onGifComplete,this),this.gifCtrl.dispose(),this.callback=null},i.prototype.setupEmpty=function(){this.updateData(),this.gif.visible=!1,Tween$.removeTweens(this.light_1),Tween$.removeTweens(this.light_3),Tween$.removeTweens(this.light_0),Tween$.removeTweens(this.light_2),this.setTime(0),this.light_1.visible=!1,this.light_3.visible=!1,this.light_0.visible=!1,this.light_2.visible=!1,this.point_0.visible=!1,this.point_1.visible=!1,this.gifCtrl.gotoAndStop(0)},i.prototype.initEvents=function(){this.gifCtrl=new MovieclipController(this.gif,12,MovieclipController.makeResLoop("XZDD_sezi_{0}_png",0,7)),this.gifCtrl.addEventListener(egret.Event.COMPLETE,this.onGifComplete,this),i18nEUI(GameIdEnum.XZDD,this,[])},i.prototype.updateData=function(){var e=t.dataProxy.roomDetailInfo,i=e?e.state:0;if(e){this.gif.visible=!1,Tween$.removeTweens(this.light_0),Tween$.removeTweens(this.light_2),Tween$.removeTweens(this.light_1),Tween$.removeTweens(this.light_3),this.gifCtrl.gotoAndStop(0),this.setTime(0);var a=e.turnPlayers||[];if(0==i){this.light_1.visible=!1,this.light_3.visible=!1,this.light_0.visible=!1,this.light_2.visible=!1,this.point_0.visible=!1,this.point_1.visible=!1,this.setTime(e.timeout);for(var n=0,o=4;o>n;n++){var r=t.XZDDPositionUtils.getUIPosByServerPos(n),s=["XZDD_east","XZDD_south","XZDD_west","XZDD_north"][n],h=t.dataProxy.findPlayerGameInfoBySeat(n);h&&-1!=a.indexOf(h.uid)&&(s+="_light"),this["dir_"+r].source=s+"_png"}}else{this.point_0.visible=!1,this.point_1.visible=!1,this.point_0.source="XZDD_sezi_value"+e.dices[0]+"_png",this.point_1.source="XZDD_sezi_value"+e.dices[1]+"_png";for(var n=0,o=4;o>n;n++){var r=t.XZDDPositionUtils.getUIPosByServerPos(n),h=t.dataProxy.findPlayerGameInfoBySeat(n);h&&-1!=a.indexOf(h.uid)?this["light_"+r].visible=!0:this["light_"+r].visible=!1}for(var n=0,o=4;o>n;n++){var r=t.XZDDPositionUtils.getUIPosByServerPos(n),s=["XZDD_east","XZDD_south","XZDD_west","XZDD_north"][n],h=t.dataProxy.findPlayerGameInfoBySeat(n);h&&-1!=a.indexOf(h.uid)&&(s+="_light"),this["dir_"+r].source=s+"_png"}for(var n=0,o=4;o>n;n++){var l=this["light_"+n];Tween$.removeTweens(l),l.alpha=1;var h=t.dataProxy.findPlayerGameInfoBySeat(n);h&&-1!=a.indexOf(h.uid)&&(s+="_light",Tween$.get(l,{loop:!0}).to({alpha:0},300).to({alpha:1},300))}i>=2&&4>=i&&this.setTime(e.timeout)}}},i}(eui.Component);t.XZDD_GameTimer=e,__reflect(e.prototype,"XZDD.XZDD_GameTimer")}(XZDD||(XZDD={}));var XZDD;!function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initEvents=function(){bindTapEvent_XY(this.grp0,this.onChoose,this),bindTapEvent_XY(this.grp1,this.onChoose,this),bindTapEvent_XY(this.grp2,this.onChoose,this)},e.prototype.onChoose=function(t){for(var i=0,a=0,n=3;n>a;a++)if(t.currentTarget==this["grp"+a]){i=a;break}this.dispatchEventWith(e.E_GANG,!1,this.cards[i])},e.prototype.dispose=function(){clearTapEvent_XY(this.grp0,this.onChoose,this),clearTapEvent_XY(this.grp1,this.onChoose,this),clearTapEvent_XY(this.grp2,this.onChoose,this),this.cards=null},e.prototype.updateData=function(t){this.cards=t;for(var e=40,i=30,a=0,n=3;n>a;a++){var o=t[a],r=this["grp"+a];if(void 0!=o){for(var s=0,h=4;h>s;s++){var l=o,d=this["card"+(4*a+s)];d.setCard(l)}this.addChild(r),r.x=e,e+=r.width+i}else remove_XY(r)}this.width=e},e.E_GANG="E_GANG",e}(eui.Component);t.XZDD_GangChoosePanel=e,__reflect(e.prototype,"XZDD.XZDD_GangChoosePanel")}(XZDD||(XZDD={}));var XZDD;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return bindEuiCreateOkEventOnce_XY(e,e.onCreate,e),e}return __extends(e,t),e.prototype.onCreate=function(){},e.prototype.setHead=function(t){this.headImg.source=toAvatarSource_XY(t)||"XZDD_head_png"},e}(eui.Component);t.XZDD_Head=e,__reflect(e.prototype,"XZDD.XZDD_Head")}(XZDD||(XZDD={}));var XZDD;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.skinName="XZDD_HuItemSkin",t}return __extends(i,e),i.prototype.init=function(e,i,a){i18nEUI(GameIdEnum.XZDD,this,[]),this.card.setCard(e);var n="<font color='#C9180C'>"+i+"</font>"+t.i18n("番")+"\n<font color='#C9180C'>"+a+"</font>"+t.i18n("张");setHtmlText(this.tf,n)},i}(eui.Component);t.XZDD_HuItem=e,__reflect(e.prototype,"XZDD.XZDD_HuItem")}(XZDD||(XZDD={}));var XZDD;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.showTimeOut=0,t.items=[],t.touchEnabled=!1,t.touchChildren=!1,t}return __extends(i,e),i.prototype.initEvents=function(){i18nEUI(GameIdEnum.XZDD,this,[this.tf]),bindTapEvent_XY(Global.stage,this.onClose,this,!1,null,!1,!1)},i.prototype.onClose=function(){remove_XY(this)},i.prototype.dispose=function(){clearTapEvent_XY(Global.stage,this.onClose,this)},i.prototype.hide=function(){egret.clearTimeout(this.showTimeOut),remove_XY(this)},i.prototype.updateData=function(e){var i=this;egret.clearTimeout(this.showTimeOut);for(var a=2*this.huImg.x+this.huImg.width,n=this.huImg.y,o=0,r=this.items.length;r>o;o++)remove_XY(this.items[o]);this.huImg.visible=!0,this.tf.visible=!0,this.allHuImg.visible=!1;for(var s,h,l=6,d=0,c=0,u=0,o=0,r=e.winCards.length;r>o;o++){var D=e.winCards[o],p=e.winCount[o],f=e.winFactors[o],_=this.items[o];_||(_=this.items[o]=new t.XZDD_HuItem),s=_.width,h=_.height,_.x=a+(s+40*.695)*int_XY(o%l),_.y=n+(h+30*.695)*int_XY(o/l),d=Math.max(d,_.x),c=Math.max(c,_.y),_.init(D.cardID,f,p),u+=p,this.addChild(_)}this.width=d+s+this.huImg.x,this.height=c+h+n;var y="("+t.i18n("共")+"<font color='#C9180C'>"+u+"</font>"+t.i18n("张")+")";setHtmlText(this.tf,y),this.showTimeOut=egret.setTimeout(function(){i.onClose()},this,3e3)},i}(eui.Component);t.XZDD_HuPanel=e,__reflect(e.prototype,"XZDD.XZDD_HuPanel")}(XZDD||(XZDD={}));var XZDD;!function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.setIndex=function(t){this.index=t},i.prototype.setupEmpty=function(){this.visible=!1},i.prototype.updateData=function(){var e=t.dataProxy.roomDetailInfo,i=e?e.state:0,a=t.dataProxy.findPlayerGameInfoByUISeat(this.index);2==i&&a&&1!=this.index?1==a.threeState?this.visible=!1:0==a.threeState?this.visible=!1:-1==a.threeState&&(this.visible=!0):this.visible=!1},i}(eui.Component);t.XZDD_KouPai=e,__reflect(e.prototype,"XZDD.XZDD_KouPai")}(XZDD||(XZDD={}));var XZDD;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.touchEnabled=!1,t}return __extends(i,e),i.prototype.setIndex=function(t){this.index=t},i.prototype.setupEmpty=function(){this.visible=!1},i.prototype.updateData=function(){var e=t.dataProxy.roomDetailInfo,i=e?e.state:0,a=t.dataProxy.findPlayerGameInfoByUISeat(this.index);if(a)if(4==i)this.visible=a.isFucked;else if(5==i){var n=e.settlingDTO,o=null;n?(o=t.dataProxy.findSettingById(a.uid),o&&(this.visible=a.isFucked)):this.visible=!1}else this.visible=!1;else this.visible=!1},i}(eui.Component);t.XZDD_Lose=e,__reflect(e.prototype,"XZDD.XZDD_Lose")}(XZDD||(XZDD={}));var XZDD;!function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.init=function(){bindTapEvent_XY(this.image_ting,this.clickTing,this),bindTapEvent_XY(this.image_liushui,this.clickLiuShui,this)},i.prototype.setupEmpty=function(){this.image_ting.visible=!1},i.prototype.clickTing=function(t){t.stopPropagation(),this.dispatchEvent(new egret.Event("clickTing"))},i.prototype.clickLiuShui=function(){t.sendSocketMessage(t.XZDDProtocol.XZDD_OP_C)},i.prototype.updateData=function(){var e=t.dataProxy.roomDetailInfo,i=e?e.state:0;4==i?e&&-1!=e.turnPlayers.indexOf(Global.uid)?this.image_ting.visible=!1:this.image_ting.visible=null!=t.dataProxy.tempHuData:this.image_ting.visible=!1},i.prototype.dispose=function(){clearTapEvent_XY(this.image_ting,this.clickTing,this),clearTapEvent_XY(this.image_liushui,this.clickLiuShui,this)},i}(eui.Component);t.XZDD_Menu=e,__reflect(e.prototype,"XZDD.XZDD_Menu")}(XZDD||(XZDD={}));var XZDD;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.touchEnabled=!1,t}return __extends(i,e),i.prototype.setIndex=function(t){this.index=t},i.prototype.setupEmpty=function(){this.visible=!1},i.prototype.updateData=function(){var e=t.dataProxy.roomDetailInfo,i=e?e.state:0,a=t.dataProxy.findPlayerGameInfoByUISeat(this.index);if(a)if(5==i){var n=e.settlingDTO,o=null;n&&999==n.roundResult?(o=t.dataProxy.findSettingById(a.uid),o&&(this.visible=!o.isTing)):this.visible=!1}else this.visible=!1;else this.visible=!1},i}(eui.Component);t.XZDD_No_Listen=e,__reflect(e.prototype,"XZDD.XZDD_No_Listen")}(XZDD||(XZDD={}));var XZDD;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.offsetX=0,t.offsetY=0,t}return __extends(i,e),i.prototype.setupEmpty=function(){egret.Tween.removeTweens(this.scoreInfo),this.offsetX=this.scoreInfo.x,this.offsetY=this.scoreInfo.y,this.visible=!1},i.prototype.setData=function(e){if(this.visible=!0,t.trace(e+"  漂粉"),e>0)this.scoreInfo.font="XZDD_win_fnt",this.scoreInfo.text="+ "+coin2Str_XY(e);else{this.scoreInfo.font="XZDD_lose_fnt";var i=Math.abs(e);this.scoreInfo.text="-"+coin2Str_XY(i)}this.scoreInfo.alpha=0,egret.Tween.removeTweens(this.scoreInfo),egret.Tween.get(this.scoreInfo).to({y:this.offsetY+30,alpha:1},500).call(this.passComplete,this)},i.prototype.passComplete=function(){var t=this;egret.Tween.removeTweens(this.scoreInfo),egret.Tween.get(this.scoreInfo).wait(1e3).to({alpha:0},500).call(function(){t.scoreInfo.y=t.offsetY,egret.Tween.removeTweens(t.scoreInfo),t.visible=!1},this)},i.prototype.dispose=function(){egret.Tween.removeTweens(this.scoreInfo)},i}(eui.Component);t.XZDD_Offset=e,__reflect(e.prototype,"XZDD.XZDD_Offset")}(XZDD||(XZDD={}));var XZDD;!function(t){var e=function(e){function i(t){var i=e.call(this)||this;return i.pool=[],i.lastUserCtrlDiscard=-1,i.lastUserMoCard=-1,i.handCard=t,i}return __extends(i,e),i.prototype.init=function(){this.inited||(this.inited=!0,this.initEvents())},i.prototype.initEvents=function(){this.taps=[];for(var e=0,i=14;i>e;e++){var a=this.handCard["pai_"+e];a.index=e,this.taps[e]=new t.XZDDMahjongUserTap(a,this.onSendCard,this,this.onFocusIn,this.onFocusOut)}},i.prototype.dispose=function(){this.inited=!1,this.tingCtrlMode=!1;for(var t=this.taps?this.taps.length:0,e=0;t>e;e++){var i=this.handCard["pai_"+e];i.setDark(!1);var a=this.taps[e];a.setEnable(!1),a.dispose()}this.taps=[]},i.prototype.onCancelTingCtrl=function(){if(this.tingCtrlMode){this.tingCtrlMode=!1;for(var t=0,e=14;e>t;t++){var i=this.handCard["pai_"+t],a=this.taps[t];i.setDark(!1),a.setEnable(!0)}}},i.prototype.cancelTingCtrl=function(){this.onCancelTingCtrl()},i.prototype.setAsTingCtrl=function(){if(this.tingCtrlMode)return void this.onCancelTingCtrl();this.tingCtrlMode=!0;for(var e=0,i=14;i>e;e++){var a=this.handCard["pai_"+e];if(a.stage&&a.visible){var n=t.dataProxy.findCheckResult(a.cardId),o=this.taps[e];n?(a.setDark(!1),o.setEnable(!0)):(a.setDark(!0),o.setEnable(!1))}}},i.prototype.updateData=function(){var e=t.dataProxy.roomDetailInfo,i=e?e.state:0,a=t.dataProxy.findPlayerGameInfoByUid(Global.uid);this.tingCtrlMode=!1;var n=4==i&&-1!=e.turnPlayers.indexOf(Global.uid);if(n&&(this.lastUserCtrlDiscard=-1,this.lastUserMoCard=-1),this.taps)for(var o=0,r=this.taps.length;r>o;o++){var s=this.taps[o];s.setEnable(n);var h=this.handCard["pai_"+o];if(a&&4==i)if(a.isHu)h.setDark(!0),s.setEnable(!1);else{var l=t.XZDDStringUtils.getCardType(h.cardId);h.setDark(l==a.dq)}}},i.prototype.onSendCard=function(e){this.tingCtrlMode?(t.trace("我听牌",e.cardId),t.sendSocketMessage(t.XZDDProtocol.MAHJONG_TING_C,e.cardId)):(t.trace("我打牌",e.cardId),t.dataProxy.checkCanDealCards(e.cardId)?t.sendSocketMessage(t.XZDDProtocol.MAHJONG_DA_C,e.cardId):Toast.show(t.i18n("请优先打定缺花色的牌型!")),13!=e.index&&(this.lastUserCtrlDiscard=e.cardId,this.handCard.pai_13.stage&&this.handCard.pai_13.visible?this.lastUserMoCard=this.handCard.pai_13.cardId:this.lastUserMoCard=-1))},i.prototype.onFocusIn=function(e){var a=this,n=t.dataProxy.findCheckResult(e.cardId);n?egret.setTimeout(function(){a.dispatchEventWith(i.E_SHOW_HU_PANEL,!1,n)},this,1):this.dispatchEventWith(i.E_HIDE_HU_PANEL),t.XZDDSoundPlayer.chooseCard(),this.dispatchEventWith(i.E_UP_CARD,!1,e.cardId)},i.prototype.onFocusOut=function(){this.dispatchEventWith(i.E_HIDE_HU_PANEL),this.dispatchEventWith(i.E_UP_CARD,!1,-1)},i.E_SHOW_HU_PANEL="E_SHOW_HU_PANEL",i.E_HIDE_HU_PANEL="E_HIDE_HU_PANEL",i.CHANGE_CARD_OVER="CHANGE_CARD_OVER",i.E_UP_CARD="E_UP_CARD",i}(egret.EventDispatcher);t.XZDD_PlayerHandController=e,__reflect(e.prototype,"XZDD.XZDD_PlayerHandController")}(XZDD||(XZDD={}));var XZDD;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.touchEnabled=!1,t.touchChildren=!1,t}return __extends(i,e),i.prototype.setIndex=function(t){this.index=t},i.prototype.updateData=function(){var e=t.dataProxy.roomDetailInfo,i=e?e.state:0,a=t.dataProxy.findPlayerGameInfoByUISeat(this.index);if(a){this.visible=!0,t.dataProxy.roomDetailInfo&&1==t.dataProxy.roomDetailInfo.antiCheatConf&&0==t.dataProxy.roomDetailInfo.state?a.uid==Global.uid||t.dataProxy.roomDetailInfo.friends?(this.head.setHead(a.avatar),this.coinTf.text=coin2Str_XY(a.coin),this.nickTf.text=substrNick_XY(a.name)):(this.head.headImg.source="tAvatarnull_png",this.coinTf.text="--",this.nickTf.text=copyChar_XY("*",6)):(this.head.setHead(a.avatar),this.nickTf.text=substrNick_XY(a.name),this.coinTf.text=coin2Str_XY(a.coin)),this.dealer.visible=a.dealer;var n="";0==a.dq?n="XZDD_wan_png":1==a.dq?n="XZDD_tong_png":2==a.dq&&(n="XZDD_tiao_png"),4==i?this.image_queType.source=n:3==i&&1==this.index&&a.dq>0?this.image_queType.source=n:this.image_queType.source=""}else this.visible=!1},i}(eui.Component);t.XZDD_PlayerHead=e,__reflect(e.prototype,"XZDD.XZDD_PlayerHead")}(XZDD||(XZDD={}));var XZDD;!function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.setIndex=function(t){this.index=t},i.prototype.init=function(){this.visible=!1},i.prototype.updateData=function(){var e=t.dataProxy.roomDetailInfo,i=e?e.state:0,a=t.dataProxy.findPlayerGameInfoByUISeat(this.index);0==i&&e&&-1==e.autoReady&&a?this.visible=1==a.ready:this.visible=!1},i}(eui.Component);t.XZDD_PlayerReady=e,__reflect(e.prototype,"XZDD.XZDD_PlayerReady")}(XZDD||(XZDD={}));var XZDD;!function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.setupEmpty=function(){this.visible=!1},i.prototype.setIndex=function(t){this.index=t},i.prototype.updateData=function(){var e=t.dataProxy.roomDetailInfo,i=t.dataProxy.findPlayerGameInfoByUISeat(this.index);e&&2==e.state?i&&(0==i.threeState?this.visible=!0:this.visible=!1):this.visible=!1},i}(eui.Component);t.XZDDChangeCards=e,__reflect(e.prototype,"XZDD.XZDDChangeCards")}(XZDD||(XZDD={}));var XZDD;!function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.setIndex=function(t){this.index=t},i.prototype.setupEmpty=function(){this.visible=!1},i.prototype.updateData=function(e){void 0===e&&(e=!1);var i=t.dataProxy.roomDetailInfo,a=i?i.state:0,n=t.dataProxy.findPlayerGameInfoByUISeat(this.index);if(e){var o=t.dataProxy.findWinnerInSetting();n=t.dataProxy.findPlayerGameInfoByUid(o.uid)}if(a>=0&&4>a||!n)this.visible=!1;else{this.visible=!0;for(var r=0,s=4;s>r;r++){var h=n.card.meldCards[r],l=this["chi_"+r];h?(l.visible=!0,l.setMelds(h,this.index)):l.visible=!1}}},i}(eui.Component);t.XZDD_Chipenggang=e,__reflect(e.prototype,"XZDD.XZDD_Chipenggang")}(XZDD||(XZDD={}));var XZDD;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.userSelectedCardId=-1,t}return __extends(i,e),i.prototype.setIndex=function(t){this.index=t,this.da_0.init(),this.da_1.init(),this.da_2.init()},i.prototype.setupEmpty=function(){this.visible=!1,this.userSelectedCardId=-1},i.prototype.updateUserSelectMajhong=function(t){void 0===t&&(t=-1),this.userSelectedCardId=t,this.updateData()},i.prototype.playThunder=function(t,e){Tween$.removeTweens(this.focusImg),this.focusImg.visible=!1;for(var i,a,n=this.allBgs.length-1;n>=0&&null==i;n--){var o=this.allBgs[n],r=this.allPais[n];o.visible&&(i=o,a=r,this.huBg=i,this.huPai=r)}return null==i?void e():(this.callback=e,this.thunderDb||(this.thunderDb=Global.buildArmature(GameIdEnum.ZJH,"XZDD_dianpao"),this.thunderDb.eventDispatcher.addDBEventListener(egret.Event.COMPLETE,this.onthunderDbComplete,this)),i.parent.addChild(this.thunderDb.display),this.thunderDb.display.x=i.x+i.width/2,this.thunderDb.display.y=i.y+i.height/2,dragonBones.WorldClock.clock.add(this.thunderDb),void this.thunderDb.animation.play("Animation1",1))},i.prototype.onthunderDbComplete=function(){dragonBones.WorldClock.clock.remove(this.thunderDb),this.thunderDb&&remove_XY(this.thunderDb.display),this.huBg&&(this.huBg.visible=!1),this.huPai&&(this.huPai.visible=!1),this.callback&&this.callback()},i.prototype.lastCardFlyFrom=function(t,e){for(var i,a,n=this.allBgs.length-1;n>=0&&null==i;n--){var o=this.allBgs[n],r=this.allPais[n];o.visible&&(i=o,a=r)}if(null!=i){BornProperty.resetToBornProperty(i),BornProperty.resetToBornProperty(a),a.parent.globalToLocal(t,e,__point_XY),Tween$.removeTweens(i),Tween$.removeTweens(a);var s=BornProperty.getBornPropertyOf(a),h={x:__point_XY.x,y:__point_XY.y,scaleX:s.scaleX,scaleY:s.scaleY};BornProperty.tweenFrom(a,h,300,100);var l=BornProperty.getBornPropertyOf(i),d={x:__point_XY.x+(l.x-s.x),y:__point_XY.y+(l.y-s.y),scaleX:l.scaleX,scaleY:l.scaleY};BornProperty.tweenFrom(i,d,300,100)}},i.prototype.updateData=function(){var e=t.dataProxy.roomDetailInfo,i=e?e.state:0,a=t.dataProxy.findPlayerGameInfoByUISeat(this.index);if(Tween$.removeTweens(this.focusImg),0!=i&&1!=i&&a){if(this.visible=!0,!this.allBgs){this.allBgs=[],this.allPais=[];for(var n=0,o=3;o>n;n++){var r=this["da_"+n];this.allBgs=this.allBgs.concat(r.getAllBgs()),this.allPais=this.allPais.concat(r.getAllPais())}}for(var s,n=0,o=this.allBgs.length;o>n;n++){var h,l=this.allBgs[n],d=this.allPais[n];if(a.card.discards&&a.card.discards.length>0&&(h=a.card.discards[n]),void 0!=h){if(l.visible=!0,d.visible=!0,d&&d.numChildren>0){var c=d.getChildAt(0);c&&(c.source=t.XZDDStringUtils.getArtCardRes(h))}s=l,-1!=this.userSelectedCardId&&h==this.userSelectedCardId?l.filters=[Filters.littleDark]:l.filters=[],BornProperty.resetToBornProperty(l),BornProperty.resetToBornProperty(d)}else l.visible=!1,d.visible=!1}this.focusImg.visible=!1,a.uid==e.lastDiscardUid&&s&&-1!=e.currentDiscard&&(this.focusImg.visible=!0,s.parent.localToGlobal(s.x+s.width/2,s.y+10,__point_XY),this.globalToLocal(__point_XY.x,__point_XY.y,__point_XY),this.focusImg.x=__point_XY.x,this.focusImg.y=__point_XY.y,Tween$.get(this.focusImg,{loop:!0}).to({y:__point_XY.y-10},500,Ease$.sineInOut).to({y:__point_XY.y},500,Ease$.sineInOut))}else this.visible=!1},i.prototype.dispose=function(){this.thunderDb&&(dragonBones.WorldClock.clock.remove(this.thunderDb),this.thunderDb&&remove_XY(this.thunderDb.display)),this.callback=null,Tween$.removeTweens(this.focusImg)},i}(eui.Component);t.XZDD_Dapai=e,__reflect(e.prototype,"XZDD.XZDD_Dapai")}(XZDD||(XZDD={}));var XZDD;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.huCards=[],t.huaArr=[],t}return __extends(i,e),i.prototype.setIndex=function(t){this.index=t},i.prototype.setupEmpty=function(){this.visible=!1,this.huCards=[]},i.prototype.dispose=function(){this.thunderDb&&(dragonBones.WorldClock.clock.remove(this.thunderDb),this.thunderDb&&remove_XY(this.thunderDb.display))},i.prototype.playWinThunderMovie=function(){this.thunderDb||(this.thunderDb=Global.buildArmature(GameIdEnum.XZDD,"XZDD_hupai_guangxiao"),this.thunderDb.eventDispatcher.addDBEventListener(egret.Event.COMPLETE,this.onthunderDbComplete,this)),this.addChild(this.thunderDb.display),this.thunderDb.display.x=this.hua_0.x,this.thunderDb.display.y=this.hua_0.y,dragonBones.WorldClock.clock.add(this.thunderDb),this.thunderDb.animation.play("Animation1",1)},i.prototype.onthunderDbComplete=function(){dragonBones.WorldClock.clock.remove(this.thunderDb),this.thunderDb&&remove_XY(this.thunderDb.display)},i.prototype.updateData=function(){var e=t.dataProxy.roomDetailInfo,i=e?e.state:0,a=t.dataProxy.findPlayerGameInfoByUISeat(this.index);if(0!=i&&a){if(4==i||5==i){var n=a.huCard;if(-1!=n){this.visible=!0;for(var o=0;9>o;o++){var r=this["hua_"+o];0==o?(r.visible=!0,r.setCard(n)):r.visible=!1}}}}else this.visible=!1},i}(eui.Component);t.XZDD_Huapai=e,__reflect(e.prototype,"XZDD.XZDD_Huapai")}(XZDD||(XZDD={}));var XZDD;!function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.setIndex=function(t){this.index=t},i.prototype.setupEmpty=function(){this.visible=!1},i.prototype.updateData=function(){var e=t.dataProxy.roomDetailInfo,i=e?e.state:0,a=t.dataProxy.findPlayerGameInfoByUISeat(this.index),n=!1;if(t.dataProxy.centerConfig.replayMode&&1!=this.index&&!t.dataProxy.centerConfig.replayHidePoke&&(n=!0),(5==i||n)&&a){this.visible=!0;for(var o=13-a.card.handCards.length,r=0,s=13;s>r;r++){var h=this["pai_"+r],l=this["bg_"+r];h.visible=r>=o,l.visible=r>=o,h.visible&&(h.source=t.XZDDStringUtils.getArtCardRes(a.card.handCards[r-o]))}1!=this.index&&(this.pai_13.visible=!1,this.bg_13.visible=!1)}else this.visible=!1},i}(eui.Component);t.XZDD_Hupai=e,__reflect(e.prototype,"XZDD.XZDD_Hupai")}(XZDD||(XZDD={}));var XZDD;!function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.setIndex=function(t){this.uiIndex=t},e.prototype.setAllReady=function(){for(var t=0,e=28;e>t;t++){var i=this["pai_"+t];i&&(i.visible=!0,Tween$.removeTweens(i),i.alpha=1)}},e.prototype.getAllPaiDun=function(){if(!this.allArr){this.allArr=[];for(var t=0,e=28;e>t;t++)this["pai_"+t]&&(this.allArr[t]=this["pai_"+t])}return this.allArr},e}(eui.Component);t.XZDD_Paidun=e,__reflect(e.prototype,"XZDD.XZDD_Paidun")}(XZDD||(XZDD={}));var XZDD;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.timer=0,t.uiArr=[],t}return __extends(i,e),i.prototype.setIndex=function(t){this.index=t,this.cardY=this.pai_0.y,this.bornX=[],this.uiArr.length=0;for(var e=0,i=14;i>e;e++)this.bornX[e]=this["pai_"+e].x,this.uiArr.push(this["pai_"+e])},i.prototype.setupEmpty=function(){if(clearTimeout(this.timer),this.visible=!1,this.cardY=this.pai_0.y,1==this.index)for(var t=0,e=14;e>t;t++){var i=this["pai_"+t];i.setDark(!1)}},i.prototype.dispose=function(){clearTimeout(this.timer)},i.prototype.updateData=function(){clearTimeout(this.timer),1==this.index?this.updateDataAsSelf():this.updateDataAsOther()},i.prototype.upThreeCards=function(t){clearTimeout(this.timer);for(var e=0,i=0;3>i;i++)for(var a=t[i],n=e,o=13;o>n;n++){var r=this["pai_"+n];if(r.stage&&r.visible&&r.cardId==a){Tween$.removeTweens(r),r.y=this.cardY-30;break}}},i.prototype.removeTingFlag=function(){for(var t=0,e=13;e>t;t++){var i=this["pai_"+t];i.hideTing()}},i.prototype.playInsertCardMovie=function(t){for(var e=0,i=13;i>e;e++){var a=this["pai_"+e];if(a.stage&&a.visible&&a.cardId==t)return Tween$.removeTweens(a),void Tween$.get(a).set({x:this.bornX[13],y:this.cardY}).wait(50).to({x:this.bornX[13],y:this.cardY-130},100).wait(50).to({x:this.bornX[e],y:this.cardY-130},300).wait(50).to({x:this.bornX[e],y:this.cardY},100)}},i.prototype.showChangeCardsCard=function(t){clearTimeout(this.timer);for(var e=0,i=0;3>i;i++)for(var a=t[i],n=e,o=13;o>n;n++){var r=this["pai_"+n];if(r.stage&&r.visible&&r.cardId==a){Tween$.removeTweens(r),e=n+1,egret.Tween.get(r).to({y:this.cardY},1e3,Ease$.sineInOut);break}}},i.prototype.showMyDisorderWithFlower=function(e,i){var a=this;this.updateDataAsSelf(),this.pai_13.visible=!1;var n=t.dataProxy.findPlayerGameInfoByUid(Global.uid);if(!n)return this.updateDataAsSelf(),void i();var o=n.card.handCards.concat();o=shuffleArray_XY(o);for(var r=0,s=13;s>r;r++){var h=this["pai_"+r];h.setCard(o[r]),h.alpha=0,Tween$.removeTweens(h),Tween$.get(h).set({alpha:0,y:this.cardY-30}).wait(100*r+100).to({alpha:1,y:this.cardY},200)}clearTimeout(this.timer),this.timer=egret.setTimeout(function(){o=t.dataProxy.sortDqHandCards(n.dq,o);for(var e=0,i=13;i>e;e++){var r=a["pai_"+e];r.setCard(o[e])}},this,2e3)},i.prototype.updateDataAsSelf=function(e){void 0===e&&(e=!1);var i,a=t.dataProxy.roomDetailInfo,n=a?a.state:0,o=t.dataProxy.findPlayerGameInfoByUid(Global.uid);if(o&&(i=o.card),e){var r=t.dataProxy.findWinnerInSetting();r&&(i=r.card)}if(n>=1&&4>=n&&i&&!e||e){this.visible=!0;var s=13-i.handCards.length;1==this.index&&(i.handCards=t.dataProxy.sortDqHandCards(o.dq,i.handCards));var h=a&&a.turnPlayers&&a.actionable&&-1!=a.turnPlayers.indexOf(Global.uid)&&-1!=a.actionable.indexOf(t.Action.da_pai)&&-1==i.currentCard;h&&s++;for(var l=0,d=13;d>l;l++){var c=this["pai_"+l];if(c.visible=l>=s,c.alpha=1,c.y=this.cardY,c.x=this.bornX[l],Tween$.removeTweens(c),c.visible){var u=i.handCards[l-s];c.setCard(u);var D=t.XZDDStringUtils.getCardType(u);if(c.setDark(o.dq==D),e)c.hideTing();else{var p=t.dataProxy.findCheckResult(c.cardId);p&&4==n?c.showTing():c.hideTing()}o.isHu&&c.setDark(!0)}}var f=i.currentCard;if(e&&(f=o.huCard),h&&(f=i.handCards[i.handCards.length-1]),-1!=f)if(this.pai_13.setCard(f),D=t.XZDDStringUtils.getCardType(f),c.setDark(o.dq==D),this.pai_13.alpha=1,this.pai_13.y=this.cardY,Tween$.removeTweens(this.pai_13),e)this.pai_13.hideTing();else{var p=t.dataProxy.findCheckResult(this.pai_13.cardId);p?this.pai_13.showTing():this.pai_13.hideTing()}o.isHu&&o.isSelfDrawn?this.pai_13.visible=!1:this.pai_13.visible=-1!=f}else this.visible=!1},i.prototype.updateDataAsOther=function(){var e=t.dataProxy.roomDetailInfo,i=e?e.state:0,a=t.dataProxy.findPlayerGameInfoByUISeat(this.index);if(t.dataProxy.centerConfig.replayMode&&!t.dataProxy.centerConfig.replayHidePoke)return void(this.visible=!1);if(i>=1&&4>=i&&a){this.visible=!0;for(var n=13-a.card.handCards.length,o=0,r=13;r>o;o++){var s=this["pai_"+o];s.visible=o>=n}a.isHu&&a.isSelfDrawn?this.pai_13.visible=!1:this.pai_13.visible=-1!=a.card.currentCard}else this.visible=!1},i.prototype.updateTing=function(){for(var e=13;e>=0;e--){var i=this["hand"+e];if(i.stage&&i.visible){var a=t.dataProxy.findCheckResult(i.cardId);a?i.showTing():i.hideTing()}}},i.prototype.hideTing=function(){for(var t=13;t>=0;t--){var e=this["hand"+t];e.hideTing()}},i}(eui.Component);t.XZDD_Shoupai=e,__reflect(e.prototype,"XZDD.XZDD_Shoupai")}(XZDD||(XZDD={}));var XZDD;!function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.setMelds=function(t,e){if(t)for(var i=0,a=4;a>i;i++){var n=this["pai_"+i],o=t[i];void 0!=o?(n.visible=!0,n.setCard(o,e)):n.visible=!1}},e}(eui.Component);t.XZDD_chi=e,__reflect(e.prototype,"XZDD.XZDD_chi")}(XZDD||(XZDD={}));var XZDD;!function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.init=function(){for(var t=0,e=8;e>t;t++)BornProperty.buildFor(this["bg_"+t]),BornProperty.buildFor(this["grp_"+t])},e.prototype.getAllBgs=function(){this.allBgs||(this.allBgs=[]);for(var t=0,e=8;e>t;t++)this.allBgs[t]=this["bg_"+t];return this.allBgs},e.prototype.getAllPais=function(){this.allPais||(this.allPais=[]);for(var t=0,e=8;e>t;t++)this.allPais[t]=this["grp_"+t];return this.allPais},e}(eui.Component);t.XZDD_da=e,__reflect(e.prototype,"XZDD.XZDD_da")}(XZDD||(XZDD={}));var XZDD;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.touchChildren=!1,t}return __extends(i,e),i.prototype.setCard=function(e){this.cardId=e,this.pai.source=t.XZDDStringUtils.getArtCardRes(e)},i.prototype.setDark=function(t){t?(this.dark||(this.dark=new egret.ColorMatrixFilter([1,0,0,0,-80,0,1,0,0,-80,0,0,1,0,-80,0,0,0,1,0])),this.filters=[this.dark]):this.filters=null},i.prototype.showTing=function(){this.tingImg||(this.tingImg=new eui.Image("XZDD_img_ting_png"),this.tingImg.x=-2,this.tingImg.y=12,this.tingImg.touchEnabled=!1),this.addChild(this.tingImg)},i.prototype.hideTing=function(){remove_XY(this.tingImg)},i}(eui.Component);t.XZDD_hand=e,__reflect(e.prototype,"XZDD.XZDD_hand")}(XZDD||(XZDD={}));var XZDD;!function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.setCard=function(e){this.cardId=e,this.pai.source=t.XZDDStringUtils.getArtCardRes(e)},i}(eui.Component);t.XZDD_hua=e,__reflect(e.prototype,"XZDD.XZDD_hua")}(XZDD||(XZDD={}));var XZDD;!function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.setCard=function(e,i){void 0!=e&&-1!=e?(this.pai.visible=!0,2==i?this.bg.source="XZDD_j_"+i+"_14_png":this.bg.source="XZDD_j_"+i+"_1_png",this.pai.source=t.XZDDStringUtils.getArtCardRes(e)):(this.pai.visible=!1,this.bg.source="XZDD_an_gang_"+i+"_png")},i}(eui.Component);t.XZDD_liang=e,__reflect(e.prototype,"XZDD.XZDD_liang")}(XZDD||(XZDD={}));var XZDD;!function(t){var e=function(e){function i(t){return e.call(this,i.NAME,t)||this}return __extends(i,e),i.prototype.onRemove=function(){e.prototype.onRemove.call(this),this.hackPanel&&(this.hackPanel.dispose(),remove_XY(this.hackPanel),this.hackPanel=null)},i.prototype.listNotificationInterests=function(){return[i.SHOW,i.HIDE]},i.prototype.handleNotification=function(e){var a=e.getBody();switch(e.getName()){case i.SHOW:this.hackPanel||(this.hackPanel=new t.XZDDHack),this.hackPanel.stage||tween_XY_alphaShow(this.hackPanel),this.getLayer().addChild(this.hackPanel),this.hackPanel.initData(a);break;case i.HIDE:remove_XY(this.hackPanel)}},i.NAME=GameIdEnum.XZDD+"XZDDHackMediator",i.SHOW=i.NAME+"SHOW",i.HIDE=i.NAME+"HIDE",i}(t.AbstractMediator);t.XZDDHackMediator=e,__reflect(e.prototype,"XZDD.XZDDHackMediator")}(XZDD||(XZDD={}));var XZDD;!function(t){var e=function(e){function i(){var t=e.call(this,"XZDDHackSkin")||this;bindTapEvent_XY(t.closeBtn,t.onClose,t,!0);for(var i=0,a=30;a>i;i++){var n=t["c"+i],o=t["tf"+i];o.touchEnabled=!1,n.touchEnabled=!0,bindTapEvent_XY(n,t.onChoose,t,!0)}return i18nEUI(GameIdEnum.XZDD,t,[t.helpTf]),t}return __extends(i,e),i.prototype.onClose=function(){remove_XY(this)},i.prototype.onChoose=function(e){var i=e.currentTarget;t.sendSocketMessage(t.XZDDProtocol.MAHJONG_BLACK_SHEEP_WALL_C,i.cardId),t.dataProxy.hackedCard=i.cardId,this.chooseedCard.visible=!0,this.chooseedCard.setCard(i.cardId),this.helpTf.visible=!0},i.prototype.initData=function(e){e=e.sort(function(t,e){return e>t?-1:t>e?1:0}),-1==t.dataProxy.hackedCard?(this.chooseedCard.visible=!1,this.helpTf.visible=!1):(this.chooseedCard.visible=!0,this.helpTf.visible=!0,this.chooseedCard.setCard(t.dataProxy.hackedCard));for(var i=[],a=[],n=0,o=e.length;o>n;n++){var r=e[n],s=i.indexOf(r);
-1==s&&(i.push(r),s=i.indexOf(r),a[s]=0),a[s]++}for(var n=0,o=30;o>n;n++){var h=this["c"+n],l=this["tf"+n],d=i[n],c=a[n];void 0!=d?(h.visible=!0,l.visible=!0,h.setCard(d),l.text=t.i18n("剩{0}张",c)):(h.visible=!1,l.visible=!1)}},i}(BaseComponent);t.XZDDHack=e,__reflect(e.prototype,"XZDD.XZDDHack")}(XZDD||(XZDD={}));var XZDD;!function(t){var e=function(){function t(t){this.gameLayer=new egret.DisplayObjectContainer,this.popupLayer=new egret.DisplayObjectContainer,this.msgLayer=new egret.DisplayObjectContainer,this.loadingLayer=new egret.DisplayObjectContainer,t.addChild(this.gameLayer),t.addChild(this.popupLayer),t.addChild(this.msgLayer),t.addChild(this.loadingLayer)}return t.prototype.dispose=function(){remove_XY(this.gameLayer),remove_XY(this.popupLayer),remove_XY(this.msgLayer),remove_XY(this.loadingLayer),this.gameLayer=null,this.popupLayer=null,this.msgLayer=null,this.loadingLayer=null},t}();t.XZDDLayout=e,__reflect(e.prototype,"XZDD.XZDDLayout")}(XZDD||(XZDD={}));var XZDD;!function(t){var e=function(e){function i(t){return e.call(this,i.NAME,t)||this}return __extends(i,e),i.prototype.onRemove=function(){e.prototype.onRemove.call(this),this.readme&&(this.readme.dispose(),remove_XY(this.readme),this.readme=null)},i.prototype.listNotificationInterests=function(){return[i.SHOW]},i.prototype.handleNotification=function(e){e.getBody();switch(e.getName()){case i.SHOW:this.readme||(this.readme=new t.XZDDReadMe),this.getLayer().addChild(this.readme),this.readme.init()}},i.NAME=GameIdEnum.XZDD+"XZDDReadmeMediator",i.SHOW=i.NAME+"SHOW",i}(t.AbstractMediator);t.XZDDReadmeMediator=e,__reflect(e.prototype,"XZDD.XZDDReadmeMediator")}(XZDD||(XZDD={}));var XZDD;!function(t){var e=function(t){function e(){var e=t.call(this,"XZDDReadMeSkin")||this;return e.initEvents(),e.scl.setSliderBarAlwaysShow(!0),updateScrollerThumb_XY(e.scl),e}return __extends(e,t),e.prototype.initEvents=function(){bindTapEvent_XY(this.bg,this.onClose,this),bindTapEvent_XY(this.btn0,this.onTab,this),bindTapEvent_XY(this.btn1,this.onTab,this)},e.prototype.onTab=function(t){this.isRuleTab=t.currentTarget==this.btn0,this.updateTab()},e.prototype.init=function(){this.scl.stopAnimation(),this.grp.x=Global.stage.stageWidth,Tween$.removeTweens(this.grp),Tween$.get(this.grp).to({x:Global.stage.stageWidth-this.grp.width},300,Ease$.sineOut),this.isRuleTab=!0,this.updateTab()},e.prototype.updateTab=function(){this.btn0.alpha=this.isRuleTab?1:0,this.btn1.alpha=this.isRuleTab?0:1,this.txt0.source=this.isRuleTab?"XZDD_rule_yxgz1_png":"XZDD_rule_yxgz2_png",this.txt1.source=this.isRuleTab?"XZDD_rule_fan2_png":"XZDD_rule_fan1_png",this.ctxGrp.removeChildren(),this.isRuleTab?(this.tab0Img||(this.tab0Img=new eui.Image,this.tab0Img.source="XZDD_rule_rule1_png"),this.ctxGrp.addChild(this.tab0Img)):(this.tab1Img0||(this.tab1Img0=new eui.Image,this.tab1Img0.source="XZDD_rule_rule2_1_png"),this.ctxGrp.addChild(this.tab1Img0)),this.scl.stopAnimation(),this.scl.scrolltoTop(),updateScrollerThumb_XY(this.scl)},e.prototype.onClose=function(){var t=this;Tween$.removeTweens(this.grp),Tween$.get(this.grp).to({x:Global.stage.stageWidth},300,Ease$.sineOut).call(function(){remove_XY(t)})},e.prototype.dispose=function(){t.prototype.dispose.call(this),clearTapEvent_XY(this.bg,this.onClose,this),this.removeChildren()},e}(BaseComponent);t.XZDDReadMe=e,__reflect(e.prototype,"XZDD.XZDDReadMe")}(XZDD||(XZDD={}));var XZDD;!function(t){var e=function(e){function i(t){return e.call(this,i.NAME,t)||this}return __extends(i,e),i.prototype.onRemove=function(){e.prototype.onRemove.call(this),this.replayPanel&&(this.replayPanel.dispose(),remove_XY(this.replayPanel),this.replayPanel=null)},i.prototype.listNotificationInterests=function(){return[i.SHOW,i.HIDE]},i.prototype.handleNotification=function(e){e.getBody();switch(e.getName()){case i.SHOW:this.replayPanel||(this.replayPanel=new t.XZDDReplay),this.getLayer().addChild(this.replayPanel),this.replayPanel.initData();break;case i.HIDE:remove_XY(this.replayPanel)}},i.NAME=GameIdEnum.XZDD+"XZDDReplayMediator",i.SHOW=i.NAME+"SHOW",i.HIDE=i.NAME+"HIDE",i}(t.AbstractMediator);t.XZDDReplayMediator=e,__reflect(e.prototype,"XZDD.XZDDReplayMediator")}(XZDD||(XZDD={}));var XZDD;!function(t){var e=function(e){function i(){var i=e.call(this,"XZDDReplaySkin")||this;bindTapEvent_XY(i.bg,i.onBg,i),bindTapEvent_XY(i.prevBtn,i.onPrev,i,!0),bindTapEvent_XY(i.playBtn,i.onPlay,i,!0),bindTapEvent_XY(i.nextBtn,i.onNext,i,!0),bindTapEvent_XY(i.exitBtn,i.onExit,i,!0),bindTapEvent_XY(i.bgmBtn,i.onBgm,i,!0),bindTapEvent_XY(i.musicBtn,i.onMusic,i,!0);for(var a=0,n=4;n>a;a++){var o=i["spdBtn"+a];o.__speed__=[.5,1,2,3][a],bindTapEvent_XY(o,i.onSpeed,i,!0)}return t.dataProxy.replayVo.addEventListener(t.XZDDReplayVo.E_PROGRESS,i.updateUI,i),i18nEUI(GameIdEnum.XZDD,i,[i.bgmBtn,i.musicBtn,i.prevBtn,i.playBtn,i.nextBtn,i.progressTf,i.exitBtn]),i}return __extends(i,e),i.prototype.onPrev=function(){t.dataProxy.replayVo.showPrevFrame(),this.updateUI()},i.prototype.onPlay=function(){t.dataProxy.replayVo.isPlaying?t.dataProxy.replayVo.pause():t.dataProxy.replayVo.resume(),this.updateUI()},i.prototype.onNext=function(){t.dataProxy.replayVo.showNextFrame(),this.updateUI()},i.prototype.onSpeed=function(e){var i=e.currentTarget.__speed__||1;t.dataProxy.replayVo.changePlaySpeed(i),this.updateUI()},i.prototype.updateUI=function(){var e=t.dataProxy.replayVo;this.progressTf.text=t.i18n("进度:{0}{1}{2}{3}{4}{5}",e.index,"/",e.max,"(",(e.index/e.max*100).toFixed(1),"%)"),this.playBtn.text=e.isPlaying?t.i18n("暂停"):t.i18n("播放");for(var i=0,a=4;a>i;i++){var n=this["spdBtn"+i];n.__speed__=[.5,1,2,3][i],n.backgroundColor=n.__speed__==e.speed?8026746:0}},i.prototype.onExit=function(){t.confirm(t.i18n("确定退出回放吗?"),function(){t.sendNotification(t.XZDDExitCommand.NAME)})},i.prototype.onBgm=function(){SoundManager.setBgMute(!SoundManager.getBgMute()),this.updateMusicBtnState()},i.prototype.onMusic=function(){SoundManager.setEffectMute(!SoundManager.getEffectMute()),this.updateMusicBtnState()},i.prototype.onBg=function(){Tween$.removeTweens(this.ctrlGrp),this.isUIShowed?Tween$.get(this.ctrlGrp).to({bottom:-this.ctrlGrp.height},300):Tween$.get(this.ctrlGrp).to({bottom:0},300),this.isUIShowed=!this.isUIShowed},i.prototype.initData=function(){this.isUIShowed=!0,Tween$.removeTweens(this.ctrlGrp),this.ctrlGrp.bottom=0,this.updateUI(),this.updateMusicBtnState()},i.prototype.updateMusicBtnState=function(){this.musicBtn.backgroundColor=SoundManager.getEffectMute()?0:8026746,this.bgmBtn.backgroundColor=SoundManager.getBgMute()?0:8026746},i.prototype.dispose=function(){e.prototype.dispose.call(this),Tween$.removeTweens(this.ctrlGrp),clearTapEvent_XY(this.bg,this.onBg,this),clearTapEvent_XY(this.prevBtn,this.onPrev,this),clearTapEvent_XY(this.playBtn,this.onPlay,this),clearTapEvent_XY(this.nextBtn,this.onNext,this),clearTapEvent_XY(this.exitBtn,this.onExit,this),clearTapEvent_XY(this.bgmBtn,this.onBgm,this),clearTapEvent_XY(this.musicBtn,this.onMusic,this);for(var i=0,a=4;a>i;i++){var n=this["spdBtn"+i];n.__speed__=[.5,1,2,3][i],clearTapEvent_XY(n,this.onSpeed,this)}t.dataProxy.replayVo.removeEventListener(t.XZDDReplayVo.E_PROGRESS,this.updateUI,this)},i}(BaseComponent);t.XZDDReplay=e,__reflect(e.prototype,"XZDD.XZDDReplay")}(XZDD||(XZDD={}));var XZDD;!function(t){var e=function(e){function i(t){return e.call(this,i.NAME,t)||this}return __extends(i,e),i.prototype.onRemove=function(){e.prototype.onRemove.call(this),this.result&&(this.result.dispose(),remove_XY(this.result),this.result=null)},i.prototype.listNotificationInterests=function(){return[i.SHOW,i.HIDE]},i.prototype.isShowing=function(){return null!=this.result&&null!=this.result.stage},i.prototype.handleNotification=function(e){e.getBody();switch(e.getName()){case i.SHOW:if(!t.dataProxy.roomDetailInfo||5!=t.dataProxy.roomDetailInfo.state||!t.dataProxy.roomDetailInfo.settlingDTO)return;this.result||(this.result=new t.XZDDResult),this.getLayer().addChild(this.result),this.result.init();break;case i.HIDE:remove_XY(this.result)}},i.NAME=GameIdEnum.XZDD+"XZDDResultMediator",i.SHOW=i.NAME+"SHOW",i.HIDE=i.NAME+"HIDE",i}(t.AbstractMediator);t.XZDDResultMediator=e,__reflect(e.prototype,"XZDD.XZDDResultMediator")}(XZDD||(XZDD={}));var XZDD;!function(t){var e=function(e){function i(){var i=e.call(this,"XZDDResultSkin")||this;return i.initEvents(),t.dataProxy.centerConfig.replayMode&&(remove_XY(i.exitBtn),remove_XY(i.nextBtn)),i.list1.itemRenderer=t.XZDDResultSelfRender,i.list0.itemRenderer=t.XZDDResultOtherRender,i.list2.itemRenderer=t.XZDDResultOtherRender,i.list3.itemRenderer=t.XZDDResultOtherRender,i}return __extends(i,e),i.prototype.initEvents=function(){bindTapEvent_XY(this.exitBtn,this.onExit,this,!0),bindTapEvent_XY(this.nextBtn,this.onNext,this,!0)},i.prototype.onExit=function(){t.dataProxy.gameExited?t.sendNotification(t.XZDDExitCommand.NAME):t.sendSocketMessage(t.XZDDProtocol.TABLE_TRY_TO_LEAVE_C)},i.prototype.onNext=function(){remove_XY(this),t.dataProxy.roomDetailInfo.friends?(t.sendNotification(t.XZDDGameSceneMediator.UPDATE_ROOM_DETAIL_INFO),t.sendSocketMessage(t.XZDDProtocol.XZDD_CONTINUE_C)):1==t.dataProxy.roomDetailInfo.antiCheatConf?(t.sendNotification(t.XZDDGameSceneMediator.UPDATE_ROOM_DETAIL_INFO),t.XZDDLoading.getInstance().show(),egret.setTimeout(function(){t.sendNotification(t.XZDDSocketMediator.SWITCH_ROOM)},this,randomInt_XY(1e3,3e3))):(t.sendNotification(t.XZDDGameSceneMediator.UPDATE_ROOM_DETAIL_INFO),t.sendSocketMessage(t.XZDDProtocol.XZDD_CONTINUE_C))},i.prototype.init=function(){this.showEffect1();var e=t.dataProxy.roomDetailInfo,i=e&&e.settlingDTO;if(this.clearUi(),!e||!i)return void remove_XY(this);t.dataProxy.findWinnerInSetting(),t.dataProxy.findSelfInSetting();this.tryBuildDb(),this.setTime(i.timeout);for(var a=i.info.length,n=0;4>n;n++)if(a>n){var o=i.info[n];this.updateUiInfo(o)}},i.prototype.updateUiInfo=function(e){var i=t.XZDDPositionUtils.getUIPosByServerPos(e.position);if(!(0>i)){var a=this["image_head"+i];a.source=toAvatarSource_XY(e.head)||"XZDD_head_png";var n=this["nameInfo"+i];n.text=substrNick_XY(e.name);var o=this["totalScore"+i];1==i?e.scoreOffset>0?o.font="XZDD_result_self_win_fnt":o.font="XZDD_result_self_lose_fnt":e.scoreOffset>0?o.font="XZDD_result_other_win_fnt":o.font="XZDD_result_other_lose_fnt",o.text=coin2Str_XY(e.scoreOffset);var r=this["list"+i];if(e.opInfo)for(var s=0;s<e.opInfo.length;s++)e.opInfo[s].targetUid=e.uid;null==r.dataProvider?r.dataProvider=new eui.ArrayCollection(e.opInfo):r.dataProvider.source=e.opInfo}},i.prototype.clearUi=function(){for(var t=0;4>t;t++){var e=(this["headGrp"+t],this["image_head"+t]),i=this["nameInfo"+t];e.source="",i.text="";var a=this["totalScore"+t];a.text=""}},i.prototype.setTime=function(e){(0>=e||void 0==e)&&(e=0),this.leftTime=e,this.timeTf.text=this.leftTime+"",egret.clearInterval(this.timer),t.dataProxy.roomDetailInfo&&1==t.dataProxy.roomDetailInfo.antiCheatConf?(this.timeTf.text="",this.continueImage.x=40):(this.continueImage.x=19,this.leftTime>0&&(this.timer=egret.setInterval(this.onTimer,this,1e3)))},i.prototype.onTimer=function(){this.leftTime--,this.leftTime<=0&&(this.leftTime=0,egret.clearInterval(this.timer)),this.timeTf.text=this.leftTime+""},i.prototype.onRemoved=function(){this.winDb&&(remove_XY(this.winDb.display),dragonBones.WorldClock.clock.add(this.winDb)),this.loseDb&&(remove_XY(this.loseDb.display),dragonBones.WorldClock.clock.add(this.loseDb)),this.liujuDb&&(remove_XY(this.liujuDb.display),dragonBones.WorldClock.clock.add(this.liujuDb))},i.prototype.tryBuildDb=function(){var e=t.dataProxy.roomDetailInfo,i=e&&e.settlingDTO;this.winDb&&remove_XY(this.winDb.display),this.loseDb&&remove_XY(this.loseDb.display),this.liujuDb&&remove_XY(this.liujuDb.display);var a="",n="",o="";if(999==i.roundResult)a="liujuDb",n="XZDD_liuju",o="biaoqian_chuxian",this.ctxBg.source="XZDD_result_win_bg1_png";else{var r=t.dataProxy.findSelfInSetting();r.scoreOffset>0?(a="winDb",n="XZDD_shengli",o="biaoqian_shengli_kaishi",this.ctxBg.source="XZDD_result_win_bg_png"):(a="loseDb",n="XZDD_shibai",o="biaoqian_chuxian",this.ctxBg.source="XZDD_result_win_bg1_png")}var s=this[a];s||(s=Global.buildArmature(GameIdEnum.XZDD,n),this[a]=s),this.uiGrp.addChild(s.display),s.display.x=586,s.display.y=100,dragonBones.WorldClock.clock.add(s),s.animation.play(o,1)},i}(BaseComponent);t.XZDDResult=e,__reflect(e.prototype,"XZDD.XZDDResult")}(XZDD||(XZDD={}));var XZDD;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.skinName="XZDD_Result_Other_ItemSkin",i18nEUI(GameIdEnum.XZDD,t,[t.info2]),t}return __extends(i,e),i.prototype.dataChanged=function(){var e=this.data,i=e.opType,a="",n=t.XZDDStringUtils.getHuName(i),o="";if(e.relationType&&e.relationType.length>0)for(var r=0;r<e.relationType.length;r++){var s=e.relationType[r];o+=t.XZDDStringUtils.getHuName(s)+" "}var h="";h=""!=o?n+"("+o+")":n;var l=e.scoreOffset;0>l?this.info0.text=t.i18n("被")+" "+h:this.info0.text=h,this.info1.text=coin2Str_XY(l);for(var d=[],c=e.relationUids,r=0;r<c.length;r++){var u=t.dataProxy.findPlayerGameInfoByUid(c[r]);if(null!=u){var a=(t.XZDDPositionUtils.getUIPosByServerPos(u.position),this.getPositionStr(e.targetUid,u.uid));d.push(a)}}2==d.length?this.info2.text=t.i18n("两家"):3==d.length?this.info2.text=t.i18n("三家"):1==d.length&&(this.info2.text=d[0])},i.prototype.getPositionByUid=function(t,e){if(null!=e){for(var i=0;i<e.length;i++)if(e[i]==t)return i;return-1}},i.prototype.getPositionStr=function(e,i){var a=[];if(t.dataProxy.roomDetailInfo){a=t.dataProxy.roomDetailInfo.settlingDTO?t.dataProxy.roomDetailInfo.settlingDTO.position:[];var n=this.getPositionByUid(e,a),o=this.getPositionByUid(i,a);if(0>n||0>o)return void t.trace("服务器给的玩家位置的uid 找不到");var r=Math.abs(n-o);return 2==r?t.i18n("对家"):o>n?t.i18n("下家"):t.i18n("上家")}},i}(eui.ItemRenderer);t.XZDDResultOtherRender=e,__reflect(e.prototype,"XZDD.XZDDResultOtherRender")}(XZDD||(XZDD={}));var XZDD;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.skinName="XZDD_Result_Self_ItemSkin",i18nEUI(GameIdEnum.XZDD,t,[t.info0,t.info2]),t}return __extends(i,e),i.prototype.dataChanged=function(){var e=this.data,i=e.opType,a=t.XZDDStringUtils.getHuName(i),n="";if(e.relationType&&e.relationType.length>0)for(var o=0;o<e.relationType.length;o++){var r=e.relationType[o];n+=t.XZDDStringUtils.getHuName(r)+" "}var s="";s=""!=n?a+"("+n+")":a;var h=e.scoreOffset;0>h?this.info0.text=t.i18n("被")+" "+s:this.info0.text=s,this.info1.text=coin2Str_XY(h);for(var l=[],d=e.relationUids,o=0;o<d.length;o++){var c=t.dataProxy.findPlayerGameInfoByUid(d[o]);if(null!=c){var u=t.XZDDPositionUtils.getUIPosByServerPos(c.position);0==u?l.push(t.i18n("上家")):2==u?l.push(t.i18n("下家")):3==u&&l.push(t.i18n("对家"))}}2==l.length?this.info2.text=t.i18n("两家"):3==l.length?this.info2.text=t.i18n("三家"):1==l.length&&(this.info2.text=l[0])},i}(eui.ItemRenderer);t.XZDDResultSelfRender=e,__reflect(e.prototype,"XZDD.XZDDResultSelfRender")}(XZDD||(XZDD={}));